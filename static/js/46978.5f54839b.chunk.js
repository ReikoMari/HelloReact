"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[46978,35617,63391,63733,40998,64826],{35617:(e,t,i)=>{i.r(t),i.d(t,{hydratedAdapter:()=>n});var r=i(76797),s=i(66388),l=i(13904),a=i(65215),o=i(23701);const n={convertToGEGeometry:function(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){const r=e.hasZ(t),s=e.hasM(t),a=new l.A({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(a.z=e.getPointZ(t)),s&&(a.m=e.getPointM(t)),a.cache._geVersion=t,a},exportPolygon:function(e,t,i){const r=new a.A({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportPolyline:function(e,t,i){const r=new o.A({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportMultipoint:function(e,t,i){const r=new s.A({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r},exportExtent:function(e,t,i){const s=e.hasZ(t),l=e.hasM(t),a=new r.A({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(s){const i=e.getZExtent(t);a.zmin=i.vmin,a.zmax=i.vmax}if(l){const i=e.getMExtent(t);a.mmin=i.vmin,a.mmax=i.vmax}return a.cache._geVersion=t,a}}},63391:(e,t,i)=>{i.r(t),i.d(t,{buffer:()=>F,changeDefaultSpatialReferenceTolerance:()=>U,clearDefaultSpatialReferenceTolerance:()=>j,clip:()=>o,contains:()=>c,convexHull:()=>b,crosses:()=>u,cut:()=>n,densify:()=>O,difference:()=>A,disjoint:()=>y,distance:()=>d,equals:()=>h,extendedSpatialReferenceInfo:()=>a,flipHorizontal:()=>x,flipVertical:()=>K,generalize:()=>L,geodesicArea:()=>Z,geodesicBuffer:()=>k,geodesicDensify:()=>B,geodesicLength:()=>D,intersect:()=>S,intersectLinesToPoints:()=>V,intersects:()=>p,isSimple:()=>w,nearestCoordinate:()=>C,nearestVertex:()=>G,nearestVertices:()=>I,offset:()=>M,overlaps:()=>m,planarArea:()=>H,planarLength:()=>E,relate:()=>f,rotate:()=>P,simplify:()=>_,symmetricDifference:()=>T,touches:()=>g,union:()=>R,within:()=>v});var r=i(52612),s=i(35617);function l(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function a(e){return r.G.extendedSpatialReferenceInfo(e)}function o(e,t){return r.G.clip(s.hydratedAdapter,l(e),e,t)}function n(e,t){return r.G.cut(s.hydratedAdapter,l(e),e,t)}function c(e,t){return r.G.contains(s.hydratedAdapter,l(e),e,t)}function u(e,t){return r.G.crosses(s.hydratedAdapter,l(e),e,t)}function d(e,t,i){return r.G.distance(s.hydratedAdapter,l(e),e,t,i)}function h(e,t){return r.G.equals(s.hydratedAdapter,l(e),e,t)}function p(e,t){return r.G.intersects(s.hydratedAdapter,l(e),e,t)}function g(e,t){return r.G.touches(s.hydratedAdapter,l(e),e,t)}function v(e,t){return r.G.within(s.hydratedAdapter,l(e),e,t)}function y(e,t){return r.G.disjoint(s.hydratedAdapter,l(e),e,t)}function m(e,t){return r.G.overlaps(s.hydratedAdapter,l(e),e,t)}function f(e,t,i){return r.G.relate(s.hydratedAdapter,l(e),e,t,i)}function w(e){return r.G.isSimple(s.hydratedAdapter,l(e),e)}function _(e){return r.G.simplify(s.hydratedAdapter,l(e),e)}function b(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.G.convexHull(s.hydratedAdapter,l(e),e,t)}function A(e,t){return r.G.difference(s.hydratedAdapter,l(e),e,t)}function T(e,t){return r.G.symmetricDifference(s.hydratedAdapter,l(e),e,t)}function S(e,t){return r.G.intersect(s.hydratedAdapter,l(e),e,t)}function R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r.G.union(s.hydratedAdapter,l(e),e,t)}function M(e,t,i,a,o,n){return r.G.offset(s.hydratedAdapter,l(e),e,t,i,a,o,n)}function F(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r.G.buffer(s.hydratedAdapter,l(e),e,t,i,a)}function k(e,t,i,a,o,n){return r.G.geodesicBuffer(s.hydratedAdapter,l(e),e,t,i,a,o,n)}function C(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r.G.nearestCoordinate(s.hydratedAdapter,l(e),e,t,i)}function G(e,t){return r.G.nearestVertex(s.hydratedAdapter,l(e),e,t)}function I(e,t,i,a){return r.G.nearestVertices(s.hydratedAdapter,l(e),e,t,i,a)}function N(e){var t,i;return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e&&null!==(t=null===(i=e.extent)||void 0===i?void 0:i.center)&&void 0!==t?t:null}function P(e,t,i){var s;if(null==e)throw new z;const l=e.spatialReference;if(null==(i=null!==(s=i)&&void 0!==s?s:N(e)))throw new z;const a=e.constructor.fromJSON(r.G.rotate(e,t,i));return a.spatialReference=l,a}function x(e,t){var i;if(null==e)throw new z;const s=e.spatialReference;if(null==(t=null!==(i=t)&&void 0!==i?i:N(e)))throw new z;const l=e.constructor.fromJSON(r.G.flipHorizontal(e,t));return l.spatialReference=s,l}function K(e,t){var i;if(null==e)throw new z;const s=e.spatialReference;if(null==(t=null!==(i=t)&&void 0!==i?i:N(e)))throw new z;const l=e.constructor.fromJSON(r.G.flipVertical(e,t));return l.spatialReference=s,l}function L(e,t,i,a){return r.G.generalize(s.hydratedAdapter,l(e),e,t,i,a)}function O(e,t,i){return r.G.densify(s.hydratedAdapter,l(e),e,t,i)}function B(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return r.G.geodesicDensify(s.hydratedAdapter,l(e),e,t,i,a)}function H(e,t){return r.G.planarArea(s.hydratedAdapter,l(e),e,t)}function E(e,t){return r.G.planarLength(s.hydratedAdapter,l(e),e,t)}function Z(e,t,i){return r.G.geodesicArea(s.hydratedAdapter,l(e),e,t,i)}function D(e,t,i){return r.G.geodesicLength(s.hydratedAdapter,l(e),e,t,i)}function V(e,t){return r.G.intersectLinesToPoints(s.hydratedAdapter,l(e),e,t)}function U(e,t){r.G.changeDefaultSpatialReferenceTolerance(e,t)}function j(e){r.G.clearDefaultSpatialReferenceTolerance(e)}class z extends Error{constructor(){super("Illegal Argument Exception")}}},63733:(e,t,i)=>{i.r(t),i.d(t,{default:()=>p});var r=i(35143),s=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),a=i(5364),o=i(25515),n=i(65624),c=i(5682),u=i(64519),d=i(731);let h=class extends((0,n.d)((0,c.j)(o.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,r._)([(0,s.MZ)({type:d.A})],h.prototype,"elevationInfo",void 0),(0,r._)([(0,s.MZ)((0,a.C)(u.Y,"graphics"))],h.prototype,"graphics",void 0),(0,r._)([(0,s.MZ)({type:["show","hide"]})],h.prototype,"listMode",void 0),(0,r._)([(0,s.MZ)()],h.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,s.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,r._)([(0,s.MZ)({constructOnly:!0})],h.prototype,"internal",void 0),h=(0,r._)([(0,l.$)("esri.layers.GraphicsLayer")],h);const p=h},96422:(e,t,i)=>{i.d(t,{K:()=>l,R:()=>a});var r=i(55171),s=i(3825);async function l(e,t,i){var l;if(!(null===r.id||void 0===r.id?void 0:r.id.findCredential(e.restUrl)))return null;if("loaded"===e.loadStatus&&""===t&&null!==(l=e.user)&&void 0!==l&&l.sourceJSON&&!1===i)return e.user.sourceJSON;const a={responseType:"json",query:{f:"json"}};if(i&&(a.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,s.A)(e.restUrl+"/community/self",a);if(t.data){const e=t.data;if(null!==e&&void 0!==e&&e.username)return e}return null}const o=await(0,s.A)(e.restUrl+"/community/users/"+t,a);if(o.data){const e=o.data;return e.error?null:e}return null}async function a(e,t,i){var r,s;const a=await l(e,t,!0);return null!==(r=null===a||void 0===a||null===(s=a.userLicenseTypeExtensions)||void 0===s?void 0:s.includes(i))&&void 0!==r&&r}},91329:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(35143),s=i(45802),l=i(42553),a=i(46053),o=(i(81806),i(76460),i(47249),i(85842));const n=new s.J({startingPoint:"starting-point",barrier:"barrier"});let c=class extends l.oY{constructor(e){super(e),this.globalId=null,this.isFilterBarrier=!1,this.percentAlong=null,this.terminalId=null,this.type=null}};(0,r._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"globalId",void 0),(0,r._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],c.prototype,"isFilterBarrier",void 0),(0,r._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"percentAlong",void 0),(0,r._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"terminalId",void 0),(0,r._)([(0,a.MZ)({type:n.apiValues,json:{type:n.jsonValues,read:{reader:n.read,source:"traceLocationType"},write:{writer:n.write,target:"traceLocationType"}}})],c.prototype,"type",void 0),c=(0,r._)([(0,o.$)("esri.rest.networks.support.TraceLocation")],c);const u=c},64826:(e,t,i)=>{i.r(t),i.d(t,{default:()=>g});var r,s=i(35143),l=i(42553),a=i(46053),o=i(40565),n=(i(47249),i(81806),i(85842)),c=i(13312),u=i(12899),d=i(64154),h=i(91329);let p=r=class extends l.oY{static from(e){return(0,o.PZ)(r,e)}constructor(e){super(e),this.namedTraceConfigurationGlobalId=null,this.gdbVersion=null,this.traceLocations=[],this.moment=null,this.outSpatialReference=null,this.traceConfiguration=null,this.resultTypes=null,this.traceType=null}};(0,s._)([(0,a.MZ)({type:String,json:{read:{source:"traceConfigurationGlobalId"},write:{target:"traceConfigurationGlobalId"}}})],p.prototype,"namedTraceConfigurationGlobalId",void 0),(0,s._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"gdbVersion",void 0),(0,s._)([(0,a.MZ)({type:[h.A],json:{write:!0}})],p.prototype,"traceLocations",void 0),(0,s._)([(0,a.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],p.prototype,"moment",void 0),(0,s._)([(0,a.MZ)({type:c.A,json:{read:!1}})],p.prototype,"outSpatialReference",void 0),(0,s._)([(0,a.MZ)({type:d.A,json:{write:!0}})],p.prototype,"traceConfiguration",void 0),(0,s._)([(0,a.MZ)({type:[Object],json:{write:!0}})],p.prototype,"resultTypes",void 0),(0,s._)([(0,a.MZ)({type:u.fO.apiValues,json:{type:u.fO.jsonValues,read:u.fO.read,write:u.fO.write}})],p.prototype,"traceType",void 0),p=r=(0,s._)([(0,n.$)("esri.rest.networks.support.TraceParameters")],p);const g=p},40998:(e,t,i)=>{i.r(t),i.d(t,{submitTraceJob:()=>o,trace:()=>a});var r=i(3825),s=i(54994),l=i(57778);async function a(e,t,i){const a=(0,s.Dl)(e),o=t.toJSON();o.traceLocations=JSON.stringify(t.traceLocations),t.resultTypes&&(o.resultTypes=JSON.stringify(t.resultTypes));const n=(0,s.jV)(a.query,{query:(0,s.lF)({...o,f:"json"}),...i}),c="".concat(a.path,"/trace");return(0,r.A)(c,n).then((e=>function(e,t){const{data:i}=e,r=l.A.fromJSON(i.traceResults);return r.aggregatedGeometry&&t&&(r.aggregatedGeometry.line&&(r.aggregatedGeometry.line.spatialReference=t.clone()),r.aggregatedGeometry.multipoint&&(r.aggregatedGeometry.multipoint.spatialReference=t.clone()),r.aggregatedGeometry.polygon&&(r.aggregatedGeometry.polygon.spatialReference=t.clone())),r}(e,t.outSpatialReference)))}async function o(e,t,i){const l=(0,s.Dl)(e),a=t.toJSON();a.traceLocations=JSON.stringify(t.traceLocations),t.resultTypes&&(a.resultTypes=JSON.stringify(t.resultTypes));const o=(0,s.jV)(l.query,{query:(0,s.lF)({...a,async:!0,f:"json"}),...i}),n="".concat(l.path,"/trace"),{data:c}=await(0,r.A)(n,o);return c.statusUrl}},46978:(e,t,i)=>{i.r(t),i.d(t,{default:()=>de});var r=i(35143),s=i(68134),l=i(46053),a=(i(81806),i(76460)),o=(i(47249),i(85842)),n=i(72599),c=i(25329),u=i(77666),d=i(98108),h=i(15062),p=i(76099),g=i(63582),v=i(12254),y=i(54761),m=i(55171),f=i(19276),w=i(50076),_=i(54099),b=i(13904),A=i(19902),T=i(63860),S=i(38451),R=i(63733),M=i(31933),F=i(67296),k=i(78715),C=i(65308),G=i(96422),I=i(40998),N=i(91329),P=i(64826),x=(i(35238),i(63391)),K=i(23701),L=i(9624),O=i(13312);function B(e){return"polygon"===e.type||"polyline"===e.type}class H{createBuffer(e,t,i,r){if(Array.isArray(e)){if(e.length>0){const s=O.A.fromJSON(e[0].spatialReference);return s.isWGS84||s.isWebMercator?(0,x.geodesicBuffer)(e,t,i):(0,x.buffer)(e,t,i,r)}return}const s=O.A.fromJSON(e.spatialReference);return s.isWGS84||s.isWebMercator?(0,x.geodesicBuffer)(e,t[0],i):(0,x.buffer)(e,t[0],i)}createConvexHull(e){if(Array.isArray(e)){if(1===e.length&&function(e){return function(e){return e.hasOwnProperty("points")}(e)&&2===e.points.length}(e[0])){const t=(0,x.convexHull)(e[0]);if(B(t))return t}return(0,x.convexHull)(e,!0).filter(B)}const t=(0,x.convexHull)(e);if(B(t))return t}calculateArea(e,t){const i=new O.A({wkid:e.spatialReference.wkid});return i.isWGS84||i.isWebMercator?parseFloat((0,x.geodesicArea)(e,t).toFixed(2)):parseFloat((0,x.planarArea)(e,t).toFixed(2))}mergeAggregatedToGeometries(e){const t=[],{line:i,multipoint:r,polygon:s}=e;return i&&t.push(i),r&&t.push(r),s&&t.push(s),t}getPercentageAlong(e,t,i){let r=e;const s=this._createPolyline(e.paths,i.wkid);if("point"===t.type){const e=t.x-5,l=t.x+5,a=[[e,t.y-5],[l,t.y+5]];r=this._createPolyline(a,t.spatialReference.wkid),r=(0,L.project)(r,i);const o=(0,x.cut)(s,r);if(o.length>0){const e=(0,x.planarLength)(s,"feet");let t;return t=o[0].paths[0][0][0]===s.paths[0][0][0]?(0,x.planarLength)(o[0],"feet"):(0,x.planarLength)(o[1],"feet"),[t/e]}return[.5]}r=(0,L.project)(t,i);const l=(0,x.cut)(s,r);if(l.length>0){const e=(0,x.planarLength)(s,"feet");return[(0,x.planarLength)(l[0],"feet")/e]}return[.5]}async projectGeometry(e,t){return await(0,L.load)(),(0,L.project)(e,t)}_createPolyline(e,t){return new K.A({hasZ:!1,hasM:!0,paths:e,spatialReference:{wkid:t}})}}var E=i(39356);const Z=[227,27,21,.6],D=[21,244,21,.6],V=[{color:[255,0,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff0000"},{color:[255,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff00ff"},{color:[217,188,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#D9BCFF"},{color:[0,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#00ff00"},{color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ffff00"},{color:[0,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#0000ff"},{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},{color:[0,0,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#000000"}];class U{constructor(){this.highlightColor=[...V]}addCustomColor(e){this.highlightColor=[...V],this.highlightColor.some((t=>t.hex.toLowerCase()===e.hex.toLowerCase()))||this.highlightColor.push(e)}getFlagGraphic(e,t,i,r){const s="starting-point"===t?D:Z;if("polygon"===e.type){const t=e;t.centroid&&(e=t.centroid)}return r?this.makeGraphic(e,s,null===i||void 0===i?void 0:i.attributes,null,r):this.makeGraphic(e,s,null===i||void 0===i?void 0:i.attributes)}makeGraphic(e,t,i,r,s){let l,a=e;switch(e.type){case"multipoint":l={type:"simple-marker",color:t,size:12,outline:{color:t,width:0}},r&&(a=e);break;case"point":l=s||{type:"simple-marker",color:t,size:12,outline:{color:t,width:0}},r&&(a=e);break;case"polyline":l={type:"simple-line",color:t,width:12},r&&(a=e);break;case"polygon":l={type:"simple-fill",color:t,outline:{color:t,width:12}},r&&(a=e)}return new E.A({geometry:a,symbol:l,attributes:null!==i&&void 0!==i?i:null})}}var j=i(86875);const z="utility-network-trace-result-area-".concat(Date.now());function W(e){return"graphics"===e.type}class q{constructor(){this.traceInformation={},this._geometryHandler=new H}addResultAreaToMap(e,t){const i=this.createGraphicLayer(t);i&&W(i)&&i.add(e)}changeResultAreaColor(e,t,i){const r=new j.default({color:t.color,style:"solid",outline:{color:t.color,width:1}}),s=this._findGraphicsByTraceId(e,i);return s&&s.forEach((e=>{e.symbol=r})),r}createBuffer(e,t,i,r){return this._geometryHandler.createBuffer(e,t,i,r)}createConvexHull(e,t,i){const r=this._geometryHandler.createConvexHull(e);return t>0&&r?this.createBuffer(r,[t],i,!1):r}createResultAreaGraphic(e,t,i,r,s,l){const a=new j.default({color:l.color,style:"solid",outline:{color:l.color,width:1}}),o=[];for(const c in t){var n;o.push({fieldName:c,label:"areaStatistic"===c?r.attributeStrings[c]+" ("+(null===(n=s.units[i])||void 0===n?void 0:n.abbr)+")":r.attributeStrings[c],value:t[c]})}return new E.A({geometry:e,symbol:a,attributes:t,popupTemplate:{title:t.traceName,content:[{type:"fields",fieldInfos:o}]}})}removeResultArea(e,t){const i=t.findLayerById(z);if(i&&W(i)){const r=this._findGraphicsByTraceId(e,t);return r&&i.removeMany(r),r}return null}removeAllResultAreaGraphics(e){if(e){const t=e.findLayerById(z);t&&W(t)&&t.removeAll()}}createGraphicLayer(e,t){const i=e.findLayerById(z);if(i&&W(i))return i;const r=new R.default({title:null!==t&&void 0!==t?t:z,listMode:"hide",id:z});return e.add(r),r}_findGraphicsByTraceId(e,t){const i=t.findLayerById(z);if(i&&W(i)){const t=i.graphics.filter((t=>t.attributes.traceId===e));return t.length>0?t.toArray():null}return null}}function J(e){return"feature"===e.type}function Y(e,t){return e.url.includes(t)}function $(e,t){var i;return((null===(i=e.dataElement)||void 0===i?void 0:i.domainNetworks)||[]).some((e=>e.subnetworkLayerId===t.layerId))}class X{getValidUtilityNetworkLayers(e,t){const i=[];return null!==e&&void 0!==e&&e.allLayers.forEach((e=>{"group"===e.type?i.push(...e.layers.filter(M.yZ).filter((e=>J(e)&&t.isUtilityLayer(e)&&!$(t,e))).filter((e=>Y(e,t.featureServiceUrl))).toArray()):"subtype-group"===e.type?i.push(...e.sublayers.filter((e=>Y(e,t.featureServiceUrl))).toArray()):(0,M.yZ)(e)&&J(e)&&t.isUtilityLayer(e)&&!$(t,e)&&Y(e,t.featureServiceUrl)&&i.push(e)})),i}}const Q="utility-network-trace-flags-".concat(Date.now()),ee="utility-network-trace-results-".concat(Date.now());let te=class extends _.A.EventedAccessor{constructor(e){super(e),this._activeProgress=!1,this._clickHandler=null,this._flags=[],this._flagId=0,this._geometryHandler=null,this._highlightHandler=[],this._resultAreaHandler=null,this._utilityHelper=new X,this._watchHandler=null,this._validUNLayers=[],this._traceTimeout=6e5,this.traces=[],this.graphicHandler=null,this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"},this.enableResultArea=!1,this.flags=[],this.gdbVersion="sde.DEFAULT",this.messages=null,this.messagesUnits=null,this.defaultResultAreaProperties={type:"convexhull",distance:10,unit:"meters",areaUnit:"square-meters",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1},this.selectedTraces=[],this.selectOnComplete=!0,this.showGraphicsOnComplete=!0,this.showSelectionAttributes=!0,this.traceResults=[],this.utilityNetwork=null}initialize(){this._geometryHandler=new H,this.graphicHandler=new U,this._resultAreaHandler=new q,(async()=>{const[e,t]=await Promise.all([(0,T.ud)("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"),(0,T.ud)("esri/core/t9n/Units")]);this.set({messages:e,messagesUnits:t})})()}destroy(){this.view=null}get resultAreaProperties(){return this.defaultResultAreaProperties}set resultAreaProperties(e){this._set("resultAreaProperties",{...this.defaultResultAreaProperties,...e}),this.graphicHandler.addCustomColor(this.resultAreaProperties.color),this.traceResults.forEach((t=>{var i;const r=null===(i=t.resultArea)||void 0===i?void 0:i.show;t.resultArea={...this.defaultResultAreaProperties,...e},this.removeResultAreaFromMap(t),this.enableResultArea&&this.createResultAreaGraphic(t).then((i=>{if(i){var s;t.resultAreaGraphic=i;const l=null!==(s=null===e||void 0===e?void 0:e.show)&&void 0!==s?s:r;t.resultArea&&(t.resultArea.show=l),l&&this.addResultAreaToMap(t,i)}}))}))}get state(){var e;return null!==(e=this.view)&&void 0!==e&&e.ready?"ready":"loading"}get view(){return this._get("view")}set view(e){e&&"2d"!==e.type&&a.A.getLogger(this).error(new w.A("view:invalid-view","SceneView is not supported",{view:e})),this._set("view",e),this.utilityNetwork&&this.reset(),this.utilityNetwork=null,this.loadUtilityNetwork().then((e=>{e&&this.selectTracesOnLoad()}))}addFlagByHit(e,t){const i=e=>{var t;(null===(t=this.view)||void 0===t?void 0:t.popup)&&(this.view.popupEnabled=e)};return new Promise(((r,s)=>{var l,a;i(!1),null!==(l=this._clickHandler)&&void 0!==l&&l.remove(),this.emit("add-flag",{type:e}),this._clickHandler=null===(a=this.view)||void 0===a?void 0:a.on("click",(l=>{this.queryFlagByHitTest(l,e,t).then((s=>{var l;i(!0),null!==(l=this._clickHandler)&&void 0!==l&&l.remove(),this.emit("add-flag-complete",{type:e,symbol:t}),r(s)})).catch((r=>{var l;i(!0),null!==(l=this._clickHandler)&&void 0!==l&&l.remove(),this.emit("add-flag-error",{type:e,symbol:t}),s(r)}))}))}))}async addFlagsOnLoad(){return new Promise((e=>{const t=[];this._watchHandler=(0,s.when)((()=>null!=this.view&&!this.view.updating),(async()=>{if(this._flags.length>0)e(t);else{const i=this.flags.map((async e=>{if(e.mapPoint){const i=new b.A({x:e.mapPoint.x,y:e.mapPoint.y,spatialReference:e.mapPoint.spatialReference.wkid}),r={screenPoint:this.view.toScreen(i),mapPoint:i};await this.queryFlagByHitTest(r,e.type)||("barrier"===e.type?t.push("barrier"):t.push("starting-point"))}}));await Promise.all(i),e(t)}}),{initial:!0})}))}async addResultAreaToMap(e,t){var i;if(this.view)if(e.resultArea.show=!0,t)null!==(i=this._resultAreaHandler)&&void 0!==i&&i.addResultAreaToMap(t,this.view.map),this.emit("add-result-area",{graphic:t});else if(e.results){var r;const t=await this.createResultAreaGraphic(e);t&&(e.resultAreaGraphic=t,null!==(r=this._resultAreaHandler)&&void 0!==r&&r.addResultAreaToMap(t,this.view.map),this.emit("add-result-area",{graphic:t}))}}async addResultGraphicToView(e,t){const{view:i}=this,{results:r}=e;if(i&&r&&this.utilityNetwork)for(const l in r.aggregatedGeometry)if("line,multipoint,polygon".includes(l)){const a=l,o=r.aggregatedGeometry[a];if(null!=o){o.spatialReference=this.utilityNetwork.spatialReference,e.graphicEnabled=!0;const r=await this._geometryHandler.projectGeometry(o,i.spatialReference),l={globalid:e.trace.globalId};if(null!==r){var s;const e=this.graphicHandler.makeGraphic(r,t.color,l,i.spatialReference);null===(s=this._getGraphicLayer(ee))||void 0===s||s.add(e)}}}}addTerminal(e,t){const i=[...this._flags];i.forEach((i=>{var r,s;i.globalId===t.globalId&&((null===(r=t.selectedTerminals)||void 0===r?void 0:r.includes(parseInt(e,10)))||null===(s=i.selectedTerminals)||void 0===s||s.push(parseInt(e,10)))})),this._flags=i}async callTrace(){const e=this.traces.filter((e=>e.selected));return e.length>0&&(this.traceResults.length>0&&this.traceResults.forEach((e=>{this.removeResultGraphicFromView(e)})),this.traceResults=[],this.removeSelection(),await Promise.all(e.map((async(e,t)=>{var i;const r=e,s=new P.default({gdbVersion:this.gdbVersion,moment:null,traceType:r.traceType,traceLocations:this._flags,namedTraceConfigurationGlobalId:r.globalId,traceConfiguration:null,outSpatialReference:null,resultTypes:null});await this.executeTrace(r,null===(i=this.utilityNetwork)||void 0===i?void 0:i.networkServiceUrl,s).then((e=>{if(e.hasOwnProperty("results")){const i={...e};if(null!==i.results){i.resultArea={...this.resultAreaProperties};const e=[...i.results.elements];i.results.elements.length=0;const r=new Map;for(const t of e)r.has(t.globalId)||(r.set(t.globalId,!0),i.results.elements.push(t));const s=[...this.traceResults];s.splice(t,0,i),this.traceResults=s,null!==i.results&&(this.selectOnComplete&&this.mergeSelection(!0,i.trace),this.showGraphicsOnComplete&&this.addResultGraphicToView(i,i.graphicColor),this.enableResultArea&&this.createResultAreaGraphic(i).then((e=>{var t;e&&(i.resultAreaGraphic=e,(null===(t=i.resultArea)||void 0===t?void 0:t.show)&&this.addResultAreaToMap(i,i.resultAreaGraphic))})))}else{const i=[...this.traceResults];i.splice(t,0,e),this.traceResults=i}this._activeProgress=!1}else{this._activeProgress=!1;const i=[...this.traceResults];i.splice(t,0,e),this.traceResults=i}})).catch((e=>{throw this._activeProgress=!1,e}))}))),!0)}changeResultAreaColor(e,t){var i;if(!e.resultArea)return;e.resultArea.color=t;const r=null===(i=this._resultAreaHandler)||void 0===i?void 0:i.changeResultAreaColor(e.trace.globalId,t,this.view.map);e.resultAreaGraphic&&(e.resultAreaGraphic.symbol=r)}changeResultGraphicColor(e,t){const i=[...this.traceResults];i.length>0&&i.forEach((i=>{i.trace.globalId===t.trace.globalId&&(i.graphicColor=e,i.graphicEnabled=!0)})),this.traceResults=i,this.removeResultGraphicFromView(t),this.addResultGraphicToView(t,e)}changeFlagSymbol(e,t){this._flags.length>0&&this._flags.forEach((i=>{i.type===e&&t&&i.mapGraphic&&(i.mapGraphic.symbol=t)}))}checkCanTrace(){const e={status:!0,issues:[]};let t=!1;const i=this._flags.some((e=>"starting-point"===e.type)),r=this._flags.filter((e=>null!==e.allTerminals));r.length>0&&(t=r.some((e=>e.selectedTerminals.length<=0)));let s=[];return i?(s=this.traces.filter((e=>e.selected)),s.length<=0?(e.status=!1,e.issues=["noTrace"],t&&(e.status=!1,e.issues=["noTrace","noTerminalSelected"])):t&&(e.status=!1,e.issues=["noTerminalSelected"])):(s=this.traces.filter((e=>!0===e.selected)),s.length>0?(e.status=!1,e.issues=["noStart"],t&&(e.status=!1,e.issues=["noStart","noTerminalSelected"])):(e.status=!1,e.issues=["noStart","noTrace"],t&&(e.status=!1,e.issues=["noStart","noTrace","noTerminalSelected"]))),e}checkSelectionExist(){return this._highlightHandler.some((e=>e))}clearResult(e){if(!this.view)return;let t=this.traceResults;if(t.length>0){const i=t.filter((t=>t.trace.globalId===e.globalId));i.length>0&&(this.removeResultGraphicFromView(i[0]),this.removeResultAreaFromMap(i[0])),t=t.filter((t=>t.trace.globalId!==e.globalId))}this.traceResults=t,0===t.length?(this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]})):this.mergeSelection(!1,e)}createResultAreaGeometries(e,t,i){var r,s,l,a,o,n,c,u;if(!this.view||!this.resultAreaProperties)return;let d;if("convexhull"===(null===(r=this.resultAreaProperties)||void 0===r?void 0:r.type)?d=1===t.length&&((0,A.fT)(t[0])||(0,A.U9)(t[0])&&1===t[0].points.length)?null===(s=this._resultAreaHandler)||void 0===s?void 0:s.createBuffer(t,i,null===(l=e.resultArea)||void 0===l?void 0:l.unit,!0):null===(a=this._resultAreaHandler)||void 0===a?void 0:a.createConvexHull(t,null===(o=e.resultArea)||void 0===o?void 0:o.distance,null===(n=e.resultArea)||void 0===n?void 0:n.unit):t&&(d=null===(c=this._resultAreaHandler)||void 0===c?void 0:c.createBuffer(t,i,null===(u=e.resultArea)||void 0===u?void 0:u.unit,!0)),d&&Array.isArray(d)){if(d.length>0)for(const f of d){var h,p,g;const t=this.getResultAreaAttributes(e,f),i=null===(h=this._resultAreaHandler)||void 0===h?void 0:h.createResultAreaGraphic(f,t,null===(p=e.resultArea)||void 0===p?void 0:p.areaUnit,this.messages,this.messagesUnits,null===(g=e.resultArea)||void 0===g?void 0:g.color);if(i)return i}}else{var v,y,m;const t=this.getResultAreaAttributes(e,d),i=null===(v=this._resultAreaHandler)||void 0===v?void 0:v.createResultAreaGraphic(d,t,null===(y=e.resultArea)||void 0===y?void 0:y.areaUnit,this.messages,this.messagesUnits,null===(m=e.resultArea)||void 0===m?void 0:m.color);if(i)return i}}async createResultAreaGraphic(e){if(e.results){const i=await this._createResultAreaInputGeometry(e.results);if(i.length>0){var t;const r=Array(i.length).fill(null===(t=e.resultArea)||void 0===t?void 0:t.distance),s=this.createResultAreaGeometries(e,i,r);return this.emit("create-result-area",{graphic:s}),s}}}executeTrace(e,t,i){const r=this._processFlags(i.traceLocations);return i.traceLocations=r,(0,I.trace)(t,i,{timeout:this._traceTimeout}).then((t=>({trace:e,results:t,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:"success",date:new Date}))).catch((t=>({trace:e,results:null,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:t.message,date:new Date})))}getResultAreaAttributes(e,t){var i,r,s,l;const{messages:a}=this,o=[],n=[];return this._flags.forEach((e=>{var t,i,r,s;const l=(null===(t=e.displayValue)||void 0===t?void 0:t.field)+":"+(null===(i=e.displayValue)||void 0===i?void 0:i.value)+";"+a.attributeStrings.globalid+":"+e.globalId+";"+a.attributeStrings.terminalid+":"+e.terminalId+";"+a.attributeStrings.x+":"+(null===(r=e.mapPoint)||void 0===r?void 0:r.x)+";"+a.attributeStrings.y+":"+(null===(s=e.mapPoint)||void 0===s?void 0:s.y);"starting-point"===e.type?o.push(l):n.push(l)})),{traceId:e.trace.globalId,traceName:e.trace.title,traceDescription:null!==(i=e.trace.description)&&void 0!==i?i:"",startingPoints:o.toString(),barriers:n.toString(),version:this.gdbVersion,username:m.id.credentials[0].userId,date:e.date,elementCount:null===(r=e.results)||void 0===r?void 0:r.elements.length,functionResult:JSON.stringify(null===(s=e.results)||void 0===s?void 0:s.globalFunctionResults),areaStatistic:t?this._geometryHandler.calculateArea(t,null===(l=e.resultArea)||void 0===l?void 0:l.areaUnit):0}}getValidSources(){var e,t;let i=[];const r=null!==(e=null===(t=this.utilityNetwork)||void 0===t||null===(t=t.dataElement)||void 0===t?void 0:t.domainNetworks)&&void 0!==e?e:[];for(const s of r)i=i.concat(s.junctionSources),i=i.concat(s.edgeSources);return i}groupResultsByNetworkSource(e){return 0===e.length?[]:this._groupBy(e,"networkSourceId")}async loadUtilityNetwork(){var e;const{view:t}=this;if(!t)return null;if(await t.when(),this.utilityNetwork){if(this.utilityNetwork.loaded||await this.utilityNetwork.load(),this.utilityNetwork instanceof F.default){try{const e=t.map;await e.loadAll(),this._loadUNSupportItems()}catch(Z){this._loadUNSupportItems()}return this.utilityNetwork}return null}const i=t.map,r=null===(e=i.utilityNetworks)||void 0===e?void 0:e.at(0);if(r){if(await r.load(),this.utilityNetwork=r,!await async function(e){const t=new S.default({url:e.networkSystemLayers.dirtyAreasLayerUrl});await t.load();const i=t.version;if(Number(i)<=11.1){var r;const t=new C.A({url:new URL(e.layerUrl).origin+"/portal"});await t.load();const i=null===t||void 0===t||null===(r=t.user)||void 0===r?void 0:r.username;return!!i&&(0,G.R)(t,i,"utilityNetwork")}return!0}(r))throw new w.A("utility-network:no-user-type-extension","User type extension not found");try{await i.loadAll(),this._loadUNSupportItems()}catch(Z){}finally{this._loadUNSupportItems()}return r}return null}manageFilterBarrier(e,t){const i=[...this._flags];i.forEach((i=>{i.globalId===t.globalId&&"barrier"===t.type&&i.id===t.id&&(i.isFilterBarrier=e)})),this._flags=i}mergeSelection(e,t){let i=[];const r=[...this.traceResults],s=t.globalId;r.forEach((t=>{var r,l,a;s===t.trace.globalId&&(t.selectionEnabled=e),t.selectionEnabled&&null!==(null===(r=t.results)||void 0===r?void 0:r.elements)&&(i=[...i,...null!==(l=null===(a=t.results)||void 0===a?void 0:a.elements)&&void 0!==l?l:[]])})),this.selectResults([...new Set(i)])}async queryFeaturesById(e){var t,i;const{view:r}=this;if(!r||!this.utilityNetwork)return null;const s=(0,k.ji)(this.utilityNetwork,e),l={layerUrl:s[0].layerUrl,objectIds:s[0].objectIds,outFields:["*"]},a=null!==(t=null===(i=r.map)||void 0===i?void 0:i.allTables.toArray().filter((e=>{var t;return(null===e||void 0===e||null===(t=e.parsedUrl)||void 0===t?void 0:t.path)===s[0].layerUrl})).filter(M.yZ))&&void 0!==t?t:[];this._getUniqueMapLayerViews(r).filter((e=>{var t;let{layer:i}=e;return(null===i||void 0===i||null===(t=i.parsedUrl)||void 0===t?void 0:t.path)===s[0].layerUrl})).forEach((e=>{let{layer:t}=e;"feature"!==t.type&&"subtype-group"!==t.type||a.push(t)}));const o=(await Promise.all(a.map((async e=>{const t={layers:new f.A([e]),layerInfos:[l],returnGeometry:!0,outSpatialReference:r.spatialReference},[i]=await(0,k.sI)(t,!1);return i})))).filter((e=>{let{featureSet:t}=e;return t.features.length>0}));return o.length>0?o:null}queryFlagByHitTest(e,t,i){return this._lookupFlagByHit(e).then((e=>{const{view:r}=this;if(!r)return!1;if(e.length>0){const r=[...this._flags],s=i;return e.forEach((e=>{const i=e.graphic,l=i.attributes.hasOwnProperty("GLOBALID")?i.attributes.GLOBALID:i.attributes.globalid;if(r.filter((e=>e.globalId===l)).length<=0){var a;const e=this.graphicHandler.getFlagGraphic(i.mapPoint,t,i,s);null!==(a=this._getGraphicLayer(Q))&&void 0!==a&&a.add(e),r.push({...i,type:t,globalId:i.attributes.globalid||i.attributes.GLOBALID,details:i,mapGraphic:e,id:this._uniqueFlagId})}else if(null!==i.percentAlong){var o;const e=this.graphicHandler.getFlagGraphic(i.mapPoint,t,i,s);null!==(o=this._getGraphicLayer(Q))&&void 0!==o&&o.add(e),r.push({...i,type:t,globalId:i.attributes.globalid||i.attributes.GLOBALID,details:i,mapGraphic:e,id:this._uniqueFlagId})}})),this._flags=r,!0}return!1}))}removeResultGraphicFromView(e){var t;const{view:i}=this;if(!i)return;const r=null===(t=this._getGraphicLayer(ee))||void 0===t?void 0:t.graphics;e.graphicEnabled=!1;const s=null===r||void 0===r?void 0:r.filter((t=>t.attributes[t.attributes.hasOwnProperty("GLOBALID")?"GLOBALID":"globalid"]===e.trace.globalId));null===s||void 0===s||s.forEach((e=>{var t;null===(t=this._getGraphicLayer(ee))||void 0===t||t.remove(e)}))}removeFlag(e){const t=this._flags.filter((t=>{if(t.id!==e.id)return t}));this._removeGraphic(e),this._flags=t}removeAllResultAreaGraphics(){var e;null===(e=this._resultAreaHandler)||void 0===e||e.removeAllResultAreaGraphics(this.view.map)}removeResultAreaFromMap(e){if(e.resultArea){var t,i;e.resultArea.show=!1;const r=null===(t=this._resultAreaHandler)||void 0===t?void 0:t.removeResultArea(e.trace.globalId,null===(i=this.view)||void 0===i?void 0:i.map);r&&this.emit("remove-result-area",{graphic:r})}}removeSelection(){this._highlightHandler.forEach((e=>{e&&e.remove()})),this._highlightHandler=[]}removeTerminal(e,t){const i=[...this._flags];i.forEach((i=>{var r;if(i.globalId===t.globalId&&null!==(r=t.selectedTerminals)&&void 0!==r&&r.includes(parseInt(e,10))){var s;const r=t.selectedTerminals.indexOf(parseInt(e,10));null===(s=i.selectedTerminals)||void 0===s||s.splice(r,1)}})),this._flags=i}removeFlagsOnLoadWatcher(){this._watchHandler&&null!==this._watchHandler&&this._watchHandler.remove()}reset(){var e,t;this._flags=[],this.traceResults=[];const i=[...this.traces];i.forEach((e=>{e.selected=!1})),this.traces=i,this.view&&(null!==(e=this._getGraphicLayer(ee))&&void 0!==e&&e.removeAll(),null!==(t=this._getGraphicLayer(Q))&&void 0!==t&&t.removeAll(),this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]}))}selectFeaturesById(e){const{view:t}=this;if(!t||!this.utilityNetwork)return;const i=(0,k.ji)(this.utilityNetwork,e);this._getUniqueMapLayerViews(t).forEach((e=>{var t;(function(e){return"layer"in e})(e)&&(null===(t=e.layer)||void 0===t||null===(t=t.parsedUrl)||void 0===t?void 0:t.path)===i[0].layerUrl&&function(e){return"feature"===e.layer.type||"subtype-group"===e.layer.type}(e)&&this._highlightHandler.push(e.highlight(i[0].objectIds))}))}selectResults(e){if(e.length>0){this.removeSelection();const t=this.groupResultsByNetworkSource(e),i=[];for(const e in t)this.selectFeaturesById(t[e]),i.push(this.queryFeaturesById(t[e]));Promise.all(i).then((e=>{this.emit("select-features",{resultSet:e})}))}else this.removeSelection(),this.emit("clear-selection",{resultSet:[]})}selectTraces(e,t){const i=[...this.traces];i.forEach((i=>{t===i.globalId&&(i.selected=e)})),this.traces=i}selectTracesOnLoad(){var e;(null===(e=this.utilityNetwork)||void 0===e?void 0:e.hasOwnProperty("sharedNamedTraceConfigurations"))&&(this.traces=[...this.utilityNetwork.sharedNamedTraceConfigurations],this.traces.forEach((e=>{e.selected=!1,this.selectedTraces.includes(e.globalId)&&(e.selected=!0)})))}zoomToAsset(e){var t;null===(t=this.view)||void 0===t||t.goTo(e).catch((e=>console.error(e)))}async _createResultAreaInputGeometry(e){if(null!=e.aggregatedGeometry)return this._geometryHandler.mergeAggregatedToGeometries(e.aggregatedGeometry);const t=this.groupResultsByNetworkSource(e.elements),i=[];for(const r in t)i.push(this.queryFeaturesById(t[r]));try{const e=await Promise.all(i),t=[];for(const i of e)if(i)for(const e of i)for(const i of e.featureSet.features)t.push(i.geometry);return t}catch{return[]}}_loadUNSupportItems(){var e;if(!this.utilityNetwork)return;const{map:t}=this.view,{messages:i}=this;this._populateOutfields(),this._createGraphicLayer(Q),this._createGraphicLayer(ee),null!==(e=this._resultAreaHandler)&&void 0!==e&&e.createGraphicLayer(t,null===i||void 0===i?void 0:i.alertsStrings.genericResultHeader),this._validUNLayers=this._utilityHelper.getValidUtilityNetworkLayers(t,this.utilityNetwork)}_getUniqueMapLayerViews(e){const t=[];return e.layerViews.filter((e=>{let{layer:{type:t}}=e;return"feature"===t||"group"===t||"subtype-group"===t})).toArray().forEach((e=>{switch(e.layer.type){case"group":if(function(e){return void 0!==e.layerViews}(e))for(const i of e.layerViews)t.push(i);break;case"subtype-group":t.push(e);break;default:t.some((t=>t.layer.id===e.layer.id))||t.push(e)}})),t}_processFlags(e){const t=[];return e.forEach((e=>{if(null!==e.selectedTerminals&&e.selectedTerminals.length>0)e.selectedTerminals.forEach((i=>{const r=new N.A({globalId:e.globalId,percentAlong:e.percentAlong,terminalId:i,type:e.type,isFilterBarrier:e.isFilterBarrier});t.push(r)}));else{const i=new N.A({globalId:e.globalId,percentAlong:e.percentAlong,terminalId:null,type:e.type,isFilterBarrier:e.isFilterBarrier});t.push(i)}})),t}_getDisplayField(e){var t;return"subtype-sublayer"===(null===e||void 0===e||null===(t=e.layer)||void 0===t?void 0:t.type)?this._getDisplayFieldBySublayer(e):this._getDisplayFieldByFeatureLayer(e)}_getDisplayFieldBySublayer(e){let t="",i="";const r=e.layer;t=this._checkParentForData(r,"displayField");for(const l in e.attributes){var s;const a=l.toLowerCase();a===(null===(s=t)||void 0===s?void 0:s.toLowerCase())?(i=e.attributes[l],"assetgroup"===a||"assettype"===a?i=this._checkSubtype(r,r.subtypeCode):(i=this._checkDomain(r.fields,l,i),"string"==typeof i&&(i=this._defaultDisplayField(i,r)))):(i=this._checkDomain(r.fields,l,i),"string"==typeof i&&(i=this._defaultDisplayField(i,r)))}return{field:t,value:i.toString()}}_getDisplayFieldByFeatureLayer(e){const t=e.layer;let i=t.displayField,r="";for(const o in e.attributes){var s;const n=o.toLowerCase();if(n===(null===(s=i)||void 0===s?void 0:s.toLowerCase()))if(r=e.attributes[o],"assetgroup"===n||"assettype"===n){var l,a;let s=e.attributes[t.typeIdField.toUpperCase()];s||(s=e.attributes[t.typeIdField.toLowerCase()]),i=t.typeIdField,r=this._checkSubtype(t,s),""===i&&(t.templates&&t.templates.length>0?(i=null===(l=t.templates[0])||void 0===l?void 0:l.name,r=null===(a=t.templates[0])||void 0===a?void 0:a.name):(i=t.displayField,r=e.attributes[o]))}else r=this._checkDomain(t.fields,o,r),"string"==typeof r&&(r=this._defaultDisplayField(r,t));else r=this._checkDomain(t.fields,o,r),"string"==typeof r&&(r=this._defaultDisplayField(r,t))}return{field:i,value:r?r.toString():""}}_checkSubtype(e,t){let i=t;if("subtype-sublayer"===e.type){const r=this._checkParentForData(e,"subtypes");(null===r||void 0===r?void 0:r.length)>0&&r.forEach((e=>{e.code===t&&(i=e.name)}))}else if(null!=e.types&&e.types.length>0){const r=e.types.filter((e=>e.id===t));r.length>0&&(i=r[0].name)}return i}_checkDomain(e,t,i){var r;let s=i;const l=e.filter((e=>e.name.toLowerCase()===t.toLowerCase()));if(l.length>0&&function(e){return e instanceof n.A}(l[0].domain)&&null!==(r=l[0].domain)&&void 0!==r&&r.codedValues){const e=l[0].domain.codedValues.filter((e=>{let{code:t}=e;return t===i}));e.length>0&&(s=e[0].name)}return s}_checkParentForData(e,t){var i,r;return null!==(i=null===(r=e.parent)||void 0===r?void 0:r[t])&&void 0!==i?i:null}_defaultDisplayField(e,t){var i;return e.trim()?e:t.templates&&(null===(i=t.templates)||void 0===i?void 0:i.length)>0?t.templates[0].name:t.title}get _uniqueFlagId(){return this._flagId++}_groupBy(e,t){return e.reduce(((e,i)=>((e[i[t]]=e[i[t]]||[]).push(i),e)),{})}async _lookupFlagByHit(e){if(null==e.mapPoint)return[];const t=await this.view.hitTest(e.screenPoint,{include:this._validUNLayers}),i=[];if(t.results.length>0){var r;const l=t.results.find((e=>null!==e.layer));if(null!=(null===(r=l.graphic)||void 0===r?void 0:r.geometry))if("polyline"===l.graphic.geometry.type){const t=this._geometryHandler.getPercentageAlong(l.graphic.geometry,e.mapPoint,l.graphic.geometry.spatialReference),r=this._getDisplayField(l.graphic);l.graphic.terminalId=null,l.graphic.isFilterBarrier=!1,l.graphic.allTerminals=null,l.graphic.selectedTerminals=null,l.graphic.percentAlong=t,l.graphic.displayValue=r,l.graphic.mapPoint=l.mapPoint,i.push(l)}else if(("point"===l.graphic.geometry.type||"polygon"===l.graphic.geometry.type)&&null!==this.utilityNetwork){var s;const e=null===(s=this.utilityNetwork)||void 0===s?void 0:s.getTerminalConfiguration(l.graphic),t=this._getDisplayField(l.graphic);l.graphic.terminalId=e?e.terminals[0].id||null:1,l.graphic.isFilterBarrier=!1,l.graphic.allTerminals=null!==e&&void 0!==e?e:null,l.graphic.selectedTerminals=[e?e.terminals[0].id||null:1],l.graphic.percentAlong=null,l.graphic.displayValue=t,l.graphic.mapPoint=l.mapPoint,i.push(l)}}return i}async _populateOutfields(){var e;const t=null===(e=this.view)||void 0===e?void 0:e.map,i=this.getValidSources();null===t||void 0===t||t.layers.forEach((e=>{"group"===e.type?e.layers.forEach((e=>{i.some((t=>t.layerId===e.layerId))&&e.fields.some((e=>"assetgroup"===e.name.toLowerCase()))&&(e.outFields=["assetgroup","assettype","globalid","objectid"])})):i.some((t=>t.layerId===e.layerId))&&e.fields.some((e=>"assetgroup"===e.name.toLowerCase()))&&(e.outFields=["assetgroup","assettype","globalid","objectid"])}))}_removeGraphic(e){var t;null===(t=this._getGraphicLayer(Q))||void 0===t||t.remove(e.mapGraphic)}_createGraphicLayer(e){const{map:t}=this.view;if(!t.findLayerById(e)){const i=new R.default({title:e,listMode:"hide",id:e});t.add(i)}}_getGraphicLayer(e){const{map:t}=this.view;if(t){const i=t.findLayerById(e);if(i&&function(e){return"graphics"===e.type}(i))return i}return null}};(0,r._)([(0,l.MZ)()],te.prototype,"_activeProgress",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"_flags",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"traces",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"defaultGraphicColor",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"enableResultArea",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"flags",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"gdbVersion",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"messages",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"messagesUnits",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"resultAreaProperties",null),(0,r._)([(0,l.MZ)()],te.prototype,"selectedTraces",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"selectOnComplete",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"showGraphicsOnComplete",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"showSelectionAttributes",void 0),(0,r._)([(0,l.MZ)({readOnly:!0})],te.prototype,"state",null),(0,r._)([(0,l.MZ)()],te.prototype,"traceResults",void 0),(0,r._)([(0,l.MZ)()],te.prototype,"utilityNetwork",void 0),(0,r._)([(0,l.MZ)({value:null})],te.prototype,"view",null),te=(0,r._)([(0,o.$)("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")],te);const ie=te,re="esri-utility-trace-network",se={base:re,widgetIcon:h.T.polyline,loaderContainer:"".concat(re,"__loader-container"),loader:"".concat(re,"__loader"),fadeIn:"".concat(re,"--fade-in"),addButtonContainer:"".concat(re,"__add-button-container"),noticeContainer:"".concat(re,"__notice-container"),listContainer:"".concat(re,"__list-container"),resultsContainer:"".concat(re,"__results-container"),flow:"".concat(re,"__flow"),numberInput:"".concat(re,"__number-input"),clearPrompt:"".concat(re,"__reset-prompt"),promptDivider:"".concat(re,"__divider"),paddingTop:"".concat(re,"__padTop")};function le(e){return{height:e+"px"}}function ae(e){return{width:e+"px"}}function oe(e){return{width:"100%",height:window.getComputedStyle(e).getPropertyValue("max-height")}}function ne(e){return{display:"flex",flexDirection:e}}const ce=-2147208474;let ue=class extends c.A{constructor(e,t){super(e,t),this._selectToolActive=!1,this._activeTrace=null,this._activeSwatch="",this._traceHeaderForFlow="",this._assetGroupHeader="",this._assetTypeHeader="",this._traceResultsFunctions=[],this._traceResultsAssetGroup=[],this._traceResultsAssetType=[],this._traceResultsIndividual=[],this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this._activeTab="input",this._flagViewType="starting-point",this._alertRemoveModal=!1,this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoStartAssetFound=!1,this._warningNoBarrierAssetFound=!1,this._warningNoTerminal=!1,this._confirmReset=!1,this._showResultOptions=!1,this._resultObjectIdField="objectid",this._resultDisplayField="objectid",this._resultSortField="objectid",this._resultSortOrder="desc",this._swatchNode=null,this._individualResultNode=null,this._symbolStartFlag=null,this._symbolBarrier=null,this._watchHandler=null,this._loadUNError=!0,this._errorMessage="",this.disabled=!0,this.iconClass=se.widgetIcon,this.inputSettings=[],this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new ie,this._afterComponentCreate=this._afterComponentCreate.bind(this)}initialize(){this._utilityNetworkTraceInitialized(),this.addHandles((0,s.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.resultAreaProperties}),(()=>this.scheduleRender())))}get defaultGraphicColor(){return this.viewModel.defaultGraphicColor}set defaultGraphicColor(e){this.viewModel.defaultGraphicColor=e}get flags(){return this.viewModel.flags}set flags(e){this.viewModel.flags=e}get gdbVersion(){return this.viewModel.gdbVersion}set gdbVersion(e){this.viewModel.gdbVersion=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get resultAreaProperties(){return this.viewModel.resultAreaProperties}set resultAreaProperties(e){this.viewModel.resultAreaProperties=e}get selectedTraces(){return this.viewModel.selectedTraces}set selectedTraces(e){this.viewModel.selectedTraces=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get showGraphicsOnComplete(){return this.viewModel.showGraphicsOnComplete}set showGraphicsOnComplete(e){this.viewModel.showGraphicsOnComplete=e}get enableResultArea(){return this.viewModel.enableResultArea}set enableResultArea(e){this.viewModel.enableResultArea=e}get showSelectionAttributes(){return this.viewModel.showSelectionAttributes}set showSelectionAttributes(e){this.viewModel.showSelectionAttributes=e}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}async checkCanTrace(){this._confirmReset=!1;const e=this.viewModel.checkCanTrace();e.status?(this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoTraceSelected=!1,this._warningNoTerminal=!1,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this.switchTab("result"),this.viewModel._activeProgress=!0,this.viewModel.removeAllResultAreaGraphics(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):e.issues.forEach((e=>{switch(e){case"noStart":this._warningNoFlag=!0;break;case"noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=!0}}))}confirmReset(){this._confirmReset=!0}render(){const{state:e}=this.viewModel;this._mixCustomStrings(),this._overrideFlagSymbol();const t="loading"===e?this._renderWarningMessage("noTraceConfig",!1):this._renderUtilityNetworkTrace();return(0,y.K)("div",{class:this.classes(se.base,d.D.widget,d.D.panel,{[d.D.widgetDisabled]:this.disabled}),styles:{height:"100%"}},t)}loadDependencies(){return(0,u.W)({action:()=>Promise.all([i.e(39879),i.e(62785),i.e(48897),i.e(37918)]).then(i.bind(i,92111)),"action-group":()=>Promise.all([i.e(39879),i.e(62785),i.e(48347),i.e(60731),i.e(48897),i.e(53794),i.e(24706),i.e(67689)]).then(i.bind(i,67689)),"action-pad":()=>Promise.all([i.e(39879),i.e(62785),i.e(48347),i.e(60731),i.e(48897),i.e(53794),i.e(24706),i.e(21415)]).then(i.bind(i,43796)),block:()=>Promise.all([i.e(39879),i.e(62785),i.e(48347),i.e(60731),i.e(48897),i.e(53794),i.e(24706),i.e(14388)]).then(i.bind(i,14388)),"block-section":()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(50402)]).then(i.bind(i,50402)),button:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(75151),i.e(11309)]).then(i.bind(i,11309)),checkbox:()=>Promise.all([i.e(39879),i.e(95203),i.e(92022)]).then(i.bind(i,92022)),"color-picker-swatch":()=>Promise.all([i.e(39879),i.e(88012),i.e(95378)]).then(i.bind(i,95378)),combobox:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(48347),i.e(13859),i.e(85292),i.e(19246)]).then(i.bind(i,19246)),"combobox-item":()=>Promise.all([i.e(39879),i.e(79012)]).then(i.bind(i,79012)),flow:()=>i.e(14961).then(i.bind(i,14961)),"flow-item":()=>Promise.all([i.e(39879),i.e(62785),i.e(48347),i.e(60731),i.e(48897),i.e(53794),i.e(24706),i.e(46269),i.e(40661)]).then(i.bind(i,40661)),icon:()=>Promise.all([i.e(39879),i.e(95012)]).then(i.bind(i,95012)),"input-number":()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(93073),i.e(75680)]).then(i.bind(i,23131)),label:()=>Promise.all([i.e(39879),i.e(65423)]).then(i.bind(i,65423)),list:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(13859),i.e(79545),i.e(58838)]).then(i.bind(i,58838)),"list-item":()=>Promise.all([i.e(39879),i.e(62785),i.e(48897),i.e(3732)]).then(i.bind(i,84661)),loader:()=>i.e(76454).then(i.bind(i,76454)),notice:()=>Promise.all([i.e(39879),i.e(62785),i.e(81985)]).then(i.bind(i,81985)),option:()=>i.e(70383).then(i.bind(i,92764)),panel:()=>Promise.all([i.e(39879),i.e(62785),i.e(48347),i.e(60731),i.e(48897),i.e(53794),i.e(24706),i.e(46269),i.e(74199)]).then(i.bind(i,74199)),popover:()=>Promise.all([i.e(39879),i.e(62785),i.e(48347),i.e(60731),i.e(48897),i.e(53794),i.e(42821)]).then(i.bind(i,72552)),scrim:()=>Promise.all([i.e(39879),i.e(62785),i.e(3735)]).then(i.bind(i,3735)),select:()=>Promise.all([i.e(39879),i.e(95203),i.e(81381)]).then(i.bind(i,81381)),tab:()=>Promise.all([i.e(39879),i.e(89458)]).then(i.bind(i,89458)),"tab-nav":()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(75151),i.e(11816),i.e(66666)]).then(i.bind(i,66666)),"tab-title":()=>Promise.all([i.e(39879),i.e(62785),i.e(72227),i.e(47922)]).then(i.bind(i,68693)),tabs:()=>i.e(59473).then(i.bind(i,59473)),tooltip:()=>Promise.all([i.e(39879),i.e(48347),i.e(73786)]).then(i.bind(i,73786))})}switchTab(e){this._activeTab=e}switchToFunctions(e,t){this._traceResultsFunctions=e,this._showTraceResultFunctions=t}switchToAssetGroup(e,t,i){this._traceHeaderForFlow=t,this._traceResultsAssetGroup=e,this._showTraceResultAssetGroup=i}switchToAssetType(e,t,i){this._assetGroupHeader=t,this._traceResultsAssetType=e,this._showTraceResultAssetType=i}switchToIndividualRecords(e,t,i){this._assetTypeHeader=t,this._traceResultsIndividual=e,this._showIndividualRecords=i}_renderUtilityNetworkTrace(){const{messages:e,messagesCommon:t}=this;let i=(0,y.K)("calcite-tabs",{layout:"center",position:"top",styles:oe(this.container)},(0,y.K)("calcite-tab-nav",{slot:"title-group"},(0,y.K)("calcite-tab-title",{onclick:()=>{this.switchTab("input")},selected:"input"===this._activeTab},e.inputsStrings.headerTabInputs),(0,y.K)("calcite-tab-title",{onclick:()=>{this.switchTab("result")},selected:"result"===this._activeTab},e.resultsStrings.headerTabResults)),(0,y.K)("calcite-tab",{selected:"input"===this._activeTab},this._renderInputPanel()),(0,y.K)("calcite-tab",{selected:"result"===this._activeTab},this.viewModel._activeProgress?(0,y.K)("calcite-loader",{label:e.alertsStrings.traceExecuting,text:e.alertsStrings.traceExecuting,type:"indeterminate"}):this.viewModel.traceResults.length>0?this._renderResultPanel():this._renderWarningMessage("noTraceExecuted",!1),this._confirmReset?(0,y.K)("calcite-scrim",{key:"prompt"},(0,y.K)("div",{class:se.clearPrompt},(0,y.K)("h3",{slot:"header"},e.resultsStrings.startOverButton),(0,y.K)("div",{slot:"content"},e.resultsStrings.startOverValidation),(0,y.K)("div",{class:se.promptDivider}),(0,y.K)("div",{styles:ne("row")},(0,y.K)("calcite-button",{appearance:"outline",onclick:()=>{this._confirmReset=!1},slot:"secondary",width:"full"},t.cancel),(0,y.K)("calcite-button",{onclick:()=>{this._confirmReset=!1,this.viewModel.reset(),this.switchTab("input")},slot:"primary",width:"full"},t.form.ok)))):null));return 0===this.viewModel.traces.length&&(i=(0,y.K)("calcite-panel",null,this._renderWarningMessage("noTraceConfig",!1))),this._loadUNError||(i=(0,y.K)("calcite-panel",null,this._renderWarningMessage("loadUNError",!1,this._errorMessage))),i}_renderInputPanel(){const{messages:e}=this;return(0,y.K)("calcite-flow",{class:se.flow},(0,y.K)("calcite-flow-item",null,this._warningNoFlag?this._renderWarningMessage("flag",!0):null,this._warningNoTerminal?this._renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this._renderWarningMessage("trace",!0):null,this._renderTraceSelectorContainer(),this._renderStartFlagsContainer(),this._renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?(0,y.K)("div",{styles:le(10)}):null,(0,y.K)("calcite-button",{kind:"brand",onclick:()=>{this.checkCanTrace()},scale:"m",slot:"footer",width:"full"},e.tracingStrings.runTrace)),this._selectToolActive?this._renderActiveTool():null)}_renderResultPanel(){return(0,y.K)("calcite-flow",{styles:{height:"100%"}},this._renderTraceResults(),this._showTraceResultFunctions?this._renderTraceResultFunctions():null,this._showTraceResultAssetGroup?this._renderTraceResultByAssetGroup():null,this._showTraceResultAssetType?this._renderTraceResultByAssetType():null,this._showIndividualRecords?this._renderTraceResultIndividual():null,this._showIndividualRecords?this._renderTraceResultIndividualPopover():null)}_renderStartFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter((e=>"starting-point"===e.type)),i.forEach((e=>{e.displayValue&&t.push(this._renderFlagRow(e,"start"))}));let r=null;return this._symbolStartFlag&&(r=this._getSymbolIcon(this._symbolStartFlag)),(0,y.K)("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerStartingPoint+" ("+i.length+")",open:!0,overlayPositioning:"fixed"},(0,y.K)("div",{slot:"icon"},r||(0,y.K)("calcite-icon",{icon:"pin",scale:"s"})),(0,y.K)("div",null,e.inputsStrings.startingPointHint),(0,y.K)("div",{class:se.listContainer},t),this._warningNoStartAssetFound?this._renderWarningMessage("noStartAsset",!0):null,(0,y.K)("div",{class:se.addButtonContainer},(0,y.K)("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="starting-point",this._selectToolActive=!0,this._warningNoStartAssetFound=!1,this.viewModel.addFlagByHit("starting-point",this._symbolStartFlag).then((e=>{this._changeCursor("default"),e?this._warningNoFlag=!1:this._warningNoStartAssetFound=!0,this._selectToolActive=!1}))},round:!0,scale:"m"})))}_renderBarriersFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter((e=>"barrier"===e.type)),i.forEach((e=>{e.displayValue&&t.push(this._renderFlagRow(e,"barrier"))}));let r=null;return this._symbolBarrier&&(r=this._getSymbolIcon(this._symbolBarrier)),(0,y.K)("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerBarrier+" ("+i.length+")",open:!1,overlayPositioning:"fixed"},(0,y.K)("div",{slot:"icon"},r||(0,y.K)("calcite-icon",{icon:"x-circle-f",scale:"s"})),(0,y.K)("div",null,e.inputsStrings.barrierPointHint),(0,y.K)("div",{class:se.listContainer},t),this._warningNoBarrierAssetFound?this._renderWarningMessage("noBarrierAsset",!0):null,(0,y.K)("div",{class:se.addButtonContainer},(0,y.K)("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",kind:"brand",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="barrier",this._selectToolActive=!0,this._warningNoBarrierAssetFound=!1,this.viewModel.addFlagByHit("barrier",this._symbolBarrier).then((e=>{this._changeCursor("default"),e||(this._warningNoBarrierAssetFound=!0),this._selectToolActive=!1}))},round:!0,scale:"m"})))}_renderFlagRow(e,t){var i,r;const{messages:s,messagesCommon:l}=this,a=[];let o=!1;return null!=e.allTerminals&&e.allTerminals.terminals.length>0&&(o=!0,e.allTerminals.terminals.forEach((t=>{var i;let r=!1;null!==e&&void 0!==e&&null!==(i=e.selectedTerminals)&&void 0!==i&&i.includes(t.id)&&(r=!0),a.push((0,y.K)("calcite-combobox-item",{key:t.name,selected:r,textLabel:t.name,value:t.id}))}))),(0,y.K)("calcite-block",{collapsible:null!==e.allTerminals||"barrier"===e.type,heading:null!==(i=null===(r=e.displayValue)||void 0===r?void 0:r.value)&&void 0!==i?i:"",key:"pop"+e.globalId+e.type+e.id+t,overlayPositioning:"fixed"},(0,y.K)("calcite-action",{icon:"trash",label:l.remove,onclick:()=>{this.viewModel.removeFlag(e)},scale:"s",slot:"header-menu-actions",text:l.remove,textEnabled:!0}),(0,y.K)("calcite-action",{icon:"zoom-to-object",label:s.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(e.details.geometry)},scale:"s",slot:"header-menu-actions",text:s.globalStrings.zoomToFeature,textEnabled:!0}),"barrier"===e.type?(0,y.K)("calcite-label",{layout:"inline",scale:"s"},(0,y.K)("calcite-checkbox",{checked:e.isFilterBarrier,onclick:()=>{this.viewModel.manageFilterBarrier(!e.isFilterBarrier,e)},scale:"s"}),s.inputsStrings.barrierFilter):null,o?(0,y.K)("calcite-combobox",{label:s.globalStrings.selectTerminalPlaceholder,maxItems:0,placeholder:s.globalStrings.selectTerminalPlaceholder,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:t=>{t.target.selectedItems.length>0?(e.selectedTerminals=[],t.target.selectedItems.forEach((t=>{this.viewModel.addTerminal(t.value,e)}))):e.selectedTerminals=[]},onCalciteComboboxChipClose:t=>{t.preventDefault(),this.viewModel.removeTerminal(t.target.value,e)}},a):null)}_renderActiveTool(){const{messages:e}=this;let t=null;return"starting-point"===this._flagViewType?this._symbolStartFlag&&(t=this._getSymbolIcon(this._symbolStartFlag)):this._symbolBarrier&&(t=this._getSymbolIcon(this._symbolBarrier)),(0,y.K)("calcite-flow-item",{heading:e.inputsStrings.addPointOption,onCalciteFlowItemBack:()=>{var e;this.viewModel._clickHandler&&(this.viewModel._clickHandler.remove(),null!==(e=this.view)&&void 0!==e&&e.popup&&(this.view.popupEnabled=!0)),this._selectToolActive=!1}},(0,y.K)("calcite-block",{collapsible:!1,heading:"",open:!0,overlayPositioning:"fixed"},(0,y.K)("div",{styles:{textAlign:"center",padding:"1rem"}},t||(0,y.K)("calcite-icon",{icon:"starting-point"===this._flagViewType?"pin-plus":"x-circle-f",scale:"m"})),(0,y.K)("div",{styles:{textAlign:"center",padding:"1rem"}},e.inputsStrings.addPointHint)))}_renderTraceSelectorContainer(){const{messages:e}=this,t=[];let i=e.tracingStrings.traceOperation,r=0;return this.viewModel.traces.length>0&&this.viewModel.traces.forEach((e=>{t.push((0,y.K)("calcite-combobox-item",{key:e.globalId,selected:e.selected,textLabel:e.title,value:e.globalId,onCalciteComboboxItemChange:e=>{const t=e.target;this.viewModel.selectTraces(t.selected,t.value),this.viewModel.traces.length>0&&(this._warningNoTraceSelected=!1)}})),e.selected&&r++})),i+=" (".concat(r,")"),(0,y.K)("calcite-block",{collapsible:!0,heading:i,open:!0,overlayPositioning:"fixed"},(0,y.K)("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),(0,y.K)("calcite-combobox",{label:e.inputsStrings.selectTraces,maxItems:0,overlayPositioning:"fixed",placeholder:e.inputsStrings.selectTraces,scale:"s",selectionMode:"multiple"},t))}_renderStartOverContainer(){const{messages:e}=this;return(0,y.K)("calcite-button",{kind:"brand",onclick:()=>{this.confirmReset()},scale:"m",slot:"footer",width:"full"},e.resultsStrings.startOverButton)}_renderWarningMessage(e,t,i){const{messages:r}=this;let s=r.alertsStrings.NoRunAlertHeader,l=r.alertsStrings.noResultsInfo;switch(e){case"flag":s=r.alertsStrings.startingPointAlertHeader,l=r.alertsStrings.startingPointAlert;break;case"noTerminal":s=r.alertsStrings.noTerminalDefinedHeader,l=r.alertsStrings.noTerminalDefined;break;case"trace":s=r.alertsStrings.selectTraceAlertHeader,l=r.alertsStrings.selectTraceAlert;break;case"noTraceExecuted":s=r.alertsStrings.NoRunAlertHeader,l=r.alertsStrings.noResultsInfo;break;case"noBarrierAsset":case"noStartAsset":s=r.alertsStrings.noAssetsFoundHeader,l=r.alertsStrings.noAssetFound;break;case"noTraceConfig":s="",l=r.alertsStrings.noTraceSupported;break;default:s=r.alertsStrings.genericErrorHeader,l=i||""}return(0,y.K)("div",{class:se.noticeContainer,key:e},(0,y.K)("calcite-notice",{closable:t,icon:!0,key:e,kind:"danger",open:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>{switch(e){case"flag":this._warningNoFlag=!1;break;case"noTerminal":this._warningNoTerminal=!1;break;case"trace":this._warningNoTraceSelected=!1;break;case"noStartAsset":this._warningNoStartAssetFound=!1;break;case"noBarrierAsset":this._warningNoBarrierAssetFound=!1}}},(0,y.K)("div",{slot:"title"},s),(0,y.K)("div",{slot:"message"},l)))}_renderRemoveTraceContainer(e){const{messages:t}=this;return(0,y.K)("calcite-action",{icon:"trash",label:t.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0,this._activeTrace=e.trace},scale:"s",slot:"header-menu-actions",text:t.globalStrings.clearResults,textEnabled:!0})}_renderHighlightColorPicker(e,t,i){const{messages:r}=this,{graphicHandler:s}=this.viewModel,l=[],a=new RegExp("^".concat(e.hex,"$"),"i"),o=s.highlightColor.length>V.length?5:4;for(const n of s.highlightColor)l.push((0,y.K)("calcite-action",{active:a.test(n.hex),key:n.hex,label:r.resultsStrings.graphicColor,onclick:()=>{"aggregate"===i?this.viewModel.changeResultGraphicColor(n,t):this.viewModel.changeResultAreaColor(t,n)},scale:"s",text:r.resultsStrings.graphicColor},(0,y.K)("calcite-color-picker-swatch",{active:a.test(n.hex),color:n.hex,scale:"s"})));return(0,y.K)("calcite-action-pad",{expandDisabled:!0,layout:"grid",position:"start"},(0,y.K)("calcite-action-group",{columns:o,layout:"grid"},l))}_renderTraceResults(){const{messages:e,messagesCommon:t}=this,{selectFeatures:i}=e.resultsStrings,r=this.viewModel.traceResults,s=[];return r.forEach(((t,r)=>{var l,a,o,n,c,u,d;let h=[],p=[],g=!1,v=!1,m=!1,f="";null!==t.results&&t.results.hasOwnProperty("elements")?(null!==t.results.aggregatedGeometry&&(v=!0),null!==t.results.globalFunctionResults&&t.results.globalFunctionResults.length>0&&(p=t.results.globalFunctionResults,p.length>0&&(m=!0)),t.results.elements&&t.results.elements.length>0&&(h=t.results.elements,h.length>0&&(g=!0)),(v||g)&&(f=null===(l=this.messagesUnits.units[null===(a=t.resultArea)||void 0===a?void 0:a.unit])||void 0===l?void 0:l.abbr),s.push((0,y.K)("calcite-block",{collapsible:!0,description:null!==(o=t.trace.description)&&void 0!==o?o:"",heading:t.trace.title,key:"".concat(t.trace.title).concat(r),open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(t),(0,y.K)("calcite-list",null,m?(0,y.K)("calcite-list-item",{label:e.resultsStrings.functionHeader+" ("+p.length+")",onCalciteListItemSelect:()=>{this.switchToFunctions(p,!0)}},(0,y.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,g&&this.viewModel.showSelectionAttributes?(0,y.K)("calcite-list-item",{key:this.id,label:e.resultsStrings.viewFeatures+" ("+h.length+")",onCalciteListItemSelect:()=>{this.switchToAssetGroup(this._groupResultsByAssetGroup(t),t.trace.title+" ("+h.length+")",!0)}},(0,y.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?(0,y.K)("calcite-label",{layout:"inline",scale:"s"},e.resultsStrings.noSelectionResults):null),g?(0,y.K)("div",{class:se.paddingTop},(0,y.K)("calcite-label",{layout:"inline",onclick:e=>{e.preventDefault(),e.stopPropagation(),this.viewModel.mergeSelection(!t.selectionEnabled,t.trace)},scale:"s"},(0,y.K)("calcite-checkbox",{checked:t.selectionEnabled,onclick:e=>{e.preventDefault(),e.stopPropagation(),this.viewModel.mergeSelection(!t.selectionEnabled,t.trace)},scale:"m"}),this.viewModel.showSelectionAttributes?i:"".concat(i," (").concat(h.length,")"))):null,v?(0,y.K)("calcite-block-section",{key:"aggregate-".concat(t.trace.title,"-").concat(r),open:t.graphicEnabled,text:e.resultsStrings.highlightTrace,toggleDisplay:"switch",onCalciteBlockSectionToggle:e=>{e.target.open?this.viewModel.changeResultGraphicColor(t.graphicColor,t):this.viewModel.removeResultGraphicFromView(t)}},(0,y.K)("calcite-list",{selectionMode:"none"},(0,y.K)("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:e=>{const t=e.target;this._swatchNode=t,this._activeSwatch="aggGeom_"+r}},(0,y.K)("calcite-color-picker-swatch",{color:t.graphicColor.hex,scale:"s",slot:"actions-end"})))):null,this.enableResultArea&&(v||g)?(0,y.K)("calcite-block-section",{key:"area-".concat(t.trace.title,"-").concat(r),open:null===(n=t.resultArea)||void 0===n?void 0:n.show,text:e.resultsStrings.resultAreaHeader,toggleDisplay:"switch",onCalciteBlockSectionToggle:e=>{e.target.open?t.resultAreaGraphic?this.viewModel.addResultAreaToMap(t,t.resultAreaGraphic):this.viewModel.addResultAreaToMap(t):this.viewModel.removeResultAreaFromMap(t)}},(0,y.K)("calcite-list",{selectionMode:"none"},(0,y.K)("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:e=>{const t=e.target;this._swatchNode=t,this._activeSwatch="resultArea_"+r}},(0,y.K)("calcite-color-picker-swatch",{color:null===(c=t.resultArea)||void 0===c?void 0:c.color.hex,scale:"s",slot:"actions-end"}))),(0,y.K)("calcite-list",{selectionMode:"none"},(0,y.K)("calcite-list-item",{label:e.resultsStrings.resultAreaBuffer},(0,y.K)("calcite-input-number",{afterCreate:this._afterComponentCreate,class:se.numberInput,max:999999,maxLength:999999,min:0,scale:"s",slot:"actions-end",suffixText:f,value:null===(u=t.resultArea)||void 0===u?void 0:u.distance.toString(),onCalciteInputNumberChange:e=>{var i;if(null===(i=this.view)||void 0===i||!i.popup)return;this.view.popup.visible&&this.view.closePopup();const r=e.target;t.resultArea.distance>=0?(t.resultArea.distance=parseInt(r.value,10),this.viewModel.removeResultAreaFromMap(t),this.viewModel.addResultAreaToMap(t)):(t.resultArea.distance=0,this.viewModel.removeResultAreaFromMap(t),this.viewModel.addResultAreaToMap(t))}})))):null,(0,y.K)("calcite-popover",{autoClose:!0,closable:!0,label:e.resultsStrings.graphicColor,offsetDistance:0,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+r||this._activeSwatch==="resultArea_"+r,placement:"auto-start",referenceElement:this._swatchNode,scale:"s",onCalcitePopoverClose:()=>{this._swatchNode=null,this._activeSwatch=null}},this._renderHighlightColorPicker(this._activeSwatch==="resultArea_"+r?null===(d=t.resultArea)||void 0===d?void 0:d.color:t.graphicColor,t,this._activeSwatch==="resultArea_"+r?"resultArea":"aggregate"))))):s.push((0,y.K)("calcite-block",{collapsible:!1,heading:t.trace.title,key:"error-"+r,open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(t),this._renderWarningMessage("noController",!1,t.status)))})),(0,y.K)("calcite-flow-item",{key:"traceResults",styles:{height:"100%"}},s,this._renderStartOverContainer(),this._alertRemoveModal?(0,y.K)("calcite-scrim",{key:"prompt"},(0,y.K)("div",{class:se.clearPrompt},(0,y.K)("h3",{slot:"header"},e.globalStrings.clearResults),(0,y.K)("div",{slot:"content"},e.alertsStrings.clearResultsAlert),(0,y.K)("div",{class:se.promptDivider}),(0,y.K)("div",{styles:ne("row")},(0,y.K)("calcite-button",{appearance:"outline",onclick:()=>{this._alertRemoveModal=!1},slot:"secondary",width:"full"},t.cancel),(0,y.K)("calcite-button",{onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace),this._alertRemoveModal=!1,0===this.viewModel.traceResults.length?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1)},slot:"primary",width:"full"},t.form.ok)))):null)}_renderTraceResultFunctions(){const{messages:e}=this,t=this._traceResultsFunctions,i=[];return t.forEach((e=>{i.push(this._renderResultRowFunctions(e))})),(0,y.K)("calcite-flow-item",{heading:e.resultsStrings.functionHeader,key:"functionResultMultiple",onCalciteFlowItemBack:()=>{this.switchToFunctions([],!1)}},i,this._renderStartOverContainer())}_renderTraceResultByAssetGroup(){const e=this._traceResultsAssetGroup,t=[];for(const i in e){const r=e[i];for(const e in r)t.push(this._renderResultRowAssetGroup(r[e]))}return(0,y.K)("calcite-flow-item",{heading:this._traceHeaderForFlow,key:"assetGroupResultMultiple",onCalciteFlowItemBack:()=>{this.switchToAssetGroup([],"",!1)}},(0,y.K)("calcite-list",null,t),this._renderStartOverContainer())}_renderTraceResultByAssetType(){const e=this._traceResultsAssetType,t=[];for(const i in e)e[i].length>0&&t.push(this._renderResultRowAssetType(e[i]));return(0,y.K)("calcite-flow-item",{heading:this._assetGroupHeader,key:"assetTypeResult",onCalciteFlowItemBack:()=>{this.switchToAssetType([],"",!1)}},(0,y.K)("calcite-list",{selectionMode:"none"},t),this._renderStartOverContainer())}_renderTraceResultIndividual(){const{messages:e}=this,t=this._traceResultsIndividual;t.sort(this._compare(this._resultSortField,this._resultSortOrder));const i=[];var r,s;t.length>0&&(null!==(r=null===(s=t[0].details)||void 0===s?void 0:s.fields.some((e=>{let{name:t}=e;return t.toLowerCase()===this._resultDisplayField.toLocaleLowerCase()})))&&void 0!==r&&r||(this._resultDisplayField=this._resultObjectIdField,this._resultSortField=this._resultObjectIdField),t.forEach((e=>{(null===e||void 0===e?void 0:e.details)&&i.push(this._renderResultRowIndividual(e))})),0===i.length&&i.push((0,y.K)("calcite-list-item",{label:e.resultsStrings.noFeaturesInMap})));return(0,y.K)("calcite-flow-item",{heading:this._assetTypeHeader,key:"individualResult",onCalciteFlowItemBack:()=>{this._showResultOptions=!1,this.switchToIndividualRecords([],"",!1)}},(0,y.K)("calcite-action",{afterCreate:p.cA,bind:this,"data-node-ref":"_individualResultNode",icon:"gear",id:"field_options"+this.id,label:e.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},scale:"m",slot:"header-actions-end",text:e.resultsStrings.displayAttribute}),(0,y.K)("calcite-list",{selectionMode:"none"},i),this._renderStartOverContainer())}_renderTraceResultIndividualPopover(){const{messages:e}=this,t=this._traceResultsIndividual,i=[],r=[];return t.length>0&&(t[0].details?t[0].details.fields.forEach((e=>{let{name:t,alias:s}=e;i.push((0,y.K)("calcite-option",{key:"display-".concat(t),label:null!==s&&void 0!==s?s:t,selected:t===this._resultDisplayField,value:t})),r.push((0,y.K)("calcite-option",{key:"sort-".concat(t),label:null!==s&&void 0!==s?s:t,selected:t===this._resultSortField,value:t}))})):(i.push((0,y.K)("calcite-option",{key:"display-".concat(this._resultDisplayField),label:this._resultDisplayField,value:this._resultDisplayField})),r.push((0,y.K)("calcite-option",{key:"sort-".concat(this._resultDisplayField),label:this._resultDisplayField,value:this._resultDisplayField})))),(0,y.K)("calcite-popover",{autoClose:!0,label:e.resultsStrings.displayAttribute,offsetDistance:0,offsetSkidding:0,open:this._showResultOptions,overlayPositioning:"fixed",placement:"left-start",referenceElement:this._individualResultNode,styles:null!==this.domNode?ae(.75*this.domNode.clientWidth):{width:"75%"}},(0,y.K)("calcite-block",{heading:"",open:!0,overlayPositioning:"fixed"},(0,y.K)("calcite-label",{scale:"s"},e.resultsStrings.displayAttribute,(0,y.K)("calcite-select",{label:e.resultsStrings.displayAttribute,scale:"s",onCalciteSelectChange:e=>{const t=e.target;this._resultDisplayField=t.selectedOption.value,this._showResultOptions=!1}},i)),(0,y.K)("calcite-label",{scale:"s"},e.resultsStrings.sortBy,(0,y.K)("calcite-select",{label:e.resultsStrings.sortBy,scale:"s",onCalciteSelectChange:e=>{const i=e.target;this._resultSortField=i.selectedOption.value,t.sort(this._compare(this._resultSortField,this._resultSortOrder)),this._traceResultsIndividual=t,this._showResultOptions=!1}},r))))}_renderResultRowFunctions(e){return(0,y.K)("calcite-block",{collapsible:!1,heading:e.networkAttributeName+" "+e.functionType+" = "+e.result,overlayPositioning:"fixed"})}_renderResultRowAssetGroup(e){const t=this._getAssetGroupName(e[0]);return(0,y.K)("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.switchToAssetType(this._groupResultsByAssetType(e),t+" ("+e.length+")",!0)}},(0,y.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowAssetType(e){const t=this._getAssetTypeName(e[0]);return(0,y.K)("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.viewModel.queryFeaturesById(e).then((i=>{if(null!==i&&void 0!==i&&i.length){this._resultObjectIdField=i[0].layer.objectIdField,"objectid"===this._resultDisplayField&&(this._resultDisplayField=i[0].layer.objectIdField),"objectid"===this._resultSortField&&(this._resultSortField=i[0].layer.objectIdField);const r=this._appendAttributes(e,i,"objectId");this.switchToIndividualRecords(r,t+" ("+e.length+")",!0)}else this.switchToIndividualRecords(e,t+" ("+e.length+")",!0)}))}},(0,y.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowIndividual(e){var t,i,r,s,l,a;const{messages:o}=this,c="display-".concat(e.objectId,"-nso"),{nonSpatialObject:u,zoomToFeature:d}=o.globalStrings;let h="",p=null;if(p=null===e||void 0===e||null===(t=e.details)||void 0===t?void 0:t.fields.find((e=>{let{name:t}=e;return t===this._resultDisplayField})),"date"===(null===(i=p)||void 0===i?void 0:i.type))h=new Date(e.details.attributes[this._resultDisplayField]).toDateString();else if("assetgroup"===this._resultDisplayField.toLowerCase())h=this._getAssetGroupName(e);else if("assettype"===this._resultDisplayField.toLowerCase())h=this._getAssetTypeName(e);else if(null!==(r=p)&&void 0!==r&&r.domain&&function(e){return e instanceof n.A}(p.domain)){const t=p.domain.codedValues.find((t=>{let{code:i}=t;return i===e.details.attributes[this._resultDisplayField]}));h=null===t||void 0===t?void 0:t.name}else h=null!==(s=null===(l=e.details)||void 0===l?void 0:l.attributes[this._resultDisplayField])&&void 0!==s?s:e.objectId;return h&&""!==h&&null!==h?"string"==typeof h&&(h.trim()||(h=o.resultsStrings.noValue)):h=o.resultsStrings.noValue,null!==(null===e||void 0===e||null===(a=e.details)||void 0===a?void 0:a.geometry)?(0,y.K)("calcite-list-item",{label:h,onCalciteListItemSelect:()=>{this.viewModel.zoomToAsset(e.details.geometry)}},(0,y.K)("calcite-icon",{icon:"zoom-to-object",scale:"s",slot:"content-end",textLabel:d})):(0,y.K)("calcite-list-item",{label:h},(0,y.K)("calcite-icon",{icon:"table",id:c,scale:"s",slot:"content-end",textLabel:u}),(0,y.K)("calcite-tooltip",{label:u,referenceElement:c},(0,y.K)("span",null,u)))}_afterComponentCreate(e){"value"in e&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"})}_mixCustomStrings(){const{messages:e}=this;this.inputSettings.length>0&&this.inputSettings.forEach((t=>{"starting-point"===t.type&&(e.inputsStrings.headerStartingPoint=t.label,e.inputsStrings.startingPointHint=t.description),"barrier"===t.type&&(e.inputsStrings.headerBarrier=t.label,e.inputsStrings.barrierPointHint=t.description)}))}_overrideFlagSymbol(){this.inputSettings.length>0&&this.inputSettings.forEach((e=>{"starting-point"===e.type?this._symbolStartFlag=e.symbol:this._symbolBarrier=e.symbol,this.viewModel.changeFlagSymbol(e.type,e.symbol)}))}_utilityNetworkTraceInitialized(){return this.viewModel.loadUtilityNetwork().then((e=>{var t;if(e)return this.viewModel.selectTracesOnLoad(),this._registerWatchers(),this.viewModel.flags.length>0&&this._processFlagOnLoad(),null===(t=this.view)||void 0===t?void 0:t.when().then((()=>{this._watchViewState()}));this.disabled=!1})).catch((e=>{const{messages:t}=this;this._loadUNError=!1,"utility-network:no-user-type-extension"===e.name||e.details.raw.extendedCode===ce?this._errorMessage=t.alertsStrings.noUserExtension:this._errorMessage=e.message,this.disabled=!1}))}_processFlagOnLoad(){var e;return null===(e=this.view)||void 0===e?void 0:e.when().then((()=>{this._watchHandler=(0,s.when)((()=>{var e;return!(null!==(e=this.view)&&void 0!==e&&e.updating)}),(async()=>{this._warningNoFlag=!1,this._warningNoBarrierAssetFound=!1,this._warningNoStartAssetFound=!1;const e=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher(),e.includes("barrier")&&(this._warningNoBarrierAssetFound=!0),e.includes("starting-point")&&(this._warningNoStartAssetFound=!0),this.disabled=!1,null!==this._watchHandler&&this._watchHandler.remove()}))}))}_registerWatchers(){this.addHandles([(0,s.watch)((()=>this.selectedTraces),(()=>{this.viewModel.selectTracesOnLoad(),this.scheduleRender()})),(0,s.watch)((()=>this.defaultGraphicColor),(()=>{this.viewModel.traceResults.length>0&&this.viewModel.traceResults.forEach((e=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,e)})),this.scheduleRender()}))])}_groupResultsByAssetGroup(e){var t;const i=[],r=null===(t=e.results)||void 0===t?void 0:t.elements,s=this._groupBy(null!==r&&void 0!==r?r:[],"networkSourceId");for(const l in s)i.push(this._groupBy(s[l],"assetGroupCode"));return i}_groupResultsByAssetType(e){return this._groupBy(e,"assetTypeCode")}_appendAttributes(e,t,i){const r=[];return e.forEach((e=>{t.forEach((t=>{t.featureSet.features.forEach((s=>{e[i]===s.attributes[this._resultObjectIdField]&&(e.details=s,e.details.fields=t.featureSet.fields,r.push(e))}))}))})),r}_getAssetGroupName(e){let t=e.assetGroupCode.toString();const i=e.assetGroupCode,r=this.viewModel.getValidSources().find((t=>t.sourceId===e.networkSourceId));if(r){const e=r.assetGroups.find((e=>e.assetGroupCode===i));e&&(t=e.assetGroupName)}return t}_getAssetTypeName(e){let t=e.assetTypeCode.toString();const i=e.assetGroupCode,r=this.viewModel.getValidSources().find((t=>t.sourceId===e.networkSourceId));if(r){const s=r.assetGroups.find((e=>e.assetGroupCode===i));if(s){const i=s.assetTypes.find((t=>t.assetTypeCode===e.assetTypeCode));i&&(t=i.assetTypeName)}}return t}_compare(e,t){return(i,r)=>{var s,l,a,o;let n=0,c=null!==(s=null===(l=i.details)||void 0===l?void 0:l.attributes[e])&&void 0!==s?s:i.objectId,u=null!==(a=null===(o=r.details)||void 0===o?void 0:o.attributes[e])&&void 0!==a?a:r.objectId;return isNaN(c)&&(c=c.toLowerCase()),isNaN(u)&&(u=u.toLowerCase()),"desc"===t?c>u?n=1:c<u&&(n=-1):c<u?n=1:c>u&&(n=-1),n}}_groupBy(e,t){return e.reduce(((e,i)=>((e[i[t]]=e[i[t]]||[]).push(i),e)),{})}_getSymbolIcon(e){var t;return"picture-marker"===e.type?(0,y.K)("img",{height:e.height,src:null!==(t=e.url)&&void 0!==t?t:void 0,width:e.width}):null}_watchViewState(){this._watchHandler=(0,s.when)((()=>{var e;return!(null!==(e=this.view)&&void 0!==e&&e.updating)}),(()=>{this.disabled=!1,null!==this._watchHandler&&this._watchHandler.remove()}),{initial:!0})}_changeCursor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";const i=null===(e=this.view)||void 0===e||null===(e=e.container)||void 0===e?void 0:e.style;i&&(i.cursor=t)}};(0,r._)([(0,l.MZ)()],ue.prototype,"_selectToolActive",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_activeTrace",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_activeSwatch",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_traceHeaderForFlow",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_assetGroupHeader",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_assetTypeHeader",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_traceResultsFunctions",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_traceResultsAssetGroup",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_traceResultsAssetType",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_traceResultsIndividual",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_showTraceResultFunctions",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_showTraceResultAssetGroup",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_showTraceResultAssetType",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_showIndividualRecords",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_activeTab",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_alertRemoveModal",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_warningNoFlag",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_warningNoTraceSelected",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_confirmReset",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_swatchNode",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"_errorMessage",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"defaultGraphicColor",null),(0,r._)([(0,l.MZ)()],ue.prototype,"disabled",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"flags",null),(0,r._)([(0,l.MZ)()],ue.prototype,"gdbVersion",null),(0,r._)([(0,l.MZ)()],ue.prototype,"iconClass",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"inputSettings",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"label",null),(0,r._)([(0,l.MZ)(),(0,g.G)("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],ue.prototype,"messages",void 0),(0,r._)([(0,l.MZ)(),(0,g.G)("esri/t9n/common")],ue.prototype,"messagesCommon",void 0),(0,r._)([(0,l.MZ)(),(0,g.G)("esri/core/t9n/Units")],ue.prototype,"messagesUnits",void 0),(0,r._)([(0,l.MZ)()],ue.prototype,"resultAreaProperties",null),(0,r._)([(0,l.MZ)()],ue.prototype,"selectedTraces",null),(0,r._)([(0,l.MZ)()],ue.prototype,"selectOnComplete",null),(0,r._)([(0,l.MZ)()],ue.prototype,"showGraphicsOnComplete",null),(0,r._)([(0,l.MZ)()],ue.prototype,"enableResultArea",null),(0,r._)([(0,l.MZ)()],ue.prototype,"showSelectionAttributes",null),(0,r._)([(0,l.MZ)()],ue.prototype,"utilityNetwork",null),(0,r._)([(0,l.MZ)()],ue.prototype,"view",null),(0,r._)([(0,v.U)(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection","add-result-area","remove-result-area","create-result-area"]),(0,l.MZ)({type:ie})],ue.prototype,"viewModel",void 0),ue=(0,r._)([(0,o.$)("esri.widgets.UtilityNetworkTrace")],ue);const de=ue},12254:(e,t,i)=>{function r(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);i.push(...r)}}i.d(t,{U:()=>r})}}]);
//# sourceMappingURL=46978.5f54839b.chunk.js.map
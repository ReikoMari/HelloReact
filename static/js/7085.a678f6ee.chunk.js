"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[7085],{84031:(e,t,s)=>{s.d(t,{T:()=>n});var i=s(50346),a=s(75540),r=s(22856);class n{constructor(){this._tasks=new Array,this._runningTasks=(0,a.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return r.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,s){return++this._runningTasks.value,new Promise(((i,a)=>this._tasks.push(new o(i,a,e,t,s)))).finally((()=>--this._runningTasks.value))}unshift(e,t,s){return++this._runningTasks.value,new Promise(((i,a)=>this._tasks.unshift(new o(i,a,e,t,s)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const a=(0,i.G4)(t.signal);if(a&&!t.abortCallback)t.reject((0,i.NK)());else{var s;const r=a?null===(s=t.abortCallback)||void 0===s?void 0:s.call(t,(0,i.NK)()):t.callback(e);(0,i.$X)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(n){t.reject(n)}return!0}cancelAll(){const e=(0,i.NK)();for(const t of this._tasks)if(t.abortCallback){const s=t.abortCallback(e);t.resolve(s)}else t.reject(e);this._tasks.length=0}}class o{constructor(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=e,this.reject=t,this.callback=s,this.signal=i,this.abortCallback=a}}},86994:(e,t,s)=>{s.d(t,{Cv:()=>u,L:()=>h,MX:()=>l,M_:()=>p,O_:()=>d,kL:()=>c,vA:()=>o,zH:()=>_});var i=s(72745),a=s(43047);const r=(0,s(55855).vt)();class n{constructor(e){this.message=e}toString(){return"AssertException: ".concat(this.message)}}function o(e,t){if(!e){t=t||"Assertion";const e=new Error(t).stack;throw new n("".concat(t," at ").concat(e))}}function l(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function d(e,t,s,i){let a,r=(s[0]-e[0])/t[0],n=(i[0]-e[0])/t[0];r>n&&(a=r,r=n,n=a);let o=(s[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(o>l&&(a=o,o=l,l=a),r>l||o>n)return!1;o>r&&(r=o),l<n&&(n=l);let d=(s[2]-e[2])/t[2],h=(i[2]-e[2])/t[2];return d>h&&(a=d,d=h,h=a),!(r>h||d>n)&&(h<n&&(n=h),!(n<0))}function h(e,t,s,a,r){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,i.vt)();const o=(a[r]-s[r])*(t[0]-e[0])-(a[0]-s[0])*(t[r]-e[r]),l=(a[0]-s[0])*(e[r]-s[r])-(a[r]-s[r])*(e[0]-s[0]);if(0===o)return!1;const d=l/o;return n[0]=e[0]+d*(t[0]-e[0]),n[1]=e[r]+d*(t[r]-e[r]),!0}function u(e,t,s,i,n){r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1,(0,a.t)(r,r,t),n.length>2&&(n[2]=-r[2]),(0,a.t)(r,r,s),o(0!==r[3]),n[0]=r[0]/r[3],n[1]=r[1]/r[3],n[2]=r[2]/r[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function c(e,t){return Math.log(e)/Math.log(t)}function p(e,t,s,i){e[12]=t,e[13]=s,e[14]=i}function _(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},98476:(e,t,s)=>{var i;s.d(t,{M:()=>i}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(i||(i={}))},59752:(e,t,s)=>{s.d(t,{Bb:()=>L,W6:()=>i,mj:()=>v,nu:()=>C});var i,a,r=s(88321),n=(s(81806),s(76460)),o=s(30726),l=s(32634),d=s(30015),h=s(50346),u=s(68134),c=s(75540),p=s(91417),_=s(84031),m=s(5551),g=s(98476),f=s(22856);function v(){return new A.Scheduler}(a=i||(i={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",a.RESOURCE_CONTROLLER="schedule",a.SLIDE="slide",a.STREAM_DATA_LOADER="stream loader",a.ELEVATION_QUERY="elevation query",a.TERRAIN_SURFACE="terrain",a.SURFACE_GEOMETRY_UPDATES="surface geometry updates",a.LOD_RENDERER="LoD renderer",a.GRAPHICS_CORE="Graphics3D",a.I3S_CONTROLLER="I3S",a.POINT_CLOUD_LAYER="point cloud",a.FEATURE_TILE_FETCHER="feature fetcher",a.OVERLAY="overlay",a.STAGE="stage",a.GRAPHICS_DECONFLICTOR="graphics deconflictor",a.FILTER_VISIBILITY="Graphics3D filter visibility",a.SCALE_VISIBILITY="Graphics3D scale visibility",a.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",a.POINT_OF_INTEREST_FREQUENT="POI frequent",a.POINT_OF_INTEREST_INFREQUENT="POI infrequent",a.LABELER="labeler",a.FEATURE_QUERY_ENGINE="feature query",a.FEATURE_TILE_TREE="feature tile tree",a.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",a.ELEVATION_ALIGNMENT="elevation alignment",a.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",a.TEXT_TEXTURE_ATLAS="text texture atlas",a.TEXTURE_UNLOAD="texture unload",a.LINE_OF_SIGHT_TOOL="line of sight tool",a.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",a.ELEVATION_PROFILE="elevation profile",a.SNAPPING="snapping",a.SHADOW_ACCUMULATOR="shadow accumulator",a.CLOUDS_GENERATOR="clouds generator",a[a.NONE=0]="NONE",a[a.TEST_PRIO=1]="TEST_PRIO";const b=new Map([[i.RESOURCE_CONTROLLER_IMMEDIATE,0],[i.RESOURCE_CONTROLLER,4],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.LOD_RENDERER,2],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.CLOUDS_GENERATOR,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.ELEVATION_ALIGNMENT_SCENE,14],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30]]);function E(e){return b.has(e)?b.get(e):"number"==typeof e?e:1}const y=(0,p.l5)(6.5),T=(0,p.l5)(1),w=(0,p.l5)(30),I=(0,p.l5)(1e3/30),R=(0,p.l5)(100);var A,k;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,c.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new s,this._state=g.M.INTERACTING,this._tasks=new d.A,this._runQueue=new d.A,this._load=0,this._idleStateCallbacks=new d.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.watch)((()=>m.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.initial);for(const t of Object.keys(i))this.performanceInfo.tasks.set(i[t],new l.A(i[t]));const e=this;this._test={FRAME_SAFETY_BUDGET:y,INTERACTING_BUDGET:I,IDLE_BUDGET:R,get availableBudget(){return e._budget.budget},usedBudget:0,getBudget:()=>e._budget,setBudget:t=>e._budget=t,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,o.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,s){const i=new t(this,e,s);return this._tasks.push(i),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.A(e)),i}registerIdleStateCallbacks(e,t){const s={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(s),this.state===g.M.IDLE&&this._idleUpdatesStartFired&&s.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(s),set idleBegin(e){i._idleUpdatesStartFired&&(s.idleEnd(),i._state===g.M.IDLE&&e()),s.idleBegin=e},set idleEnd(e){s.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==g.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){this._test.usedBudget=0,++this._frameNumber;let t=y,s=e.frameDuration,i=T;switch(this.state){case g.M.IDLE:t=(0,p.l5)(0),s=(0,p.l5)(Math.max(R,e.frameDuration)),i=w;break;case g.M.INTERACTING:s=(0,p.l5)(Math.max(I,e.frameDuration));case g.M.ANIMATING:}return s=(0,p.l5)(s-e.elapsedFrameTime-t),this.state!==g.M.IDLE&&s<T&&!this._forceTask?(this._forceTask=!0,!1):(s=(0,p.l5)(Math.max(s,i)),this._budget.reset(s,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case g.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case g.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset((0,p.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return k.SCHEDULED;let t=k.IDLE;return this._tasks.forAll((s=>{s.name===e&&s.needsUpdate&&(s.schedulePriority<=1?t=k.READY:t!==k.READY&&(t=k.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((s=>{s.name===e&&(t+=s.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,s)=>{t+=e>1?" ".concat(e,"x ").concat(s):" ".concat(s)})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((s=>{s.needsUpdate&&0!==s.schedulePriority&&0!==s.basePriority&&s.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,s.basePriority),1===s.schedulePriority?(s.schedulePriority=0,this._runQueue.push(s)):--s.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const s=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===f.G&&(a.blockFrame=this._frameNumber)}catch(t){n.A.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(a.name,'"'),t),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,i.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const r=this._budget.now()-s;if(a.runtime+=r,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+r),this._debug&&r>2*this._budget.budget&&console.log("Task",a.name,"used",r,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(i))this._frameTaskTimes.set(i[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,s){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new _.T,this._handles=new r.A,this._basePriority=E(t),this.schedulePriority=this._basePriority,this._task=(0,c.v)(null!=s?s:this._queue),this._handles.add((0,u.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(L),this._scheduler.removeTask(this),this.schedule=C.schedule,this.reschedule=C.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=E(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,s){return this._queue.push(e,t,s)}reschedule(e,t,s){return this._queue.unshift(e,t,s)}processQueue(e){return this._queue.runTask(e)}}class s{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=g.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=s}(A||(A={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(k||(k={}));const L=(()=>{const e=new A.Budget;return e.enabled=!1,e})();const C=new class{remove(){}processQueue(){}schedule(e,t,s){try{if((0,h.G4)(t)){const e=(0,h.NK)();return s?Promise.resolve(s(e)):Promise.reject(e)}return(0,h.z7)(e(L))}catch(i){return Promise.reject(i)}}reschedule(e,t,s){return this.schedule(e,t,s)}}},22856:(e,t,s)=>{s.d(t,{G:()=>i});const i=Symbol("Yield")},5551:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(35143),a=s(91967),r=s(46053),n=(s(81806),s(76460),s(47249),s(85842));let o=class extends a.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,i._)([(0,r.MZ)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,i._)([(0,r.MZ)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,i._)([(0,n.$)("esri.views.support.DebugFlags")],o);const l=new o},16239:(e,t,s)=>{s.r(t),s.d(t,{default:()=>se});var i=s(35143),a=s(28899),r=s(68134),n=s(46053),o=(s(81806),s(76460)),l=(s(47249),s(85842)),d=s(86300),h=s(25329),u=s(194),c=s(19276),p=s(49304),_=s(21403),m=s(9624),g=s(80963),f=s(18690),v=s(50076),b=s(50346),E=s(31933),y=s(64465),T=s(4225),w=s(44527),I=s(59801);async function R(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{basemap:s,view:i}=e;await s.load(t),function(e){if(0===e.baseLayers.length&&0===e.referenceLayers.length)return;const t=e.baseLayers.concat(e.referenceLayers).toArray().filter((e=>!(0,E.ce)(e))).map((e=>function(e){return new v.A("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}(e)));if(t.length)throw t[0]}(s),await async function(e,t,s){if(0===e.baseLayers.length)return;const i=e.baseLayers.at(0);if((0,E.r$)(i)){try{await i.load(s)}catch(a){const e="basemap-compatibility:unknown-error",t="Unknown basemap compatibility error",{name:s=e,message:i=t,details:r}=a;throw new v.A(s,i,r)}!function(e,t){var s;const i=t.state.viewingMode;if(!i)return;let a,r;if("wmts"===(null===e||void 0===e?void 0:e.type)){const s=(0,T.EM)(e,t.spatialReference,i);if(null==s.tileInfo)throw new v.A("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");a=s.tileInfo,r=s.fullExtent}else a=e.tileInfo,r=e.fullExtent;if(null==a)return;if(!(0,I.M)(a.spatialReference,i))throw new v.A("basemapgalleryitem:spatial-reference-unsupported-".concat((0,y._s)(i)),"Basemap spatial reference is unsupported in ".concat((0,y._s)(i)," mode"));const n=a.spatialReference.isGeographic,o="vector-tile"===(null===e||void 0===e?void 0:e.type)?a.getOrCreateCompatible(256,n?1:2):null;if(i===y.RT.Global){let t=(0,T._y)(a,r,null,i);if(t&&"vector-tile"===(null===e||void 0===e?void 0:e.type)&&null!=r&&o&&!(0,T._y)(o,r,null,i)&&(t=null),t){const e=a.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new v.A("basemapgalleryitem:tiling-scheme-unsupported-".concat(e,"-global"),"Basemap tiling scheme is unsupported in global mode",{error:t})}}else if(w.n.checkUnsupported(a))throw new v.A("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const l=null===(s=t.basemapTerrain)||void 0===s?void 0:s.tilingScheme;if(l&&!l.compatibleWith(a)&&("vector-tile"!==(null===e||void 0===e?void 0:e.type)||!o||!l.compatibleWith(o)))throw new v.A("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}(i,t)}}(s,i,t),(0,b.Te)(t)}async function A(e){var t,s;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{basemap:a,view:r}=e;(0,b.Te)(i);const n=null===(t=a.baseLayers.find((e=>"unknown"===e.type)))||void 0===t?void 0:t.loadError;if(null!=n)throw n;if(!r||"spatialReferenceLocked"in r&&!r.spatialReferenceLocked)return;if(await a.load(i),(0,b.Te)(i),0===a.baseLayers.length)return;const o=a.baseLayers.at(0);if(!(0,E.qK)(o))return;if(a.spatialReference){if(r.spatialReference.equals(a.spatialReference))return;k()}await o.load(i),(0,b.Te)(i);const l=(("supportedSpatialReferences"in o?o.supportedSpatialReferences:null)||["tileInfo"in o?null===(s=o.tileInfo)||void 0===s?void 0:s.spatialReference:null]).filter(f.Ru);0!==l.length&&l.every((e=>!r.spatialReference.equals(e)))&&k()}function k(){throw new v.A("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}var L=s(91967),C=s(5632);let S=class extends((0,C.sA)(L.A)){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([(0,r.watch)((()=>{var e;return null===(e=this.basemap)||void 0===e?void 0:e.loadStatus}),e),(0,r.watch)((()=>this.compatibilityFunction),e),(0,r.watch)((()=>{var e;return this.view&&"basemapTerrain"in this.view&&(null===(e=this.view.basemapTerrain)||void 0===e?void 0:e.tilingScheme)}),e),(0,r.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.ready}),e),(0,r.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.spatialReference}),e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return(0,d.n8)(this.view,this.basemap)}set basemap(e){e&&e.load().catch((()=>{})),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){var e;this._cancelRefresh(),this._set("state","loading");const t=null===(e=this.basemap)||void 0===e?void 0:e.loadStatus;if("loaded"!==t&&"failed"!==t)return;if(!this.compatibilityFunction)return void("loaded"===t?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const s=new AbortController,{signal:i}=s;this.compatibilityFunction(this,{signal:i}).then((()=>(0,r.whenOnce)((()=>!this._spatialReferenceTask.updating),i))).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((e=>{(0,b.zf)(e)||(this._set("state","error"),this._set("error",e))})),this._refreshController=s}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};(0,i._)([(0,n.MZ)({readOnly:!0})],S.prototype,"_spatialReferenceTask",null),(0,i._)([(0,n.MZ)()],S.prototype,"basemap",null),(0,i._)([(0,n.MZ)()],S.prototype,"compatibilityFunction",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],S.prototype,"error",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],S.prototype,"spatialReference",null),(0,i._)([(0,n.MZ)({readOnly:!0})],S.prototype,"state",void 0),(0,i._)([(0,n.MZ)()],S.prototype,"view",void 0),S=(0,i._)([(0,l.$)("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],S);const O=S,M=c.A.ofType(u.default);let N=class extends L.A{constructor(e){super(e),this.basemaps=new M}destroy(){this.basemaps.forEach((e=>e.destroy()))}get state(){return"ready"}refresh(){}};(0,i._)([(0,n.MZ)({type:M})],N.prototype,"basemaps",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],N.prototype,"state",null),N=(0,i._)([(0,l.$)("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],N);const B=N;var F=s(91291),P=s(65308);const U=c.A.ofType(u.default);let D=class extends(p.A.LoadableMixin((0,F.g)(B))){constructor(e){super(e),this._lastPortalBasemapFetchController=null,this.basemaps=new U,this.filterFunction=null,this.portal=P.A.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles((0,r.watch)((()=>{var e,t,s;return[this.filterFunction,this.loadStatus,null===(e=this.portal)||void 0===e?void 0:e.basemapGalleryGroupQuery,null===(t=this.portal)||void 0===t?void 0:t.basemapGalleryGroupQuery3D,null===(s=this.portal)||void 0===s?void 0:s.user,this.query,this.updateBasemapsCallback]}),(()=>this.refresh()),r.initial))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach((e=>e.destroy()))}get state(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),Promise.resolve(this)}async refresh(){if("loaded"!==this.loadStatus)return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const s=await e.fetchBasemaps(this._toQueryString(this.query),{signal:t.signal,include3d:"3d"===this.viewType||void 0});await this._updateBasemaps(s)}catch(s){if((0,b.zf)(s))throw s;o.A.getLogger(this).warn(new v.A("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:s})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&"string"!=typeof e?Object.keys(e).map((t=>"".concat(t,":").concat(e[t]))).join(" AND "):e}async _updateBasemaps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=await this._filterBasemaps(e);t=this.updateBasemapsCallback?await this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}async _filterBasemaps(e){if(!this.filterFunction)return e;const t=e.map(this.filterFunction),s=await Promise.all(t);return e.filter(((e,t)=>s[t]))}};(0,i._)([(0,n.MZ)({readOnly:!0,type:U})],D.prototype,"basemaps",void 0),(0,i._)([(0,n.MZ)()],D.prototype,"filterFunction",void 0),(0,i._)([(0,n.MZ)({type:P.A})],D.prototype,"portal",void 0),(0,i._)([(0,n.MZ)()],D.prototype,"query",void 0),(0,i._)([(0,n.MZ)({readOnly:!0})],D.prototype,"state",null),(0,i._)([(0,n.MZ)()],D.prototype,"updateBasemapsCallback",void 0),(0,i._)([(0,n.MZ)()],D.prototype,"viewType",void 0),D=(0,i._)([(0,l.$)("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],D);const G=D,Z=c.A.ofType(O);let x=class extends p.A{constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new Z,this.source=new G,this.view=null}initialize(){const e=()=>this._recreateItems();this.addHandles([(0,r.watch)((()=>"ready"===this.state?this.compatibilityFunction:null),(()=>this._updateItems())),(0,r.on)((()=>{var e;return null===(e=this.source)||void 0===e?void 0:e.basemaps}),"change",e,{onListenerAdd:e}),(0,r.when)((()=>this.view),(()=>{var e;this.source instanceof G&&(this.source.viewType=null===(e=this.view)||void 0===e?void 0:e.type)}),{once:!0})])}destroy(){var e;const t=this.source.basemaps.find((e=>e===this.activeBasemap));t&&this.source.basemaps.remove(t),null===(e=this.source)||void 0===e||e.destroy()}get activeBasemap(){var e,t;return null!==(e=null===(t=this.view)||void 0===t||null===(t=t.map)||void 0===t?void 0:t.basemap)&&void 0!==e?e:null}set activeBasemap(e){var t;const s=this.view;if(null===s||void 0===s||!s.map)return;const i="string"==typeof e?u.default.fromId(e):e;if(!i||!s.ready)return s.map.basemap=i,void this._clearOverride("activeBasemap");const a=i.spatialReference||(null===(t=this.items)||void 0===t||null===(t=t.find((e=>this.basemapEquals(i,e.basemap))))||void 0===t?void 0:t.spatialReference);if(a&&"spatialReferenceLocked"in s&&!s.spatialReferenceLocked){const t=s.spatialReference;if(null!=a&&!(0,g.aI)(t,a)&&!(0,m.canProjectWithoutEngine)(s.spatialReference,a)&&!(0,m.isLoaded)())return this._override("activeBasemap",i),this._loadingProjectionEngine=!0,void(0,m.load)().then((()=>{this._get("activeBasemap")===e&&(s.map.basemap=e,s.spatialReference=a,this._clearOverride("activeBasemap"))}),(()=>{})).then((()=>{this._loadingProjectionEngine=!1}));s.map.basemap=i,this._clearOverride("activeBasemap"),null==a||(0,g.aI)(s.spatialReference,a)||(s.spatialReference=a)}else s.map.basemap=i,this._clearOverride("activeBasemap")}get activeBasemapIndex(){const{state:e,activeBasemap:t}=this;return"ready"!==e?-1:this._findBasemapIndex(t)}get compatibilityFunction(){var e;return"3d"===(null===(e=this.view)||void 0===e?void 0:e.type)?R:A}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||c.A.isCollection(e)?new B({basemaps:e}):function(e){return e&&"esri.portal.Portal"===e.declaredClass}(e)?new G({portal:e}):function(e){return e&&!(e instanceof G)&&(!!e.portal||!!e.query)}(e)?new G(e):function(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}(e)?e:null}get state(){var e;return null!==(e=this.view)&&void 0!==e&&e.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return(0,d.jU)(e,t)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(e){return this.addResolvingPromise(p.A.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){const{items:t}=this,s=t.findIndex((t=>t.basemap===e));return-1===s?t.findIndex((t=>this.basemapEquals(t.basemap,e))):s}_recreateItems(){var e,t;const s=null!==(e=null===(t=this.source)||void 0===t?void 0:t.basemaps)&&void 0!==e?e:[],{view:i,compatibilityFunction:a}=this,r=new Map(this.items.map((e=>[e.basemap,e]))),n=s.map((e=>{const t=r.get(e);return t?(r.delete(e),t):new O({basemap:e,compatibilityFunction:a,view:i})}));this.items.removeAll(),this.items.addMany(n),r.forEach((e=>e.destroy()))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};(0,i._)([(0,n.MZ)()],x.prototype,"_loadingProjectionEngine",void 0),(0,i._)([(0,n.MZ)()],x.prototype,"activeBasemap",null),(0,i._)([(0,n.MZ)({readOnly:!0})],x.prototype,"activeBasemapIndex",null),(0,i._)([(0,n.MZ)()],x.prototype,"compatibilityFunction",null),(0,i._)([(0,n.MZ)({readOnly:!0,type:Z})],x.prototype,"items",void 0),(0,i._)([(0,n.MZ)()],x.prototype,"source",void 0),(0,i._)([(0,_.w)("source")],x.prototype,"castSource",null),(0,i._)([(0,n.MZ)({readOnly:!0})],x.prototype,"state",null),(0,i._)([(0,n.MZ)()],x.prototype,"view",void 0),x=(0,i._)([(0,l.$)("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],x);const Q=x;const H="esri-basemap-gallery",K={base:H,widgetIcon:s(15062).T.basemap,sourceLoading:"".concat(H,"--source-loading"),layoutGrid:"".concat(H,"--grid"),narrowItems:"".concat(H,"--narrow-items"),loader:"".concat(H,"__loader"),item:"".concat(H,"__item"),itemContainer:"".concat(H,"__item-container"),itemContent:"".concat(H,"__item-content"),itemTitle:"".concat(H,"__item-title"),itemTagsContainer:"".concat(H,"__item-tags-container"),itemThumbnail:"".concat(H,"__item-thumbnail"),selectedItem:"".concat(H,"__item--selected"),itemError:"".concat(H,"__item--error")};var V=s(77666),q=s(98108),Y=s(87540),j=s(20459),W=s(63582),$=s(54761),z=s(76099);const X=200,J=280,ee=420;let te=class extends h.A{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.iconClass=K.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new Q,this._focusBasemapItemEnabled=!1,this._container=null,this._width=0,this._onContainerCreated=e=>{this._container=e}}initialize(){this.addHandles([(0,z.EV)((()=>this._container),(e=>{let{contentRect:t}=e;this._width=t.width})),(0,r.when)((()=>this.source),(()=>this.viewModel.loadSource()),{sync:!0,initial:!0})])}loadDependencies(){return(0,V.W)({scrim:()=>Promise.all([s.e(39879),s.e(62785),s.e(3735)]).then(s.bind(s,3735)),chip:()=>Promise.all([s.e(39879),s.e(62785),s.e(28847)]).then(s.bind(s,28847))})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e="loading"===this.source.state,t=this.disabled||"disabled"===this.viewModel.state,s=this.viewModel.items,i={[K.sourceLoading]:e,[q.D.disabled]:t},a=this._width;a<=X||a>=ee?i[K.layoutGrid]=!0:a<J&&(i[K.narrowItems]=!0);const r=e?(0,$.K)("div",{class:K.loader,key:"loader"}):null,n=e?null:s.length>0?(0,$.K)("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:K.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},s.map(((e,t)=>this._renderBasemapGalleryItem(e,t))).toArray()):(0,$.K)("div",{class:q.D.empty,key:"empty-message"},(0,$.K)(Y.D,{level:this.headingLevel},this.messages.noBasemaps));return(0,$.K)("div",{afterCreate:this._onContainerCreated,class:this.classes(K.base,q.D.widget,q.D.panelHeightOnly,i),key:"container"},0===this._width?null:[r,n])}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:s,activeBasemapIndex:i}=this.viewModel,a="ArrowUp"===t||"ArrowLeft"===t?this._getRoundRobinIndex(Math.max(i-1,-1),s.length):this._getRoundRobinIndex(i+1,s.length),r=s.at(a);"ready"===(null===r||void 0===r?void 0:r.state)&&(this.viewModel.activeBasemap=r.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&0===e.tabIndex&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];"ready"===t.state&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){var s,i;const r=(0,d.hA)(e.basemap)||(0,a.s)("esri/themes/base/images/basemap-toggle-64.svg"),n=e.basemap.title,o=null===(s=e.basemap.portalItem)||void 0===s?void 0:s.snippet,l=(null===(i=e.error)||void 0===i?void 0:i.message)||o||n,{viewModel:{state:h,activeBasemapIndex:u}}=this,c=this.disabled||"disabled"===h,p=u===t,_=p||-1===u&&0===t?0:-1,m="loading"===h,g={[K.selectedItem]:p,[K.itemError]:"error"===e.state},f="basemapgallery-item-".concat(e.uid);return(0,$.K)("li",{afterUpdate:this._focusBasemapItem,"aria-checked":p.toString(),"aria-disabled":c.toString(),"aria-labelledby":f,bind:this,class:this.classes(K.item,g),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:_,title:l},(0,$.K)("img",{alt:"",class:K.itemThumbnail,src:r}),(0,$.K)("div",{class:K.itemContent,key:"content"},(0,$.K)("div",{class:K.itemTitle,key:"title"},(0,$.K)("span",{id:f},n)),(0,d.$P)(e.basemap)?this._renderTags(e.basemap):null),"loading"===e.state||p&&m?(0,$.K)("calcite-scrim",null,(0,$.K)("span",{"aria-hidden":"true",class:q.D.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return(0,$.K)("div",{class:K.itemTagsContainer,key:"tag"},this._render3DTag(),(0,d.t5)(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return(0,$.K)("calcite-chip",{key:"tag-3d",scale:"s",value:e.tag3D},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return(0,$.K)("calcite-chip",{appearance:"outline-fill",key:"tag-beta",scale:"s",value:e.tagBeta},this.messages.tagBeta)}};(0,i._)([(0,n.MZ)()],te.prototype,"activeBasemap",null),(0,i._)([(0,n.MZ)()],te.prototype,"disabled",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"headingLevel",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"iconClass",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"icon",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"label",null),(0,i._)([(0,n.MZ)(),(0,W.G)("esri/widgets/BasemapGallery/t9n/BasemapGallery")],te.prototype,"messages",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"source",null),(0,i._)([(0,n.MZ)()],te.prototype,"view",null),(0,i._)([(0,n.MZ)()],te.prototype,"viewModel",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"_focusBasemapItemEnabled",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"_container",void 0),(0,i._)([(0,n.MZ)()],te.prototype,"_width",void 0),(0,i._)([(0,j.$)()],te.prototype,"_handleClick",null),te=(0,i._)([(0,l.$)("esri.widgets.BasemapGallery")],te);const se=te}}]);
//# sourceMappingURL=7085.a678f6ee.chunk.js.map
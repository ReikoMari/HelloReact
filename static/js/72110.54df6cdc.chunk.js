"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[72110,10290],{61979:(e,t,i)=>{i.d(t,{$9:()=>p,Jz:()=>u,Mk:()=>g,Zk:()=>h,dP:()=>c,gz:()=>y,w6:()=>w});var r=i(35143),n=i(54099),s=i(53084),o=i(50346),a=(i(76460),i(81806),i(50076),i(85842)),d=i(35298);const l=new n.A.EventEmitter;function u(e){return l.on("apply-edits",new WeakRef(e))}function c(e){return l.on("update-moment",new WeakRef(e))}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=(0,o.Tw)();return r=null==t||r,l.emit("apply-edits",{serviceUrl:e,layerId:t,gdbVersion:i,mayReceiveServiceEdits:r,result:n.promise}),n}function p(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;l.emit("update-moment",{serviceUrl:e,layerId:t,gdbVersion:i,moment:r})}const v="esri.layers.mixins.EditBusLayer",f=Symbol(v);function g(e){return null!=e&&"object"==typeof e&&f in e}function m(e){return null!=e&&"object"==typeof e&&"gdbVersion"in e}function y(e,t,i){const r=new URL(e).host,n=d.Z3.get(r),s=e=>!e||e===n;return s(t)&&s(i)||t===i}const w=e=>{var t;let i=class extends e{constructor(){super(...arguments),this[t]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:i,gdbVersion:r,mayReceiveServiceEdits:n,result:o}=e,a=t===this.url,l=null!=i&&null!=this.layerId&&i===this.layerId,u=m(this),c=m(this)&&y(t,r,this.gdbVersion);if(!a||u&&!c||!l&&!n)return;const h=o.then((e=>{var t;if(l&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",(0,s.o8)(e)),e;const i=null===(t=e.editedFeatures)||void 0===t?void 0:t.find((e=>{let{layerId:t}=e;return t===this.layerId}));if(i){const{adds:t,updates:r,deletes:n}=i.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:t?t.map((e=>{let{attributes:t}=e;return{objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}})):[],deletedFeatures:n?n.map((e=>{let{attributes:t}=e;return{objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}})):[],updatedFeatures:r?r.map((e=>{let{current:{attributes:t}}=e;return{objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]}})):[],editedFeatures:(0,s.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(e.historicMoment)};return this.emit("edits",o),o}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,s.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(e.historicMoment)}})).then((e=>("historicMoment"in this&&this.historicMoment!==e.historicMoment&&(0,d.w5)(t,r)&&(this.historicMoment=e.historicMoment),e)));this.emit("apply-edits",{result:h})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:i,moment:r}=e,n=t===this.url,s=m(this),o=m(this)&&y(t,i,this.gdbVersion),a=m(this)&&!y(t,this.gdbVersion,null);n&&s&&o&&a&&"historicMoment"in this&&this.historicMoment!==r&&(this.historicMoment=r)},this.when().then((()=>{this.addHandles(u(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(c(this._updateMomentHandler))}),(()=>{}))}};return t=f,i=(0,r._)([(0,a.$)(v)],i),i}},96422:(e,t,i)=>{i.d(t,{K:()=>s,R:()=>o});var r=i(55171),n=i(3825);async function s(e,t,i){var s;if(!(null===r.id||void 0===r.id?void 0:r.id.findCredential(e.restUrl)))return null;if("loaded"===e.loadStatus&&""===t&&null!==(s=e.user)&&void 0!==s&&s.sourceJSON&&!1===i)return e.user.sourceJSON;const o={responseType:"json",query:{f:"json"}};if(i&&(o.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,n.A)(e.restUrl+"/community/self",o);if(t.data){const e=t.data;if(null!==e&&void 0!==e&&e.username)return e}return null}const a=await(0,n.A)(e.restUrl+"/community/users/"+t,o);if(a.data){const e=a.data;return e.error?null:e}return null}async function o(e,t,i){var r,n;const o=await s(e,t,!0);return null!==(r=null===o||void 0===o||null===(n=o.userLicenseTypeExtensions)||void 0===n?void 0:n.includes(i))&&void 0!==r&&r}},10290:(e,t,i)=>{i.d(t,{u:()=>o});var r=i(31633),n=i(80963);function s(e,t,i){if(null==e.hasM||e.hasZ)for(const r of t)for(const e of r)e.length>2&&(e[2]*=i)}function o(e,t,i){if(!e&&!t||!i)return;const n=(0,r.G9)(i);a(e,i,n),a(t,i,n)}function a(e,t,i){if(e)for(const r of e)d(r.geometry,t,i)}function d(e,t,i){if(null===e||void 0===e||!e.spatialReference||(0,n.aI)(e.spatialReference,t))return;const o=(0,r.G9)(e.spatialReference)/i;if(1!==o)if("x"in e)null!=e.z&&(e.z*=o);else if("rings"in e)s(e,e.rings,o);else if("paths"in e)s(e,e.paths,o);else if("points"in e&&(null==e.hasM||e.hasZ))for(const r of e.points)r.length>2&&(r[2]*=o)}},35298:(e,t,i)=>{i.d(t,{CD:()=>a,DC:()=>o,TA:()=>n,We:()=>d,Z3:()=>s,ZJ:()=>l,w5:()=>u});var r=i(3825);const n=(0,i(49723).vD)(),s=new Map,o=new Map,a=new Map;async function d(e,t,i){if(!e||!i)return!1;if(!t)return!0;const n=new URL(e).host;let o=s.get(n);if(!o){const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");o=(await(0,r.A)(t,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return o===t}async function l(e,t){var r;let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return!0;const a=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),d=null===(r=o.get(a))||void 0===r?void 0:r.entries();if(d)for(const[o,u]of d)if(u.name===t){var l;const e=!(null!==(l=u.stack)&&void 0!==l&&l.hasForwardEdits());if(!e&&s){const[{deleteForwardEdits:e},{default:t}]=await Promise.all([i.e(56868).then(i.bind(i,56868)),i.e(37028).then(i.bind(i,37028))]);return e(a,o,new t({sessionId:n,moment:u.moment}))}return e}return!0}function u(e,t){var i;if(!e)return!1;const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=null===(i=o.get(r))||void 0===i?void 0:i.entries();if(n)for(const[s,o]of n)if(o.name===t)return"edit"===o.lockType;return!1}},72110:(e,t,i)=>{i.r(t),i.d(t,{default:()=>H});var r=i(35143),n=i(91967),s=i(50076),o=i(76460),a=i(68134),d=i(46053),l=(i(81806),i(47249),i(85842)),u=i(19451),c=i(65308),h=i(96422),p=i(13096),v=i(3825),f=i(18690),g=i(5632),m=i(42553),y=i(53084),w=i(49304),E=i(28379),_=i(13312),V=i(38911),S=i(54610),k=i(61979),M=i(54994),I=i(10290),b=i(98136),F=i(35298);function L(e){return{isDataVersioned:(0,b.Vf)(e,"hasVersionedData",!1)}}function U(e,t){const i=e?e.toLowerCase().split(",").map((e=>e.trim())):[],r=i.includes("query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let s=n&&i.includes("create"),o=n&&i.includes("delete"),a=n&&i.includes("update");return n&&!(s||o||a)&&(s=o=a=!0),{supportsAdd:s,supportsDelete:o,supportsEditing:n,supportsChangeTracking:i.includes("changetracking"),supportsQuery:r,supportsQueryDataElements:(0,b.Vf)(t,"supportsQueryDataElements",!1),supportsQueryDomains:(0,b.Vf)(t,"supportsQueryDomains",!1),supportsQueryContingentValues:(0,b.Vf)(t,"supportsQueryContingentValues",!1),supportsSync:i.includes("sync"),supportsUpdate:a}}function C(e){return{maxRecordCountFactor:(0,b.kz)(e,"maxRecordCountFactor",void 0),maxRecordCount:(0,b.kz)(e,"maxRecordCount",void 0)}}function x(e){const t=null===e||void 0===e?void 0:e.advancedEditingCapabilities;return{supportsGlobalId:(0,b.Vf)(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:(0,b.Vf)(t,"supportsReturnServiceEditsInSourceSR",!1),supportsSplit:(0,b.Vf)(t,"supportsSplit",!1),supportsAsyncApplyEdits:(0,b.Vf)(t,"supportsAsyncApplyEdits",!1)}}function A(e){const t=null===e||void 0===e?void 0:e.syncCapabilities,i=null===t||void 0===t?void 0:t.supportedSyncDataOptions;return{supportsAsync:(0,b.Vf)(t,"supportsAsync",!1),supportedSyncDataOptions:{annotations:1==(1&i),dimensions:2==(2&i),contingentValues:4==(4&i),attributeRules:8==(8&i),utilityNetworkSystem:16==(16&i),annotationFullModel:32==(32&i),include3DObjects:64==(64&i),utilityNetworkMissingLayers:128==(128&i),preserveTrueCurves:256==(256&i)}}}let R=class extends((0,m.Te)((0,g.sA)(w.A))){constructor(e){super(e),this.url=null,this.sourceJSON=null,this.userTypeExtensions=[],this.layerInfos=[],this.tableInfos=[],this.capabilities=null}read(e,t){this.sourceJSON=e,super.read(e,t)}get utilityNetworkUrl(){for(const e of this.sourceJSON.layers)if("Utility Network Layer"===e.type)return"".concat(this.url,"/").concat(e.id);return null}get versionManagementServiceUrl(){return this.sourceJSON.hasBranchVersionedData?this.url.replace(/\/FeatureServer/i,"/VersionManagementServer"):null}readCapabilities(e,t){return function(e){return{data:L(e),sync:A(e),operations:U(e.capabilities,e),query:C(e),editing:x(e)}}(t)}load(e){return this.addResolvingPromise(this._fetchService(this.url,e)),Promise.resolve(this)}async applyEdits(e,t){let i=null;try{const{results:r,edits:n,editedFeatures:s}=await this._internalApplyEdits(e,t),o=e=>e.filter((e=>!e.error)).map(y.o8);let a=0;return r.map((e=>{i=(0,k.Zk)(this.url,e.id,null===t||void 0===t?void 0:t.gdbVersion,!0);const r={edits:n[a],addedFeatures:o(e.addFeatureResults),updatedFeatures:o(e.updateFeatureResults),deletedFeatures:o(e.deleteFeatureResults),addedAttachments:o(e.addAttachmentResults),updatedAttachments:o(e.updateAttachmentResults),deletedAttachments:o(e.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:e.editMoment?new Date(e.editMoment):null};a+=1,s.length>0&&(r.editedFeatures=s),i.resolve(r),i=null})),r}catch(r){throw i&&i.reject(r),r}}async _internalApplyEdits(e,t){var i;const r=null!==(i=null===t||void 0===t?void 0:t.globalIdUsed)&&void 0!==i&&i,n=_.A.fromJSON(this.sourceJSON.spatialReference),{edits:s,options:o}=await this._processApplyEditsParams(e,t),a=await Promise.all(s.map((async e=>{var t,i,s,o;const a=null!==(t=null===(i=e.addFeatures)||void 0===i?void 0:i.map((e=>(0,V.jR)({spatialReference:n},e,null))))&&void 0!==t?t:[],d=(await Promise.all(a)).filter(f.Ru),l=null!==(s=null===(o=e.updateFeatures)||void 0===o?void 0:o.map((e=>(0,V.jR)({spatialReference:n},e,null))))&&void 0!==s?s:[],u=(await Promise.all(l)).filter(f.Ru),c=(0,V.TG)(e.identifierFields,e.deleteFeatures,r);(0,I.u)(d,u,n);const h=await(0,V.ZI)(e.identifierFields,e);return{id:e.id,adds:d,updates:u,deletes:c,attachments:h}}))),d={gdbVersion:null===o||void 0===o?void 0:o.gdbVersion,rollbackOnFailure:!0,useGlobalIds:r,returnEditMoment:!0,honorSequenceOfEdits:null===o||void 0===o?void 0:o.honorSequenceOfEdits,usePreviousEditMoment:null===o||void 0===o?void 0:o.usePreviousEditMoment,returnServiceEditsInSourceSR:null===o||void 0===o?void 0:o.returnServiceEditsInSourceSR,returnServiceEditsOption:"originalAndCurrentFeatures",async:!1};await(0,F.ZJ)(this.url,null===t||void 0===t?void 0:t.gdbVersion,!0);const l=(0,F.w5)(this.url,(null===t||void 0===t?void 0:t.gdbVersion)||null);d.edits=JSON.stringify(a);const u=(0,M.Dl)(this.url),c=(0,M.jV)(u.query,{query:(0,M.lF)({...d,f:"json"}),method:"post"});let h;l&&(c.authMode="immediate",c.query.sessionId=F.TA);try{h=await(0,v.A)(this.url+"/applyEdits",c)}catch(p){if(!(0,V.F0)(p))throw p;c.authMode="immediate",h=await(0,v.A)(this.url+"/applyEdits",c)}return{...this._createServiceEditsResult(h),edits:s}}_createServiceEditsResult(e){const t=e.data,i=[];return{results:t.map((e=>{var t,r,n;const s={addResults:null!==(t=e.addResults)&&void 0!==t?t:[],updateResults:null!==(r=e.updateResults)&&void 0!==r?r:[],deleteResults:null!==(n=e.deleteResults)&&void 0!==n?n:[],attachments:e.attachments,editMoment:e.editMoment},o=(0,V.mP)(s),a=e.editedFeatures,d=null!==a&&void 0!==a&&a.spatialReference?new _.A({wkid:null===a||void 0===a?void 0:a.spatialReference.wkid,wkt:null===a||void 0===a?void 0:a.spatialReference.wkt,latestWkid:null===a||void 0===a?void 0:a.spatialReference.latestWkid,latestVcsWkid:null===a||void 0===a?void 0:a.spatialReference.latestVcsWkid,vcsWkid:null===a||void 0===a?void 0:a.spatialReference.vcsWkid}):null,l=a?(0,V.pX)(a,d):null;return l&&i.push({layerId:e.id,editedFeatures:l}),{id:e.id,editedFeatures:l,...o}})),editedFeatures:i}}async _processApplyEditsParams(e,t){const i={...t};return{edits:await Promise.all(e.map((async e=>{const i=this.capabilities,r=e&&(e.addFeatures||e.updateFeatures||e.deleteFeatures),n=e&&(e.addAttachments||e.updateAttachments||e.deleteAttachments);if((0,S.pz)(e,i,t,!!r,!!n,"feature-service"),!i.data.isDataVersioned&&null!==t&&void 0!==t&&t.gdbVersion)throw new s.A("feature-service:invalid-parameter","'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");const o=(0,S.Tj)(e,i,"feature-service");return{...await(0,S.Gm)(o),id:e.id,identifierFields:e.identifierFields}}))),options:i}}async _fetchService(e,t){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:(0,M.Dl)(e)});const i=await(0,v.A)(e,{responseType:"json",query:{f:"json"},...t});this.read(i.data)}};(0,r._)([(0,d.MZ)()],R.prototype,"url",void 0),(0,r._)([(0,d.MZ)()],R.prototype,"sourceJSON",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],R.prototype,"utilityNetworkUrl",null),(0,r._)([(0,d.MZ)({readOnly:!0})],R.prototype,"versionManagementServiceUrl",null),(0,r._)([(0,d.MZ)()],R.prototype,"userTypeExtensions",void 0),(0,r._)([(0,d.MZ)({json:{read:{source:"layers"}}})],R.prototype,"layerInfos",void 0),(0,r._)([(0,d.MZ)({json:{read:{source:"tables"}}})],R.prototype,"tableInfos",void 0),(0,r._)([(0,d.MZ)({readOnly:!0,json:{read:{source:["hasVersionedData","capabilities","supportsQueryDataElements","supportsQueryDomains","supportsQueryContingentValues","maxRecordCountFactor","maxRecordCount","advancedEditingCapabilities","supportsApplyEditsWithGlobalIds","syncCapabilities","datesInUnknownTimezone"]}}})],R.prototype,"capabilities",void 0),(0,r._)([(0,E.w)("service","capabilities")],R.prototype,"readCapabilities",null),R=(0,r._)([(0,l.$)("esri.services.FeatureService")],R);const T=R,D=(e,t)=>{for(const i of e)if("feature"===i.type||"subtype-group"===i.type){if(!i.url)continue;const e=(0,p.qg)(i.url).url.path,r=t.get(e);if(r)r.layers.push(i);else{const r=new T({url:e}),n=[i];t.set(e,{featureService:r,layers:n})}}else"group"===i.type&&D(i.layers,t)};var N=i(90534),O=i(17707);class Z{constructor(e){this.moments=[],this.forwardMoments=[],this.moments.push(e)}push(e){return this.forwardMoments.length,this.moments.push(e)}pop(){if(!(this.forwardMoments.length>0))return this.moments.pop()}undo(){if(!this.canUndo())return;const e=this.moments.pop();return this.forwardMoments.push(e),e}peek(){return this.moments.at(-1)}canUndo(){return this.moments.length>1}canRedo(){return this.hasForwardEdits()}redo(){if(!this.canRedo())return;const e=this.forwardMoments.pop();return this.moments.push(e),e}size(){return this.moments.length+this.forwardMoments.length}hasForwardEdits(){return this.forwardMoments.length>0}clearForwardEdits(){this.forwardMoments=[]}}let j=class extends((0,m.Te)(w.A)){constructor(e){super(e),this.url=null,this.sourceJSON=null,this.name=null,this.defaultVersionIdentifier=null,this.capabilities=null,this._applyEditsHandler=e=>{const{serviceUrl:t,gdbVersion:i,result:r}=e;t===this._featureServiceUrl&&r.then((e=>{const t=e.historicMoment;t&&this._addMomentToVersionItem(i,t)}))}}initialize(){var e;this.url=(0,N.UC)(this.url),this._featureServiceUrl=this.url.replace(/\/VersionManagementServer/i,"/FeatureServer"),F.DC.has(this.url)||F.DC.set(this.url,new Map);const t=(null!==(e=F.CD.get(this.url))&&void 0!==e?e:0)+1;F.CD.set(this.url,t),this.when().then((()=>this.addHandles((0,k.Jz)(this._applyEditsHandler))),(()=>{}))}destroy(){var e;const t=(null!==(e=F.CD.get(this.url))&&void 0!==e?e:1)-1;F.CD.set(this.url,t),0===t&&F.DC.delete(this.url),F.Z3.delete(this._featureServiceUrl)}read(e,t){this.sourceJSON=e,super.read(e,t)}readDefaultVersionIdentifier(e,t){return{name:t.defaultVersionName,guid:t.defaultVersionGuid}}writeDefaultVersionIdentifier(e,t){t.defaultVersionName=e.name,t.defaultVersionGuid=e.guid}load(e){return this.addResolvingPromise(this._fetchService(this.url,e)),Promise.resolve(this)}async createVersion(e){const[{createVersion:t},{default:r}]=await Promise.all([i.e(45075).then(i.bind(i,45075)),i.e(1015).then(i.bind(i,1015))]),n=r.from(e);return t(this.url,n)}async deleteVersion(e){var t;const[{deleteVersion:r},{default:n}]=await Promise.all([i.e(83842).then(i.bind(i,83842)),i.e(81702).then(i.bind(i,81702))]);let s;e.guid&&(null===(t=F.DC.get(this.url))||void 0===t?void 0:t.has(e.guid))&&(s=null!==F.TA&&void 0!==F.TA?F.TA:void 0);const o=new n({versionName:e.name,sessionId:s});return r(this.url,o)}async getVersionInfoExtended(e){const{getVersion:t}=await i.e(52811).then(i.bind(i,52811));return t(this.url,e.guid)}async getVersionInfos(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[{getVersionInfos:t},{default:r}]=await Promise.all([i.e(78362).then(i.bind(i,78362)),i.e(13358).then(i.bind(i,13358))]),n=r.from(e);return t(this.url,n)}async reconcile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[{reconcile:r},{default:n}]=await Promise.all([i.e(35331).then(i.bind(i,35331)),i.e(16089).then(i.bind(i,16089))]),s=n.from(t);return s.sessionId=F.TA,r(this.url,e.guid,s)}async post(e){const[{post:t},{default:r}]=await Promise.all([i.e(90017).then(i.bind(i,90017)),i.e(45431).then(i.bind(i,45431))]),n=r.from({sessionId:F.TA});return t(this.url,e.guid,n)}async alterVersion(e,t){const[{alterVersion:r},{default:n}]=await Promise.all([i.e(36289).then(i.bind(i,36289)),i.e(34185).then(i.bind(i,34185))]),s=n.from(t);return r(this.url,e.guid,s)}async startReading(e){const{startReading:t}=await i.e(31729).then(i.bind(i,31729)),r=await t(this.url,e.guid,F.TA);if(r){const t=await this.getVersionInfoExtended(e),i=new Date(t.modifiedDate),r={name:t.versionIdentifier.name,moment:i,lockType:"read"};this._addOrUpdateItem(e.guid,r),(0,k.$9)(this._featureServiceUrl,null,e.name,i)}return r}async stopReading(e){var t;const{stopReading:r}=await i.e(10153).then(i.bind(i,10153)),n=await r(this.url,e.guid,F.TA);return n&&(null!==(t=F.DC.get(this.url))&&void 0!==t&&t.delete(e.guid),(0,k.$9)(this._featureServiceUrl,null,e.name,null)),n}async startEditing(e){const{startEditing:t}=await i.e(75213).then(i.bind(i,75213)),r=await t(this.url,e.guid,F.TA);if(r){const t=await this.getVersionInfoExtended(e),i=new Date(t.modifiedDate),r=new Z(i),n={name:e.name,moment:i,lockType:"edit",stack:r};this._addOrUpdateItem(e.guid,n),(0,k.$9)(this._featureServiceUrl,null,e.name,i)}return r}async stopEditing(e,t){if(t){var r,n;const t=null===(r=F.DC.get(this.url))||void 0===r?void 0:r.get(e.guid);if(null!==t&&void 0!==t&&null!==(n=t.stack)&&void 0!==n&&n.canRedo()){const[{deleteForwardEdits:r},{default:n}]=await Promise.all([i.e(56868).then(i.bind(i,56868)),i.e(37028).then(i.bind(i,37028))]);if(!await r(this.url,e.guid,new n({sessionId:F.TA,moment:t.moment})))return!1}}const{stopEditing:s}=await i.e(15093).then(i.bind(i,15093)),o=await s(this.url,e.guid,F.TA,t);if(o){const t=await this.getVersionInfoExtended(e),i=new Date(t.modifiedDate);this._addOrUpdateItem(e.guid,{name:e.name,moment:i,lockType:"read",editMomentStack:void 0}),(0,k.$9)(this._featureServiceUrl,null,e.name,i)}return o}getLockType(e){var t;const i=null===(t=F.DC.get(this.url))||void 0===t||null===(t=t.get(e.guid))||void 0===t?void 0:t.lockType;return null!==i&&void 0!==i?i:"none"}changeVersionInternal(e,t,i){let r=null,n=null,s=null,o=null;const a=e=>!e||e===this.defaultVersionIdentifier.name,d=e=>{var t,i;const r=null===F.DC||void 0===F.DC||null===(t=F.DC.get(this.url))||void 0===t?void 0:t.get(e.guid);s=e.name,o=null!==(i=null===r||void 0===r?void 0:r.moment)&&void 0!==i?i:null},l=(e,t)=>!e&&!t||!(!e||!t)&&e.toISOString()===t.toISOString();if("name"in t){if("none"!==this.getLockType(t))return!1;r=t.name,n=null,"name"in i?d(i):(s=this.defaultVersionIdentifier.name,o=i)}else r=this.defaultVersionIdentifier.name,n=t,"name"in i?d(i):(s=this.defaultVersionIdentifier.name,o=i);return(a(r)&&a(e.gdbVersion)&&l(e.historicMoment,n)||r===e.gdbVersion&&l(e.historicMoment,n))&&(e.gdbVersion=s,e.historicMoment=o),!0}async changeVersion(e,t,i){if("name"in i&&!await this.getVersionInfoExtended(i))throw new s.A("version-management-service:invalid-version","version does not exist");if("networkServiceUrl"in e){if(this._featureServiceUrl.toLowerCase()===e.featureServiceUrl.toLowerCase())return this.changeVersionInternal(e,t,i)}else{let r;"layers"in e?(r=e.allTables.concat(e.allLayers),e.utilityNetworks&&e.utilityNetworks.forEach((e=>{this._featureServiceUrl.toLowerCase()===e.featureServiceUrl.toLowerCase()&&this.changeVersionInternal(e,t,i)}))):r=e;for(const e of r)if("feature"===e.type||"subtype-group"===e.type){const r=/^(.*\/FeatureServer)\/\d+$/,n=e.url.replace(r,"$1");if(this._featureServiceUrl.toLowerCase()===n.toLowerCase()&&!this.changeVersionInternal(e,t,i))return!1}else if("group"===e.type){const r=e.allTables.concat(e.allLayers);for(const e of r)if("feature"===e.type||"subtype-group"===e.type){const r=/^(.*\/FeatureServer)\/\d+$/,n=e.url.replace(r,"$1");if(this._featureServiceUrl.toLowerCase()===n.toLowerCase()&&!this.changeVersionInternal(e,t,i))return!1}}}return!0}async getVersionIdentifierFromName(e){try{var t;return(null===(t=(await this.getVersionInfos({includeHidden:!0})).find((t=>t.versionIdentifier.name===e)))||void 0===t?void 0:t.versionIdentifier)||null}catch{return null}}async getVersionIdentifierFromGuid(e){const{getVersion:t}=await i.e(52811).then(i.bind(i,52811));try{return(await t(this.url,e)).versionIdentifier}catch{return null}}canUndo(e){var t,i;const r=null===(t=F.DC.get(this.url))||void 0===t?void 0:t.get(e.guid);return!(null===r||void 0===r||null===(i=r.stack)||void 0===i||!i.canUndo())}canRedo(e){var t,i;const r=null===(t=F.DC.get(this.url))||void 0===t?void 0:t.get(e.guid);return!(null===r||void 0===r||null===(i=r.stack)||void 0===i||!i.canRedo())}undo(e){var t,i;const r=null===(t=F.DC.get(this.url))||void 0===t?void 0:t.get(e.guid),n=(null===r||void 0===r||null===(i=r.stack)||void 0===i?void 0:i.undo())||void 0;if(r&&n){var s;const t=r.stack.peek();(0,k.$9)(this._featureServiceUrl,null,e.name,t),null===(s=F.DC.get(this.url))||void 0===s||s.set(e.guid,{...r,moment:t})}}redo(e){var t,i,r;const n=null===(t=F.DC.get(this.url))||void 0===t?void 0:t.get(e.guid),s=(null===n||void 0===n||null===(i=n.stack)||void 0===i?void 0:i.redo())||void 0;n&&s&&((0,k.$9)(this._featureServiceUrl,null,e.name,s),null===(r=F.DC.get(this.url))||void 0===r||r.set(e.guid,{...n,moment:s}))}_addMomentToVersionItem(e,t){const i=F.DC.get(this.url);if(i)for(const[r,n]of i)n.name===e&&this._addToStack(r,t)}_canAddToStack(e,t){return!e||e.getTime()<t.getTime()}_addToStack(e,t){const i=F.DC.get(this.url),r=null===i||void 0===i?void 0:i.get(e);return!(null===r||void 0===r||!r.stack)&&(this._canAddToStack(r.stack.peek(),t)&&r.stack.push(t),i.set(e,{...r,moment:t}),!0)}_addOrUpdateItem(e,t){const i=F.DC.get(this.url),r=null===i||void 0===i?void 0:i.get(e);return r?(i.set(e,{...r,...t}),!0):!(!t.name||!t.lockType)&&(null!==i&&void 0!==i&&i.set(e,{...t,lockType:t.lockType}),!0)}async _fetchService(e,t){if(this.sourceJSON){this.read(this.sourceJSON,{origin:"service",url:(0,M.Dl)(e)});const t=new N.s0(this.url).host;return void F.Z3.set(t,this.defaultVersionIdentifier.name)}const i=await(0,v.A)(e,{responseType:"json",query:{f:"json"},...t});this.read(i.data)}};(0,r._)([(0,d.MZ)()],j.prototype,"url",void 0),(0,r._)([(0,d.MZ)()],j.prototype,"sourceJSON",void 0),(0,r._)([(0,d.MZ)({type:String,json:{write:!0}})],j.prototype,"name",void 0),(0,r._)([(0,d.MZ)({json:{write:{target:{defaultVersionName:{type:String},defaultVersionGuid:{type:String}}},read:{source:["defaultVersionName","defaultVersionGuid"]}}})],j.prototype,"defaultVersionIdentifier",void 0),(0,r._)([(0,E.w)("defaultVersionIdentifier",["defaultVersionName","defaultVersionGuid"])],j.prototype,"readDefaultVersionIdentifier",null),(0,r._)([(0,O.K)("defaultVersionIdentifier",{defaultVersionName:{type:String},defaultVersionGuid:{type:String}})],j.prototype,"writeDefaultVersionIdentifier",null),(0,r._)([(0,d.MZ)({json:{write:!0}})],j.prototype,"capabilities",void 0),j=(0,r._)([(0,l.$)("esri.versionManagement.VersionManagementService")],j);const P=j;let J=class extends n.A{constructor(e){super(e),this._initialValidationsFinished=!1,this._portalLookup=new Map,this._updatingHandles=new u.U,this._validConstructProperties=!0,this.advancedEditingUserTypeExtensionLookup=new Map,this.executionError=void 0,this.featureServiceLookup=new Map,this.loadError=void 0,this.serverVersionLookup=new Map,this.serviceNameLookup=new Map,this.userLookup=new Map,this.versionIdentifierLookup=new Map,this.versionInfoLookup=new Map,this.versionManagementServiceLookup=new Map}initialize(){this.addHandles([(0,a.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map.layers.toArray()}),(async()=>{await this._onLayersChange()}),a.initial)])}destroy(){this._updatingHandles.destroy()}get state(){return this.loadError||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._initialValidationsFinished?"ready":"loading"}set view(e){this._get("view")!==e&&this._set("view",e)}async alterVersion(e){"disabled"!==this.state?await this._updatingHandles.addPromise((async()=>{this._setExecutionError();const t=this.versionManagementServiceLookup.get(e.featureServerUrl);if(!t)return void this._logNoVersionManagementServiceFoundError();if(!this.serverVersionLookup.has(e.featureServerUrl)||this.serverVersionLookup.get(e.featureServerUrl)<=11.1)return void this._logError("execution-error","no-valid-enterprise-version");if(!this.advancedEditingUserTypeExtensionLookup.get(e.featureServerUrl))return void this._logError("execution-error","no-advanced-editing-user-type-extension");const{featureServerUrl:i,versionIdentifier:r,...n}=e;await t.alterVersion(r,n).catch((async e=>{await this.getVersionInfos(i,!0),this._logExecutionError(e)}))})()):this._logError("load-error",this.loadError)}async changeVersion(e,t,i){"disabled"!==this.state?await this._updatingHandles.addPromise((async(r,n)=>{this._setExecutionError();const s=this.versionManagementServiceLookup.get(e);if(!s)return void this._logNoVersionManagementServiceFoundError();const o=null!==(r=this.versionIdentifierLookup.get(e))&&void 0!==r?r:{name:s.defaultVersionIdentifier.name,guid:s.defaultVersionIdentifier.guid},a={name:t,guid:i};await s.changeVersion(null===(n=this.view)||void 0===n?void 0:n.map,o,a).catch((e=>{this._logExecutionError(e)}))&&this.versionIdentifierLookup.set(e,a)})()):this._logError("load-error",this.loadError)}async createVersion(e){"disabled"!==this.state?await this._updatingHandles.addPromise((async(t,i)=>{this._setExecutionError();const r=e.featureServerUrl,n=this.versionManagementServiceLookup.get(r);if(!n)return void this._logNoVersionManagementServiceFoundError();const s=this.advancedEditingUserTypeExtensionLookup.get(e.featureServerUrl),o=this.userLookup.get(r).toUpperCase(),a=this._isEmptyString(e.ownerName)?o:null===(t=e.ownerName)||void 0===t?void 0:t.trim().toUpperCase();if(a!==o){if(this.serverVersionLookup.get(r)<=11.1)return void this._logError("execution-error","versioning-api-error");if(!s)return void this._logError("execution-error","no-advanced-editing-user-type-extension")}if("SDE"===(null===a||void 0===a?void 0:a.toUpperCase())&&"DEFAULT"===e.versionName.toUpperCase()||null!==(i=this.versionInfoLookup.get(r))&&void 0!==i&&i.find((t=>t.versionIdentifier.name.toUpperCase()===(a+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(o+"."+e.versionName).toUpperCase())))return void this._logError("execution-error","no-valid-version-name");const d=await n.createVersion({versionName:e.versionName,access:a!==o?"public":e.access,description:e.description}).catch((e=>{this._logExecutionError(e)}));if(!this.executionError&&a!==o){const{guid:t,name:i}=d.versionIdentifier,n={featureServerUrl:r,versionIdentifier:{guid:t,name:i},access:e.access,ownerName:a};await this.alterVersion(n),this.executionError&&this.deleteVersion(r,o+"."+e.versionName,d.versionIdentifier.guid)}await this.getVersionInfos(r,!0)})()):this._logError("load-error",this.loadError)}async deleteVersion(e,t,i){"disabled"!==this.state?await this._updatingHandles.addPromise((async()=>{this._setExecutionError();const r=this.versionManagementServiceLookup.get(e);if(!r)return void this._logNoVersionManagementServiceFoundError();if(this.serverVersionLookup.get(e)<=11.1)return void this._logError("execution-error","versioning-api-error");if(!this.advancedEditingUserTypeExtensionLookup.get(e))return void this._logError("execution-error","no-advanced-editing-user-type-extension");const n={name:t,guid:i};await r.deleteVersion(n).catch((e=>{this._logExecutionError(e)}))&&await this.getVersionInfos(e,!0).catch((e=>{this._logExecutionError(e)}))})()):this._logError("load-error",this.loadError)}async getVersionInfos(e,t){if("disabled"!==this.state)return await this._updatingHandles.addPromise((async i=>{this._setExecutionError();const r=null===(i=this.featureServiceLookup.get(e))||void 0===i?void 0:i.featureService;if(!r)return void this._logError("execution-error","no-feature-service-found");if(!r.loaded){var n,s;await r.load().catch((e=>{this._logExecutionError(e)}));const t=r.url;this.serverVersionLookup.set(t,null!==(n=null===(s=r.sourceJSON)||void 0===s?void 0:s.currentVersion)&&void 0!==n?n:0),this.serverVersionLookup.get(t)<=11.1&&this.advancedEditingUserTypeExtensionLookup.set(t,!1);const i=this.userLookup.get(e);this._portalLookup.get(e)&&i?this.advancedEditingUserTypeExtensionLookup.set(t,await(0,h.R)(this._portalLookup.get(e),i,"advediting")):this.advancedEditingUserTypeExtensionLookup.set(t,!1)}r.versionManagementServiceUrl&&this.versionManagementServiceLookup.set(r.url,new P({url:r.versionManagementServiceUrl}));const o=this.versionManagementServiceLookup.get(e);if(o){if(o.loaded||await o.load().catch((e=>{this._logExecutionError(e)})),!this.versionInfoLookup.get(e)||t){const t=await o.getVersionInfos().catch((e=>{this._logExecutionError(e)}));this.versionInfoLookup.set(e,t)}}else this._logNoVersionManagementServiceFoundError()})()),this.versionInfoLookup.get(e);this._logError("load-error",this.loadError)}_isEmptyString(e){return!e||0===e.trim().length}_logError(e,t){switch(e){case"load-error":this._setLoadError(t),o.A.getLogger(this).error(new s.A(e,t));break;case"execution-error":this._setExecutionError(t),o.A.getLogger(this).error(new s.A(e,t))}}_logExecutionError(e){this._logError("execution-error",e.message)}_logNoVersionManagementServiceFoundError(){this._logError("execution-error","no-version-management-service-found")}async _onLayersChange(){if(this._initialValidationsFinished=!1,this._setLoadError(),this._validConstructProperties=!0,!this.view)return this._logError("load-error","no-view-property"),void(this._validConstructProperties=!1);if(this.featureServiceLookup=function(e){const t=new Map;return D(e,t),t}(this.view.map.layers),!this.featureServiceLookup.size)return this._logError("load-error","no-feature-services"),void(this._validConstructProperties=!1);for(const t of this.featureServiceLookup.keys())if(!this.serviceNameLookup.has(t)){var e;this.serviceNameLookup.set(t,t.split("/").at(-2));const i=new c.A({authMode:"immediate",url:new URL(t).origin+"/portal"});await i.load(),this._portalLookup.set(t,i);const r=null===i||void 0===i||null===(e=i.user)||void 0===e?void 0:e.username;r&&this.userLookup.set(t,r)}this._initialValidationsFinished=!0}_setExecutionError(e){this._set("executionError",e)}_setLoadError(e){this._set("loadError",e)}};(0,r._)([(0,d.MZ)()],J.prototype,"_initialValidationsFinished",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],J.prototype,"advancedEditingUserTypeExtensionLookup",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],J.prototype,"executionError",void 0),(0,r._)([(0,d.MZ)()],J.prototype,"featureServiceLookup",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],J.prototype,"loadError",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],J.prototype,"serverVersionLookup",void 0),(0,r._)([(0,d.MZ)()],J.prototype,"serviceNameLookup",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],J.prototype,"state",null),(0,r._)([(0,d.MZ)({readOnly:!0})],J.prototype,"userLookup",void 0),(0,r._)([(0,d.MZ)({readOnly:!0})],J.prototype,"versionIdentifierLookup",void 0),(0,r._)([(0,d.MZ)()],J.prototype,"versionInfoLookup",void 0),(0,r._)([(0,d.MZ)()],J.prototype,"versionManagementServiceLookup",void 0),(0,r._)([(0,d.MZ)()],J.prototype,"view",null),J=(0,r._)([(0,l.$)("esri.widgets.VersionManagement.VersionManagementViewModel")],J);const H=J}}]);
//# sourceMappingURL=72110.54df6cdc.chunk.js.map
"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[97768],{56567:(e,t,n)=>{n.d(t,{A:()=>m});var i=n(35143),a=(n(35238),n(23458)),s=n(69098),o=n(73582),r=n(42553),l=n(46053),c=n(21403),u=(n(47249),n(81806),n(85842)),d=n(40565),p=n(13904);let h=class extends((0,r.Te)(s.P)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=a.L.Direct,this.offset=0,this.orientation=0}};(0,i._)([(0,l.MZ)({type:["length"],json:{write:{isRequired:!0}}})],h.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:p.A,json:{write:!0}})],h.prototype,"startPoint",void 0),(0,i._)([(0,l.MZ)({type:p.A,json:{write:!0}})],h.prototype,"endPoint",void 0),(0,i._)([(0,l.MZ)({type:a.h,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"measureType",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"offset",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.w)((e=>o.ie.normalize((0,d.GB)(e),0,!0)))],h.prototype,"orientation",void 0),h=(0,i._)([(0,u.$)("esri.analysis.LengthDimension")],h);const m=h},23458:(e,t,n)=>{var i;n.d(t,{L:()=>i,h:()=>a}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));const a=[i.Horizontal,i.Vertical,i.Direct]},29201:(e,t,n)=>{n.d(t,{I:()=>S,b:()=>M});var i,a,s,o=n(57528),r=n(34981),l=n(26917),c=n(59395),u=n(81993),d=n(90235),p=n(80883),h=n(3799),m=n(21390),g=n(64839),v=n(32307),f=n(70367),_=n(10773),y=n(66470);function M(e){const t=new v.N5,{vertex:n,fragment:M}=t;return(0,h.NB)(n,e),t.include(c.d,e),t.attributes.add(y.r.POSITION,"vec3"),t.attributes.add(y.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(y.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),n.code.add((0,g.H)(i||(i=(0,o.A)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0;\n      gl_Position = transformPosition(proj, view, vpos);\n\n      ","\n    }\n  "])),e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":"")),t.include(l.HQ,e),t.include(u.Q,e),M.uniforms.add(new f.N("tex",(e=>e.texture)),new m.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.output===r.V.Alpha?M.code.add((0,g.H)(a||(a=(0,o.A)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      fragColor = vec4(alpha);\n    }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",g.H.float(d.H))):(M.include(p.a),M.code.add((0,g.H)(s||(s=(0,o.A)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      fragColor = texture(tex, vTexCoord) * opacity;\n\n      if (fragColor.a < ",") {\n        discard;\n      }\n\n      fragColor = highlightSlice(fragColor, vpos);\n      ","\n    }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",g.H.float(d.H),e.transparencyPassType===_.y.Color?"fragColor = premultiplyAlpha(fragColor);":""))),t}const S=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}))},56002:(e,t,n)=>{function i(e){let t,n,i=[],a=!1;return function(){for(var s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];return a&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,i)||(n=e.apply(this,o),t=this,i=o,a=!0),n}}n.d(t,{B:()=>i})},8203:(e,t,n)=>{n.d(t,{A:()=>v});var i,a=n(35143),s=n(35238),o=n(82111),r=n(45802),l=n(42553),c=n(53084),u=n(46053),d=(n(81806),n(76460),n(85842)),p=n(68295);const h=new r.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new r.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let g=i=class extends l.oY{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{where:t,geometry:n,spatialRelationship:i,timeExtent:a,objectIds:s,units:o,distance:r}=this;return new p.A({geometry:(0,c.o8)(n),objectIds:(0,c.o8)(s),spatialRelationship:i,timeExtent:(0,c.o8)(a),where:t,units:o,distance:r,...e})}clone(){const{where:e,geometry:t,spatialRelationship:n,timeExtent:a,objectIds:s,units:o,distance:r}=this;return new i({geometry:(0,c.o8)(t),objectIds:(0,c.o8)(s),spatialRelationship:n,timeExtent:(0,c.o8)(a),where:e,units:o,distance:r})}};(0,a._)([(0,u.MZ)({type:String,json:{write:!0}})],g.prototype,"where",void 0),(0,a._)([(0,u.MZ)({types:s.yR,json:{write:!0}})],g.prototype,"geometry",void 0),(0,a._)([(0,u.MZ)({type:h.apiValues,json:{name:"spatialRel",read:{reader:h.read},write:{allowNull:!1,writer:h.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],g.prototype,"spatialRelationship",void 0),(0,a._)([(0,u.MZ)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],g.prototype,"distance",void 0),(0,a._)([(0,u.MZ)({type:[Number],json:{write:!0}})],g.prototype,"objectIds",void 0),(0,a._)([(0,u.MZ)({type:m.apiValues,json:{read:m.read,write:{writer:m.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],g.prototype,"units",void 0),(0,a._)([(0,u.MZ)({type:o.A,json:{write:!0}})],g.prototype,"timeExtent",void 0),g=i=(0,a._)([(0,d.$)("esri.layers.support.FeatureFilter")],g);const v=g},23218:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Wt});var i,a=n(35143),s=n(91967),o=n(54901),r=n(76460),l=n(30726),c=n(68134),u=n(46053),d=(n(81806),n(47249),n(85842)),p=n(2522),h=n(23458),m=n(31633),g=n(19747),v=n(15941),f=n(24648),_=n(34761),y=n(13191),M=n(20664),S=n(9392),w=n(5568),P=n(75762),b=n(18117),C=n(32535),O=n(25191),A=n(68655),D=n(29772),x=n(90659);function T(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,dimension:{offset:i,measureType:a,orientation:s}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i,measureType:a,orientation:s}}function z(e,t){var n,i,a;let{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,offset:r,measureType:l,orientation:c}=e,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==s||null==o)return null;const d=H(null!==(n=null===u||void 0===u?void 0:u.directSegment)&&void 0!==n?n:new O.C,{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o},t),p=null!==(i=null===u||void 0===u?void 0:u.primaryOffsetAxis)&&void 0!==i?i:(0,S.vt)();L(p,{measureType:l,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,orientation:c,renderCoordsHelper:t});const m=null!==(a=null===u||void 0===u?void 0:u.dimensionSegment)&&void 0!==a?a:new O.C;return N({elevationAlignedStartPoint:s,elevationAlignedEndPoint:o})&&l===h.L.Vertical?((0,M.c)(m.startRenderSpace,d.startRenderSpace),(0,M.c)(m.endRenderSpace,d.endRenderSpace)):V(m,{offsetAxis:p,offset:r,relativeToSegment:d,renderCoordsHelper:t}),{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,dimensionSegment:m,primaryOffsetAxis:p,spatialReference:t.spatialReference}}function I(e,t,n,a){return t===i.Start?((0,M.c)(e.startRenderSpace,n.startRenderSpace),(0,M.c)(e.endRenderSpace,a.startRenderSpace)):((0,M.c)(e.startRenderSpace,n.endRenderSpace),(0,M.c)(e.endRenderSpace,a.endRenderSpace)),e}function R(e,t,n,i){switch(t){case h.L.Direct:return H(e,n,i);case h.L.Horizontal:case h.L.Vertical:{const{elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,dimension:o,geometry:r}=n;let l;o.measureType===h.L.Direct?(l=function(e,t){const n=e.directSegment.eval(.5,P.rq.get()),i=t.worldUpAtPosition(n,P.rq.get()),a=e.dimensionSegment.eval(.5,P.rq.get()),s=(0,M.z)(P.rq.get(),a,n);return!(0,M.G)(s,S.uY)&&(0,M.k)(s,i)>0}(r,i)===a.z>s.z,t===h.L.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment,{startRenderSpace:i,endRenderSpace:a}=e.directSegment;return(0,M.w)(i,t)<(0,M.w)(a,n)}(r);const[c,u]=l?[a,s]:[s,a],d=(0,C.EL)(u,Z);return t===h.L.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),i.toRenderCoords(c,e.startRenderSpace),i.toRenderCoords(d,e.endRenderSpace),e}}}function H(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(i||(i={}));const Z=(0,b.T)(0,0,0,null);const E=new O.C;function L(e,t){const{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:a,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:r,renderCoordsHelper:l}=t,c=r.eval(.5,P.rq.get()),u=l.worldUpAtPosition(c,P.rq.get()),d=l.worldBasisAtPosition(c,w._.Y,P.rq.get());switch(n){case h.L.Horizontal:(0,M.c)(e,u);break;case h.L.Vertical:(0,M.k)(s,u)<(0,M.k)(o,u)?(0,M.z)(e,o,s):(0,M.z)(e,s,o),(0,M.b)(e,e,u),(0,M.b)(e,e,u);break;case h.L.Direct:{var p;const n=null!==(p=t.orientation)&&void 0!==p?p:0;if(N({elevationAlignedStartPoint:i,elevationAlignedEndPoint:a}))(0,_.$0)(k,-(0,v.kU)(n),u),(0,M.e)(e,d,k);else{const t=(0,M.z)(P.rq.get(),o,s),i=(0,M.b)(P.rq.get(),t,u);(0,M.b)(i,i,t),(0,_.$0)(k,(0,v.kU)(n),t),(0,M.e)(e,i,k)}break}}return(0,M.G)(e,S.uY)?(0,M.c)(e,d):(0,M.n)(e,e)}const k=(0,y.vt)();function N(e){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;return null!=t&&null!=n&&t.x===n.x&&t.y===n.y}function V(e,t){const{offsetAxis:n,offset:i,relativeToSegment:{startRenderSpace:a,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:r}=t,l=i/r.unitInMeters,[c,u]=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=(0,M.k)(t,n),s=(0,M.k)(e,n),o=Math.abs(a-s)+i;return a>s?[o,i]:[i,o]}(a,s,n,l);return(0,M.r)(e.startRenderSpace,o.startRenderSpace,n,c),(0,M.r)(e.endRenderSpace,o.endRenderSpace,n,u),e}function j(e,t,n){const i=t.directSegment.eval(.5,P.rq.get());return n.worldUpAtPosition(i,e)}function G(e,t){const{startRenderSpace:n,endRenderSpace:i}=t.directSegment;return(0,M.z)(e,i,n)}function U(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:i,endRenderSpace:a}=t.dimensionSegment;return n.invert?(0,M.z)(e,i,a):(0,M.z)(e,a,i)}function F(e,t){const n=e.directSegment.eval(.5,P.rq.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}const W=(0,S.vt)();function q(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;if(null==t||null==n)return!1;const i=(0,D.Ce)(t,n);return null!=i&&(0,f.kM)(i,"meters").value>x.U}function Y(e){return null!=e.geometry}let B=class extends s.A{constructor(e){super(e)}initialize(){const e=(0,c.mapCollection)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._watchComputation(t)}));this.addHandles((0,o.DQ)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,g.c)(this.view)}_watchComputation(e){return(0,c.watch)((()=>T(e)),(t=>{const{measureType:n}=t;if(q(t)&&n!==h.L.Direct){const t=Math.round((0,m.oU)(x.U,"meters","kilometers"));return r.A.getLogger(this).warnOnce("A ".concat(n," dimension in the analysis (id: '").concat(this.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(t,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}const i=z(t,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=function(e,t,n){if(null==e)return null;let i;if(t===h.L.Horizontal)i=(0,A.Kt)(e.elevationAlignedStartPoint,e.elevationAlignedEndPoint);else{const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment;i=(0,D.vp)(t,n,e.spatialReference)}if(null==i)return null;const a=t===h.L.Vertical?(0,m.jE)(i.value,i.unit,n):(0,m.Vs)(i.value,i.unit,n);return(0,f.kM)(i,a)}(i,n,this._defaultUnit)}),c.syncAndInitial)}};(0,a._)([(0,u.MZ)({constructOnly:!0})],B.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],B.prototype,"view",void 0),(0,a._)([(0,u.MZ)()],B.prototype,"analysis",null),(0,a._)([(0,u.MZ)()],B.prototype,"_defaultUnit",null),B=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.support.DimensionController")],B);n(35238);var X=n(50176),$=n(69539),Q=n(73582),J=n(76931),K=n(55855),ee=n(13927),te=n(59784);function ne(e){return(0,te._L)(e.accentColor,.5)}const ie=new $.A([127,127,127,.5]),ae=6,se=5;var oe=n(56121),re=n(38317),le=n(91175),ce=n(7947),ue=n(99443),de=n(50468),pe=n(51799),he=n(62577),me=n(45463),ge=n(66470),ve=n(77447),fe=n(425),_e=n(17046),ye=n(76336),Me=n(13904);class Se{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of h.h)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case h.L.Direct:return this.direct;case h.L.Horizontal:return this.horizontal;case h.L.Vertical:return this.vertical}}}class we extends oe.q{constructor(e,t){const n=(0,re.UM)($.A.toUnitRGBA(ne(e.effectiveTheme))),i=[new le.M((0,he.CM)(n,1,32,32),Ne)];super({view:e,renderObjects:i,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.watch)((()=>({color:$.A.toUnitRGBA(ne(e.effectiveTheme))})),(e=>n.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class Pe extends oe.q{constructor(e,t){let{lineSizePt:n,material:i,metadata:a}=t;super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:a}),this._options={calloutColor:(0,K.vt)(),lineSizePt:n,material:i},this._themeHandle=(0,c.watch)((()=>$.A.toUnitRGBA(ne(e.effectiveTheme))),(e=>{this._options.calloutColor=e,ke(this,be({...this._options,metadata:this.metadata}))}),c.initial)}update(e){let{lineSizePt:t,material:n}=e;this._options.lineSizePt=t,this._options.material=n,ke(this,be({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function be(e){let{calloutColor:t,lineSizePt:n,material:i,metadata:a}=e;return{calloutLength:.25*ue.PV*.8*(0,J.Lz)(n)+18,calloutColor:t,calloutWidth:2,customStateMask:Ne,discScale:.3,focusMultiplier:2,material:i,metadata:a}}function Ce(e,t){let{computation:n,view:i}=t;return[(0,_e.Xt)(e,((e,t,a)=>{Oe({cancel:a,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,n){const{dimension:i,geometry:a}=t;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if(null==a)return;const{renderCoordsHelper:s}=n,o=z({...T(t),orientation:90},s),r=z({...T(t),orientation:270},s);if(null==o||null==r)return;const l=F(o,s),c=F(r,s),u=xe(a,n),d=Q.ie.shortestSignedDiff(u,l),p=Q.ie.shortestSignedDiff(u,c);i.orientation=Math.abs(d)<Math.abs(p)?90:270,e.stopPropagation()}(e,n,i)}))]}function Oe(e){var t,n;const{cancel:i,computation:a,settingHeading:s,steps:o,view:r}=e;if(!Y(a))return;const{renderCoordsHelper:l}=r,{dimension:c,geometry:u}=a,d=(0,S.vt)(),p=Re((0,S.vt)(),u,u.directSegment,l),h=He(P.rq.get(),{forHeading:s,geometry:u,renderCoordsHelper:l}),m=(0,ee.O_)(p,h,(0,ee.vt)()),g=s?null!==(t=c.orientation)&&void 0!==t?t:F(u,r.renderCoordsHelper):null!==(n=c.orientation)&&void 0!==n?n:0;o.next((0,ce.AA)(r,m)).next((e=>{"start"===e.action&&(0,M.c)(d,e.renderStart);const t=(0,ee.Qj)(m),n=(0,re.FY)(d,e.renderEnd,p,t);let i=g-(0,v.KJ)(n);s||(i=function(e){const t=Q.ie.normalize(e)%90;return t<se?e-t:90-t<se?e+(90-t):e}(i)),c.orientation=i})),i.next((0,_e.VG)(c,["orientation"]))}function Ae(e,t){let{computation:n,manipulatorMeasureType:i,view:a}=t,s=h.L.Direct,o=0,r=0;return[e.events.on("grab-changed",(t=>{if("start"!==t.action||!Y(n))return;const{dimension:l,geometry:c}=n;s=l.measureType,o=l.offset,r=l.orientation;const u=(0,M.c)(P.rq.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){const{directSegment:a}=n,s=L(P.rq.get(),{measureType:t,directSegment:a,renderCoordsHelper:i}),o=V(E,{offsetAxis:s,offset:0,relativeToSegment:a,renderCoordsHelper:i}).eval(.5,P.rq.get()),r=(0,M.z)(P.rq.get(),e,o);return(0,M.k)(r,s)*i.unitInMeters}(u,i,c,a.renderCoordsHelper),l.orientation=0})),(0,_e.Xt)(e,((e,t,l)=>{if(!Y(n))return;const{geometry:c,dimension:u}=n,{renderCoordsHelper:d}=a,p=R(Ue,i,n,d),h=L(P.rq.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:d}),m=(0,ce.z7)(e);t.next(m).next(De(a,u,p,h)),l.next(m).next((e=>(u.measureType=s,u.offset=o,u.orientation=r,e)))}))]}function De(e,t,n,i){const a=(0,M.f)(P.rq.get(),n.endRenderSpace,n.startRenderSpace);(0,M.b)(a,a,i);const s=(0,ee.O_)(n.startRenderSpace,a,(0,ee.vt)()),o=(0,ee.O_)(n.startRenderSpace,i,(0,ee.vt)()),r=t.offset;let l,c=0;const u=new _e.rh;return u.next((0,ce.AA)(e,s)).next((n=>{"start"===n.action&&(c=(0,ee.mN)(o,n.renderStart));const i=((0,ee.mN)(o,n.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=r+i,l=n})),e=>(u.execute(e),l)}function xe(e,t){const{directSegment:n}=e,{renderCoordsHelper:i}=t,a=j(P.rq.get(),e,i),s=G(P.rq.get(),e),o=(0,M.b)(P.rq.get(),s,a),{viewForward:r}=t.state.camera;(0,M.k)(o,r)>0&&(0,M.h)(o,o,-1);const l=n.eval(.5,P.rq.get());return i.headingAtPosition(l,o)}function Te(e,t,n,i){let{forHeading:a}=i;const{dimension:s,geometry:o}=t,{primaryOffsetAxis:r}=o,l=(0,M.h)(ze,r,s.offset>=0?1:-1),c=He(Ie,{forHeading:a,geometry:o,renderCoordsHelper:n});(0,M.b)(c,c,l);const u=(0,re.wQ)(l,c,S.uY,Ge);e.modelTransform=u,e.renderLocation=Re(Ve,o,o.dimensionSegment,n)}const ze=(0,S.vt)(),Ie=(0,S.vt)();function Re(e,t,n,i){const{startRenderSpace:a,endRenderSpace:s}=n,o=function(e,t){const n=G(Ze,e),i=j(Ee,e,t);return(0,M.k)(n,i)>0}(t,i)?a:s;return(0,M.c)(e,o)}function He(e,t){let{forHeading:n,geometry:i,renderCoordsHelper:a}=t;return n?j(e,i,a):U(e,i,{invert:!0})}const Ze=(0,S.vt)(),Ee=(0,S.vt)();function Le(e){return(0,J.Lz)(e)+ae}function ke(e,t){var n,i,a,s,o,r,l;const c=null!==(n=t.material)&&void 0!==n?n:new ve.r({transparent:!0,writeDepth:!1,textureId:null===(i=t.texture)||void 0===i?void 0:i.id,renderOccluded:me.m$.Opaque,isDecoration:!0}),u=null!==(a=t.focusMultiplier)&&void 0!==a?a:re.eO.focusMultiplier,d=null!==(s=t.calloutLength)&&void 0!==s?s:re.eO.calloutLength,p=re.eO.discRadius*(null!==(o=t.discScale)&&void 0!==o?o:1),h=p*u,m=(e,t)=>{const n=[0,1,2,2,3,0];return new pe.V(t,[[ge.r.POSITION,new de.n([d-e,-e,0,d+e,-e,0,d+e,e,0,d-e,e,0],n,3,!0)],[ge.r.UV0,new de.n([0,0,1,0,1,1,0,1],n,2,!0)]])},g=null!==(r=t.calloutWidth)&&void 0!==r?r:re.eO.calloutWidth,v=new fe.W({width:g,color:t.calloutColor,renderOccluded:me.m$.OccludeAndTransparent,isDecoration:!0}),f=(0,he.Z8)(v,[[0,0,0],[d-p,0,0]]),_=(0,he.Z8)(v,[[0,0,0],[d-h,0,0]]),y=null!==(l=t.customStateMask)&&void 0!==l?l:ye.SJ.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[d,0,0]},e.focusMultiplier=u,e.metadata=t.metadata,e.radius=p,e.renderObjects=[new le.M(m(p,c),ye.p7.Unfocused|y),new le.M(f,ye.p7.Unfocused|y),new le.M(m(h,c),ye.p7.Focused|y),new le.M(_,ye.p7.Focused|y)]}const Ne=ye.SJ.Custom1,Ve=(0,S.vt)(),je=(0,S.vt)(),Ge=(0,y.vt)(),Ue=new O.C;var Fe,We=n(56567),qe=n(88321),Ye=n(53084),Be=n(56002),Xe=n(50346),$e=n(19451);function Qe(e,t,n){const{constraint:i,elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:r}=n,{dimension:l,previousConstraint:c,preConstraintProperties:u}=e;if(null==a||null==s)return;const d=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==i)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=h.L.Direct,i){case Fe.Horizontal:if(i!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=s.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=a.z),l.endPoint=e}break;case Fe.Vertical:if(i!==c&&(l.orientation=xe(o,r)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=s.x,e.y=s.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=a.x,e.y=a.y),l.endPoint=e}break;case Fe.Direct:i!==c&&null!=u&&(l.orientation=u.orientation),d()}e.previousConstraint=i,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(Fe||(Fe={}));var Je=n(59962),Ke=n(70836),et=n(7256),tt=n(85937),nt=n(35925),it=n(89238),at=n(974),st=n(87878),ot=n(28455),rt=n(13284),lt=n(61237),ct=n(14318),ut=n(70330);let dt=class extends s.A{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new qe.A,this._orientationManipulatorTexture=null,this._updatingHandles=new $e.U,this._getSnappingContext=(0,Be.B)((e=>new rt.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new st.p(new at.ZE("point",(0,it.BV)(!0,!1,this.view.spatialReference))),visualizer:new Ke.s})));const{view:t}=e;this._snappingManagerResult=(0,ot.X)(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,nt.wk)(2)}),this._constraintSnappingIndicator=new et.t({view:t,attached:!0,width:1,renderOccluded:me.m$.OccludeAndTransparent,stipplePattern:(0,nt.wk)(5),isDecoration:!0});const n=$.A.toUnitRGBA(ie);this._stagedStartIndicator=new tt.I({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:n,size:10,outlineSize:0,renderOccluded:me.m$.OccludeAndTransparent,isDecoration:!0})}initialize(){var e;const{view:t}=this;this._snappingOperation=new ct.O({view:t});const n=!(null!==(e=t._stage)&&void 0!==e&&e.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new ve.r({transparent:!0,writeDepth:!1,renderOccluded:me.m$.Opaque,isDecoration:!0}),this.addHandles((0,c.watch)((()=>{return{accentColor:ne(t.effectiveTheme),contrastColor:(e=t.effectiveTheme,(0,te.bJ)(e.accentColor))};var e}),(e=>{let{accentColor:i,contrastColor:a}=e;const s=this._orientationManipulatorTexture,o=(0,Je.t)(t.textures,{accentColor:i,contrastColor:a,preMultiplyAlpha:n});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,null===s||void 0===s||s.release();const r=$.A.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:r}),this._focusedOffsetManipulatorMaterial.setParameters({color:r}),this._thinOffsetManipulatorMaterial.setParameters({color:r}),this._constraintSnappingIndicator.color=r}),c.initial));const i=(0,c.mapCollection)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createManipulators(t)}));this.addHandles((0,o.DQ)(i)),this.addHandles([(0,c.watch)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(e=>{let{stagedPoint:t,stagedComputation:n}=e;if(null==n||null==t)return;const i=(0,C.EL)(t,new Me.A);this._applyPointUpdate(n,{endPoint:i})}),c.sync),(0,c.watch)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:n,selectedComputation:i,firstGrabbedManipulator:a}=e;if(n===(null===t||void 0===t?void 0:t.stagedDimension)&&a===(null===t||void 0===t?void 0:t.firstGrabbedManipulator)){for(const s of[i,null===t||void 0===t?void 0:t.selectedComputation])if(null!=s){const t=this._computationManipulators.get(s);null!=t&&this._updateManipulators(s,t,e)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,e)}),c.syncAndInitial),(0,c.watch)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),c.initial),(0,c.watch)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.watch)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,n=(0,S.vt)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,n)?n:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,ut.BY)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){var n;const e=null!==(n=this.view.inputManager.latestPointerType)&&void 0!==n?n:"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,Xe.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))}if(null!=e){const{start:t,end:n}=this._computationManipulators.get(e);if(t.grabbing||n.grabbing){!function(e,t,n){let{constraint:i,view:a}=n;const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:o,spatialReference:r}=a,{startRenderSpace:l,endRenderSpace:c}=s.directSegment,u=o.fromRenderCoords(l,new Me.A({spatialReference:r})),d=o.fromRenderCoords(c,new Me.A({spatialReference:r}));let p;p="start"===t?{startPoint:u}:{endPoint:d},Qe(e,p,{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:a})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){var e;this._snappingOperation=(0,l.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),null===(e=this._orientationManipulatorTexture)||void 0===e||e.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){var e;const t=this._stagedDimension,n=null===(e=this.analysisViewData.computations.at(-1))||void 0===e?void 0:e.computation;return null==t||null==n||n.dimension!==t?null:n}get _constraintHandles(){return[(0,c.when)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...c.syncAndInitial,equals:Ye.aI}),(0,c.watch)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:n}=e.dimension;return{measureType:t,orientation:n,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:n,computation:i}=e;switch(i.previousConstraint){case Fe.Horizontal:i.preConstraintProperties={measureType:h.L.Horizontal,orientation:0};break;case Fe.Vertical:i.preConstraintProperties={measureType:h.L.Vertical,orientation:0};break;case Fe.Direct:i.preConstraintProperties={measureType:h.L.Direct,orientation:n};break;default:i.preConstraintProperties={measureType:t,orientation:n}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),c.sync)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,c.watch)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(t=>{let{stagedComputation:n,activeComputation:i}=t;const a=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=i)if(i===n)a.attached=!0;else{const{start:t,end:n}=this._computationManipulators.get(i),s=()=>{a.attached=t.grabbing||n.grabbing};s(),this.addHandles([t.events.on("grab-changed",s),n.events.on("grab-changed",s)],e)}else a.attached=!1})),(0,c.watch)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(e=>{let{geometry:t,constraint:n}=e;const i=this._constraintSnappingIndicator;null!=t&&null!=n&&n!==Fe.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove(e){let{mapPoint:t,pointerType:n}=e;if("touch"===n)return;const i=this._getSnappingContext(n);this._updatingHandles.addPromise((0,Xe.QZ)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(e){let{mapPoint:t,pointerType:n}=e,i=t;if("mouse"===n){const e=this._getSnappingContext(n);i=this._snappingManager.update({point:t,context:e})}const a=new We.A({startPoint:(0,C.EL)(i,new Me.A),endPoint:null,measureType:h.L.Horizontal});return this._stagedDimension=a,this._resetSnappingState(),a}_onStagedClick(e){let{mapPoint:t,pointerType:n}=e;const i=this._stagedComputation;if(null==i)return;let a=t;if("mouse"===n){const e=this._getSnappingContext(n);a=this._snappingManager.update({point:t,context:e})}const s=(0,C.EL)(a,new Me.A);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),a=this._setupHeadingManipulator(e),s=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,h.L.Direct),r=this._setupMeasureTypeManipulator(e,h.L.Horizontal),l=this._setupMeasureTypeManipulator(e,h.L.Vertical),c=new Se({start:t,end:n,offset:i,heading:a,rotation:s,direct:o,horizontal:r,vertical:l});return this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of c.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,c.watch)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...c.syncAndInitial,equals:Ye.aI})],e)}_setupPointManipulator(e,t){const{view:n}=this,{dimension:i}=e,a=new we(n,{metadata:i}),s=function(e,t){let{isStart:n,createSnappingPipelineStep:i,dimension:a,onUpdate:s,view:o}=t;const r=n?"startPoint":"endPoint",l=(0,_e.Xt)(e,((e,t,n,l)=>{const c=(0,ce.z7)(e),{snappingStep:u,cancelSnapping:d}=i(l);n=n.next(c).next((0,_e.VG)(a,[r,"measureType","orientation"])).next(d),t.next(c).next((0,ce.xk)(o)).next(...u).next((e=>{const t=(0,C.EL)(e.mapEnd,new Me.A);s("startPoint"===r?{startPoint:t}:{endPoint:t})}))}));return[l]}(a,{isStart:t.isStart,createSnappingPipelineStep:e=>(0,lt.L)({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:t=>this._applyPointUpdate(e,t),view:n});return this._computationHandles.add(s,e),a}_setupOffsetManipulator(e){const{view:t}=this,n=function(e,t){const n=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],i=(0,he.Z8)(t.unfocusedMaterial,n.map((e=>(0,M.h)((0,S.vt)(),e,.5)))),a=i.instantiate({material:t.focusedMaterial});return new oe.q({view:e,renderObjects:[new le.M(i,ye.p7.Unfocused|ye.p7.Selected|Ne),new le.M(a,ye.p7.Focused|Ne)],collisionType:{type:"line",paths:[n]},radius:Le(t.lineSizePt)/2,metadata:t.metadata,available:!1,...re.MO})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,_e.Xt)(e,((e,t,a)=>{if(!Y(n)||!e.selected)return;const{geometry:s,dimension:o}=n,r=(0,ce.z7)(e);t.next(r).next(De(i,o,s.dimensionSegment,s.primaryOffsetAxis)),a.next(r).next((0,_e.VG)(o,["offset"]))}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupHeadingManipulator(e){const{view:t}=this,n=new Pe(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,_e.Xt)(e,((e,t,a)=>{Oe({cancel:a,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupRotationManipulator(e){const{view:t}=this,n=new Pe(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=Ce(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupMeasureTypeManipulator(e,t){const{view:n}=this,i=function(e,t){const n=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],i=(0,he.Z8)(t.thinOffsetManipulatorMaterial,n),a=(0,he.Z8)(t.unfocusedMaterial,n.map((e=>(0,M.h)((0,S.vt)(),e,.5)))),s=a.instantiate({material:t.focusedMaterial});return new oe.q({view:e,renderObjects:[new le.M(a,ye.p7.Unfocused|Ne),new le.M(s,ye.p7.Focused|Ne),new le.M(i,Ne)],collisionType:{type:"line",paths:[n]},radius:Le(t.lineSizePt)/2,available:!1,metadata:t.metadata,...re.MO})}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),a=Ae(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(a,e),i}_updateManipulators(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:i,selectedComputation:a,firstGrabbedManipulator:s}=n,{start:o,end:r,offset:l,heading:c,rotation:u}=t,d=a===e,p=Y(e),{dimension:m}=e;for(const h of t.values()){const e=p&&null==i&&(null==s||h===s);h===l?(h.available=e,h.selected=d):h.available=e&&d}if(!p)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(m.measureType).available=!1;for(const f of[c,u])m.measureType===h.L.Direct&&0!==m.offset||(f.available=!1);N(e)?u.available=!1:c.available=!1;const{geometry:g}=e;o.renderLocation=g.directSegment.startRenderSpace,r.renderLocation=g.directSegment.endRenderSpace;const{renderCoordsHelper:v}=this.view;(function(e,t,n){const{dimensionSegment:i,primaryOffsetAxis:a}=t,s=U(Ve,t),o=(0,M.j)(s,S.uY)?(0,_.D_)(Ge):(0,re.wQ)(s,a,S.uY,Ge),r=Math.max((0,M.l)(s),.1/n.unitInMeters);(0,_.hs)(o,o,(0,M.s)(Ve,r,r,r)),e.modelTransform=o,e.renderLocation=i.eval(.5,Ve)})(l,g,v),c.available&&function(e,t,n){Te(e,t,n,{forHeading:!0})}(c,e,v),u.available&&function(e,t,n){Te(e,t,n,{forHeading:!1})}(u,e,v),t.forEachMeasureTypeManipulator(((t,n)=>{t.available&&function(e,t,n,i){const{geometry:a}=t,s=R(Ue,n,t,i),o=L(Ve,{measureType:n,directSegment:a.directSegment,renderCoordsHelper:i}),r=(0,M.z)(je,s.endRenderSpace,s.startRenderSpace),l=(0,re.wQ)(r,o,S.uY,Ge),c=(0,M.l)(r);(0,_.hs)(l,l,(0,M.s)(je,c,c,c)),e.modelTransform=l,e.renderLocation=s.eval(.5,je)}(t,e,n,v)}))}_updateManipulatorStyle(e){const t=function(e){return(0,J.Lz)(e)+4}(e),n=Le(e),i={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:a,heading:s,rotation:o}of this._computationManipulators.values())a.radius=n/2,s.update(i),o.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:n})}_applyPointUpdate(e,t){const{view:n}=this,i=T(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);const a=z(i,n.renderCoordsHelper);if(null==a)return;const s=this._computeConstraint({...i,geometry:a});Qe(e,t,{...i,constraint:s,unconstrainedGeometry:a,view:n}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,pt);const t=this.view.state.camera.computeScreenPixelSizeAt(pt);e.dimension.offset=50*t}_computeConstraint(e){return function(e,t){if(q(e))return Fe.Direct;if(!e.enabled)return null;const{geometry:n}=e;if(null==n||(0,M.j)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;const{camera:i}=t.state,a=j(P.rq.get(),n,t.renderCoordsHelper),s=G(P.rq.get(),n),o=(0,M.h)(P.rq.get(),a,(0,M.k)(s,a)),r=(0,M.f)(P.rq.get(),s,o),l=(0,M.p)(r),c=(0,M.p)(o),{startRenderSpace:u,endRenderSpace:d}=n.directSegment,p=Math.max(10*i.computeScreenPixelSizeAt(u),10*i.computeScreenPixelSizeAt(d))**2;return l<p?Fe.Vertical:c<p?Fe.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new fe.W({width:1,renderOccluded:me.m$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const e=e=>{var t;return null===(t=this.analysisViewData.computations.find((t=>{let{computation:n}=t;return n.dimension===e})))||void 0===t?void 0:t.computation};return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=me.m$.Occlude,this.manipulators.forEach((e=>{let{manipulator:t}=e;for(const{geometry:n}of t.renderObjects)n.material.setParameters({renderOccluded:me.m$.Occlude})}))},getManipulatorsForDimension:t=>this._computationManipulators.get(e(t)),getComputationForDimension:t=>e(t),getConstraintForDimension:t=>{const n=e(t);return null!=n?this._computeConstraint(n):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};(0,a._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"manipulators",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],dt.prototype,"parentTool",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],dt.prototype,"view",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],dt.prototype,"updating",null),(0,a._)([(0,u.MZ)()],dt.prototype,"firstGrabbedManipulator",null),(0,a._)([(0,u.MZ)()],dt.prototype,"hasGrabbedManipulators",null),(0,a._)([(0,u.MZ)()],dt.prototype,"snappingOptions",null),(0,a._)([(0,u.MZ)()],dt.prototype,"_stagedDimension",void 0),(0,a._)([(0,u.MZ)()],dt.prototype,"_activeComputation",null),(0,a._)([(0,u.MZ)()],dt.prototype,"_stagedComputation",null),dt=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],dt);const pt=(0,S.vt)();var ht,mt=n(5109),gt=n(82307),vt=n(46576),ft=n(11500);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(ht||(ht={}));let _t=class extends mt.k{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,vt.T)(this.view.state.viewingMode),this._lengthDimensionSubTool=new dt({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.DQ)(this._lengthDimensionSubTool),(0,o.hA)((()=>this._clearPointerMoveTimeout())),(0,c.watch)((()=>this.state),(e=>{e===ht.Created&&this.finishToolCreation()}),c.syncAndInitial),(0,c.when)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),c.syncAndInitial),(0,c.watch)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.syncAndInitial)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?ht.Creating:ht.Created:ht.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(gt.NE.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else gt.NE.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,ft.sC)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const n=this._intersector.results.min,i=P.rq.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new Me.A({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=Ne)),this._prevPointerMoveTimeout=X.p.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~Ne))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout()}}}};(0,a._)([(0,u.MZ)({constructOnly:!0})],_t.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],_t.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],_t.prototype,"state",null),(0,a._)([(0,u.MZ)({readOnly:!0})],_t.prototype,"updating",null),(0,a._)([(0,u.MZ)({readOnly:!0})],_t.prototype,"cursor",null),(0,a._)([(0,u.MZ)({constructOnly:!0})],_t.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)()],_t.prototype,"selectedDimension",null),(0,a._)([(0,u.MZ)()],_t.prototype,"automaticManipulatorSelection",void 0),(0,a._)([(0,u.MZ)()],_t.prototype,"_activeSubTool",void 0),(0,a._)([(0,u.MZ)()],_t.prototype,"_lengthDimensionSubTool",void 0),_t=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionTool")],_t);n(11265);var yt=n(11113),Mt=n(66747),St=n(28608),wt=n(32314),Pt=n(70667),bt=n(60561);class Ct extends wt.X{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=me.m$.OccludeAndTransparent,this._width=1,this._color=(0,St.fA)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const n=e.endRenderSpace;this.transform=(0,_.kN)(Ot,n),this._normal=t;const{points:i}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[i]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(e){this._color=(0,St.o8)(e),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.markerPrimitive)&&void 0!==e?e:this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new bt.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,Pt.z)(this.geometry,this.normal)){const n=(0,Pt.t)(this._material,t);e.addGeometry(n)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const Ot=(0,y.vt)();class At{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new qe.A,this._messages=null,this._labelSegment=new O.C;const{analysis:t,computation:n,view:i,messages:a,isDecoration:s}=e;this.analysis=t,this.computation=n,this.view=i,this._messages=a;const o=e.visible,r={view:i,attached:o,isDecoration:s},{fontSize:l,textColor:u,textBackgroundColor:d}=t.style;this._visualElements=new zt({marker:new Ct(r,e.markerMaterial),dimension:new et.t(r,e.dimensionLineMaterial),startOffset:new et.t(r,e.offsetLineMaterial),endOffset:new et.t(r,e.offsetLineMaterial),dimensionSmall:new et.t(r,e.smallDimensionLineMaterial),startOffsetSmall:new et.t(r,e.smallOffsetLineMaterial),endOffsetSmall:new et.t(r,e.smallOffsetLineMaterial),label:new Mt.N({view:i,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,J.Lz)(l),textColor:u.clone(),backgroundColor:d.clone(),isDecoration:s})}),this._handles.add([(0,c.watch)((()=>n.geometry),(e=>{this.updateCameraDependentElements(i.state.camera,e,t.style),null!=n.geometry&&this._updateLines(n.geometry)}),{...c.initial,equals:Ye.aI}),(0,c.watch)((()=>n.length),(e=>this._updateLabelContent(e)),c.initial)])}destroy(){this.destroyed=!0,this._handles=(0,l.pR)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=I(Dt,i.Start,e.directSegment,e.dimensionSegment),n=I(xt,i.End,e.directSegment,e.dimensionSegment),a=this._visualElements;a.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),a.dimension.setGeometryFromSegment(e.dimensionSegment),a.startOffset.setGeometryFromSegment(t),a.endOffset.setGeometryFromSegment(n),a.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),a.startOffsetSmall.setGeometryFromSegment(t),a.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,t,n){const i=this._visualElements;if(null==t){for(const e of i.values())e.visible=!1;return}const a=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Tt)),s=function(e,t){return(0,M.p)(U(W,e))/t**2}(t,a),o=s<(2*(0,J.Lz)(n.lineSize))**2,r=!o;i.marker.visible=r,i.dimension.visible=r,i.startOffset.visible=r,i.endOffset.visible=r,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;const l=5*(0,J.Lz)(n.fontSize),{label:c}=i;if(c.visible=s>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=t,{offset:p}=this.computation.dimension,h=(Math.sign(p)>=0?1:-1)*this._labelOffsetPx(n)*a;(function(e,t,n,i){(0,M.r)(e.startRenderSpace,t.startRenderSpace,n,i),(0,M.r)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,u,d,h),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,J.Lz)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,yt.zJ)(this._messages,e,e.unit):t.text=""}_labelOffsetPx(e){return 1.5*(0,J.Lz)(e.fontSize)+20+(0,J.Lz)(e.lineSize/2)}}const Dt=new O.C,xt=new O.C,Tt=(0,S.vt)();class zt{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var It=n(50125),Rt=n(38042),Ht=n(63860);let Zt=class extends s.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new bt.i({width:1,anchor:It.kJ.Tip,color:K.uY,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:me.m$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new fe.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new fe.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,stipplePattern:(0,nt.wk)(5),isDecoration:e}),this._smallDimensionLineMaterial=new fe.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new fe.W({width:1,color:K.uY,renderOccluded:me.m$.OccludeAndTransparent,stipplePattern:(0,nt.wk)(5),isDecoration:e});for(const n of this._lineMaterials())this.view._stage.add(n),this.addHandles((0,o.hA)((()=>{var e;null===(e=this.view._stage)||void 0===e||e.remove(n)})));const t=(0,c.mapCollection)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createVisualization(t)}));this._dimensionVisualizations=t,this.addHandles([(0,o.DQ)(t),(0,c.watch)((()=>$.A.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),c.syncAndInitial),(0,c.watch)((()=>this.analysis.style.lineSize),(e=>{const t=(0,J.Lz)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const n=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:n})}),c.syncAndInitial),(0,c.watch)((()=>({camera:this.view.state.camera,style:Et(this.analysis)})),(e=>{let{camera:t,style:n}=e;for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(t,i.computation.geometry,n),i.updateLabelStyle(n)})),(0,c.watch)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,Rt.oQ)((()=>this._updateMessageBundle())),(0,c.when)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),c.sync)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map((e=>{let{visualization:t}=e;return t})),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:me.m$.Occlude})}}}_createVisualization(e){const t=new At({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,Ht.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Et(e){const{fontSize:t,lineSize:n,textColor:i,textBackgroundColor:a}=e.style;return{fontSize:t,lineSize:n,textBackgroundColor:a.clone(),textColor:i.clone()}}(0,a._)([(0,u.MZ)({constructOnly:!0})],Zt.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],Zt.prototype,"isDecoration",void 0),(0,a._)([(0,u.MZ)()],Zt.prototype,"analysis",null),(0,a._)([(0,u.MZ)()],Zt.prototype,"visible",null),(0,a._)([(0,u.MZ)()],Zt.prototype,"loadingMessages",void 0),Zt=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Zt);let Lt=class extends s.A{constructor(e){super(e),this.dimension=null,this.length=null}};(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"dimension",void 0),(0,a._)([(0,u.MZ)()],Lt.prototype,"length",void 0),Lt=(0,a._)([(0,d.$)("esri.views.3d.analysis.LengthDimensionResult")],Lt);const kt=Lt;let Nt=class extends s.A{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...n}=e;return{result:new kt({dimension:t}),...n}}initialize(){this.addHandles([(0,c.watch)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),c.syncAndInitial),(0,c.watch)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),c.syncAndInitial)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Nt.prototype,"result",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Nt.prototype,"projectAndAlignPoint",void 0),(0,a._)([(0,u.MZ)()],Nt.prototype,"dimension",null),(0,a._)([(0,u.MZ)()],Nt.prototype,"length",null),(0,a._)([(0,u.MZ)()],Nt.prototype,"geometry",void 0),(0,a._)([(0,u.MZ)()],Nt.prototype,"unconstrainedGeometry",void 0),(0,a._)([(0,u.MZ)()],Nt.prototype,"elevationAlignedStartPoint",void 0),(0,a._)([(0,u.MZ)()],Nt.prototype,"elevationAlignedEndPoint",void 0),(0,a._)([(0,u.MZ)()],Nt.prototype,"preConstraintProperties",void 0),(0,a._)([(0,u.MZ)()],Nt.prototype,"previousConstraint",void 0),Nt=(0,a._)([(0,d.$)("esri.views.3d.analysis.LengthDimensionComputation")],Nt);var Vt=n(17430),jt=n(10260),Gt=n(19276);const Ut=e=>{let t=class extends e{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new Gt.A}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,a._)([(0,u.MZ)({constructOnly:!0})],t.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)()],t.prototype,"tool",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],t.prototype,"results",null),(0,a._)([(0,u.MZ)()],t.prototype,"selectedDimension",void 0),(0,a._)([(0,u.MZ)()],t.prototype,"interactive",void 0),(0,a._)([(0,u.MZ)()],t.prototype,"visible",void 0),t=(0,a._)([(0,d.$)("esri.views.analysis.DimensionAnalysisView")],t),t};let Ft=class extends(Ut((0,p.P)(s.A))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:n}=this.view,i=(0,Vt.B)(e,t,n);return null==i&&(0,Vt.V)(this.analysis,e.spatialReference,r.A.getLogger(this)),i};const e=(0,c.mapCollection)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,jt.Hd)(this,_t),(0,o.DQ)(e)]),this._analysisVisualization=new Zt({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new B({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.DC)(this._placementTask),this._analysisVisualization=(0,l.pR)(this._analysisVisualization),(0,jt.aS)(this)}get updating(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.DC)(this._placementTask),this._placementTask=(0,jt.JY)(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,n=new Nt({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,n),{computation:n,remove:()=>this._removeComputation(n)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,a._)([(0,u.MZ)({readOnly:!0})],Ft.prototype,"type",void 0),(0,a._)([(0,u.MZ)()],Ft.prototype,"tool",void 0),(0,a._)([(0,u.MZ)()],Ft.prototype,"updating",null),(0,a._)([(0,u.MZ)({readOnly:!0})],Ft.prototype,"results",null),(0,a._)([(0,u.MZ)()],Ft.prototype,"computations",void 0),(0,a._)([(0,u.MZ)()],Ft.prototype,"selectedDimension",void 0),(0,a._)([(0,u.MZ)()],Ft.prototype,"selectedComputation",null),(0,a._)([(0,u.MZ)()],Ft.prototype,"_analysisVisualization",void 0),(0,a._)([(0,u.MZ)()],Ft.prototype,"_analysisController",void 0),(0,a._)([(0,u.MZ)()],Ft.prototype,"_dimensionsToComputations",void 0),(0,a._)([(0,u.MZ)()],Ft.prototype,"_placementTask",void 0),Ft=(0,a._)([(0,d.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],Ft);const Wt=Ft},59962:(e,t,n)=>{n.d(t,{t:()=>u,k:()=>d});const i="theme-style";function a(e,t){return function(e,t){const n=new Image(t,t);return n.src=e,n}(function(e){const t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))}(s(function(e){const t=e.split(",")[1],n=atob(t);return(new DOMParser).parseFromString(n,"image/svg+xml")}(e),t)),t.size)}function s(e,t){let{accentColor:n,contrastColor:a}=t;const s=n.toHex(),o=n.a,r=a.toHex(),l=a.a,c=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(i);return c&&(c.innerHTML="\n      .contrast-fill { fill: ".concat(r,"; fill-opacity: ").concat(l,"; }\n      .contrast-stroke { stroke: ").concat(r,"; stroke-opacity: ").concat(l,";  }\n      .accent-fill { fill: ").concat(s,"; fill-opacity: ").concat(o,"; }\n      .accent-stroke { stroke: ").concat(s,"; stroke-opacity:  ").concat(o,"; }")),e}const o="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",r="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxjaXJjbGUgY3g9IjM5LjQ3OCIgY3k9IjMuMDc4IiByPSIyOCIgY2xhc3M9ImFjY2VudC1maWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg0MC41NDIpIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI1IiBkPSJtNy4wNzQgMzAuMDUzIDI5LjM5NyAxMS45ODUtMy42NzMtMzMuNDkzIiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSIyLjk5NiIgZD0iTTI0LjUwNCAyMy4yMDdhMTEuOTggMTEuOTggMCAwIDAtOS44IDcuNTA3IiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIGNvbnRyYXN0LWZpbGwiLz48cGF0aCBkPSJtMjkuODE4IDIyLjgwOC02LjE4NCA0LjYtLjU0MS04LjM2NHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+";var l=n(96897);const c=64;function u(e,t){const{accentColor:n,contrastColor:i,preMultiplyAlpha:s}=t;return e.fromData("heading-rotate:[accent:".concat(n,",contrast:").concat(i,",size:").concat(c,"]"),(()=>new l.g(a(o,{accentColor:n,contrastColor:i,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:s})))}function d(e,t){const{accentColor:n,contrastColor:i,preMultiplyAlpha:s}=t;return e.fromData("tilt-rotate:[accent:".concat(n,",contrast:").concat(i,",size:").concat(c,"]"),(()=>new l.g(a(r,{accentColor:n,contrastColor:i,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:s})))}},85937:(e,t,n)=>{n.d(t,{I:()=>g});var i=n(20664),a=n(9392),s=n(43047),o=n(55855),r=n(32314),l=n(49296),c=n(44815),u=n(67425);var d=n(83490),p=n(62577),h=n(45463),m=n(84294);class g extends r.X{constructor(e){super(e),this.view=null,this._renderOccluded=h.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,o.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,o.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,s.a)(e,this._color)||((0,s.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,s.a)(e,this._outlineColor)||((0,s.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,n,i,a){const s=(0,c.jh)(3*e.length),o=(0,c.jh)(s.length);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const r=(0,u.au)(s,t,0,o,0,s,0,s.length/3,n,i,a),l=null!=r;return{numVertices:e.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:r}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,l.F.fromElevationInfo(this.elevationInfo)),n=[],a=t.numVertices,s=t.position;for(let o=0;o<a;++o){const e=(0,i.s)(v,s[3*o],s[3*o+1],s[3*o+2]),t=f(this._vertexMaterial,.5,e),a=f(this._vertexOutlineMaterial,.5,e);n.push({vertexGeometry:t,vertexOutlineGeometry:a})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:i}of t)e.addGeometry(n),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new m.A({...this._vertexMaterialParameters,writeDepth:!0,cullFace:d.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new m.A({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:d.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const v=(0,a.vt)();function f(e,t,n){return(0,p.CM)(e,t,16,16,{offset:n})}},77447:(e,t,n)=>{n.d(t,{r:()=>z});var i=n(88105),a=n(34981),s=n(83490),o=n(75803),r=n(45463),l=n(60322),c=n(77730),u=n(86994),d=n(66470),p=n(82809),h=n(86401),m=n(63928),g=n(52757),v=n(35143),f=(n(64839),n(16506)),_=n(42693),y=n(99415),M=n(28584),S=n(96643),w=n(10773),P=n(92656),b=n(29201),C=n(93345),O=n(57162);class A extends _.w{initializeProgram(e){return new M.B(e.rctx,A.shader.get().build(this.configuration),T)}_setPipelineState(e,t){const n=this.configuration,i=e===w.y.NONE,s=e===w.y.FrontFace;return(0,O.Ey)({blending:n.output!==a.V.Color&&n.output!==a.V.Alpha||!n.transparent?null:i?D:(0,l.ez)(e),culling:(0,O.Xt)(n.cullFace),depthTest:{func:(0,l.K_)(e)},depthWrite:i?n.writeDepth?O.kn:null:(0,l.XO)(e),colorWrite:O.wE,stencilWrite:n.hasOccludees?S.v0:null,stencilTest:n.hasOccludees?t?S.a9:S.qh:null,polygonOffset:i||s?null:(0,l.aB)(n.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}A.shader=new f.$(b.I,(()=>n.e(48391).then(n.bind(n,48391))));const D=(0,O.ox)(C.dn.ONE,C.dn.ONE_MINUS_SRC_ALPHA);class x extends P.E{constructor(){super(...arguments),this.output=a.V.Color,this.cullFace=s.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=w.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,v._)([(0,y.W)({count:a.V.COUNT})],x.prototype,"output",void 0),(0,v._)([(0,y.W)({count:s.s2.COUNT})],x.prototype,"cullFace",void 0),(0,v._)([(0,y.W)()],x.prototype,"hasSlicePlane",void 0),(0,v._)([(0,y.W)()],x.prototype,"transparent",void 0),(0,v._)([(0,y.W)()],x.prototype,"enableOffset",void 0),(0,v._)([(0,y.W)()],x.prototype,"writeDepth",void 0),(0,v._)([(0,y.W)()],x.prototype,"hasOccludees",void 0),(0,v._)([(0,y.W)({count:w.y.COUNT})],x.prototype,"transparencyPassType",void 0),(0,v._)([(0,y.W)()],x.prototype,"multipassEnabled",void 0),(0,v._)([(0,y.W)()],x.prototype,"cullAboveGround",void 0),(0,v._)([(0,y.W)()],x.prototype,"perspectiveInterpolation",void 0),(0,v._)([(0,y.W)({constValue:!1})],x.prototype,"occlusionPass",void 0);const T=new Map([[d.r.POSITION,0],[d.r.UV0,2],[d.r.PERSPECTIVEDIVIDE,3]]);class z extends m.W{constructor(e){super(e,new H),this.supportsEdges=!0,this.produces=new Map([[c.N.OPAQUE_MATERIAL,e=>e===a.V.Highlight||(0,a.j8)(e)&&!this.parameters.transparent],[c.N.TRANSPARENT_MATERIAL,e=>(0,a.j8)(e)&&this.parameters.transparent&&this.parameters.writeDepth],[c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,a.j8)(e)&&this.parameters.transparent&&!this.parameters.writeDepth],[c.N.DRAPED_MATERIAL,e=>(0,a.jS)(e)]]),this._vertexAttributeLocations=T,this._configuration=new x}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<l.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new I(e)}createBufferWriter(){const e=h.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(d.r.PERSPECTIVEDIVIDE),new R(e)}}class I extends o.m{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(A,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==a.V.Color&&this._output!==a.V.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class R extends p.Z{write(e,t,n,a,s){for(const o of this.vertexBufferLayout.fields.keys()){const r=n.attributes.get(o);if(r)if(o===d.r.PERSPECTIVEDIVIDE){(0,u.vA)(1===r.size);const e=a.getField(o,i.Y$);e&&(0,g.uO)(r,e,s)}else(0,g.zC)(o,r,e,t,a,s)}}}class H extends r.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=s.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}},10260:(e,t,n)=>{n.d(t,{Hd:()=>l,JY:()=>r,aS:()=>c});var i=n(98773),a=n(30726),s=n(50346),o=n(68134);function r(e,t){e.interactive=!0;const{tool:n,view:r}=e;r.activeTool=n;let l=(0,s.u7)(t,(()=>{r.activeTool===n&&(r.activeTool=null)}));return(0,i.UT)((async e=>{await(0,o.whenOnce)((()=>null==n||!n.active),e),l=(0,a.xt)(l)}),t)}function l(e,t){return(0,o.watch)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){c(e);const{view:n,analysis:i}=e,a=new t({view:n,analysis:i,analysisViewData:e});e.tool=a,n.tools.add(a)}(e,t):c(e)}(e,t)),o.syncAndInitial)}function c(e){const{view:t,tool:n}=e;null!=n&&(t.tools.remove(n),e.tool=null)}},5109:(e,t,n)=>{n.d(t,{k:()=>r});var i=n(35143),a=n(68134),s=(n(76460),n(81806),n(47249),n(50076),n(85842)),o=n(56829);let r=class extends o.g{constructor(e){super(e)}initialize(){this.addHandles((0,a.watch)((()=>this.analysisViewData.visible),(e=>this.visible=e),a.syncAndInitial))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};r=(0,i._)([(0,s.$)("esri.views.interactive.AnalysisToolBase")],r)},46576:(e,t,n)=>{n.d(t,{T:()=>s});var i=n(29808),a=n(3112);function s(e){const t=(0,i.hz)(e);return t.options.store=a.oH.MIN,t.options.hud=!1,t}},28455:(e,t,n)=>{n.d(t,{X:()=>h});var i=n(54901),a=n(77944),s=n(19276),o=n(68134),r=n(3589),l=n(63078),c=n(83973);var u=n(12843),d=n(43184);const p=new Map;function h(e){if(!p.has(e)){const t=function(e,t){var n,i;const a=new c.A({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:l.N.distance,touchSensitivityMultiplier:null!==(i=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==i?i:l.N.touchSensitivityMultiplier});return{...(0,o.watch)((()=>{var t,n;return null!==(t=null===(n=e.map)||void 0===n||null===(n=n.allLayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]}),(e=>{a.featureSources=new s.A(e.map((e=>new r.A({layer:e,enabled:!0}))))}),o.initial),options:a}}(e,{distance:10}),n=function(e,t){return new d.g({view:e,options:t,snappingEnginesFactory:(t,n)=>[new u.f({view:e,spatialReference:e.spatialReference,options:n})]})}(e,t.options);p.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=p.get(e);t.referenceCount++;const n=(0,i.hA)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,a.d)((()=>{0===t.referenceCount&&(t.remove(),p.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...n}}},13284:(e,t,n)=>{n.d(t,{e:()=>i});class i{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},61237:(e,t,n)=>{n.d(t,{L:()=>p});var i=n(30726),a=n(50346),s=n(68134),o=n(74e3),r=n(32535),l=n(12482),c=n(17046),u=n(13284),d=n(59752);function p(e){let{predicate:t=(()=>!0),snappingManager:n,snappingContext:r,updatingHandles:p,useZ:f=!0}=e;const _=new c.rh;if(null==n)return{snappingStep:[v,_],cancelSnapping:v};let y,M=null,S=null,w=null;const P=()=>{var e;M=(0,i.DC)(M),n.doneSnapping(),null!==(e=S)&&void 0!==e&&e.frameTask.remove(),S=null,y=(0,i.xt)(y),w=null},b=function(e,t,n){return(0,a.sg)((async(i,a)=>{let{frameTask:s,point:r,scenePoint:l,context:c,event:u,delta:d,getLastState:p}=i;const h=await s.schedule((()=>e.snap({point:r,scenePoint:l,context:c,signal:a})),a);if(h.valid){let i=await s.schedule((()=>h.apply()),a);const l=p();null!=l.point&&r!==l.point&&(i=e.update({point:l.point,scenePoint:l.scenePoint,context:c})),null!=l.updatePoint&&(0,o.CI)(i,l.updatePoint)||(g(u.mapEnd,i,d,t),n.execute(u))}}))}(n,f,_);let C=null,O=null,A=null;return{snappingStep:[e=>{if(!t(e))return e;const{action:i}=e;if("start"===i){const{info:t}=e,i=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(d.W6.SNAPPING):d.nu}(n.view);if(S=function(e,t,n){return{context:new u.e({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(r,e,i),S.context.selfSnappingZ=null,!f&&null!=t){var o;const e=function(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const a of n){const t=e.getZ(a.pos);if(null!=i&&null!=t&&Math.abs(t-i)>1e-6)return null;null==i&&(i=t)}return i}(r.coordinateHelper,t.handle.component);null!=e&&(S.context.selfSnappingZ={value:e,elevationInfo:null!==(o=r.elevationInfo)&&void 0!==o?o:l.qt})}}if(null!=S){const{context:t,originalScenePos:o,originalPos:r}=S,{mapEnd:l,mapStart:c,scenePoints:u}=e,d=h(r,m(l,c)),v=m(c,r),_={...e,action:"update"},P=S.context,D=function(e,t){return null==e||null==t?null:h(e,m(t.sceneEnd,t.sceneStart))}(o,u),x=n.update({point:d,scenePoint:D,context:t});if(A=x,g(l,x,v,f),C=d,O=D,"end"!==i){const{frameTask:e}=S;null==M&&(M=new AbortController),w=t=>{p.addPromise((0,a.QZ)(b({frameTask:e,event:_,context:P,point:d,scenePoint:D,delta:v,getLastState:()=>({point:C,scenePoint:O,updatePoint:t.forceUpdate?null:A})},M.signal)))},w({forceUpdate:!1}),null==y&&(y=(0,s.watch)((()=>n.options.effectiveEnabled),(()=>{var e;return null===(e=w)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===i&&P(),e},_],cancelSnapping:e=>(P(),e)}}function h(e,t){let[n,i,a]=t;const s=(0,r.EL)(e);return s.x+=n,s.y+=i,s.hasZ&&(s.z+=a),s}function m(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function g(e,t,n,i){let[a,s,o]=n;e.x=t.x+a,e.y=t.y+s,i&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function v(e){return e}},14318:(e,t,n)=>{n.d(t,{O:()=>u});var i=n(35143),a=n(91967),s=n(30726),o=n(50346),r=n(46053),l=(n(81806),n(76460),n(47249),n(85842)),c=n(59752);let u=class extends a.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.sg)((async(e,t,n,i)=>{const a=this._frameTask;if(null==a)return;const s=await a.schedule((()=>t.snap({...e,context:n,signal:i})),i);s.valid&&await a.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(c.W6.SNAPPING):c.nu}destroy(){this._abortController=(0,s.DC)(this._abortController),this._frameTask=(0,s.xt)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:a}=e,s=t.update({point:i,scenePoint:a,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:a}=e;return this.stagedPoint=t.update({point:i,scenePoint:a,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,s.DC)(this._abortController),this._snapPoints=null}};(0,i._)([(0,r.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,i._)([(0,r.MZ)()],u.prototype,"stagedPoint",null),(0,i._)([(0,r.MZ)()],u.prototype,"constrainResult",void 0),(0,i._)([(0,r.MZ)()],u.prototype,"_stagedPoint",void 0),u=(0,i._)([(0,l.$)("esri.views.interactive.snapping.SnappingOperation")],u)},68655:(e,t,n)=>{n.d(t,{Do:()=>l,Kt:()=>r,ob:()=>o});var i=n(9392),a=n(29772),s=n(92854);function o(e){var t;return null!==(t=(0,s.mh)(e))&&void 0!==t?t:(0,a.Xg)(e)}function r(e,t){var n;return null!==(n=(0,s.Og)(e,t))&&void 0!==n?n:(0,a.ll)(e,t)}function l(e,t,n){var i;return c[0]=e[0],c[1]=e[1],c[2]=3===e.length?e[2]:0,u[0]=t[0],u[1]=t[1],u[2]=3===t.length?t[2]:0,null!==(i=(0,s.n3)(c,u,n))&&void 0!==i?i:(0,a.sT)(c,u,n)}const c=(0,i.vt)(),u=(0,i.vt)()},29772:(e,t,n)=>{n.d(t,{Ce:()=>h,Of:()=>v,Qc:()=>f,Xg:()=>d,cL:()=>M,e5:()=>g,ll:()=>m,sT:()=>y,vp:()=>_});var i,a=n(24648),s=n(31633),o=n(20664),r=n(9392),l=n(14487),c=n(80963),u=n(41868);function d(e){return p(e,i.Horizontal)}function p(e,t){const{hasZ:n,spatialReference:o}=e,r=(0,u.l)(o);let l=0;const c=(0,s._H)(r);if(null==c)return null;const d=t===i.Direct?_:y;for(const i of e.paths){if(i.length<2)continue;const e=i.length-1;for(let t=0;t<e;++t){const e=i[t];w[0]=e[0],w[1]=e[1],w[2]=n?e[2]:0;const a=i[t+1];P[0]=a[0],P[1]=a[1],P[2]=n?a[2]:0;const s=d(w,P,o);if(null==s)return null;l+=s.value}}return(0,a.d_)(l,c)}function h(e,t){const{spatialReference:n}=e;return(0,c.aI)(n,t.spatialReference)?(w[0]=e.x,w[1]=e.y,w[2]=e.hasZ?e.z:0,P[0]=t.x,P[1]=t.y,P[2]=t.hasZ?t.z:0,_(w,P,n)):null}function m(e,t){const{spatialReference:n}=e;return(0,c.aI)(n,t.spatialReference)?(w[0]=e.x,w[1]=e.y,w[2]=e.hasZ?e.z:0,P[0]=t.x,P[1]=t.y,P[2]=t.hasZ?t.z:0,y(w,P,n)):null}function g(e,t){const{spatialReference:n}=e;return(0,c.aI)(n,t.spatialReference)?(w[0]=e.x,w[1]=e.y,w[2]=e.hasZ?e.z:0,P[0]=t.x,P[1]=t.y,P[2]=t.hasZ?t.z:0,M(w,P,n)):null}function v(e){return null!=e?f(e.hasZ?e.z:0,e.spatialReference):null}function f(e,t){const n=(0,s.mq)(t);return null!=n?(0,a.d_)(null!==e&&void 0!==e?e:0,n):null}function _(e,t,n){const s=S(e,t,n,i.Direct);return null!=s?(0,a.d_)(s.direct,s.unit):null}function y(e,t,n){const s=S(e,t,n,i.Horizontal);return null!=s?(0,a.d_)(s.horizontal,s.unit):null}function M(e,t,n){const s=S(e,t,n,i.Vertical);return null!=s?(0,a.d_)(s.verticalSigned,s.unit):null}function S(e,t,n,a){const r=(0,u.l)(n),c=(0,s._H)(r);if(null==c)return null;const d=t[2]-e[2];if(a===i.Vertical)return{verticalSigned:d,unit:c};if(!(0,l.F)(e,n,b,r)||!(0,l.F)(t,n,C,r))return null;if(a===i.Direct)return{direct:(0,o.q)(C,b),unit:c};if((0,o.s)(O,e[0],e[1],t[2]),!(0,l.F)(O,n,O,r))return null;const p=(0,o.q)(O,C);return a===i.Horizontal?{horizontal:p,unit:c}:{direct:(0,o.q)(C,b),horizontal:p,vertical:Math.abs(d),unit:c}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(i||(i={}));const w=(0,r.vt)(),P=(0,r.vt)(),b=(0,r.vt)(),C=(0,r.vt)(),O=(0,r.vt)()},41868:(e,t,n)=>{n.d(t,{l:()=>s});var i=n(9624),a=n(98510);function s(e){const t=(0,a.lO)(e),n=t===a.GD?a.Y0:t;return(0,i.canProjectWithoutEngine)(e,n)?n:e}}}]);
//# sourceMappingURL=97768.1e01fa9f.chunk.js.map
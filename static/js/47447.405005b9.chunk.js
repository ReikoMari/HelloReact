"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[47447],{80381:(e,t,r)=>{r.d(t,{O:()=>u,a:()=>f,b:()=>p});var i,n=r(57528),o=r(19539),s=r(73398),a=r(21390),l=r(72790),d=r(64839),c=r(32307),h=r(70367);class u extends d.Y{constructor(){super(...arguments),this.overlayIndex=o.vr.INNER,this.opacity=1}}function p(){const e=new c.N5;return e.include(s.c),e.fragment.uniforms.add(new h.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new l.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity))),e.fragment.code.add((0,d.H)(i||(i=(0,n.A)(["void main() {\nvec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\nfragColor = texture(tex, overlayUV) * opacity;\n}"])))),e}const f=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:p},Symbol.toStringTag,{value:"Module"}))},14623:(e,t,r)=>{r.d(t,{R:()=>_e,b:()=>ge,r:()=>me});var i,n,o,s,a,l,d,c,h,u,p,f,v,m,g,_,y,w,C,x,A,S,T,R,O,b,M,E,D,P,I,L,N,F,V,H,z,j,W,U,G,B,k,Z=r(57528),q=r(72412),Q=r(34981),X=r(26917),J=r(90080),Y=r(3838),$=r(49399),K=r(2443),ee=r(17698),te=r(81993),re=r(36324),ie=r(90235),ne=r(80883),oe=r(3799),se=r(95756),ae=r(58350),le=r(21390),de=r(64839),ce=r(43425),he=r(32307),ue=r(10773),pe=r(66470),fe=r(50125),ve=r(46259);const me=1;function ge(e){const t=new he.N5,{attributes:r,varyings:ge,constants:_e,vertex:ye,fragment:we}=t;t.include(re.p),t.include(Y.s,e),t.include(K.q,e);const Ce=e.applyMarkerOffset&&!e.draped;Ce&&(ye.uniforms.add(new le.m("markerScale",(e=>e.markerScale))),t.include(ee.r,{space:fe.lM.World,draped:!1})),e.output===Q.V.LinearDepth&&t.include($.L,e),t.include(J.g,e),(0,oe.NB)(ye,e),ye.uniforms.add(new ce.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new se.G("nearFar",((e,t)=>t.camera.nearFar)),new le.m("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new ae.E("viewport",((e,t)=>t.camera.fullViewport))),ye.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(pe.r.POSITION,"vec3"),r.add(pe.r.PREVPOSITION,"vec3"),r.add(pe.r.NEXTPOSITION,"vec3"),r.add(pe.r.SUBDIVISIONFACTOR,"float"),r.add(pe.r.UV0,"vec2"),ge.add("vColor","vec4"),ge.add("vpos","vec3"),ge.add("vLineDistance","float"),ge.add("vLineWidth","float"),(0,q.Mu)(t);const xe=e.multipassEnabled&&(e.output===Q.V.Color||e.output===Q.V.Alpha);xe&&ge.add("depth","float");const Ae=e.stippleEnabled;Ae&&ge.add("vLineSizeInv","float"),_e.add("aaWidth","float",e.stippleEnabled?0:1);const Se=e.capType===ve.x.ROUND,Te=e.stippleEnabled&&Se,Re=e.falloffEnabled||Te;Re&&ge.add("vLineDistanceNorm","float"),Se&&(ge.add("vSegmentSDF","float"),ge.add("vReverseSegmentSDF","float")),ye.code.add((0,de.H)(i||(i=(0,Z.A)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),ye.code.add((0,de.H)(n||(n=(0,Z.A)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),(0,q.i$)(t),ye.code.add((0,de.H)(o||(o=(0,Z.A)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = calculateLinearDepth(nearFar,pos.z);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),xe?"depth = pos.z;":"")),(0,oe.Nz)(ye),ye.code.add((0,de.H)(s||(s=(0,Z.A)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n      float lineSize = getSize();\n\n      if (lineSize < 1.0) {\n        coverage = lineSize; // convert sub-pixel coverage to alpha\n        lineSize = 1.0;\n      }\n      lineSize += aaWidth;\n\n      float lineWidth = lineSize * pixelRatio;\n      vLineWidth = lineWidth;\n      ","\n\n      vec4 pos  = view * vec4(position, 1.0);\n      vec4 prev = view * vec4(prevPosition, 1.0);\n      vec4 next = view * vec4(nextPosition, 1.0);\n  "])),Ae?(0,de.H)(a||(a=(0,Z.A)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),Ce&&ye.code.add((0,de.H)(l||(l=(0,Z.A)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),ye.code.add((0,de.H)(d||(d=(0,Z.A)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||Se)&&ye.code.add((0,de.H)(c||(c=(0,Z.A)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),Se?(0,de.H)(h||(h=(0,Z.A)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),ye.code.add((0,de.H)(u||(u=(0,Z.A)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?ye.code.add((0,de.H)(p||(p=(0,Z.A)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,de.H)(f||(f=(0,Z.A)(["min(1.0, subdivisionFactor * ",")"])),de.H.float((me+2)/(me+1))):(0,de.H)(v||(v=(0,Z.A)(["subdivisionFactor"]))))):ye.code.add((0,de.H)(m||(m=(0,Z.A)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));const Oe=e.capType!==ve.x.BUTT;return ye.code.add((0,de.H)(g||(g=(0,Z.A)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),Oe?(0,de.H)(_||(_=(0,Z.A)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),ye.code.add((0,de.H)(y||(y=(0,Z.A)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n    float lineDistNorm = sign(uv0.y) * pos.w;\n\n    vLineDistance =  lineWidth * lineDistNorm;\n    ","\n\n    pos.xy += dpos;\n  "])),Re?(0,de.H)(w||(w=(0,Z.A)(["vLineDistanceNorm = lineDistNorm;"]))):"")),Se&&ye.code.add((0,de.H)(C||(C=(0,Z.A)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?ye.uniforms.add(new le.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):ye.code.add((0,de.H)(x||(x=(0,Z.A)(["vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),ye.code.add((0,de.H)(A||(A=(0,Z.A)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?ye.code.add((0,de.H)(S||(S=(0,Z.A)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):ye.code.add((0,de.H)(T||(T=(0,Z.A)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),ye.uniforms.add(new le.m("stipplePatternPixelSize",(e=>(0,K.h)(e)))),ye.code.add((0,de.H)(R||(R=(0,Z.A)(["float patternLength = lineSize * stipplePatternPixelSize;\nvStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\nvStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\nif (segmentLengthScreenDouble >= 0.001) {\nvec2 stippleDisplacement = pos.xy - segmentOrigin;\nfloat stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\nvStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n}\nvStippleDistanceLimits *= pos.w;\nvStippleDistance *= pos.w;\nvStippleDistanceLimits = isJoin ?\nvStippleDistanceLimits :\nisStartVertex ?\nvec2(-1e34, vStippleDistanceLimits.y) :\nvec2(vStippleDistanceLimits.x, 1e34);"]))))),ye.code.add((0,de.H)(O||(O=(0,Z.A)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),xe&&t.include(te.Q,e),t.include(X.HQ,e),we.include(ne.a),we.code.add((0,de.H)(b||(b=(0,Z.A)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),xe?"terrainDepthTest(depth);":"")),e.wireframe?we.code.add((0,de.H)(M||(M=(0,Z.A)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(Se&&we.code.add((0,de.H)(E||(E=(0,Z.A)(["\n        float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n        vec2 fragmentPosition = vec2(\n          min(sdf, 0.0),\n          vLineDistance\n        ) * gl_FragCoord.w;\n\n        float fragmentRadius = length(fragmentPosition);\n        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n        if (capCoverage < ",") {\n          discard;\n        }\n      "])),de.H.float(ie.y))),Te?we.code.add((0,de.H)(D||(D=(0,Z.A)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),de.H.float(ie.y))):we.code.add((0,de.H)(P||(P=(0,Z.A)(["float stippleAlpha = getStippleAlpha();"])))),e.output!==Q.V.ObjectAndLayerIdColor&&we.code.add((0,de.H)(I||(I=(0,Z.A)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),we.uniforms.add(new ae.E("intrinsicColor",(e=>e.color))),we.code.add((0,de.H)(L||(L=(0,Z.A)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(we.uniforms.add(new ae.E("innerColor",(e=>{var t;return null!==(t=e.innerColor)&&void 0!==t?t:e.color})),new le.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),we.code.add((0,de.H)(N||(N=(0,Z.A)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),we.code.add((0,de.H)(F||(F=(0,Z.A)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(we.uniforms.add(new le.m("falloff",(e=>e.falloff))),we.code.add((0,de.H)(V||(V=(0,Z.A)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"]))))),e.stippleEnabled||we.code.add((0,de.H)(H||(H=(0,Z.A)(["float featherStartDistance = max(vLineWidth - 2.0, 0.0);\nfloat value = abs(vLineDistance) * gl_FragCoord.w;\nfloat feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);\nfinalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);"]))))),we.code.add((0,de.H)(z||(z=(0,Z.A)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===Q.V.ObjectAndLayerIdColor?(0,de.H)(j||(j=(0,Z.A)(["finalColor.a = 1.0;"]))):"",de.H.float(ie.y),e.output===Q.V.Alpha?(0,de.H)(W||(W=(0,Z.A)(["fragColor = vec4(finalColor.a);"]))):"",e.output===Q.V.Color?(0,de.H)(U||(U=(0,Z.A)(["fragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===Q.V.Color&&e.transparencyPassType===ue.y.Color?"fragColor = premultiplyAlpha(fragColor);":"",e.output===Q.V.Highlight?(0,de.H)(G||(G=(0,Z.A)(["fragColor = vec4(1.0);"]))):"",e.output===Q.V.LinearDepth?(0,de.H)(B||(B=(0,Z.A)(["outputDepth(linearDepth);"]))):"",e.output===Q.V.ObjectAndLayerIdColor?(0,de.H)(k||(k=(0,Z.A)(["outputObjectAndLayerIdColor();"]))):"")),t}const _e=Object.freeze(Object.defineProperty({__proto__:null,build:ge,ribbonlineNumRoundJoinSubdivisions:me},Symbol.toStringTag,{value:"Module"}))},53070:(e,t,r)=>{r.d(t,{T:()=>h,a:()=>p,b:()=>u});var i,n=r(57528),o=r(9392),s=r(73398),a=r(5517),l=r(64839),d=r(32307),c=r(70367);class h extends l.Y{constructor(){super(...arguments),this.color=(0,o.fA)(1,1,1)}}function u(){const e=new d.N5;return e.include(s.c),e.fragment.uniforms.add(new c.N("tex",(e=>e.texture)),new a.t("uColor",(e=>e.color))),e.fragment.code.add((0,l.H)(i||(i=(0,n.A)(["void main() {\nvec4 texColor = texture(tex, uv);\nfragColor = texColor * vec4(uColor, 1.0);\n}"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:h,build:u},Symbol.toStringTag,{value:"Module"}))},23859:(e,t,r)=>{r.d(t,{I:()=>n});var i=r(79369);class n{constructor(e,t){this._cache=e(t,((e,t,r)=>this._remove(e,t,r)))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const t=this._cache.peek(e);if(!t)return;const r=t.pop();if(t.length>0){if(r){const i=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,t,i)}}else this._cache.pop(e);return r}put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.Cn;const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[t],t.usedMemory,r);n.push(t);const o=this._cache.getSize(e)+Math.round(t.usedMemory);this._cache.updateSize(e,n,o)}_remove(e,t,r){switch(t){case i.k2.ALL:return e.forEach((e=>e.dispose())),0;case i.k2.SOME:{const t=e.shift();return t&&(r-=Math.round(t.usedMemory),t.dispose()),r}}}}},14522:(e,t,r)=>{r.d(t,{T:()=>o,U:()=>n});var i=r(15941);function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(0,i.qE)(e,0,l);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*d(n*s[i]))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const s=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=o(new Uint8ClampedArray([255,255,255,255]));function d(e){return e-Math.floor(e)}},83755:(e,t,r)=>{function i(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function s(){return i()}function a(){return o(1,1,1)}function l(){return o(1,0,0)}function d(){return o(0,1,0)}function c(){return o(0,0,1)}r.d(t,{Ul:()=>s,fA:()=>o,o8:()=>n,vt:()=>i});const h=s(),u=a(),p=l(),f=d(),v=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:p,UNIT_Y:f,UNIT_Z:v,ZEROS:h,clone:n,create:i,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:o,ones:a,unitX:l,unitY:d,unitZ:c,zeros:s},Symbol.toStringTag,{value:"Module"}))},44815:(e,t,r)=>{r.d(t,{Ns:()=>l,jh:()=>n,l5:()=>s,s:()=>a,xm:()=>o});var i=r(78393);function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function o(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float64Array(e)}function s(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function a(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e}function l(e){return Array.isArray(e)?new Float64Array(e):e}},52896:(e,t,r)=>{r.d(t,{$I:()=>_,AU:()=>v,Cr:()=>u,g7:()=>g,i4:()=>h,ui:()=>p,up:()=>w,vt:()=>c,yo:()=>m});var i=r(15941),n=r(34761),o=r(60008),s=r(4336),a=r(20664),l=r(9392),d=r(55855);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;return[e[0],e[1],e[2],e[3]]}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,a.c)(r,e),r[3]=t,r}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,d.vt)();return(0,a.b)(r,e,t),(0,a.n)(r,r),r[3]=-(0,a.d)(e,t),r}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c();const r=(0,n.l)(C,e);return y(t,(0,i.KJ)((0,o.Xd)(t,r))),t}function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,o.x8)(C,e,_(e)),(0,o.x8)(x,t,_(t)),(0,o.lw)(C,x,C),y(r,(0,i.KJ)((0,o.Xd)(r,C)))}function v(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c();return h(l.Cw,e,A),h(l.JP,t,S),h(l.Cb,r,T),f(A,S,A),f(A,T,i),i}function m(e){return e}function g(e){return e[3]}function _(e){return(0,i.kU)(e[3])}function y(e,t){return e[3]=t,e}const w=[0,0,1,0],C=(0,s.vt)(),x=(0,s.vt)(),A=(c(),c()),S=c(),T=c()},49753:(e,t,r)=>{var i,n;function o(e){return null!=(null===e||void 0===e?void 0:e.cubeMap)}function s(e){return null!=e&&!e.running}r.d(t,{c:()=>n,c2:()=>i,pi:()=>s,q9:()=>o}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(n||(n={}))},63401:(e,t,r)=>{r.d(t,{OQ:()=>i,ny:()=>v});var i,n,o=r(15941),s=r(34761),a=r(13191),l=r(20664),d=r(9392),c=r(52896),h=r(14556),u=r(49753),p=r(53203),f=r(98476);class v{constructor(){this.readChannels=u.c.RG,this.renderingStage=u.c2.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,d.vt)(),this.parallax=new m,this.parallaxNew=new m,this.pointOnGround=(0,d.vt)(),this.fadeMode=i.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,r=(0,l.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-h.$O.radius*h.$O.radius,0))/r,(0,c.Cr)(g,t.anchorPointClouds,_),(0,s.e$)(t.transform,a.zK,_[3],(0,c.yo)(_)),this.fadeMode===i.CROSS_FADE){const e=this.parallaxNew;(0,c.Cr)(g,e.anchorPointClouds,_),(0,s.e$)(e.transform,a.zK,_[3],(0,c.yo)(_))}}updateFading(e,t,r,i){this.isFading&&this._advanceFading(r,i),this._evaluateFading(e,t,r)}_evaluateFading(e,t,r){const n=e.relativeElevation,o=this._calculateDistanceToAnchorPoint(e);if((n>1.7*p.ni||n<-p.ni||o>A)&&this.opacity>0)this._setFade(i.HIDE,r);else if(!this.isFading)if((n>p.ni||n<-.35*p.ni||o>x)&&this.opacity>0)this._setFade(i.FADE_OUT,r);else if(n<=p.ni&&n>=-.35*p.ni&&t===f.M.IDLE&&(0,u.pi)(this.data)){if(0===this.opacity)return void this._setFade(i.FADE_IN,r);(o>C||this.renderingStage===u.c2.FADING)&&this._setFade(i.CROSS_FADE,r)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,o.qE)((e-this.startTime)/(w*t),0,1):1,this.fadeMode===i.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===i.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===i.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===i.FADE_OUT&&(this.opacity=0),this.fadeMode===i.FADE_IN&&(this.opacity=1),this.fadeMode===i.CROSS_FADE&&(this.opacity=1),this.fadeMode=i.NONE}_switchReadChannels(){const e=this.fadeMode===i.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===i.FADE_IN&&0===this.fadeFactor;this.renderingStage===u.c2.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=u.c2.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,l.n)(this.pointOnGround,e.eye),(0,l.h)(this.pointOnGround,this.pointOnGround,h.$O.radius),(0,l.l)((0,l.f)(y,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===i.CROSS_FADE&&(0===this.fadeFactor&&(0,l.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===i.FADE_IN&&0===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case i.HIDE:this.opacity=0;break;case i.FADE_OUT:this.opacity=1;break;case i.FADE_IN:this.opacity=0;break;case i.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===i.FADE_OUT||this.fadeMode===i.FADE_IN||this.fadeMode===i.CROSS_FADE}}(n=i||(i={}))[n.NONE=0]="NONE",n[n.HIDE=1]="HIDE",n[n.FADE_OUT=2]="FADE_OUT",n[n.FADE_IN=3]="FADE_IN",n[n.CROSS_FADE=4]="CROSS_FADE";class m{constructor(){this.anchorPointClouds=(0,d.vt)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,a.vt)()}}const g=(0,d.fA)(0,0,1),_=(0,c.vt)(),y=(0,d.vt)(),w=1.25,C=34e3,x=64e3,A=2e5},4216:(e,t,r)=>{r.d(t,{A:()=>c});var i,n=r(35143),o=r(42553),s=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let d=i=class extends o.oY{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({cloudy:"cloudy"})],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),d=i=(0,n._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],d);const c=d},23695:(e,t,r)=>{r.d(t,{A:()=>c});var i,n=r(35143),o=r(42553),s=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let d=i=class extends o.oY{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new i({fogStrength:this.fogStrength})}};(0,n._)([(0,a.e)({foggy:"foggy"})],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=i=(0,n._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],d);const c=d},20728:(e,t,r)=>{r.d(t,{A:()=>c});var i,n=r(35143),o=r(42553),s=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let d=i=class extends o.oY{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new i({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.e)({rainy:"rainy"})],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"precipitation",void 0),d=i=(0,n._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],d);const c=d},92521:(e,t,r)=>{r.d(t,{A:()=>c});var i,n=r(35143),o=r(42553),s=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let d=i=class extends o.oY{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new i({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.e)({snowy:"snowy"})],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"precipitation",void 0),(0,n._)([(0,s.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],d.prototype,"snowCover",void 0),d=i=(0,n._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],d);const c=d},68814:(e,t,r)=>{r.d(t,{A:()=>c});var i,n=r(35143),o=r(42553),s=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);let d=i=class extends o.oY{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.e)({sunny:"sunny"})],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),d=i=(0,n._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],d);const c=d},53203:(e,t,r)=>{r.d(t,{TJ:()=>c,eM:()=>l,k9:()=>u,l2:()=>d,ni:()=>h});var i=r(4216),n=r(23695),o=r(20728),s=r(92521),a=r(68814);const l={key:"type",base:a.A,typeMap:{sunny:a.A,cloudy:i.A,rainy:o.A,snowy:s.A,foggy:n.A}},d=Object.keys(l.typeMap);function c(e,t){return!!d.includes(e)||(t.error('"'.concat(e,'" is not a valid weather type')),!1)}const h=1e4,u=1e5},49296:(e,t,r)=>{r.d(t,{F:()=>o});var i=r(59097),n=r(41595);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,i.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,n.g7)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){var t;this.mode=e.mode,this.unit=(0,i.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=null!==(t=e.offset)&&void 0!==t?t:0}updateFeatureExpressionInfoContext(e,t,r){if(null==e)return void(this._featureExpressionInfoContext=null);const i=null===e||void 0===e?void 0:e.arcade;i&&null!=t&&null!=r?(this._featureExpressionInfoContext=(0,n.o8)(e),(0,n.gf)(this._featureExpressionInfoContext,(0,n.VG)(i.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return null!=e&&t.setFromElevationInfo(e),t}}},67425:(e,t,r)=>{r.d(t,{I2:()=>m,Kf:()=>_,Uk:()=>C,ai:()=>w,au:()=>p,fe:()=>y,nG:()=>v,nu:()=>g,sE:()=>f,uw:()=>i});var i,n,o=r(34761),s=r(13191),a=r(9392),l=r(5809),d=r(45308),c=r(81284),h=r(80935),u=r(66470);function p(e,t,r,i,n,o,s,a,l,c,h){const u=x[h.mode];let p,f,v=0;if((0,d.projectBuffer)(e,t,r,i,l.spatialReference,n,a))return u.requiresAlignment(h)?(v=u.applyElevationAlignmentBuffer(i,n,o,s,a,l,c,h),p=o,f=s):(p=i,f=n),(0,d.projectBuffer)(p,l.spatialReference,f,o,c.spatialReference,s,a)?v:void 0}function f(e,t,r,i,n){const o=((0,c.v)(e)?e.z:(0,h.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{var s;const r=null!==(s=(0,h.R1)(t,e,"ground"))&&void 0!==s?s:0;return n.verticalDistanceToGround=0,n.sampledElevation=r,void(n.z=r)}case"relative-to-ground":{var a;const s=null!==(a=(0,h.R1)(t,e,"ground"))&&void 0!==a?a:0,l=r.geometryZWithOffset(o,i);return n.verticalDistanceToGround=l,n.sampledElevation=s,void(n.z=l+s)}case"relative-to-scene":{var l;const s=null!==(l=(0,h.R1)(t,e,"scene"))&&void 0!==l?l:0,a=r.geometryZWithOffset(o,i);return n.verticalDistanceToGround=a,n.sampledElevation=s,void(n.z=a+s)}case"absolute-height":{var d;const s=r.geometryZWithOffset(o,i),a=null!==(d=(0,h.R1)(t,e,"ground"))&&void 0!==d?d:0;return n.verticalDistanceToGround=s-a,n.sampledElevation=a,void(n.z=s)}default:return void(n.z=0)}}function v(e,t,r,i){return f(e,t,r,i,S),S.z}function m(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?i.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function _(e){return"absolute-height"!==e}function y(e,t,r,i,n){f(t,r,n,i,S),w(e,S.verticalDistanceToGround);const s=S.sampledElevation,a=(0,o.C)(A,e.transformation);return T[0]=t.x,T[1]=t.y,T[2]=S.z,(0,l.l)(t.spatialReference,T,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function w(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(u.r.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[r],u.r.CENTEROFFSETANDDISTANCE))}}class C{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(n=i||(i={}))[n.NONE=0]="NONE",n[n.UPDATE=1]="UPDATE",n[n.RECREATE=2]="RECREATE";const x={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o,s,a){const l=a.calculateOffsetRenderUnits(s),d=a.featureExpressionInfoContext;t*=3,i*=3;for(let c=0;c<n;++c){const n=e[t],o=e[t+1],s=e[t+2];r[i]=n,r[i+1]=o,r[i+2]=null==d?s+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o){let s=0;const a=o.spatialReference;t*=3,i*=3;for(let d=0;d<n;++d){var l;const n=e[t],d=e[t+1],c=e[t+2],h=null!==(l=o.getElevation(n,d,c,a,"ground"))&&void 0!==l?l:0;s+=h,r[i]=n,r[i+1]=d,r[i+2]=h,t+=3,i+=3}return s/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o,s,a){let l=0;const d=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){var u;const n=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(n,s,a,h,"ground"))&&void 0!==u?u:0;l+=p,r[i]=n,r[i+1]=s,r[i+2]=null==c?a+p+d:p+d,t+=3,i+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o,s,a){let l=0;const d=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){var u;const n=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(n,s,a,h,"scene"))&&void 0!==u?u:0;l+=p,r[i]=n,r[i+1]=s,r[i+2]=null==c?a+p+d:p+d,t+=3,i+=3}return l/n},requiresAlignment:()=>!0}},A=(0,s.vt)(),S=new C,T=(0,a.vt)()},41595:(e,t,r)=>{r.d(t,{KF:()=>v,MF:()=>f,VG:()=>h,g7:()=>p,gf:()=>u,hI:()=>d,o8:()=>l,q6:()=>c});var i=r(76460),n=r(50346),o=r(32535),s=r(98976);const a=()=>i.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function d(e){const t=null===e||void 0===e?void 0:e.expression;if("string"==typeof t){const e=g(t);if(null!=e)return{cachedResult:e}}return null}async function c(e,t,r,i){const o=null===e||void 0===e?void 0:e.expression;if("string"!=typeof o)return null;const a=g(o);if(null!=a)return{cachedResult:a};const l=await(0,s.lw)();(0,n.Te)(r);const d=l.arcadeUtils,c=d.createSyntaxTree(o);return d.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(c),context:d.createExecContext(null,{sr:t}),modules:l}}}function h(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function u(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=(0,o.wZ)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(m(e))return e.cachedResult;const t=e.arcade;let r=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function f(e){var t,r;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null===e||void 0===e?void 0:e.featureExpressionInfo;const o=null===(t=n)||void 0===t?void 0:t.expression;return i||"0"===o||(n=null),null!==(r=n)&&void 0!==r?r:null}const v={cachedResult:0};function m(e){return null!=e.cachedResult}function g(e){return"0"===e?0:null}},57662:(e,t,r)=>{var i,n,o;r.d(t,{O7:()=>n,Om:()=>i,sv:()=>o}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(o||(o={}))},99443:(e,t,r)=>{r.d(t,{Cz:()=>l,DZ:()=>h,PV:()=>c,sS:()=>u,vO:()=>a});var i=r(72900),n=r(93345),o=r(98433),s=r(96673);const a=64,l=a/2,d=l/5,c=a/d,h=.25;function u(e,t){const r=(0,i.m9)(e,a,l,d),c=new s.R;return c.internalFormat=n.Ab.RGBA,c.width=a,c.height=a,c.wrapMode=n.pF.CLAMP_TO_EDGE,new o.g(t,c,r)}},72900:(e,t,r)=>{r.d(t,{CN:()=>a,Q_:()=>s,m9:()=>c,ny:()=>l,sZ:()=>d});r(81806);var i=r(14522),n=r(96897),o=r(93345);const s=128,a=.5;function l(e){return"cross"===e||"x"===e}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;const r=c(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return new n.g(r,{mipmap:!1,wrap:{s:o.pF.CLAMP_TO_EDGE,t:o.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return function(e,t){const r=e/2-.5;return v(e,p(r,r,t/2))}(t,r);case"square":return function(e,t){return h(e,t,!1)}(t,r);case"cross":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!1,r)}(t,r,i);case"x":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!0,r)}(t,r,i);case"kite":return function(e,t){return h(e,t,!0)}(t,r);case"triangle":return function(e,t){return v(e,f(e/2,t,t/2))}(t,r);case"arrow":return function(e,t){const r=t,i=t/2,n=e/2,o=.8*r,s=p(n,(e-t)/2-o,Math.sqrt(o*o+i*i)),a=f(n,r,i);return v(e,((e,t)=>Math.max(a(e,t),-s(e,t))))}(t,r)}}function h(e,t,r){return r&&(t/=Math.SQRT2),v(e,((i,n)=>{let o=i-.5*e+.25,s=.5*e-n-.75;if(r){const e=(o+s)/Math.SQRT2;s=(s-o)/Math.SQRT2,o=e}return Math.max(Math.abs(o),Math.abs(s))-.5*t}))}function u(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=i,r&&(t*=Math.SQRT2);const n=.5*t;return v(e,((t,o)=>{let s,a=t-.5*e,l=.5*e-o-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),s=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,s-=i/2,s}))}function p(e,t,r){return(i,n)=>{const o=i-e,s=n-t;return Math.sqrt(o*o+s*s)-r}}function f(e,t,r){const i=Math.sqrt(t*t+r*r);return(n,o)=>{const s=Math.abs(n-e)-r,a=o-e+t/2+.75,l=(t*s+r*a)/i,d=-a;return Math.max(l,d)}}function v(e,t){const r=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let o=0;o<e;o++){const s=o+e*n;let a=t(o,n);a=a/e+.5,(0,i.U)(a,r,4*s)}return r}},29898:(e,t,r)=>{var i;r.d(t,{A:()=>i}),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(i||(i={}))},33169:(e,t,r)=>{r.d(t,{or:()=>ne,bi:()=>ae,O8:()=>le});var i=r(35143),n=r(54099),o=r(87663),s=r(30726),a=r(30015),l=r(68134),d=r(41289),c=r(46053),h=r(81806),u=(r(76460),r(47249),r(85842)),p=r(34761),f=r(20664),v=r(9392),m=r(64465),g=r(57662),_=r(22955),y=r(19539),w=r(2413),C=r(75507);class x{constructor(){this._extent=(0,w.vt)(),this.resolution=0,this.renderLocalOrigin=(0,C.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new A}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,w.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class A{constructor(){this.extents=[(0,w.vt)(),(0,w.vt)(),(0,w.vt)()],this.numViews=0}}var S=r(29898);class T{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){var e;return null!=(null===(e=this._handle)||void 0===e?void 0:e.getTexture())}dispose(){this._handle=(0,s.Gz)(this._handle)}get texture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}bind(e,t,r){var i,n,o;this._handle&&this._handle.fbo.width===t&&this._handle.fbo.height===r||(null!==(i=this._handle)&&void 0!==i&&i.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.unbindTexture(null===(n=this._handle)||void 0===n?void 0:n.fbo.colorTexture),e.bindFramebuffer(null===(o=this._handle)||void 0===o?void 0:o.fbo)}generateMipMap(){var e,t;(null===(e=this._handle)||void 0===e||null===(e=e.getTexture())||void 0===e||null===(e=e.descriptor)||void 0===e?void 0:e.hasMipmap)&&(null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t||t.generateMipmap())}}var R=r(16455),O=r(34981);class b{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R.N.RGBA_MIPMAP;this.output=r,this.content=i,this.fbo=new T(e,n,t)}get valid(){return this.fbo.valid}}class M{constructor(e){this.targets=[new b(e,"overlay color",O.V.Color,S.A.Color),new b(e,"overlay IM color",O.V.Color,S.A.ColorNoRasterImage),new b(e,"overlay highlight",O.V.Highlight,S.A.Highlight,R.N.RGBA4),new b(e,"overlay water",O.V.Normal,S.A.WaterNormal),new b(e,"overlay occluded",O.V.Color,S.A.Occluded)],(0,h.A)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new b(e,"overlay oid",O.V.ObjectAndLayerIdColor,S.A.ObjectAndLayerIdColor))}getTexture(e){var t;return null===(t=this.targets[e])||void 0===t?void 0:t.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var E=r(12057),D=r(53070),P=r(58229),I=r(38205),L=r(46034),N=r(30988),F=r(97583),V=r(45463),H=r(23187),z=r(77730),j=r(90877),W=r(76044),U=r(40325),G=r(86967),B=r(10773),k=r(44513),Z=r(71011),q=r(80381),Q=r(16506),X=r(42693),J=r(32119),Y=r(28584),$=r(93345),K=r(57162);class ee extends X.w{initializeProgram(e){return new Y.B(e.rctx,ee.shader.get().build(),J.D)}initializePipeline(){return(0,K.Ey)({blending:(0,K.ox)($.dn.ONE,$.dn.ONE_MINUS_SRC_ALPHA),colorWrite:K.wE})}}ee.shader=new Q.$(q.a,(()=>r.e(71747).then(r.bind(r,71747))));var te=r(59752),re=r(98433),ie=r(96673);let ne=class extends I.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new q.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new a.A,this._passParameters=new D.T,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new L.i,this.worldToPCSRatio=1,this.events=new n.A,this.longitudeCyclical=null,this.produces=new Map([[z.N.DRAPED_MATERIAL,e=>e!==O.V.Highlight||this.hasHighlights],[z.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextures:r,stippleTextures:i,markerTextures:n}=t;this._shaderTechniques=new P.I({rctx:this._rctx,viewingMode:m.RT.Local,stippleTextureRepository:i,markerTextureRepository:n,waterTextureRepository:r}),this._renderContext=new H.gE(this._rctx,new j.p(e,this.view.state.viewingMode),null),this.addHandles([(0,l.watch)((()=>r.updating),(()=>this.events.emit("content-changed")),l.syncAndInitial),(0,l.watch)((()=>this.spatialReference),(e=>this._localOriginFactory=new F.g(e)),l.syncAndInitial),(0,l.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materialRepository=new N.v(t.textureRepository,this._shaderTechniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=z.N.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=B.y.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Z.$p((0,v.fA)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(te.W6.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,s.Gz)(this._debugTextureTechnique),this._passParameters.texture=(0,s.WD)(this._passParameters.texture),this._shaderTechniques=(0,s.pR)(this._shaderTechniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,o.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce(((t,r)=>t+r.getMemoryForMaterial(e)),0)}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,W.B)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);null!=i&&i.destroy();const n=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,l.watch)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e,t;return null!==(e=null===(t=this._renderTargets)||void 0===t?void 0:t.computeValidity())&&void 0!==e?e:0}releaseRenderTargets(){var e;null===(e=this._renderTargets)||void 0===e||e.dispose()}get overlays(){var e;return null!==(e=this._overlays)&&void 0!==e?e:[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,d.bw)(e,(e=>e.drapeTargetType===g.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,d.bw)(e,(e=>e.drapeSourceType===g.Om.Features)),this._hasDrapedRasterSource=(0,d.bw)(e,(e=>e.drapeSourceType===g.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new M(this.view._stage.renderer.fboCache),this._overlays=[new x,new x]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=(0,s.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,r;if(null!=e)return e===S.A.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null===(t=this._renderTargets)||void 0===t?void 0:t.getTexture(S.A.Color):null===(r=this._renderTargets)||void 0===r?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[i,n]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,o.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(te.Bb,(e=>e.updatePolicy===k.q.SYNC))}get isEmpty(){return!_.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,o.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=le;const t=this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}));return this._renderContext.renderOccludedMask=e,t}renders(e){return _.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==S.A.Occluded||this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}))}get mode(){var e,t;return this.isEmpty?E.w9.Disabled:null!==(e=this._renderTargets)&&void 0!==e&&e.getTexture(S.A.WaterNormal)?E.w9.EnabledWithWater:null!==(t=this._renderTargets)&&void 0!==t&&t.getTexture(S.A.Color)?E.w9.Enabled:E.w9.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets){if(t.content===S.A.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(y.vr.INNER,t,e),i=this._drawTarget(y.vr.OUTER,t,e);(r||i)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,r){const i=this._overlays[e],n=i.canvasGeometries;if(0===n.numViews)return!1;const{alignPixelEnabled:o,contentPixelRatio:s}=r;this._screenToWorldRatio=s*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===O.V.Highlight&&!this.hasHighlights||a===O.V.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;const l=this._rctx;if(this._camera.pixelRatio=i.pixelRatio*s,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===O.V.Normal?z.N.DRAPED_WATER:z.N.DRAPED_MATERIAL,t.content===S.A.Occluded&&(this._renderContext.renderOccludedMask=le),!this.renders(t.content))return this._renderContext.renderOccludedMask=H.Vr,!1;const d=i.resolution;this._rctx.setViewport(e===y.vr.INNER?0:d,0,d,d);const c=2*i.resolution,h=i.resolution,u=t.fbo;if(u.bind(l,c,h),e===y.vr.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe($.hn.COLOR_BUFFER_BIT)),_.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==S.A.Occluded)for(let p=0;p<n.numViews;p++)this._setViewParameters(n.extents[p],i),this._ensureDebugPatternResources(i.resolution,se[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((r=>{let{drapeSource:o,renderer:s}=r;if(t.content===S.A.ColorNoRasterImage&&o.drapeSourceType===g.Om.RasterImage)return;const{fullOpacity:d}=o,p=null!=d&&d<1&&a===O.V.Color?this.bindTemporaryFramebuffer(c,h):null;for(let e=0;e<n.numViews;e++)this._setViewParameters(n.extents[e],i),s.render(this._renderContext);if(p){u.bind(l,c,h),this._overlayParameters.texture=p.getTexture(),this._overlayParameters.opacity=d,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniqueRepository.acquire(ee);this._rctx.bindTechnique(t,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),t.release(),p.release()}})),l.bindFramebuffer(null),this._renderContext.renderOccludedMask=H.Vr,!0}bindTemporaryFramebuffer(e,t){const r=this.view._stage.renderer.fboCache,i=r.acquire(e,t,"overlay tmp");return r.rctx.unbindTexture(i.fbo.colorTexture),r.rctx.bindFramebuffer(i.fbo),r.rctx.clearSafe($.hn.COLOR_BUFFER_BIT),i}async reloadShaders(){await this._shaderTechniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers){var o,s;n=null!==(o=null===(s=a.intersect)||void 0===s?void 0:s.call(a,e,t,r,i,n))&&void 0!==o?o:n}}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((r,i)=>{var n;const o=e.indexOf(i.layer),s=o>=0,a=null!==(n=i.renderGroup)&&void 0!==n?n:s?g.O7.MapLayer:g.O7.ViewLayer,l=t*a+(s?o:0);this._sortedRenderers.push(new oe(i,r,l))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,p.v3)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,p.kN)(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,o.Bs)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,t){if((0,f.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let s=0;s<e;s++)for(let t=0;t<e;t++){const n=Math.floor(t/10),o=Math.floor(s/10);n<2||o<2||10*n>e-20||10*o>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&n&&1&o?1&t^1&s?0:255:1&n^1&o?0:128)}const n=new ie.R(e);n.samplingMode=$.Cj.NEAREST,this._passParameters.texture=new re.g(this._rctx,n,r);const o=new G.M;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniques.acquire(U.e,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),sortedDrapeSources:Array.from(this._sortedRenderers).map((e=>{let{drapeSource:t}=e;return t})),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};(0,i._)([(0,c.MZ)()],ne.prototype,"hasHighlights",void 0),(0,i._)([(0,c.MZ)()],ne.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,i._)([(0,c.MZ)()],ne.prototype,"_shaderTechniques",void 0),(0,i._)([(0,c.MZ)({constructOnly:!0})],ne.prototype,"view",void 0),(0,i._)([(0,c.MZ)()],ne.prototype,"worldToPCSRatio",void 0),(0,i._)([(0,c.MZ)()],ne.prototype,"spatialReference",void 0),(0,i._)([(0,c.MZ)({type:Boolean,readOnly:!0})],ne.prototype,"updating",null),(0,i._)([(0,c.MZ)()],ne.prototype,"isEmpty",null),(0,i._)([(0,c.MZ)({readOnly:!0})],ne.prototype,"rendersOccludedDraped",null),ne=(0,i._)([(0,u.$)("esri.views.3d.terrain.OverlayRenderer")],ne);class oe{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const se=[[1,.5,.5],[.5,.5,1]],ae=-2,le=V.m$.OccludeAndTransparent},19539:(e,t,r)=>{var i,n,o,s;r.d(t,{JG:()=>n,ZY:()=>s,iw:()=>o,vr:()=>i}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(o||(o={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(s||(s={}))},89712:(e,t,r)=>{r.d(t,{Dh:()=>d,eF:()=>h,kR:()=>c,zq:()=>i});var i,n,o=r(9392),s=r(34981),a=r(55386);class l extends a.Zo{constructor(){super(...arguments),this.slicePlaneLocalOrigin=(0,o.vt)(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}}(n=i||(i={}))[n.Material=0]="Material",n[n.ShadowMap=1]="ShadowMap",n[n.Highlight=2]="Highlight";class d extends l{constructor(){super(...arguments),this.identifier=i.Material,this.output=s.V.Color,this.transparent=!1}}class c extends l{constructor(){super(...arguments),this.identifier=i.ShadowMap}}class h extends l{constructor(){super(...arguments),this.identifier=i.Highlight}}},3838:(e,t,r)=>{r.d(t,{s:()=>g});var i,n,o,s,a,l,d=r(57528),c=r(66763),h=r(5517),u=r(21390),p=r(60205),f=r(64839),v=r(66470);const m=8;function g(e,t){const r=e.vertex;r.uniforms.add(new u.m("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(v.r.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new h.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new h.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new h.t("vvSizeOffset",(e=>e.vvSize.offset)),new h.t("vvSizeFactor",(e=>e.vvSize.factor))),r.code.add((0,f.H)(i||(i=(0,d.A)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(v.r.SIZE,"float"),r.code.add((0,f.H)(n||(n=(0,d.A)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(v.r.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new p.x("vvOpacityValues",(e=>e.vvOpacity.values),m),new p.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),m)),r.code.add((0,f.H)(o||(o=(0,d.A)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):r.code.add((0,f.H)(s||(s=(0,d.A)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.include(c.A,t),e.attributes.add(v.r.COLORFEATUREATTRIBUTE,"float"),r.code.add((0,f.H)(a||(a=(0,d.A)(["vec4 getColor(){\nreturn applyOpacity(interpolateVVColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(v.r.COLOR,"vec4"),r.code.add((0,f.H)(l||(l=(0,d.A)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},98521:(e,t,r)=>{var i;r.d(t,{D:()=>i}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}))},32925:(e,t,r)=>{r.d(t,{v:()=>l,z:()=>a});var i,n,o=r(57528),s=r(64839);function a(e){e.fragment.code.add((0,s.H)(i||(i=(0,o.A)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,s.H)(n||(n=(0,o.A)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},94759:(e,t,r)=>{r.d(t,{C:()=>s});var i,n=r(57528),o=r(64839);function s(e){e.fragment.code.add((0,o.H)(i||(i=(0,n.A)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}},2443:(e,t,r)=>{r.d(t,{q:()=>S,h:()=>T});var i=r(57528),n=r(81449),o=r(3799),s=r(58350),a=r(21390),l=r(64839),d=r(70367),c=r(95901),h=r(43047),u=r(55855);function p(e){return null==e?u.uY:4===e.length?e:(0,h.s)(f,e[0],e[1],e[2],1)}const f=(0,u.vt)();var v,m,g,_,y,w,C,x,A;function S(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:h,fragment:u}=e;u.include(n.W),t.draped||((0,o.yu)(h,t),h.uniforms.add(new a.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),h.code.add((0,l.H)(v||(v=(0,i.A)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),h.code.add((0,l.H)(m||(m=(0,i.A)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),R)),h.code.add((0,l.H)(g||(g=(0,i.A)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),h.code.add((0,l.H)(_||(_=(0,i.A)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),r?"patternLength":"1e4")),(0,o.Nz)(h),h.code.add((0,l.H)(y||(y=(0,i.A)(["float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\nfloat flooredRepetitions = max(1.0, floor(repetitions + 0.5));\nfloat segmentLengthScreenRounded = flooredRepetitions * patternLength;\nfloat stretch = repetitions / flooredRepetitions;\nvStipplePatternStretch = max(0.75, stretch);\nreturn vec2(0.0, segmentLengthScreenRounded);\n}\nreturn vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n}"])))),u.uniforms.add(new d.N("stipplePatternTexture",(e=>e.stippleTexture)),new a.m("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*((0,c.GV)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new a.m("stipplePatternPixelSizeInv",(e=>1/T(e)))),u.code.add((0,l.H)(w||(w=(0,i.A)(["float getStippleSDF(out bool isClamped) {\nfloat stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\nvec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\nisClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;\nfloat u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;\nu = fract(u);\nfloat encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));\nfloat sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\nreturn (sdf - 0.5) * vStipplePatternStretch + 0.5;\n}\nfloat getStippleSDF() {\nbool ignored;\nreturn getStippleSDF(ignored);\n}\nfloat getStippleAlpha() {\nbool isClamped;\nfloat stippleSDF = getStippleSDF(isClamped);\nfloat antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);\nreturn isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n}"])))),t.stippleOffColorEnabled?(u.uniforms.add(new s.E("stippleOffColor",(e=>p(e.stippleOffColor)))),u.code.add((0,l.H)(C||(C=(0,i.A)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):u.code.add((0,l.H)(x||(x=(0,i.A)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,l.H)(A||(A=(0,i.A)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function T(e){const t=e.stipplePattern;return t?(0,c.GQ)(e.stipplePattern)/t.pixelRatio:1}const R=l.H.float(.4)},17698:(e,t,r)=>{r.d(t,{r:()=>h});var i,n,o=r(57528),s=r(99443),a=r(3799),l=r(21390),d=r(64839),c=r(50125);function h(e,t){const{vertex:r,constants:h}=e;h.add("markerSizePerLineWidth","float",s.PV),(0,a.Nz)(r),null==r.uniforms.get("markerScale")&&r.constants.add("markerScale","float",1),r.code.add((0,d.H)(i||(i=(0,o.A)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===c.lM.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new l.m("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),r.code.add((0,d.H)(n||(n=(0,o.A)(["bool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}\nfloat getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}"])))))}},10708:(e,t,r)=>{r.d(t,{H:()=>d,U:()=>c});var i,n=r(57528),o=r(65058),s=r(95756),a=r(64839),l=r(70367);function d(e){e.include(o.D),e.uniforms.add(new l.N("geometryDepthTexture",((e,t)=>{var r;return null===(r=t.multipassGeometry.linearDepth)||void 0===r?void 0:r.getTexture()})),new s.G("nearFar",((e,t)=>t.camera.nearFar))),e.code.add((0,a.H)(i||(i=(0,n.A)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}class c{}},59640:(e,t,r)=>{r.d(t,{E:()=>T});var i,n=r(57528),o=r(32925),s=r(94759),a=r(42953),l=r(48353),d=r(65058),c=r(95756),h=r(21390),u=r(64839),p=r(43425),f=r(70367);function v(e,t){const r=e.fragment;r.include(d.D),r.uniforms.add(new c.G("nearFar",((e,t)=>t.camera.nearFar))),r.uniforms.add(new f.N("depthMap",((e,t)=>{var r;return null===(r=t.linearDepth)||void 0===r?void 0:r.getTexture()}))),r.uniforms.add(new p.X("proj",((e,t)=>t.camera.projectionMatrix))),r.uniforms.add(new h.m("invResolutionHeight",((e,t)=>1/t.camera.height))),r.uniforms.add(new p.X("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),r.code.add((0,u.H)(i||(i=(0,n.A)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P = clamp(P + dP, vec2(0.0), vec2(0.999));\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var m,g,_,y,w,C,x,A,S=r(24475);function T(e,t){e.include(a.f,t),e.include(s.C),e.include(o.v),t.hasCloudsReflections&&e.include(S.g,t),t.hasScreenSpaceReflections&&e.include(v,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",l.O).add("ssrHeightFadeEnd","float",l.b).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add((0,u.H)(m||(m=(0,n.A)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),r.uniforms.add(new h.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new h.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add((0,u.H)(g||(g=(0,n.A)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&r.code.add((0,u.H)(_||(_=(0,n.A)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(r.uniforms.add(new p.X("view",((e,t)=>t.camera.viewMatrix)),new f.N("lastFrameColorTexture",((e,t)=>{var r;return null===(r=t.ssr.lastFrameColor)||void 0===r?void 0:r.getTexture()})),new h.m("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),r.code.add((0,u.H)(y||(y=(0,n.A)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):r.code.add((0,u.H)(w||(w=(0,n.A)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add((0,u.H)(C||(C=(0,n.A)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):r.code.add((0,u.H)(x||(x=(0,n.A)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):r.code.add((0,u.H)(A||(A=(0,n.A)(["return waterRenderedColor;\n}"]))))}},12057:(e,t,r)=>{r.d(t,{Lg:()=>M,Tv:()=>T,eO:()=>R,w9:()=>l});var i,n,o,s,a,l,d,c=r(57528),h=r(55855),u=r(2413),p=r(19539),f=r(29898),v=r(89712),m=r(34981),g=r(43557),_=r(26719),y=r(59640),w=r(20123),C=r(21390),x=r(64839),A=r(70367),S=r(7223);function T(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new w.V("overlayTexOffset",((e,t)=>function(e,t){var r,i;const n=null===(r=t.overlay)||void 0===r||null===(r=r.overlays[p.vr.INNER])||void 0===r?void 0:r.extent;(0,u.pT)(n)&&(E[0]=e.toMapSpace[0]/(0,u.VL)(n)-n[0]/(0,u.VL)(n),E[1]=e.toMapSpace[1]/(0,u.uJ)(n)-n[1]/(0,u.uJ)(n));const o=null===(i=t.overlay)||void 0===i||null===(i=i.overlays[p.vr.OUTER])||void 0===i?void 0:i.extent;return(0,u.pT)(o)&&(E[2]=e.toMapSpace[0]/(0,u.VL)(o)-o[0]/(0,u.VL)(o),E[3]=e.toMapSpace[1]/(0,u.uJ)(o)-o[1]/(0,u.uJ)(o)),E}(e,t))),new w.V("overlayTexScale",((e,t)=>function(e,t){var r,i;const n=null===(r=t.overlay)||void 0===r||null===(r=r.overlays[p.vr.INNER])||void 0===r?void 0:r.extent;(0,u.pT)(n)&&(E[0]=e.toMapSpace[2]/(0,u.VL)(n),E[1]=e.toMapSpace[3]/(0,u.uJ)(n));const o=null===(i=t.overlay)||void 0===i||null===(i=i.overlays[p.vr.OUTER])||void 0===i?void 0:i.extent;return(0,u.pT)(o)&&(E[2]=e.toMapSpace[2]/(0,u.VL)(o),E[3]=e.toMapSpace[3]/(0,u.uJ)(o)),E}(e,t)))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new A.N("ovColorTex",((e,t)=>M(e,t)))),b(e,t)}function R(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new O("overlayTexOffset"),new O("overlayTexScale")),i.uniforms.add(new C.m("overlayOpacity",(e=>e.overlayOpacity)),new A.N("ovColorTex",((e,t)=>{var r;return null===(r=t.overlay)||void 0===r?void 0:r.getTexture(e.overlayContent)}))),b(e,t)}(d=l||(l={}))[d.Disabled=0]="Disabled",d[d.Enabled=1]="Enabled",d[d.EnabledWithWater=2]="EnabledWithWater",d[d.COUNT=3]="COUNT";class O extends S.n{constructor(e){super(e,"vec4")}}function b(e,t){t.pbrMode!==_.A9.Water&&t.pbrMode!==_.A9.WaterOnIntegratedMesh&&t.pbrMode!==_.A9.TerrainWithWater||e.include(y.E,t);const{vertex:r,fragment:l}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add((0,x.H)(i||(i=(0,c.A)(["void setOverlayVTC(in vec2 uv) {\nvtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n}"])))),l.code.add((0,x.H)(n||(n=(0,c.A)(["bool isValid(vec2 uv, vec2 dxdy) {\nreturn (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);\n}\nvec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {\nvec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));\nvec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}"])))),l.code.add((0,x.H)(o||(o=(0,c.A)(["vec4 getCombinedOverlayColor() {\nreturn overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);\n}"])))),l.code.add((0,x.H)(s||(s=(0,c.A)(["vec4 getOverlayColorTexel(vec4 texCoords) {\nvec2 texDim =  vec2(textureSize(ovColorTex, 0));\nvec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);\nvec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}"])))),t.pbrMode!==_.A9.Water&&t.pbrMode!==_.A9.WaterOnIntegratedMesh&&t.pbrMode!==_.A9.TerrainWithWater||((0,g.Gc)(l),(0,g.O4)(l),l.code.add((0,x.H)(a||(a=(0,c.A)(["vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\nfloat shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {\nvec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\nvec3 v = vposEyeDir;\nvec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);\nreturn vec4(final, colorInput.w);\n}"])))))}function M(e,t){var r,i,n;return e.identifier===v.zq.Material&&e.output===m.V.Color?null===(r=t.overlay)||void 0===r?void 0:r.getTexture(f.A.ColorNoRasterImage):e.identifier===v.zq.Material&&e.output===m.V.ObjectAndLayerIdColor?null===(i=t.overlay)||void 0===i?void 0:i.getTexture(f.A.ObjectAndLayerIdColor):e.identifier===v.zq.Highlight?null===(n=t.overlay)||void 0===n?void 0:n.getTexture(f.A.Highlight):null}const E=(0,h.vt)()},24475:(e,t,r)=>{r.d(t,{g:()=>R});var i,n,o,s,a,l,d,c,h=r(57528),u=r(15941),p=r(14556),f=r(49753),v=r(63401),m=r(53203),g=r(43557),_=r(53736),y=r(5517),w=r(21390),C=r(64839),x=r(43425),A=r(7223),S=r(24245);class T extends A.n{constructor(e,t){super(e,"samplerCube",S.c.Pass,((r,i,n)=>r.bindTexture(e,t(i,n))))}}function R(e){const t=e.fragment;t.uniforms.add(new x.X("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new x.X("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new y.t("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new y.t("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new w.m("cloudsHeight",(()=>m.k9)),new w.m("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new w.m("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new w.m("crossFadeAnchorFactor",((e,t)=>(0,u.qE)(t.cloudsFade.fadeFactor,0,1))),new T("cubeMap",((e,t)=>{var r,i;return null!==(r=null===(i=t.cloudsFade.data)||void 0===i||null===(i=i.cubeMap)||void 0===i?void 0:i.colorTexture)&&void 0!==r?r:null})),new _.e("crossFade",((e,t)=>t.cloudsFade.fadeMode===v.OQ.CROSS_FADE)),new _.e("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===f.c.RG)),new _.e("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===f.c2.FADING))),t.constants.add("planetRadius","float",p.$O.radius),t.code.add((0,C.H)(i||(i=(0,h.A)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,C.H)(n||(n=(0,h.A)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,C.H)(o||(o=(0,h.A)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,g.Gc)(t),(0,g.O4)(t),t.code.add((0,C.H)(s||(s=(0,h.A)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,C.H)(a||(a=(0,h.A)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = texture(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,C.H)(l||(l=(0,h.A)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,C.H)(d||(d=(0,h.A)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,C.H)(c||(c=(0,h.A)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}},20123:(e,t,r)=>{r.d(t,{V:()=>o});var i=r(7223),n=r(24245);class o extends i.n{constructor(e,t){super(e,"vec4",n.c.Draw,((r,i,n)=>r.setUniform4fv(e,t(i,n))))}}},58229:(e,t,r)=>{r.d(t,{I:()=>o});var i=r(75941),n=r(99415);class o{constructor(e){this._context=e,this._perConstructorInstances=new i.O,this._frameCounter=0,this._keepAliveFrameCount=a}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;const r=t.key;let i=this._perConstructorInstances.get(e,r);if(null==i){const n=new e(this._context,t,(()=>this.release(n)));i=new s(n),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}releaseAndAcquire(e,t,r){if(null!=r){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==a&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{e.push((async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,r))})),await Promise.all(e)}}class s{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const a=-1,l=new n.K},10209:(e,t,r)=>{r.d(t,{k:()=>f});var i=r(13191),n=r(72745),o=r(63401),s=r(98521),a=r(10708),l=r(81993),d=r(83490),c=r(46034),h=r(77730),u=r(10773),p=r(4998);class f{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=h.N.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=u.y.NONE,this.alignPixelEnabled=!1,this.decorations=d.ID.ON,this.overlayStretch=1,this._camera=new c.i,this._inverseViewport=(0,n.vt)(),this.oldLighting=new p.TA,this.newLighting=new p.TA,this._fadedLighting=new p.TA,this._lighting=this.newLighting,this.ssr=new v,this.multipassEnabled=!1,this.multipassTerrain=new l.h,this.multipassGeometry=new a.U,this.hudRenderStyle=s.D.Occluded,this.cloudsFade=new o.ny}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(t,r,e),this._lighting=this._fadedLighting)}}class v{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,i.vt)()}}},46034:(e,t,r)=>{r.d(t,{i:()=>A,z:()=>M});var i,n=r(35143),o=r(91967),s=r(76460),a=r(15941),l=r(76931),d=r(46053),c=(r(81806),r(47249),r(85842)),h=r(34761),u=r(13191),p=r(19555),f=r(72745),v=r(20664),m=r(9392),g=r(43047),_=r(55855),y=r(4763),w=r(95925),C=r(96190),x=r(64465);let A=i=class extends o.A{constructor(e){super(e),this._ray=(0,w.vt)(),this._viewport=(0,_.fA)(0,0,1,1),this._padding=(0,_.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,u.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,u.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,u.vt)(),this._frustumDirty=!0,this._frustum=(0,y.vt)(),this._fullViewport=(0,_.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,m.vt)(),this._up=(0,m.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,v.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,h.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,v.s)((0,m.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,v.s)((0,m.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,v.s)((0,m.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,g.b)((0,_.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,g.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,g.b)((0,_.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,g.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[M.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[M.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[M.RIGHT]+this._padding[M.LEFT]}set fullWidth(e){this.width=e-(this._padding[M.RIGHT]+this._padding[M.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[M.TOP]+this._padding[M.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[M.TOP]+this._padding[M.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[M.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[M.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,g.a)(this._padding,e)||(this._viewport[0]+=e[M.LEFT]-this._padding[M.LEFT],this._viewport[1]+=e[M.BOTTOM]-this._padding[M.BOTTOM],this._viewport[2]-=e[M.RIGHT]+e[M.LEFT]-(this._padding[M.RIGHT]+this._padding[M.LEFT]),this._viewport[3]-=e[M.TOP]+e[M.BOTTOM]-(this._padding[M.TOP]+this._padding[M.BOTTOM]),(0,g.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,o=i/this.columns,s=-i/2+this.column*o,a=s+o,l=-r/2+this.row*n,d=l+n,c=(0,h.$h)((0,u.vt)(),s*(1+2*this._padding[M.LEFT]/e),a*(1+2*this._padding[M.RIGHT]/e),l*(1+2*this._padding[M.BOTTOM]/t),d*(1+2*this._padding[M.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,h.aI)(p,c)?p:c}get inverseProjectionMatrix(){return(0,h.B8)((0,u.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,u.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,v.q)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){(0,v.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,g.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,g.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,p.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,h.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,y.C)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,g.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new i).copyFrom(this)}equals(e){return(0,v.j)(this.eye,e.eye)&&(0,v.j)(this.center,e.center)&&(0,v.j)(this.up,e.up)&&(0,g.a)(this._viewport,e.viewport)&&(0,g.a)(this._padding,e.padding)&&(0,p.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,g.d)(e.screenPadding,this.screenPadding)>=t||(0,g.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,v.z)(R,e.eye,e.center),(0,v.z)(O,this.eye,this.center);const r=(0,v.k)(R,O),i=(0,v.x)(R),n=(0,v.x)(O),o=5e-4;return r*r>=(1-1e-10)*i*n&&(0,v.w)(e.eye,this.eye)<Math.max(i,n)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,C.gr)(this.viewForward,(0,v.f)(R,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.gs)();return e[0]=(this.padding[M.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[M.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[M.LEFT]+this.width*t,e[1]=this.padding[M.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==S&&(0,v.c)(S,e),S[3]=1,(0,g.t)(S,S,this.projectionMatrix);const r=Math.abs(S[3]);(0,v.h)(S,S,1/r);const i=this.fullViewport;t[0]=(0,a.Cc)(0,i[0]+i[2],.5+.5*S[0]),t[1]=(0,a.Cc)(0,i[1]+i[3],.5+.5*S[1]),t[2]=.5*(S[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;S[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],S[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],S[2]=(2*e[2]-1)*e[3],S[3]=e[3],null!=this.inverseProjectionMatrix&&((0,g.t)(S,S,this.inverseProjectionMatrix),t[0]=S[0],t[1]=S[1],t[2]=S[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,b),this.renderToScreen(b,t),t}projectToRenderScreen(e,t){if(S[0]=e[0],S[1]=e[1],S[2]=e[2],S[3]=1,(0,g.t)(S,S,this.viewProjectionMatrix),0===S[3])return null;const r=S;(0,v.h)(r,r,1/Math.abs(S[3]));const i=this.fullViewport,n=(0,a.Cc)(0,i[0]+i[2],.5+.5*r[0]),o=(0,a.Cc)(0,i[1]+i[3],.5+.5*r[1]);return"x"in t?(t.x=n,t.y=o):(t[0]=n,t[1]=o,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,b),t)}unprojectFromRenderScreen(e,t){if((0,h.lw)(T,this.projectionMatrix,this.viewMatrix),!(0,h.B8)(T,T))return null;const r=this.fullViewport;return S[0]=2*(e[0]-r[0])/r[2]-1,S[1]=2*(e[1]-r[1])/r[3]-1,S[2]=2*e[2]-1,S[3]=1,(0,g.t)(S,S,T),0===S[3]?null:(t[0]=S[0]/S[3],t[1]=S[1]/S[3],t[2]=S[2]/S[3],t)}constrainWindowSize(e,t,r,i){const n=e*this.pixelRatio,o=t*this.pixelRatio,s=Math.max(n-r/2,0),a=Math.max(this.fullHeight-o-i/2,0),l=-Math.min(n-r/2,0),d=-Math.min(this.fullHeight-o-i/2,0),c=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-d- -Math.min(o-i/2,0);return[Math.round(s),Math.round(a),Math.round(c),Math.round(h)]}computeUp(e){e===x.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,v.f)(R,this.center,this.eye);const e=(0,v.l)(this.center);e<1?((0,v.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,v.k)(R,this.center))>.9999*(0,v.l)(R)*e||((0,v.b)(this._up,R,this.center),(0,v.b)(this._up,this._up,R),(0,v.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,v.E)(R,this.eye,this.center),Math.abs(R[2])<=.9999&&((0,v.h)(R,R,R[2]),(0,v.s)(this._up,-R[0],-R[1],1-R[2]),(0,v.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,v.j)(e,t)||((0,v.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):s.A.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,n._)([(0,d.MZ)()],A.prototype,"_viewport",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"_padding",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"_fov",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"_nearFar",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"_viewDirty",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"_viewMatrix",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"_pixelRatio",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"pixelRatio",null),(0,n._)([(0,d.MZ)()],A.prototype,"row",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"column",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"_rows",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"rows",null),(0,n._)([(0,d.MZ)()],A.prototype,"_columns",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"columns",null),(0,n._)([(0,d.MZ)()],A.prototype,"eye",null),(0,n._)([(0,d.MZ)()],A.prototype,"center",null),(0,n._)([(0,d.MZ)()],A.prototype,"_center",void 0),(0,n._)([(0,d.MZ)()],A.prototype,"up",null),(0,n._)([(0,d.MZ)()],A.prototype,"_up",void 0),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"viewForward",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"viewUp",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"viewRight",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"nearFar",null),(0,n._)([(0,d.MZ)()],A.prototype,"near",null),(0,n._)([(0,d.MZ)()],A.prototype,"far",null),(0,n._)([(0,d.MZ)()],A.prototype,"viewport",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"screenViewport",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"screenPadding",null),(0,n._)([(0,d.MZ)()],A.prototype,"x",null),(0,n._)([(0,d.MZ)()],A.prototype,"y",null),(0,n._)([(0,d.MZ)()],A.prototype,"width",null),(0,n._)([(0,d.MZ)()],A.prototype,"height",null),(0,n._)([(0,d.MZ)()],A.prototype,"fullWidth",null),(0,n._)([(0,d.MZ)()],A.prototype,"fullHeight",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"_aspect",null),(0,n._)([(0,d.MZ)()],A.prototype,"padding",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"projectionMatrix",null),(0,n._)([(0,d.MZ)({readOnly:!0})],A.prototype,"inverseProjectionMatrix",null),(0,n._)([(0,d.MZ)()],A.prototype,"fov",null),(0,n._)([(0,d.MZ)()],A.prototype,"fovX",null),(0,n._)([(0,d.MZ)()],A.prototype,"fovY",null),A=i=(0,n._)([(0,c.$)("esri.views.3d.webgl-engine.lib.Camera")],A);const S=(0,_.vt)(),T=(0,u.vt)(),R=(0,m.vt)(),O=(0,m.vt)(),b=(0,l.r_)();var M,E;(E=M||(M={}))[E.TOP=0]="TOP",E[E.RIGHT=1]="RIGHT",E[E.BOTTOM=2]="BOTTOM",E[E.LEFT=3]="LEFT"},63496:(e,t,r)=>{r.d(t,{VR:()=>n,a0:()=>s});var i=r(30015);class n{constructor(){this.adds=new i.A,this.removes=new i.A,this.updates=new i.A({allocator:e=>e||new o,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class o{}class s{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},30988:(e,t,r)=>{r.d(t,{v:()=>a});var i=r(76460),n=r(30726),o=r(75941),s=r(86994);class a{constructor(e,t,r,i){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new o.O}dispose(){this._textureRepository.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(!i||!i(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(null==n){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:r});n=new l(t),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,n.WD)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&i.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class l{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,s.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}},50255:(e,t,r)=>{r.d(t,{c:()=>n});var i=r(83490);class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){const n=this._material.produces.get(t);if(!n||!n(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const o=this._map.get(r);if(null!=o){if(o.ensureResources(e)===i.Am.LOADED)return o;this._repository.requestRender()}return null}}},62577:(e,t,r)=>{r.d(t,{zC:()=>ne,C1:()=>T,EE:()=>Y,nW:()=>$,td:()=>E,_B:()=>re,Nq:()=>ee,DJ:()=>Q,Y6:()=>q,uX:()=>Z,Z8:()=>te,CM:()=>k,Gj:()=>J,Ho:()=>B,Nb:()=>K,Xl:()=>se,xh:()=>ie});var i,n=r(72745),o=r(20664),s=r(83755),a=r(9392),l=r(44815),d=r(75002),c=r(38496),h=r(13927),u=r(95925),p=r(50468);!function(e){e.length=function(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)},e.normalize=function(e,t){const r=e[t],i=e[t+1],n=e[t+2],o=1/Math.sqrt(r*r+i*i+n*n);e[t]*=o,e[t+1]*=o,e[t+2]*=o},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[o]=e[t]+r[i],n[o+1]=e[t+1]+r[i+1],n[o+2]=e[t+2]+r[i+2]},e.subtract=function(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[o]=e[t]-r[i],n[o+1]=e[t+1]-r[i+1],n[o+2]=e[t+2]-r[i+2]}}(i||(i={}));var f=r(87634),v=r(51799),m=r(86994),g=r(66470);const _=i,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],w=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],C=[0,0,1,0,1,1,0,1],x=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],A=new Array(36);for(let de=0;de<6;de++)for(let e=0;e<6;e++)A[6*de+e]=de;const S=new Array(36);for(let de=0;de<6;de++)S[6*de]=0,S[6*de+1]=1,S[6*de+2]=2,S[6*de+3]=2,S[6*de+4]=3,S[6*de+5]=0;function T(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=y[i][0]*t[0],r[3*i+1]=y[i][1]*t[1],r[3*i+2]=y[i][2]*t[2];return new v.V(e,[[g.r.POSITION,new p.n(r,x,3,!0)],[g.r.NORMAL,new p.n(w,A,3)],[g.r.UV0,new p.n(C,S,2)]])}const R=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],O=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],b=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],M=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function E(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=R[i][0]*t[0],r[3*i+1]=R[i][1]*t[1],r[3*i+2]=R[i][2]*t[2];return new v.V(e,[[g.r.POSITION,new p.n(r,b,3,!0)],[g.r.NORMAL,new p.n(O,M,3)]])}const D=(0,s.fA)(-.5,0,-.5),P=(0,s.fA)(.5,0,-.5),I=(0,s.fA)(0,0,.5),L=(0,s.fA)(0,.5,0),N=(0,s.vt)(),F=(0,s.vt)(),V=(0,s.vt)(),H=(0,s.vt)(),z=(0,s.vt)();(0,o.f)(N,D,L),(0,o.f)(F,D,P),(0,o.b)(V,N,F),(0,o.n)(V,V),(0,o.f)(N,P,L),(0,o.f)(F,P,I),(0,o.b)(H,N,F),(0,o.n)(H,H),(0,o.f)(N,I,L),(0,o.f)(F,I,D),(0,o.b)(z,N,F),(0,o.n)(z,z);const j=[D,P,I,L],W=[0,-1,0,V[0],V[1],V[2],H[0],H[1],H[2],z[0],z[1],z[2]],U=[0,1,2,3,1,0,3,2,1,3,0,2],G=[0,0,0,1,1,1,2,2,2,3,3,3];function B(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=j[i][0]*t[0],r[3*i+1]=j[i][1]*t[1],r[3*i+2]=j[i][2]*t[2];return new v.V(e,[[g.r.POSITION,new p.n(r,U,3,!0)],[g.r.NORMAL,new p.n(W,G,3)]])}function k(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0};const o=-Math.PI,s=2*Math.PI,a=-Math.PI/2,l=Math.PI,h=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),f=(h+1)*(u+1),m=(0,d.oe)(3*f),_=(0,d.oe)(3*f),y=(0,d.oe)(2*f),w=[];let C=0;for(let d=0;d<=u;d++){const e=[],r=d/u,i=a+r*l,n=Math.cos(i);for(let a=0;a<=h;a++){const l=a/h,d=o+l*s,c=Math.cos(d)*n,u=Math.sin(i),p=-Math.sin(d)*n;m[3*C]=c*t,m[3*C+1]=u*t,m[3*C+2]=p*t,_[3*C]=c,_[3*C+1]=u,_[3*C+2]=p,y[2*C]=l,y[2*C+1]=r,e.push(C),++C}w.push(e)}const x=new Array;for(let d=0;d<u;d++)for(let e=0;e<h;e++){const t=w[d][e],r=w[d][e+1],i=w[d+1][e+1],n=w[d+1][e];0===d?(x.push(t),x.push(i),x.push(n)):d===u-1?(x.push(t),x.push(r),x.push(i)):(x.push(t),x.push(r),x.push(i),x.push(i),x.push(n),x.push(t))}const A=[[g.r.POSITION,new p.n(m,x,3,!0)],[g.r.NORMAL,new p.n(_,x,3,!0)]];return n.uv&&A.push([g.r.UV0,new p.n(y,x,2,!0)]),n.offset&&(A[0][0]=g.r.OFFSET,A.push([g.r.POSITION,new p.n(Float64Array.from(n.offset),(0,c.EH)(x.length),3,!0)])),new v.V(e,A)}function Z(e,t,r,i){const n=q(t,r,i);return new v.V(e,n)}function q(e,t,r){const i=e;let n,o;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;n=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let d=0;d<n.length;d+=3)_.scale(n,d,e/_.length(n,d));let s={};function a(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(s[i])return s[i];let o=n.length;return n.length+=3,_.add(n,3*t,n,3*r,n,o),_.scale(n,o,e/_.length(n,o)),o/=3,s[i]=o,o}for(let d=0;d<t;d++){const e=o.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=o[r],i=o[r+1],n=o[r+2],s=a(e,i),l=a(i,n),d=a(n,e),c=4*r;t[c]=e,t[c+1]=s,t[c+2]=d,t[c+3]=i,t[c+4]=l,t[c+5]=s,t[c+6]=n,t[c+7]=d,t[c+8]=l,t[c+9]=s,t[c+10]=l,t[c+11]=d}o=t,s={}}const l=(0,d.Wz)(n);for(let d=0;d<l.length;d+=3)_.normalize(l,d);return[[g.r.POSITION,new p.n((0,d.Wz)(n),o,3,!0)],[g.r.NORMAL,new p.n(l,o,3,!0)]]}function Q(e,t,r,i,o,s,l,d){var h;let u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const m=r?(0,a.o8)(r):(0,a.vt)(),_=t?(0,a.o8)(t):(0,a.fA)(0,0,1);null!==(h=l)&&void 0!==h||(l=(0,n.vt)());const y=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],w=null!=o&&2===o.length?o:[1,1],C=(0,c.EH)(1),x=[[g.r.POSITION,new p.n(m,C,3,!0)],[g.r.NORMAL,new p.n(_,C,3,!0)],[g.r.UV0,new p.n(l,C,l.length)],[g.r.COLOR,new p.n(y,C,4,!0)],[g.r.SIZE,new p.n(w,C,2)]];if(null!=s&&(s=[s[0],s[1],s[2],s[3]],x.push([g.r.CENTEROFFSETANDDISTANCE,new p.n(s,C,4)])),d){const e=[d[0],d[1],d[2],d[3]];x.push([g.r.FEATUREATTRIBUTE,new p.n(e,C,4)])}return new v.V(e,x,null,f.X.Point,u)}const X=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function J(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X;const r=new Array(12);for(let s=0;s<4;s++)for(let e=0;e<3;e++)r[3*s+e]=t[s][e];const i=[0,1,2,2,3,0],n=[0,0,0,0,0,0],o=[[g.r.POSITION,new p.n(r,i,3,!0)],[g.r.NORMAL,new p.n([0,0,1],n,3,!0)],[g.r.UV0,new p.n([0,0,1,0,1,1,0,1],i,2,!0)],[g.r.COLOR,new p.n([255,255,255,255],n,4,!0)]];return new v.V(e,o)}function Y(e,t,r,i,n){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=0;const c=r,h=t;let u=(0,s.fA)(0,l,0),f=(0,s.fA)(0,l+h,0),m=(0,s.fA)(0,-1,0),_=(0,s.fA)(0,1,0);n&&(l=h,f=(0,s.fA)(0,0,0),u=(0,s.fA)(0,l,0),m=(0,s.fA)(0,1,0),_=(0,s.fA)(0,-1,0));const y=[f,u],w=[m,_],C=i+2,x=Math.sqrt(h*h+c*c);if(n)for(let d=i-1;d>=0;d--){const e=d*(2*Math.PI/i),t=(0,s.fA)(Math.cos(e)*c,l,Math.sin(e)*c);y.push(t);const r=(0,s.fA)(h*Math.cos(e)/x,-c/x,h*Math.sin(e)/x);w.push(r)}else for(let d=0;d<i;d++){const e=d*(2*Math.PI/i),t=(0,s.fA)(Math.cos(e)*c,l,Math.sin(e)*c);y.push(t);const r=(0,s.fA)(h*Math.cos(e)/x,c/x,h*Math.sin(e)/x);w.push(r)}const A=new Array,S=new Array;if(o){for(let e=3;e<y.length;e++)A.push(1),A.push(e-1),A.push(e),S.push(0),S.push(0),S.push(0);A.push(y.length-1),A.push(2),A.push(1),S.push(0),S.push(0),S.push(0)}if(a){for(let e=3;e<y.length;e++)A.push(e),A.push(e-1),A.push(0),S.push(e),S.push(e-1),S.push(1);A.push(0),A.push(2),A.push(y.length-1),S.push(1),S.push(2),S.push(w.length-1)}const T=(0,d.oe)(3*C);for(let s=0;s<C;s++)T[3*s]=y[s][0],T[3*s+1]=y[s][1],T[3*s+2]=y[s][2];const R=(0,d.oe)(3*C);for(let s=0;s<C;s++)R[3*s]=w[s][0],R[3*s+1]=w[s][1],R[3*s+2]=w[s][2];const O=[[g.r.POSITION,new p.n(T,A,3,!0)],[g.r.NORMAL,new p.n(R,S,3,!0)]];return new v.V(e,O)}function $(e,t,r,i,n,a,l){var c;const h=n?(0,s.o8)(n):(0,s.fA)(1,0,0),u=a?(0,s.o8)(a):(0,s.fA)(0,0,0);null!==(c=l)&&void 0!==c||(l=!0);const f=(0,s.vt)();(0,o.n)(f,h);const m=(0,s.vt)();(0,o.h)(m,f,Math.abs(t));const _=(0,s.vt)();(0,o.h)(_,m,-.5),(0,o.g)(_,_,u);const y=(0,s.fA)(0,1,0);Math.abs(1-(0,o.k)(f,y))<.2&&(0,o.s)(y,0,0,1);const w=(0,s.vt)();(0,o.b)(w,f,y),(0,o.n)(w,w),(0,o.b)(y,w,f);const C=2*i+(l?2:0),x=i+(l?2:0),A=(0,d.oe)(3*C),S=(0,d.oe)(3*x),T=(0,d.oe)(2*C),R=new Array(3*i*(l?4:2)),O=new Array(3*i*(l?4:2));l&&(A[3*(C-2)]=_[0],A[3*(C-2)+1]=_[1],A[3*(C-2)+2]=_[2],T[2*(C-2)]=0,T[2*(C-2)+1]=0,A[3*(C-1)]=A[3*(C-2)]+m[0],A[3*(C-1)+1]=A[3*(C-2)+1]+m[1],A[3*(C-1)+2]=A[3*(C-2)+2]+m[2],T[2*(C-1)]=1,T[2*(C-1)+1]=1,S[3*(x-2)]=-f[0],S[3*(x-2)+1]=-f[1],S[3*(x-2)+2]=-f[2],S[3*(x-1)]=f[0],S[3*(x-1)+1]=f[1],S[3*(x-1)+2]=f[2]);const b=(e,t,r)=>{R[e]=t,O[e]=r};let M=0;const E=(0,s.vt)(),D=(0,s.vt)();for(let s=0;s<i;s++){const e=s*(2*Math.PI/i);(0,o.h)(E,y,Math.sin(e)),(0,o.h)(D,w,Math.cos(e)),(0,o.g)(E,E,D),S[3*s]=E[0],S[3*s+1]=E[1],S[3*s+2]=E[2],(0,o.h)(E,E,r),(0,o.g)(E,E,_),A[3*s]=E[0],A[3*s+1]=E[1],A[3*s+2]=E[2],T[2*s]=s/i,T[2*s+1]=0,A[3*(s+i)]=A[3*s]+m[0],A[3*(s+i)+1]=A[3*s+1]+m[1],A[3*(s+i)+2]=A[3*s+2]+m[2],T[2*(s+i)]=s/i,T[2*s+1]=1;const t=(s+1)%i;b(M++,s,s),b(M++,s+i,s),b(M++,t,t),b(M++,t,t),b(M++,s+i,s),b(M++,t+i,t)}if(l){for(let e=0;e<i;e++){const t=(e+1)%i;b(M++,C-2,x-2),b(M++,e,x-2),b(M++,t,x-2)}for(let e=0;e<i;e++){const t=(e+1)%i;b(M++,e+i,x-1),b(M++,C-1,x-1),b(M++,t+i,x-1)}}const P=[[g.r.POSITION,new p.n(A,R,3,!0)],[g.r.NORMAL,new p.n(S,O,3,!0)],[g.r.UV0,new p.n(T,R,2,!0)]];return new v.V(e,P)}function K(e,t,r,i,n,o){i=i||10,n=null==n||n,(0,m.vA)(t.length>1);const s=[],a=[];for(let l=0;l<i;l++){s.push([0,-l-1,-(l+1)%i-1]);const e=l/i*2*Math.PI;a.push([Math.cos(e)*r,Math.sin(e)*r])}return ee(e,a,t,[[0,0,0]],s,n,o)}function ee(e,t,r,i,n,l){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,s.fA)(0,0,0);const f=t.length,m=(0,d.oe)(r.length*f*3+(6*i.length||0)),_=(0,d.oe)(r.length*f*3+(i?6:0)),y=new Array,w=new Array;let C=0,x=0;const A=(0,a.vt)(),S=(0,a.vt)(),T=(0,a.vt)(),R=(0,a.vt)(),O=(0,a.vt)(),b=(0,a.vt)(),M=(0,a.vt)(),E=(0,a.vt)(),D=(0,a.vt)(),P=(0,a.vt)(),I=(0,a.vt)(),L=(0,a.vt)(),N=(0,a.vt)(),F=(0,h.vt)();(0,o.s)(D,0,1,0),(0,o.f)(S,r[1],r[0]),(0,o.n)(S,S),l?((0,o.g)(E,r[0],c),(0,o.n)(T,E)):(0,o.s)(T,0,0,1),se(S,T,D,D,O,T,ae),(0,o.c)(R,T),(0,o.c)(L,O);for(let s=0;s<i.length;s++)(0,o.h)(b,O,i[s][0]),(0,o.h)(E,T,i[s][2]),(0,o.g)(b,b,E),(0,o.g)(b,b,r[0]),m[C++]=b[0],m[C++]=b[1],m[C++]=b[2];_[x++]=-S[0],_[x++]=-S[1],_[x++]=-S[2];for(let o=0;o<n.length;o++)y.push(n[o][0]>0?n[o][0]:-n[o][0]-1+i.length),y.push(n[o][1]>0?n[o][1]:-n[o][1]-1+i.length),y.push(n[o][2]>0?n[o][2]:-n[o][2]-1+i.length),w.push(0),w.push(0),w.push(0);let V=i.length;const H=i.length-1;for(let s=0;s<r.length;s++){let e=!1;s>0&&((0,o.c)(A,S),s<r.length-1?((0,o.f)(S,r[s+1],r[s]),(0,o.n)(S,S)):e=!0,(0,o.g)(P,A,S),(0,o.n)(P,P),(0,o.g)(I,r[s-1],R),(0,h.O_)(r[s],P,F),(0,h.Ui)(F,(0,u.LV)(I,A),E)?((0,o.f)(E,E,r[s]),(0,o.n)(T,E),(0,o.b)(O,P,T),(0,o.n)(O,O)):se(P,R,L,D,O,T,ae),(0,o.c)(R,T),(0,o.c)(L,O)),l&&((0,o.g)(E,r[s],c),(0,o.n)(N,E));for(let i=0;i<f;i++)if((0,o.h)(b,O,t[i][0]),(0,o.h)(E,T,t[i][1]),(0,o.g)(b,b,E),(0,o.n)(M,b),_[x++]=M[0],_[x++]=M[1],_[x++]=M[2],(0,o.g)(b,b,r[s]),m[C++]=b[0],m[C++]=b[1],m[C++]=b[2],!e){const e=(i+1)%f;y.push(V+i),y.push(V+f+i),y.push(V+e),y.push(V+e),y.push(V+f+i),y.push(V+f+e);for(let t=0;t<6;t++){const e=y.length-6;w.push(y[e+t]-H)}}V+=f}const z=r[r.length-1];for(let s=0;s<i.length;s++)(0,o.h)(b,O,i[s][0]),(0,o.h)(E,T,i[s][1]),(0,o.g)(b,b,E),(0,o.g)(b,b,z),m[C++]=b[0],m[C++]=b[1],m[C++]=b[2];const j=x/3;_[x++]=S[0],_[x++]=S[1],_[x++]=S[2];const W=V-f;for(let o=0;o<n.length;o++)y.push(n[o][0]>=0?V+n[o][0]:-n[o][0]-1+W),y.push(n[o][2]>=0?V+n[o][2]:-n[o][2]-1+W),y.push(n[o][1]>=0?V+n[o][1]:-n[o][1]-1+W),w.push(j),w.push(j),w.push(j);const U=[[g.r.POSITION,new p.n(m,y,3,!0)],[g.r.NORMAL,new p.n(_,w,3,!0)]];return new v.V(e,U)}function te(e,t,r,i){(0,m.vA)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,m.vA)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,m.vA)(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,m.vA)(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const n=(0,l.jh)(3*t.length),o=new Array(2*(t.length-1));let s=0,a=0;for(let l=0;l<t.length;l++){for(let e=0;e<3;e++)n[s++]=t[l][e];l>0&&(o[a++]=l-1,o[a++]=l)}const h=[[g.r.POSITION,new p.n(n,o,3,!0)]];if(r){const e=(0,d.oe)(3*r.length);let i=0;for(let n=0;n<t.length;n++)for(let t=0;t<3;t++)e[i++]=r[n][t];h.push([g.r.NORMAL,new p.n(e,o,3,!0)])}return i&&h.push([g.r.COLOR,new p.n(i,(0,c.tM)(i.length/4),4)]),new v.V(e,h,null,f.X.Line)}function re(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=new Array(18),a=[[-r,o,n/2],[i,o,n/2],[0,t+o,n/2],[-r,o,-n/2],[i,o,-n/2],[0,t+o,-n/2]];for(let l=0;l<6;l++)s[3*l]=a[l][0],s[3*l+1]=a[l][1],s[3*l+2]=a[l][2];return new v.V(e,[[g.r.POSITION,new p.n(s,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function ie(e,t){const r=e.getMutableAttribute(g.r.POSITION).data;for(let i=0;i<r.length;i+=3){const e=r[i],n=r[i+1],s=r[i+2];(0,o.s)(le,e,n,s),(0,o.e)(le,le,t),r[i]=le[0],r[i+1]=le[1],r[i+2]=le[2]}}function ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const r=e.attributes,i=r.get(g.r.POSITION).data,n=r.get(g.r.NORMAL).data;if(n){const e=t.getMutableAttribute(g.r.NORMAL).data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute(g.r.POSITION).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}}function oe(e,t,r,i,n){return!(Math.abs((0,o.k)(t,e))>n)&&((0,o.b)(r,e,t),(0,o.n)(r,r),(0,o.b)(i,r,e),(0,o.n)(i,i),!0)}function se(e,t,r,i,n,o,s){return oe(e,t,n,o,s)||oe(e,r,n,o,s)||oe(e,i,n,o,s)}const ae=.99619469809,le=(0,a.vt)()},97583:(e,t,r)=>{r.d(t,{g:()=>g});var i=r(90632),n=r(20664),o=r(9392),s=r(55855),a=r(45308),l=r(50468),d=r(87634),c=r(51799),h=r(75507),u=r(37046),p=r(67737),f=r(66470),v=r(8918),m=r(425);class g{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,i.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const r=(0,h.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,i=Math.round(e[0]/r),o=Math.round(e[1]/r),s=Math.round(e[2]/r),a="".concat(i,"/").concat(o,"/").concat(s);let l=this._origins.get(a);const d=.5*r;if((0,n.f)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<d&&_[1]<d&&_[2]<d){if(l){const t=Math.max(..._);if((0,n.f)(_,e,l.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max(..._)<t)return l}return t}return l||(l=(0,h.f)(i*r,o*r,s*r,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.fA)(1,1,0,1);const r=window.view,i=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new m.W({width:2,color:t}),i.add(this._material);const e=new v.x(i,{pickable:!1}),r=new u.B({castShadow:!1});i.add(r),e.add(r),this._objects.set(n,r)}const o=this._objects.get(n),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,g=new Array(3*p),_=new Array,y=.5*this._gridSize;for(let s=0;s<p;s++)g[3*s]=e[0]+(1&h[s]?y:-y),g[3*s+1]=e[1]+(2&h[s]?y:-y),g[3*s+2]=e[2]+(4&h[s]?y:-y),s>0&&_.push(s-1,s);(0,a.projectBuffer)(g,this._originSR,0,g,r.renderSpatialReference,0,p);const w=new c.V(this._material,[[f.r.POSITION,new l.n(g,_,3,!0)]],null,d.X.Line);i.add(w),o.addGeometry(w)}get test(){const e=this;return{set gridSize(t){e._gridSize=t}}}}const _=(0,o.vt)()},75507:(e,t,r)=>{r.d(t,{f:()=>o});var i=r(9392);class n{constructor(e,t){this.vec3=e,this.id=t}}function o(e,t,r,o){return new n((0,i.fA)(e,t,r),o)}},57824:(e,t,r)=>{var i,n;r.d(t,{k:()=>n,q:()=>i}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(n||(n={}))},37046:(e,t,r)=>{r.d(t,{B:()=>m});var i=r(34761),n=r(13191),o=r(20664),s=r(9392),a=r(93582),l=r(94966),d=r(83490),c=r(73146),h=r(87634),u=r(35416),p=r(86994),f=r(66470),v=r(68967);class m extends c.J{get geometries(){return this._geometries}get transformation(){var e;return null!==(e=this._transformation)&&void 0!==e?e:n.zK}set transformation(e){var t;this._transformation=(0,i.C)(null!==(t=this._transformation)&&void 0!==t?t:(0,n.vt)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){var t;this._shaderTransformation=e?(0,i.C)(null!==(t=this._shaderTransformation)&&void 0!==t?t:(0,n.vt)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){var e;return null!==(e=this.shaderTransformation)&&void 0!==e?e:this.transformation}constructor(){var e,t;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=h.X.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=null===(e=r.castShadow)||void 0===e||e,this.usesVerticalDistanceToGround=null!==(t=r.usesVerticalDistanceToGround)&&void 0!==t&&t,this.graphicUid=r.graphicUid,this.layerUid=r.layerUid,r.isElevationSource&&(this.lastValidElevationBB=new g),this._geometries=r.geometries?Array.from(r.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.vA)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:r}),(0,f.b)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new u.X(d.Mg.MaskOccludee);for(const t of this._geometries)t.occludees=(0,v.Ci)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,v.PC)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new u.X(d.Mg.Highlight);for(const t of this._geometries)t.highlights=(0,v.Ci)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,v.PC)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,i.lw)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.vt)();return(0,i.lw)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new _,this._validateBoundingVolume(this._bvWorldSpace,S.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new _,this._validateBoundingVolume(this._bvObjectSpace,S.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const r=t===S.ObjectSpace;for(const i of this._geometries){const t=i.boundingInfo;t&&y(t,e,r?i.transformation:this.getCombinedShaderTransformation(i))}(0,o.m)((0,a.g)(e.bounds),e.min,e.max,.5);for(const i of this._geometries){const t=i.boundingInfo;if(null==t)continue;const n=r?i.transformation:this.getCombinedShaderTransformation(i),s=(0,l.hG)(n);(0,o.e)(A,t.center,n);const d=(0,o.q)(A,(0,a.g)(e.bounds)),c=t.radius*s;e.bounds[3]=Math.max(e.bounds[3],d+c)}}_invalidateBoundingVolume(){var e;const t=null===(e=this._bvWorldSpace)||void 0===e?void 0:e.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&t&&this._parentLayer.notifyObjectBBChanged(this,t)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}}class g{constructor(){this.min=(0,s.fA)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,s.fA)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends g{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function y(e,t,r){const n=e.bbMin,s=e.bbMax;if((0,i.tZ)(r)){const e=(0,o.s)(w,r[12],r[13],r[14]);(0,o.g)(C,n,e),(0,o.g)(x,s,e);for(let r=0;r<3;++r)t.min[r]=Math.min(t.min[r],C[r]),t.max[r]=Math.max(t.max[r],x[r])}else if((0,o.e)(C,n,r),(0,o.j)(n,s))for(let i=0;i<3;++i)t.min[i]=Math.min(t.min[i],C[i]),t.max[i]=Math.max(t.max[i],C[i]);else{(0,o.e)(x,s,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],C[e],x[e]),t.max[e]=Math.max(t.max[e],C[e],x[e]);for(let e=0;e<3;++e){(0,o.c)(C,n),(0,o.c)(x,s),C[e]=s[e],x[e]=n[e],(0,o.e)(C,C,r),(0,o.e)(x,x,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],C[e],x[e]),t.max[e]=Math.max(t.max[e],C[e],x[e])}}}const w=(0,s.vt)(),C=(0,s.vt)(),x=(0,s.vt)(),A=(0,s.vt)();var S,T;(T=S||(S={}))[T.WorldSpace=0]="WorldSpace",T[T.ObjectSpace=1]="ObjectSpace"},23187:(e,t,r)=>{r.d(t,{AZ:()=>d,Vr:()=>c,gE:()=>l});var i=r(91417),n=r(34981),o=r(10209),s=r(46034),a=r(45463);class l{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new s.i,this.output=n.V.Color,this.renderOccludedMask=c,this.bindParameters=new o.k(t,null!=r?r.plane:null),this.bindParameters.alignPixelEnabled=!0}}class d extends l{constructor(e,t,r,n){super(e,r,n),this.offscreenRenderingHelper=t,this.sliceHelper=n,this.time=(0,i.l5)(0)}}const c=a.m$.Occlude|a.m$.OccludeAndTransparent|a.m$.OccludeAndTransparentStencil},442:(e,t,r)=>{r.d(t,{$:()=>d});var i=r(90632),n=r(34761),o=r(13191),s=r(20664),a=r(93582),l=r(94966);class d{constructor(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,o.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=null!==(t=r.castShadow)&&void 0!==t&&t,null!=r.objectShaderTransformation&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){var t;null==e?this._shaderTransformation=null:(null!==(t=this._shaderTransformation)&&void 0!==t||(this._shaderTransformation=(0,o.vt)()),(0,n.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){var e;return this.boundingInfo?(null==this._boundingSphere&&(null!==(e=this._boundingSphere)&&void 0!==e||(this._boundingSphere=(0,a.c)()),(0,s.e)((0,a.g)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){var e;return null!==(e=this._shaderTransformation)&&void 0!==e?e:this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},90877:(e,t,r)=>{r.d(t,{p:()=>E,z:()=>x});var i=r(81806),n=r(15941),o=r(30726),s=r(44680),a=r(34761),l=r(13191),d=r(19555),c=r(72745),h=r(20664),u=r(9392),p=r(43047),f=r(55855),v=r(64465),m=r(16455),g=r(35143),_=r(46053),y=(r(76460),r(47249),r(85842)),w=r(46034);let C=class extends w.i{constructor(){super(...arguments),this._projectionMatrix=(0,l.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,g._)([(0,_.MZ)()],C.prototype,"_projectionMatrix",void 0),(0,g._)([(0,_.MZ)({readOnly:!0})],C.prototype,"projectionMatrix",null),C=(0,g._)([(0,y.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],C);var x,A,S=r(81330),T=r(86994),R=r(93345),O=r(98433);(A=x||(x={}))[A.Highlight=0]="Highlight",A[A.ExcludeHighlight=1]="ExcludeHighlight";class b{constructor(){this.camera=new C,this.lightMat=(0,l.vt)()}}class M{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class E{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new M,this._projectionView=(0,l.vt)(),this._projectionViewInverse=(0,l.vt)(),this._modelViewLight=(0,l.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,f.vt)(),this._cascades=[new b,new b,new b,new b],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,i.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,p.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,o.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,n.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)j[e]=this._cascades[e];return j.length=this._numCascades,j}start(e,t,r,i,n){(0,T.vA)(this.enabled);const{near:o,far:s}=this._clampNearFar(r);this._computeCascadeDistances(o,s,i),this._textureHeight=this._computeTextureHeight(e,n,i),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let d=0;d<this._numCascades;++d)this._constructCascade(d,l,a,t);this._lastOrigin=null,this.clear()}finish(){var e;(0,T.vA)(this.enabled),null===(e=this._handle)||void 0===e||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,h.j)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,u.vt)(),(0,h.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,a.Tl)(W,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)U[16*t+e]=W[e]}}return U}moveSnapshot(e){var t,r;(0,T.vA)(this.enabled),null!==(t=this._handle)&&void 0!==t&&t.detachDepth(),null!==(r=this._snapshots[e])&&void 0!==r&&r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var t,r,i;const n=null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t?void 0:t.descriptor;if(!this.enabled||!n)return;null===(r=this._snapshots[e])||void 0===r||r.release();const{width:o,height:s}=n,a=e===x.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(o,s,a,m.N.RGBA4);const l=this._fbos.rctx;this._bindFbo();const d=l.bindTexture(null===(i=this._snapshots[e])||void 0===i?void 0:i.getTexture(),O.g.TEXTURE_UNIT_FOR_UPDATES);l.gl.copyTexSubImage2D(R.Ap.TEXTURE_2D,0,0,0,0,0,o,s),l.bindTexture(d,O.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var t;return this.enabled?null===(t=this._snapshots[e])||void 0===t?void 0:t.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(R.hn.COLOR_BUFFER_BIT|R.hn.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,r){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=(0,S.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*n)),s=Math.min(this._maxTextureWidth,this._numCascades*o);return(0,S.uT)(s/this._numCascades)}_ensureFbo(){var e,t,r,i;(null===(e=this._handle)||void 0===e?void 0:e.fbo.width)===this._textureWidth&&(null===(t=this._handle)||void 0===t?void 0:t.fbo.height)===this._textureHeight||(null!==(r=this._handle)&&void 0!==r&&r.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",m.N.RGBA4)),null===(i=this._handle)||void 0===i||i.acquireDepth(m.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,o.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;const t=this._fbos.rctx;t.unbindTexture(this.depthTexture),t.bindFramebuffer(null===(e=this._handle)||void 0===e?void 0:e.fbo)}_constructCascade(e,t,r,i){const o=this._cascades[e],s=-this._cascadeDistances[e],l=-this._cascadeDistances[e+1],c=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]),u=(t[10]*l+t[14])/Math.abs(t[11]*l+t[15]);(0,T.vA)(c<u);for(let n=0;n<8;++n){(0,p.s)(P,n%4==0||n%4==3?-1:1,n%4==0||n%4==1?-1:1,n<4?c:u,1);const e=I[n];(0,p.t)(e,P,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,h.F)(z,I[0]),o.camera.viewMatrix=(0,a.Tl)(D,this._modelViewLight,z);for(let n=0;n<8;++n)(0,h.e)(I[n],I[n],o.camera.viewMatrix);let f=I[0][2],v=I[0][2];for(let n=1;n<8;++n)f=Math.min(f,I[n][2]),v=Math.max(v,I[n][2]);f-=200,v+=200,o.camera.near=-v,o.camera.far=-f,function(e,t,r,i,o){const s=1/I[0][3],a=1/I[4][3];(0,T.vA)(s<a);let l=s+Math.sqrt(s*a);const c=Math.sin((0,n.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));l/=c,function(e,t,r,i,n,o,s,a){(0,d.hZ)(G,0,0);for(let x=0;x<4;++x)(0,d.WQ)(G,G,e[x]);(0,d.hs)(G,G,.25),(0,d.hZ)(B,0,0);for(let x=4;x<8;++x)(0,d.WQ)(B,B,e[x]);(0,d.hs)(B,B,.25),(0,d.Cc)(k[0],e[4],e[5],.5),(0,d.Cc)(k[1],e[5],e[6],.5),(0,d.Cc)(k[2],e[6],e[7],.5),(0,d.Cc)(k[3],e[7],e[4],.5);let l=0,c=(0,d.hG)(k[0],G);for(let x=1;x<4;++x){const e=(0,d.hG)(k[x],G);e<c&&(c=e,l=x)}(0,d.Re)(Z,k[l],e[l+4]);const h=Z[0];let u,p;Z[0]=-Z[1],Z[1]=h,(0,d.Re)(q,B,G),(0,d.Om)(q,Z)<0&&(0,d.ze)(Z,Z),(0,d.Cc)(Z,Z,q,r),(0,d.S8)(Z,Z),u=p=(0,d.Om)((0,d.Re)(Q,e[0],G),Z);for(let x=1;x<8;++x){const t=(0,d.Om)((0,d.Re)(Q,e[x],G),Z);t<u?u=t:t>p&&(p=t)}(0,d.C)(i,G),(0,d.hs)(Q,Z,u-t),(0,d.WQ)(i,i,Q);let f=-1,v=1,m=0,g=0;for(let x=0;x<8;++x){(0,d.Re)(X,e[x],i),(0,d.S8)(X,X);const t=Z[0]*X[1]-Z[1]*X[0];t>0?t>f&&(f=t,m=x):t<v&&(v=t,g=x)}(0,T.MX)(f>0,"leftArea"),(0,T.MX)(v<0,"rightArea"),(0,d.hs)(J,Z,u),(0,d.WQ)(J,J,G),(0,d.hs)(Y,Z,p),(0,d.WQ)(Y,Y,G),$[0]=-Z[1],$[1]=Z[0];const _=(0,T.L)(i,e[g],Y,(0,d.WQ)(Q,Y,$),1,n),y=(0,T.L)(i,e[m],Y,Q,1,o),w=(0,T.L)(i,e[m],J,(0,d.WQ)(Q,J,$),1,s),C=(0,T.L)(i,e[g],J,Q,1,a);(0,T.MX)(_,"rayRay"),(0,T.MX)(y,"rayRay"),(0,T.MX)(w,"rayRay"),(0,T.MX)(C,"rayRay")}(I,l,c,L,N,F,V,H),function(e,t,r,i,n){(0,d.Re)(re,r,i),(0,d.hs)(re,re,.5),ie[0]=re[0],ie[1]=re[1],ie[2]=0,ie[3]=re[1],ie[4]=-re[0],ie[5]=0,ie[6]=re[0]*re[0]+re[1]*re[1],ie[7]=re[0]*re[1]-re[1]*re[0],ie[8]=1,ie[K(0,2)]=-(0,d.Om)(te(ie,0),e),ie[K(1,2)]=-(0,d.Om)(te(ie,1),e);let o=(0,d.Om)(te(ie,0),r)+ie[K(0,2)],s=(0,d.Om)(te(ie,1),r)+ie[K(1,2)],a=(0,d.Om)(te(ie,0),i)+ie[K(0,2)],l=(0,d.Om)(te(ie,1),i)+ie[K(1,2)];o=-(o+a)/(s+l),ie[K(0,0)]+=ie[K(1,0)]*o,ie[K(0,1)]+=ie[K(1,1)]*o,ie[K(0,2)]+=ie[K(1,2)]*o,o=1/((0,d.Om)(te(ie,0),r)+ie[K(0,2)]),s=1/((0,d.Om)(te(ie,1),r)+ie[K(1,2)]),ie[K(0,0)]*=o,ie[K(0,1)]*=o,ie[K(0,2)]*=o,ie[K(1,0)]*=s,ie[K(1,1)]*=s,ie[K(1,2)]*=s,ie[K(2,0)]=ie[K(1,0)],ie[K(2,1)]=ie[K(1,1)],ie[K(2,2)]=ie[K(1,2)],ie[K(1,2)]+=1,o=(0,d.Om)(te(ie,1),t)+ie[K(1,2)],s=(0,d.Om)(te(ie,2),t)+ie[K(2,2)],a=(0,d.Om)(te(ie,1),r)+ie[K(1,2)],l=(0,d.Om)(te(ie,2),r)+ie[K(2,2)],o=-.5*(o/s+a/l),ie[K(1,0)]+=ie[K(2,0)]*o,ie[K(1,1)]+=ie[K(2,1)]*o,ie[K(1,2)]+=ie[K(2,2)]*o,o=(0,d.Om)(te(ie,1),t)+ie[K(1,2)],s=(0,d.Om)(te(ie,2),t)+ie[K(2,2)],a=-s/o,ie[K(1,0)]*=a,ie[K(1,1)]*=a,ie[K(1,2)]*=a,n[0]=ie[0],n[1]=ie[1],n[2]=0,n[3]=ie[2],n[4]=ie[3],n[5]=ie[4],n[6]=0,n[7]=ie[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=ie[6],n[13]=ie[7],n[14]=0,n[15]=ie[8]}(L,N,V,H,o.projectionMatrix),o.projectionMatrix[10]=2/(r-i),o.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,f,v,o.camera),(0,a.lw)(o.lightMat,o.camera.projectionMatrix,o.camera.viewMatrix);const m=this._textureHeight;o.camera.viewport=[e*m,0,m,m]}_setupMatrices(e,t){(0,a.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,a.B8)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===v.RT.Global?e.eye:(0,h.s)(z,0,0,1);(0,a.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_clampNearFar(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,T.kL)(t/e,4)),i);const o=(t-e)/this._numCascades,s=(t/e)**(1/this._numCascades);let a=e,l=e;for(let d=0;d<this._numCascades+1;++d)this._cascadeDistances[d]=(0,n.Cc)(a,l,this.settings.splitSchemeLambda),a*=s,l+=o}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}}const D=(0,l.vt)(),P=(0,f.vt)(),I=[];for(let ne=0;ne<8;++ne)I.push((0,f.vt)());const L=(0,c.vt)(),N=(0,c.vt)(),F=(0,c.vt)(),V=(0,c.vt)(),H=(0,c.vt)(),z=(0,u.vt)(),j=[],W=(0,l.vt)(),U=l.zK.concat(l.zK,l.zK,l.zK,l.zK),G=(0,c.vt)(),B=(0,c.vt)(),k=[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()],Z=(0,c.vt)(),q=(0,c.vt)(),Q=(0,c.vt)(),X=(0,c.vt)(),J=(0,c.vt)(),Y=(0,c.vt)(),$=(0,c.vt)();function K(e,t){return 3*t+e}const ee=(0,c.vt)();function te(e,t){return(0,d.hZ)(ee,e[t],e[t+3]),ee}const re=(0,c.vt)(),ie=(0,s.vt)()},76044:(e,t,r)=>{r.d(t,{B:()=>w});var i=r(35143),n=r(91967),o=r(30015),s=r(46053),a=(r(81806),r(76460),r(47249),r(85842)),l=r(72745),d=r(93582),c=r(21255),h=r(34981),u=r(63496),p=r(29808),f=r(3112),v=r(45463),m=r(57824),g=r(13840),_=r(77730),y=r(52583);let w=class extends n.A{constructor(e){super(e),this._pending=new C,this._changes=new u.VR,this._materialRenderers=new o.A,this._sortedMaterialRenderers=new o.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll((e=>e.destroy())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return this._materialRenderers.some((e=>0!==e.numGeometries&&!e.queryRenderOccludedState(v.m$.Occlude)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.length&&0===this._geometries.size}getMemoryForMaterial(e){var t;if(null==e)return 0;const r=this._materialRenderers.find((t=>t.materialReference===e));return null!==(t=null===r||void 0===r?void 0:r.usedMemory)&&void 0!==t?t:0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,g.$)(this._changes);let t=!1;return e.forEach(((e,r)=>{let i=this._materialRenderers.find((e=>e.materialReference===r));if(!i&&e.adds.length>0){const e=new y.y({material:r});e.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),i=e,this._materialRenderers.push(i),t=!0}i&&(i.modify(e),0===i.numGeometries&&(this._materialRenderers.removeUnordered(i),i.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=this._materialRenderers.some((e=>{const t=e.produces.get(_.N.DRAPED_MATERIAL);return!!t&&t(h.V.Highlight)})),this._hasWater=this._materialRenderers.some((e=>{const t=e.produces.get(_.N.DRAPED_WATER);return!!t&&t(h.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const i=this._pending.empty;for(const n of r)this._pending.adds.add(n);i&&this.notifyChange("updating"),t===m.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const n of e)i.has(n)?(this._pending.removed.add(n),i.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===m.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(i),e.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case m.k.TRANSFORMATION:case m.k.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case m.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((r=>t=!!r.updateAnimation&&r.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const r=t.prepareTechnique(e);null!=r&&t.renderNode(e,r)}))}intersect(e,t,r,i,n){return this._geometries.forEach((o=>{if(i&&!i(o))return;this._intersectRenderGeometry(o,r,t,0,e,n);const s=this.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&this._intersectRenderGeometry(o,r,t,s.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&this._intersectRenderGeometry(o,r,t,-s.range,e,n)),n++})),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll(((e,t)=>{e.drapedPriority=t,this._sortedMaterialRenderers.push(e)})),this._sortedMaterialRenderers.sort(((e,t)=>{var r,i,n,o;return(null===(r=t.materialReference)||void 0===r?void 0:r.renderPriority)===(null===(i=e.materialReference)||void 0===i?void 0:i.renderPriority)?e.drapedPriority-t.drapedPriority:((null===(n=t.materialReference)||void 0===n?void 0:n.renderPriority)||0)-((null===(o=e.materialReference)||void 0===o?void 0:o.renderPriority)||0)}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,n,o){if(!e.visible)return;let s=0;i+=e.transformation[12],s=e.transformation[13],x[0]=r[0]-i,x[1]=r[1]-s,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,x,((r,i,s)=>{!function(e,t,r,i,n,o,s){const a=new c.MQ(o,s,t),l=t=>{t.set(f.dz.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==f.oH.MIN&&(null==n.results.max.drapedLayerOrder||r<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===f.oH.ALL){const e=(0,p.G7)(n.ray);l(e),n.results.all.push(e)}}(t,s,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,d.g)(e.boundingSphere))),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};(0,i._)([(0,s.MZ)()],w.prototype,"drapeSource",void 0),(0,i._)([(0,s.MZ)()],w.prototype,"updating",null),(0,i._)([(0,s.MZ)()],w.prototype,"rctx",null),(0,i._)([(0,s.MZ)({constructOnly:!0})],w.prototype,"rendererContext",void 0),(0,i._)([(0,s.MZ)()],w.prototype,"_materialRepository",null),(0,i._)([(0,s.MZ)()],w.prototype,"_localOriginFactory",null),(0,i._)([(0,s.MZ)({readOnly:!0})],w.prototype,"isEmpty",null),(0,i._)([(0,s.MZ)()],w.prototype,"_materialRenderers",void 0),(0,i._)([(0,s.MZ)()],w.prototype,"_geometries",void 0),w=(0,i._)([(0,a.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],w);class C{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const x=(0,l.vt)()},40325:(e,t,r)=>{r.d(t,{e:()=>c});var i=r(53070),n=r(16506),o=r(42693),s=r(32119),a=r(28584),l=r(93345),d=r(57162);class c extends o.w{initializeProgram(e){return new a.B(e.rctx,c.shader.get().build(),s.D)}initializePipeline(){return this.configuration.hasAlpha?(0,d.Ey)({blending:(0,d.p3)(l.dn.SRC_ALPHA,l.dn.ONE,l.dn.ONE_MINUS_SRC_ALPHA,l.dn.ONE_MINUS_SRC_ALPHA),colorWrite:d.wE}):(0,d.Ey)({colorWrite:d.wE})}}c.shader=new n.$(i.a,(()=>r.e(62553).then(r.bind(r,62553))))},86967:(e,t,r)=>{r.d(t,{M:()=>o});var i=r(35143),n=r(99415);class o extends n.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,i._)([(0,n.W)()],o.prototype,"hasAlpha",void 0)},44513:(e,t,r)=>{var i;r.d(t,{q:()=>i}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(i||(i={}))},69008:(e,t,r)=>{r.d(t,{Z:()=>n});var i=r(36911);class n extends i.Z{}},8918:(e,t,r)=>{r.d(t,{x:()=>u,r:()=>p});var i=r(54099),n=r(88321),o=r(30726),s=r(30015),a=r(73146),l=r(87634);const d=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var c=r(94536),h=r(44513);class u extends a.J{get objects(){return this._objects}constructor(e,t){var r,o,a,c;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super(),this.stage=e,this.apiLayerUid=u,this.type=l.X.Layer,this.events=new i.A,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new s.A,this._objectsAdded=new s.A,this._handles=new n.A,this.apiLayerUid=u,this.visible=null===(r=null===t||void 0===t?void 0:t.visible)||void 0===r||r,this.pickable=null===(o=null===t||void 0===t?void 0:t.pickable)||void 0===o||o,this.updatePolicy=null!==(a=null===t||void 0===t?void 0:t.updatePolicy)&&void 0!==a?a:h.q.ASYNC,this._disableOctree=null!==(c=null===t||void 0===t?void 0:t.disableOctree)&&void 0!==c&&c,e.add(this);for(const i of d)this._handles.add(this.events.on(i,(t=>e.handleEvent(i,t))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.q.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new c.A((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,o.pR)(this._octree),this._objectsAdded.clear()}}function p(e){return null!=e&&e.type===l.X.Layer}},13840:(e,t,r)=>{r.d(t,{$:()=>s,f:()=>i});var i,n,o=r(63496);function s(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new o.a0,t.set(e,r)),r};return e.removes.forAll((e=>{a(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{a(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{a(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function a(e){return e.geometry.indexCount>=1}(n=i||(i={}))[n.Default=0]="Default",n[n.Screenshot=1]="Screenshot",n[n.ObjectAndLayerID=2]="ObjectAndLayerID"},67737:(e,t,r)=>{r.d(t,{G:()=>i,Q:()=>n});const i={stableRendering:!1},n={rootOrigin:null}},16699:(e,t,r)=>{r.d(t,{P:()=>o});var i=r(9392),n=r(55386);class o extends n.gy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.vt)();super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}},73999:(e,t,r)=>{r.d(t,{f:()=>n});var i=r(90632);class n{constructor(e,t,r){this._createTexture=e,this._parametersKey=t,this._repository=new Map,this._orphanCache=r.newCache("procedural-texture-repository:".concat((0,i.c)()),(e=>e.dispose()))}destroy(){for(const[e,{texture:t}]of this._repository)t.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=this._acquire(e);return this.release(t),r}release(e){if(null==e)return;const t=this._parametersKey(e),r=this._repository.get(t);if(r&&(r.refCount--,0===r.refCount)){this._repository.delete(t);const{texture:e}=r,i=e.usedMemory;this._orphanCache.put(t,e,i)}}_acquire(e){var t;if(null==e)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const n=null!==(t=this._orphanCache.pop(r))&&void 0!==t?t:this._createTexture(e),s=new o(n);return this._repository.set(r,s),n}}class o{constructor(e){this.texture=e,this.refCount=1}}},425:(e,t,r)=>{r.d(t,{W:()=>H});var i=r(81806),n=r(76460),o=r(15941),s=r(76931),a=r(19555),l=r(20664),d=r(9392),c=r(55855),h=r(4763),u=r(44230),p=r(13927),f=r(48549),v=r(34981),m=r(59696),g=r(45463),_=r(77730),y=r(86994),w=r(66470),C=r(93684),x=r(50125),A=r(14623),S=r(16506),T=r(42693),R=r(60322),O=r(28584),b=r(96643),M=r(10773),E=r(93345),D=r(57162);const P=new Map([[w.r.POSITION,0],[w.r.PREVPOSITION,1],[w.r.NEXTPOSITION,2],[w.r.SUBDIVISIONFACTOR,3],[w.r.UV0,4],[w.r.COLOR,5],[w.r.COLORFEATUREATTRIBUTE,5],[w.r.SIZE,6],[w.r.SIZEFEATUREATTRIBUTE,6],[w.r.OPACITYFEATUREATTRIBUTE,7],[w.r.OBJECTANDLAYERIDCOLOR,8]]);class I extends T.w{initializeProgram(e){return new O.B(e.rctx,I.shader.get().build(this.configuration),P)}_makePipelineState(e,t){const r=this.configuration,i=e===M.y.NONE,n=e===M.y.FrontFace,o=(0,v.cb)(r.output);return(0,D.Ey)({blending:r.output===v.V.Color||r.output===v.V.Alpha?i?R.V0:(0,R.ez)(e):null,depthTest:{func:(0,R.K_)(e)},depthWrite:i?r.writeDepth||o?D.kn:null:(0,R.XO)(e),colorWrite:D.wE,stencilWrite:r.hasOccludees?b.v0:null,stencilTest:r.hasOccludees?t?b.a9:b.qh:null,polygonOffset:i||n?r.hasPolygonOffset?L:null:R.SE})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?L:null;this._occluderPipelineTransparent=(0,D.Ey)({blending:R.V0,polygonOffset:t,depthTest:b.sf,depthWrite:null,colorWrite:D.wE,stencilWrite:null,stencilTest:b.mK}),this._occluderPipelineOpaque=(0,D.Ey)({blending:R.V0,polygonOffset:t,depthTest:b.sf,depthWrite:null,colorWrite:D.wE,stencilWrite:b.r8,stencilTest:b.I$}),this._occluderPipelineMaskWrite=(0,D.Ey)({blending:null,polygonOffset:t,depthTest:b.m,depthWrite:null,colorWrite:null,stencilWrite:b.v0,stencilTest:b.a9})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?E.WR.LINES:E.WR.TRIANGLE_STRIP}getPipeline(e,t,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}I.shader=new S.$(A.R,(()=>r.e(61721).then(r.bind(r,61721))));const L={factor:0,units:-4};var N,F,V=r(46259);(F=N||(N={}))[F.LEFT_JOIN_START=-2]="LEFT_JOIN_START",F[F.LEFT_JOIN_END=-1]="LEFT_JOIN_END",F[F.LEFT_CAP_START=-4]="LEFT_CAP_START",F[F.LEFT_CAP_END=-5]="LEFT_CAP_END",F[F.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",F[F.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",F[F.RIGHT_CAP_START=4]="RIGHT_CAP_START",F[F.RIGHT_CAP_END=5]="RIGHT_CAP_END";class H extends g.im{constructor(e){super(e,new j),this._configuration=new V.Q,this.produces=new Map([[_.N.OPAQUE_MATERIAL,e=>e===v.V.Highlight||e===v.V.ObjectAndLayerIdColor||(e===v.V.Color||e===v.V.Alpha)&&this.parameters.renderOccluded===g.m$.OccludeAndTransparentStencil],[_.N.OPAQUE_NO_SSAO_DEPTH,e=>e===v.V.LinearDepth],[_.N.OCCLUDER_MATERIAL,e=>(0,v.Mo)(e)&&this.parameters.renderOccluded===g.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,v.Mo)(e)&&this.parameters.renderOccluded===g.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_MATERIAL,e=>(e===v.V.Color||e===v.V.Alpha)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==g.m$.OccludeAndTransparentStencil],[_.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(e===v.V.Color||e===v.V.Alpha)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==g.m$.OccludeAndTransparentStencil],[_.N.DRAPED_MATERIAL,e=>(0,v.i3)(e)]]),this._vertexAttributeLocations=P}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===_.N.DRAPED_MATERIAL;const r=null!=this.parameters.stipplePattern&&e!==v.V.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===x.kJ.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===g.m$.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,r,i,n,s){if(!r.options.selectionMode)return;const a=e.attributes.get(w.r.POSITION).data,l=e.attributes.get(w.r.SIZE);let d=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(w.r.SIZEFEATUREATTRIBUTE).data[0];d*=(0,o.qE)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(d*=l.data[0]);const c=i[0],h=i[1],u=(d/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let v=0;v<a.length-5;v+=3){const e=a[v],t=a[v+1],r=c-e,i=h-t,n=a[v+3]-e,s=a[v+4]-t,l=(0,o.qE)((n*r+s*i)/(n*n+s*s),0,1),d=n*l-r,u=s*l-i,m=d*d+u*u;m<p&&(p=m,f=v/3)}p<u*u&&n(s.dist,s.normal,f,!1)}intersect(e,t,r,i,s,d){if(!r.options.selectionMode||!e.visible)return;if(!(0,y.zH)(t))return void n.A.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const c=e.attributes,f=c.get(w.r.POSITION).data;let v=this.parameters.width;if(this.parameters.vvSize){const e=c.get(w.r.SIZEFEATUREATTRIBUTE).data[0];v*=(0,o.qE)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else c.has(w.r.SIZE)&&(v*=c.get(w.r.SIZE).data[0]);const m=r.camera,g=Q;(0,a.C)(g,r.point);const _=v*m.pixelRatio/2+4*m.pixelRatio;(0,l.s)(ne[0],g[0]-_,g[1]+_,0),(0,l.s)(ne[1],g[0]+_,g[1]+_,0),(0,l.s)(ne[2],g[0]+_,g[1]-_,0),(0,l.s)(ne[3],g[0]-_,g[1]-_,0);for(let n=0;n<4;n++)if(!m.unprojectFromRenderScreen(ne[n],oe[n]))return;(0,p.Cr)(m.eye,oe[0],oe[1],se),(0,p.Cr)(m.eye,oe[1],oe[2],ae),(0,p.Cr)(m.eye,oe[2],oe[3],le),(0,p.Cr)(m.eye,oe[3],oe[0],de);let C=Number.MAX_VALUE,x=0;const A=G(this.parameters,c)?f.length-2:f.length-5;for(let n=0;n<A;n+=3){B[0]=f[n]+t[12],B[1]=f[n+1]+t[13],B[2]=f[n+2]+t[14];const e=(n+3)%f.length;if(k[0]=f[e]+t[12],k[1]=f[e+1]+t[13],k[2]=f[e+2]+t[14],(0,p.mN)(se,B)<0&&(0,p.mN)(se,k)<0||(0,p.mN)(ae,B)<0&&(0,p.mN)(ae,k)<0||(0,p.mN)(le,B)<0&&(0,p.mN)(le,k)<0||(0,p.mN)(de,B)<0&&(0,p.mN)(de,k)<0)continue;if(m.projectToRenderScreen(B,X),m.projectToRenderScreen(k,J),X[2]<0&&J[2]>0){(0,l.f)(Z,B,k);const e=m.frustum,t=-(0,p.mN)(e[h.FB.NEAR],B)/(0,l.k)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.h)(Z,Z,t),(0,l.g)(B,B,Z),m.projectToRenderScreen(B,X)}else if(X[2]>0&&J[2]<0){(0,l.f)(Z,k,B);const e=m.frustum,t=-(0,p.mN)(e[h.FB.NEAR],k)/(0,l.k)(Z,(0,p.Qj)(e[h.FB.NEAR]));(0,l.h)(Z,Z,t),(0,l.g)(k,k,Z),m.projectToRenderScreen(k,J)}else if(X[2]<0&&J[2]<0)continue;X[2]=0,J[2]=0;const r=(0,u.kb)((0,u.Cr)(X,J,K),g);r<C&&(C=r,(0,l.c)(Y,B),(0,l.c)($,k),x=n/3)}const S=r.rayBegin,T=r.rayEnd;if(C<_*_){let e=Number.MAX_VALUE;if((0,u.ld)((0,u.Cr)(Y,$,K),(0,u.Cr)(S,T,ee),q)){(0,l.f)(q,q,S);const t=(0,l.l)(q);(0,l.h)(q,q,1/t),e=t/(0,l.q)(S,T)}d(e,q,x,!1)}}get _layout(){const e=(0,f.BP)().vec3f(w.r.POSITION).vec3f(w.r.PREVPOSITION).vec3f(w.r.NEXTPOSITION).f32(w.r.SUBDIVISIONFACTOR).vec2f(w.r.UV0);return this.parameters.vvSize?e.f32(w.r.SIZEFEATUREATTRIBUTE):e.f32(w.r.SIZE),this.parameters.vvColor?e.f32(w.r.COLORFEATUREATTRIBUTE):e.vec4f(w.r.COLOR),this.parameters.vvOpacity&&e.f32(w.r.OPACITYFEATUREATTRIBUTE),(0,i.A)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(w.r.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new W(this._layout,this.parameters)}createGLMaterial(e){return new z(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class z extends m.A{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==v.V.Color&&this._output!==v.V.Alpha||this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(I,e)}}class j extends C.S{constructor(){super(...arguments),this.width=0,this.color=c.Un,this.join="miter",this.cap=V.x.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class W{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=A.r+r}}_isClosed(e){return G(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(w.r.POSITION).indices.length/2+1,r=this._isClosed(e);let i=r?2:4;return i+=((r?t:t-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),i+=2,this._parameters.wireframe&&(i=2+4*(i-2)),i}write(e,t,r,n,o){var s,a,d,c,h;const u=te,p=re,f=ie,v=r.attributes.get(w.r.POSITION),m=v.indices,g=v.data.length/3,_=null===(s=r.attributes.get(w.r.DISTANCETOSTART))||void 0===s?void 0:s.data;m&&m.length!==2*(g-1)&&console.warn("RibbonLineMaterial does not support indices");const y=null!==(a=null!==(d=null===(c=r.attributes.get(w.r.SIZEFEATUREATTRIBUTE))||void 0===c?void 0:c.data[0])&&void 0!==d?d:null===(h=r.attributes.get(w.r.SIZE))||void 0===h?void 0:h.data[0])&&void 0!==a?a:1;let C=[1,1,1,1],x=0;const A=this.vertexBufferLayout.fields.has(w.r.COLORFEATUREATTRIBUTE);A?x=r.attributes.get(w.r.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(w.r.COLOR)&&(C=r.attributes.get(w.r.COLOR).data);const S=(0,i.A)("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,T=this.vertexBufferLayout.fields.has(w.r.OPACITYFEATUREATTRIBUTE),R=T?r.attributes.get(w.r.OPACITYFEATUREATTRIBUTE).data[0]:0,O=new Float32Array(n.buffer),b=(0,i.A)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,M=this.vertexBufferLayout.stride/4;let E=o*M;const D=E;let P=0;const I=_?(e,t,r)=>P=_[r]:(e,t,r)=>P+=(0,l.q)(e,t),L=(0,i.A)("enable-feature:objectAndLayerId-rendering"),F=(e,t,r,i,n,o,s)=>{if(O[E++]=t[0],O[E++]=t[1],O[E++]=t[2],O[E++]=e[0],O[E++]=e[1],O[E++]=e[2],O[E++]=r[0],O[E++]=r[1],O[E++]=r[2],O[E++]=i,O[E++]=s,O[E++]=n,O[E++]=y,A)O[E++]=x;else{const e=Math.min(4*o,C.length-4);O[E++]=C[e],O[E++]=C[e+1],O[E++]=C[e+2],O[E++]=C[e+3]}T&&(O[E++]=R),L&&(null!=S&&(b[4*E]=S[0],b[4*E+1]=S[1],b[4*E+2]=S[2],b[4*E+3]=S[3]),E++)};E+=M,(0,l.s)(p,v.data[0],v.data[1],v.data[2]),e&&(0,l.e)(p,p,e);const V=this._isClosed(r);if(V){const t=v.data.length-3;(0,l.s)(u,v.data[t],v.data[t+1],v.data[t+2]),e&&(0,l.e)(u,u,e)}else(0,l.s)(f,v.data[3],v.data[4],v.data[5]),e&&(0,l.e)(f,f,e),F(p,p,f,1,N.LEFT_CAP_START,0,0),F(p,p,f,1,N.RIGHT_CAP_START,0,0),(0,l.c)(u,p),(0,l.c)(p,f);const H=V?0:1,z=V?g:g-1;for(let i=H;i<z;i++){const t=(i+1)%g*3;(0,l.s)(f,v.data[t],v.data[t+1],v.data[t+2]),e&&(0,l.e)(f,f,e),I(u,p,i),F(u,p,f,0,N.LEFT_JOIN_END,i,P),F(u,p,f,0,N.RIGHT_JOIN_END,i,P);const r=this.numJoinSubdivisions;for(let e=0;e<r;++e){const t=(e+1)/(r+1);F(u,p,f,t,N.LEFT_JOIN_END,i,P),F(u,p,f,t,N.RIGHT_JOIN_END,i,P)}F(u,p,f,1,N.LEFT_JOIN_START,i,P),F(u,p,f,1,N.RIGHT_JOIN_START,i,P),(0,l.c)(u,p),(0,l.c)(p,f)}V?((0,l.s)(f,v.data[3],v.data[4],v.data[5]),e&&(0,l.e)(f,f,e),P=I(u,p,z),F(u,p,f,0,N.LEFT_JOIN_END,H,P),F(u,p,f,0,N.RIGHT_JOIN_END,H,P)):(P=I(u,p,z),F(u,p,p,0,N.LEFT_CAP_END,z,P),F(u,p,p,0,N.RIGHT_CAP_END,z,P)),U(O,D+M,O,D,M),E=U(O,E-M,O,E,M),this._parameters.wireframe&&this._addWireframeVertices(n,D,E,M)}_addWireframeVertices(e,t,r,i){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let s=0;const a=e=>s=U(o,e,n,s,i);for(let l=0;l<o.length-1;l+=2*i)a(l),a(l+2*i),a(l+1*i),a(l+2*i),a(l+1*i),a(l+3*i)}}function U(e,t,r,i,n){for(let o=0;o<n;o++)r[i++]=e[t++];return i}function G(e,t){return!!e.isClosed&&t.get(w.r.POSITION).indices.length>2}const B=(0,d.vt)(),k=(0,d.vt)(),Z=(0,d.vt)(),q=(0,d.vt)(),Q=(0,d.vt)(),X=(0,s.r_)(),J=(0,s.r_)(),Y=(0,d.vt)(),$=(0,d.vt)(),K=(0,u.vt)(),ee=(0,u.vt)(),te=(0,d.vt)(),re=(0,d.vt)(),ie=(0,d.vt)(),ne=[(0,s.r_)(),(0,s.r_)(),(0,s.r_)(),(0,s.r_)()],oe=[(0,d.vt)(),(0,d.vt)(),(0,d.vt)(),(0,d.vt)()],se=(0,p.vt)(),ae=(0,p.vt)(),le=(0,p.vt)(),de=(0,p.vt)()},52583:(e,t,r)=>{r.d(t,{y:()=>N});var i=r(35143),n=r(18690),o=r(87663),s=r(15941),a=r(30726),l=r(75941),d=r(30015),c=r(46053),h=(r(81806),r(76460),r(85842)),u=r(34761),p=r(13191),f=r(57481),v=r(34981),m=r(38205),g=r(50255),_=r(57824),y=r(77730),w=r(86994),C=r(16699);class x{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.from=e,this.to=t}get numElements(){return this.to-this.from}}function A(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let i=0;i<e.length;++i){const n=e.data[i],o=t.get(n.to);if(!o)return;n.to=o.to,t.delete(o.from),e.removeUnordered(o),r=!0}}}class S extends x{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class T{constructor(){this.first=0,this.count=0}}class R{constructor(){this._numElements=0,this._instances=new Map,this.holes=new d.A({allocator:e=>e||new x,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=O(),this.drawCommandsHighlight=O(),this.drawCommandsOccludees=O(),this.drawCommandsShadowHighlightRest=O()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=r,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const r of t)r.isVisible&&(b(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),b(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function O(){return new d.A({allocator:e=>e||new T,deallocator:e=>e})}function b(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class M{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var E=r(23859),D=r(69008),P=r(76718),I=r(93345);class L{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=new E.I(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let r=this._cache.pop(t);return r||(r=new D.Z(this._rctx,this._locations,{geometry:this._layout},{geometry:P.g.createVertex(this._rctx,I._U.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e)}}let N=class extends m.Ot{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=(0,a.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,a.WD)(this._vaoCache)}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==v.V.Highlight&&t!==v.V.ShadowHighlight||this._hasHighlights))&&e(t)))}))}get produces(){return this._produces}initializeRenderContext(e,t){const{rctx:r}=e.renderContext;this._glMaterials=new g.c(this.material,null!==t&&void 0!==t?t:e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new L(r,this.material.vertexAttributeLocations,(0,f.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),o=null===n||void 0===n?void 0:n.findBuffer(e.id);if(null==o)return;const s=o.instances.get(e.id);if(i.updateType&(_.k.GEOMETRY|_.k.TRANSFORMATION)){const i=Q(t.elementCount(s.geometry.geometry)*r),n=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,n,0),o.vao.vertexBuffers.geometry.setSubData(i,s.from*r,0,s.numElements*r)}i.updateType&(_.k.HIGHLIGHT|_.k.OCCLUDEE|_.k.VISIBILITY)&&(o.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new l.O;for(const i of e){const e=i.localOrigin;if(null==e)continue;let t=r.get(e.id,null);null==t&&(t=new F(e.vec3),r.set(e.id,null,t)),t.changes.push(i)}for(const i of t){const e=i.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),n=null===t||void 0===t?void 0:t.findBuffer(i.id);if(null==n)continue;let o=r.get(e.id,n);null==o&&(o=new F(e.vec3),r.set(e.id,n,o)),o.changes.push(i)}return r}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:i}=this,o=r.vertexBufferLayout.stride/4,s=this._computeDeltas(e,t);s.forEach(((e,t)=>{const a=e.get(null),l=null!=a?a.changes:[];s.delete(t,null);let d=i.get(t);if(e.forEach(((e,a)=>{if(s.delete(t,a),null==a)return void(0,w.vA)(!1,"No VAO for removed geometries");if(a.instances.size===e.changes.length)return this._vaoCache.deleteVao(a.vao),(0,n.Xy)(d.buffers,a),void(0===d.buffers.length&&0===l.length&&i.delete(t));const c=a.numElements,h=a.vao.byteSize/4,u=l.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),p=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),f=Math.min((c+u-p)*o,Z),v=f>h;f>U&&f<h/2?(e.changes.forEach((e=>{let{id:t}=e;return a.deleteInstance(t)})),a.instances.forEach((e=>{let{geometry:t}=e;return l.push(t)})),this._vaoCache.deleteVao(a.vao),(0,n.Xy)(d.buffers,a)):v?this._applyAndRebuild(a,l,e):this._applyRemoves(a,e)})),l.length>0)for(null==d&&(d=new M(a.origin),i.set(t,d)),d.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)d.buffers.push(this._applyAndRebuild(new R,l,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,o.Bs)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(null!=r)for(const p of r.changes)e.deleteInstance(p.id);const i=this._bufferWriter,n=i.vertexBufferLayout.stride,o=n/4,s=Math.floor(Z/o);let a=e.numElements;for(;t.length>0;){const r=t.pop(),n=i.elementCount(r.geometry);if(a+n>s&&a>0){t.push(r);break}a+=n;const o=new S(r,0,0);(0,w.vA)(null==e.instances.get(r.id)),e.addInstance(r.id,o)}const l=a*o,d=Q(l),c=i.vertexBufferLayout.createView(d.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,c,h);const n=h;h+=i.elementCount(t.geometry.geometry),e.updateInstance(r,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(X(l)),e.vao.vertexBuffers.geometry.setSubData(d,0,0,h*o),e.holes.clear();const u=e.holes.pushNew();return u.from=h,u.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const s of t.changes){const t=s.id,r=e.instances.get(t);if(!r)continue;e.deleteInstance(t);const i=W.back();if(i){if(i.to===r.from){i.to=r.to;continue}if(i.from===r.to){i.from=r.from;continue}}const n=W.pushNew();n.from=r.from,n.to=r.to}A(W);const r=this._bufferWriter.vertexBufferLayout.stride/4,i=W.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,n=Q(i);n.fill(0,0,i);const o=e.vao.vertexBuffers.geometry;W.forAll((e=>o.setSubData(n,e.from*r,0,e.numElements*r))),e.holes.pushArray(W.data,W.length),W.forAll(((e,t)=>W.data[t]=null)),W.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,o=e.numElements,s=t.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),a=Math.min((o+s)*i,Z),l=4*a;if(e.vao.byteSize<X(Z-U)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);A(e.holes);const d=new Array;for(const n of t){const t=r.elementCount(n.geometry),i=V(e.holes,t);d.push(i)}const c=e.vao.vertexBuffers.geometry;let h=0,u=0,p=0;const f=Q(a),v=r.vertexBufferLayout.createView(f.buffer);t.forEach(((t,n)=>{const o=d[n];if(null==o)return;if(p!==o){const e=p-u;e>0&&c.setSubData(f,u*i,0,e*i),u=o,h=0}const s=r.elementCount(t.geometry);this._writeGeometry(t,v,h),h+=s,p=o+s;const a=new S(t,o,o+s);(0,w.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const m=p-u;m>0&&c.setSubData(f,u*i,0,m*i),(0,n.$i)(t,((e,t)=>null==d[t]))}_writeGeometry(e,t,r){if(null===this._bufferWriter)return;const i=e.localOrigin.vec3;(0,w.M_)(H,-i[0],-i[1],-i[2]);const n=(0,u.lw)(z,H,e.transformation);(0,u.B8)(j,n),(0,u.mg)(j,j),this._bufferWriter.write(n,j,e.geometry,t,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:r}=e,i=this.material.produces.get(r.slot);if(!i||!i(t))return null;const n=t===v.V.Highlight||t===v.V.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=t===v.V.ShadowExcludeHighlight,s=!(n||o);for(const a of this._dataByOrigin.values())for(const i of a.buffers){if(n&&!i.hasHighlights)continue;const a=(n?i.drawCommandsHighlight:o&&i.needsMultipleCommands()?i.drawCommandsShadowHighlightRest:i.drawCommandsDefault)||null,l=s&&i.drawCommandsOccludees||null;if(null!==a&&void 0!==a&&a.length||null!==l&&void 0!==l&&l.length){const i=this._glMaterials.load(e.rctx,r.slot,t),n=null!=i?i.beginSlot(r):null;if(null!=n)return n}}return null}renderNode(e,t){const{output:r,bindParameters:i}=e,n=r===v.V.Highlight||r===v.V.ShadowHighlight,o=r===v.V.ShadowExcludeHighlight,s=!(n||o),a=e.rctx,l=e.bindParameters.slot===y.N.OCCLUDER_MATERIAL,d=e.bindParameters.slot===y.N.TRANSPARENT_OCCLUDER_MATERIAL;a.runAppleAmdDriverHelper(),a.bindTechnique(t,i,this.material.parameters);for(const c of this._dataByOrigin.values())for(const e of c.buffers){if(n&&!e.hasHighlights)continue;const r=(n?e.drawCommandsHighlight:o&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,h=s&&e.drawCommandsOccludees||null;(null!==r&&void 0!==r&&r.length||null!==h&&void 0!==h&&h.length)&&(t.program.bindDraw(new C.P(c.origin),i,this.material.parameters),t.ensureAttributeLocations(e.vao),a.bindVAO(e.vao),null!==r&&void 0!==r&&r.length&&(a.setPipelineState(t.getPipeline(!1,l,d)),r.forAll((e=>a.drawArrays(t.primitiveType,e.first,e.count)))),(null===h||void 0===h?void 0:h.length)&&(a.setPipelineState(t.getPipeline(!0,l,d)),h.forAll((e=>a.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};(0,i._)([(0,c.MZ)({constructOnly:!0})],N.prototype,"material",void 0),N=(0,i._)([(0,h.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],N);class F{constructor(e){this.origin=e,this.changes=new Array}}function V(e,t){let r;if(!e.some((e=>!(e.numElements<t)&&(r=e,!0))))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const H=(0,p.vt)(),z=(0,p.vt)(),j=(0,p.vt)(),W=new d.A({allocator:e=>e||new x,deallocator:null}),U=65536,G=4*U,B=1024,k=16777216,Z=k/4;let q=new Float32Array(U);function Q(e){return q.length<e&&(q=new Float32Array(e)),q}function X(e){const t=4*e;return t<=B?B:t<G?(0,s.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/G)*G,k),t)}},95901:(e,t,r)=>{r.d(t,{GQ:()=>h,GV:()=>u,Ry:()=>l});var i=r(14522),n=r(73999),o=r(93345),s=r(98433),a=r(96673);function l(e,t){return new n.f((t=>{const{encodedData:r,textureSize:i}=d(t),n=new a.R;return n.internalFormat=o.Ab.RGBA,n.width=i,n.height=1,n.wrapMode=o.pF.REPEAT,new s.g(e,n,r)}),(e=>"".concat(e.pattern.join(","),"-r").concat(e.pixelRatio)),t)}function d(e){const t=c(e),r=1/e.pixelRatio,n=h(e),o=u(e),s=(Math.floor(.5*(o-1))+.5)*r,a=[];let l=1;for(const i of t){for(let e=0;e<i;e++){const t=l*(Math.min(e,i-1-e)+.5)*r/s*.5+.5;a.push(t)}l=-l}const d=Math.round(t[0]/2),p=[...a.slice(d),...a.slice(0,d)],f=new Uint8Array(4*n);let v=0;for(const c of p)(0,i.U)(c,f,v),v+=4;return{encodedData:f,textureSize:n}}function c(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function h(e){if(null==e)return 1;const t=c(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function u(e){return c(e).reduce(((e,t)=>Math.max(e,t)))}},50125:(e,t,r)=>{r.d(t,{Dt:()=>h,kJ:()=>n,lM:()=>i});var i,n,o,s=r(35143),a=r(34981),l=r(99415),d=r(10773),c=r(92656);(o=i||(i={}))[o.Draped=0]="Draped",o[o.Screen=1]="Screen",o[o.World=2]="World",o[o.COUNT=3]="COUNT",function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(n||(n={}));class h extends c.E{constructor(){super(...arguments),this.output=a.V.Color,this.transparencyPassType=d.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=i.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=n.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===i.Draped}}(0,s._)([(0,l.W)({count:a.V.COUNT})],h.prototype,"output",void 0),(0,s._)([(0,l.W)({count:d.y.COUNT})],h.prototype,"transparencyPassType",void 0),(0,s._)([(0,l.W)()],h.prototype,"occluder",void 0),(0,s._)([(0,l.W)()],h.prototype,"hasSlicePlane",void 0),(0,s._)([(0,l.W)()],h.prototype,"writeDepth",void 0),(0,s._)([(0,l.W)({count:i.COUNT})],h.prototype,"space",void 0),(0,s._)([(0,l.W)()],h.prototype,"hideOnShortSegments",void 0),(0,s._)([(0,l.W)()],h.prototype,"hasCap",void 0),(0,s._)([(0,l.W)({count:n.COUNT})],h.prototype,"anchor",void 0),(0,s._)([(0,l.W)()],h.prototype,"hasTip",void 0),(0,s._)([(0,l.W)()],h.prototype,"vvSize",void 0),(0,s._)([(0,l.W)()],h.prototype,"vvColor",void 0),(0,s._)([(0,l.W)()],h.prototype,"vvOpacity",void 0),(0,s._)([(0,l.W)()],h.prototype,"hasOccludees",void 0),(0,s._)([(0,l.W)()],h.prototype,"multipassEnabled",void 0),(0,s._)([(0,l.W)()],h.prototype,"cullAboveGround",void 0),(0,s._)([(0,l.W)({constValue:!1})],h.prototype,"occlusionPass",void 0),(0,s._)([(0,l.W)({constValue:!0})],h.prototype,"hasVvInstancing",void 0),(0,s._)([(0,l.W)({constValue:!0})],h.prototype,"hasSliceTranslatedView",void 0)},46259:(e,t,r)=>{r.d(t,{Q:()=>c,x:()=>i});var i,n,o=r(35143),s=r(34981),a=r(99415),l=r(10773),d=r(92656);(n=i||(i={}))[n.BUTT=0]="BUTT",n[n.SQUARE=1]="SQUARE",n[n.ROUND=2]="ROUND",n[n.COUNT=3]="COUNT";class c extends d.E{constructor(){super(...arguments),this.output=s.V.Color,this.capType=i.BUTT,this.transparencyPassType=l.y.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,o._)([(0,a.W)({count:s.V.COUNT})],c.prototype,"output",void 0),(0,o._)([(0,a.W)({count:i.COUNT})],c.prototype,"capType",void 0),(0,o._)([(0,a.W)({count:l.y.COUNT})],c.prototype,"transparencyPassType",void 0),(0,o._)([(0,a.W)()],c.prototype,"occluder",void 0),(0,o._)([(0,a.W)()],c.prototype,"hasSlicePlane",void 0),(0,o._)([(0,a.W)()],c.prototype,"hasPolygonOffset",void 0),(0,o._)([(0,a.W)()],c.prototype,"writeDepth",void 0),(0,o._)([(0,a.W)()],c.prototype,"draped",void 0),(0,o._)([(0,a.W)()],c.prototype,"stippleEnabled",void 0),(0,o._)([(0,a.W)()],c.prototype,"stippleOffColorEnabled",void 0),(0,o._)([(0,a.W)()],c.prototype,"stipplePreferContinuous",void 0),(0,o._)([(0,a.W)()],c.prototype,"roundJoins",void 0),(0,o._)([(0,a.W)()],c.prototype,"applyMarkerOffset",void 0),(0,o._)([(0,a.W)()],c.prototype,"vvSize",void 0),(0,o._)([(0,a.W)()],c.prototype,"vvColor",void 0),(0,o._)([(0,a.W)()],c.prototype,"vvOpacity",void 0),(0,o._)([(0,a.W)()],c.prototype,"falloffEnabled",void 0),(0,o._)([(0,a.W)()],c.prototype,"innerColorEnabled",void 0),(0,o._)([(0,a.W)()],c.prototype,"hasOccludees",void 0),(0,o._)([(0,a.W)()],c.prototype,"multipassEnabled",void 0),(0,o._)([(0,a.W)()],c.prototype,"cullAboveGround",void 0),(0,o._)([(0,a.W)()],c.prototype,"wireframe",void 0),(0,o._)([(0,a.W)()],c.prototype,"objectAndLayerIdColorInstanced",void 0),(0,o._)([(0,a.W)({constValue:!1})],c.prototype,"occlusionPass",void 0),(0,o._)([(0,a.W)({constValue:!0})],c.prototype,"hasVvInstancing",void 0),(0,o._)([(0,a.W)({constValue:!0})],c.prototype,"hasSliceTranslatedView",void 0)},36911:(e,t,r)=>{r.d(t,{Z:()=>d});var i=r(76460),n=r(30726),o=r(78393),s=r(93345),a=r(27207);const l=()=>i.A.getLogger("esri.views.webgl.VertexArrayObject");let d=class{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*o.zQ}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers){var e;null!==(e=this._buffers[t])&&void 0!==e&&e.dispose(),delete this._buffers[t]}this._indexBuffer=(0,n.WD)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||l().error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const n in e){const r=e[n];r||l().error("Vertex buffer is uninitialized!");const i=t[n];i||l().error("Vertex element descriptor is empty!"),(0,a.yu)(this._context,this._locations,r,i)}null!=r&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}}}]);
//# sourceMappingURL=47447.405005b9.chunk.js.map
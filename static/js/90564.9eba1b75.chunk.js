"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[90564,30550],{30550:(e,t,n)=>{n.r(t),n.d(t,{createArcadeExecutor:()=>I,createArcadeProfile:()=>M});var i=n(39356),o=n(46405),s=n(98264),a=n(50076),l=n(53084),r=n(16503),u=n(14902),d=n(38451),c=n(65308),p=n(77725),h=n(98976);let m=null;function f(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=t.elementType,a="value",l="array"===o.type?[{name:a,type:o.type,elementType:o.elementType}]:"dictionary"===o.type?[{name:a,type:o.type,properties:o.properties}]:[{name:a,type:o.type}];return new s.A(e.map((e=>{const t={};return _(t,l,{[a]:e},n,i),t[a]})))}function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e instanceof p.A?new d.default({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return t.constructFeatureSet(i,n.spatialReference,null,!0,n.lruCache,n.interceptor)}function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{spatialReference:i,interceptor:o,lruCache:s}=n;return"string"==typeof e?t.createFeatureSetCollectionFromService(e,i,s,o):t.createFeatureSetCollectionFromMap(e,i,s,o)}function g(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o={};return _(o,t.properties,e,n,i),new m.Dictionary(o)}function _(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a={};for(const o of Object.keys(n))a[o.toLowerCase()]=n[o];for(const l of t){const t=l.name.toLowerCase();if(s.variablesPreProcessed)e[t]=a[t];else switch(l.type){case"array":{const n=a[t];e[t]=null==n?null:f(n,l,i,s);break}case"feature":{const n=a[t];e[t]=null==n?null:m.Feature.createFromGraphic(n,null===s||void 0===s?void 0:s.timeZone);break}case"featureSet":{const n=a[t];e[t]=null==n?null:i?y(n,i,s):null;break}case"featureSetCollection":{const n=a[t];e[t]=null==n?null:i?v(n,i,s):null;break}case"dictionary":{const n=a[t];e[t]=null==n?null:g(n,l,i,s);break}case"date":{const n=a[t];e[t]=n?n instanceof o.lY?n:null!==s&&void 0!==s&&s.timeZone?o.lY.dateJSAndZoneToArcadeDate(n,null===s||void 0===s?void 0:s.timeZone):o.lY.dateJSToArcadeDate(n):null;break}case"dateOnly":{const n=a[t];e[t]=n?n instanceof r.n?n:r.n.fromReader(n):null;break}case"time":{const n=a[t];e[t]=n?n instanceof u.k?n:u.k.fromReader(n):null;break}case"knowledgeGraph":case"geometry":case"boolean":case"text":case"number":e[t]=a[t]}}}function b(e,t){for(const n of e)t.push(n),"dictionary"===n.type&&b(n.properties,t);return t}function C(e,t,n,i,o){const{spatialReference:s,interceptor:a,lruCache:l,console:r,abortSignal:u,timeZone:d,services:p={portal:c.A.getDefault()}}=n,h={vars:{},spatialReference:s,interceptor:a,timeZone:d,lrucache:l,useAsync:o,services:p,console:r,abortSignal:u};return t?(_(h.vars,e.variables,t,i,n),h):h}function F(e,t){switch(t.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":{const t=(e.type,e),n="geometry"in t?t.geometry():null,o="readAttributes"in t?t.readAttributes():t.attributes;return new i.A({geometry:n,attributes:o})}case"dictionary":{const n=e,i=n.attributes,o={};for(const e of Object.keys(i))o[e]=F(n.field(e),t);return o}case"array":return("toArray"in e?e.toArray():e).map((e=>F(e,t)))}return e}const w={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$userInput",type:"geometry"},{name:"$graph",type:"knowledgeGraph"}]},x={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},V=new Map([["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",w],["popup-element",w],["feature-reduction-popup",x],["feature-reduction-popup-element",x],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);function M(e){const t=V.get(e);if(!t){const t=Array.from(V.keys()).map((e=>"'".concat(e,"'"))).join(", ");throw new a.A("createArcadeProfile:invalid-profile-name","Invalid profile name '".concat(e,"'. You must specify one of the following values: ").concat(t))}return(0,l.o8)(t)}async function I(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};m||(m=await(0,h.lw)());const{arcade:i,arcadeUtils:o}=m,{loadScriptDependencies:s,referencesMember:l,scriptIsAsync:r}=i,u=b(t.variables,[]),d=u.filter((e=>"featureSet"===e.type||"featureSetCollection"===e.type)).map((e=>e.name.toLowerCase())),c=i.parseScript(e,d);if(!c)throw new a.A("arcade:invalid-script","Unable to create SyntaxTree");const p=o.extractFieldNames(c),f=i.scriptTouchesGeometry(c),y=u.map((e=>e.name.toLowerCase())).filter((e=>l(c,e))),v=r(c,d);await s(c,v,d);const g={vars:{},spatialReference:null,useAsync:v};for(const a of y)g.vars[a]="any";const{lruCache:_}=n,w=i.compileScript(c,g),x=i.featureSetUtils(),{services:V}=n;return{execute:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(v)throw new a.A("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");const i=w(C(t,e,{lruCache:_,...n},x,v));return n.rawOutput?i:F(i,o)},executeAsync:async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=await w(C(t,e,{lruCache:_,services:V,...n},x,v));return n.rawOutput?i:F(i,o)},isAsync:v,variablesUsed:y,fieldsUsed:p,geometryUsed:f,syntaxTree:c}}},98264:(e,t,n)=>{n.d(t,{A:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._elements=e}length(){return this._elements.length}get(e){return this._elements[e]}toArray(){const e=[];for(let t=0;t<this.length();t++)e.push(this.get(t));return e}}},90564:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var i=n(35143),o=(n(11265),n(18690)),s=n(63241),a=n(76460),l=n(68134),r=n(46053),u=(n(81806),n(85842)),d=n(53430),c=n(25329);const p="esri-feature-form",h="".concat(p,"__group"),m="".concat(p,"__input"),f="".concat(p,"__related-records"),y={base:p,form:"".concat(p,"__form"),formHeader:"".concat(p,"__form-header"),label:"".concat(p,"__label"),labelTextContent:"".concat(p,"__label-text-content"),fieldInput:"".concat(m),inputRadio:"".concat(m,"--radio"),inputRadioGroup:"".concat(m,"--radio-group"),inputRadioLabel:"".concat(m,"--radio-label"),inputDisabled:"".concat(m,"--disabled"),inputSwitch:"".concat(m,"--switch"),inputInvalid:"".concat(m,"--invalid"),centeredButton:"".concat(p,"__centered-button"),description:"".concat(p,"__description-text"),listObserver:"".concat(p,"__list-observer"),relatedRecordsHeader:"".concat(f,"_header"),relatedRecordsLabel:"".concat(f,"_label"),relatedRecordsList:"".concat(f,"_list"),dateInputContainer:"".concat("".concat(p,"__date"),"-input-container"),group:h,groupSequential:"".concat(h,"--sequential"),groupActive:"".concat(h,"--active")};var v=n(3320),g=n(694),_=n(77666),b=n(11571),C=n(20639),F=n(98108),w=n(87540),x=(n(76099),n(63582)),V=n(12254),M=n(54761),I=n(39348);const E="data-field-name";let R=class extends c.A{constructor(e,t){super(e,t),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver((e=>{e.length&&e[0].isIntersecting&&this._incrementRelatedRecordPage()}),{root:window.document}),this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new g.A,this._onShowAllRelatedRecordsClick=e=>{const{feature:t,relatedRecordCallbacks:n}=this;t&&(null===n||void 0===n?void 0:n.showAllRelatedRecords)&&n.showAllRelatedRecords({parentFeature:t,relationshipId:e})},this._onAddRelatedRecordsClick=(e,t)=>{const{feature:n,relatedRecordCallbacks:i}=this;n&&(null===i||void 0===i?void 0:i.addRelatedRecord)&&i.addRelatedRecord({parentFeature:n,relatedLayer:t,relationshipId:e})},this._activeCombobox=null,this._activeComboboxClosedByWorkaround=!1,this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this),this._onComboboxOpen=this._onComboboxOpen.bind(this),this._onComboboxClose=this._onComboboxClose.bind(this),this.onScroll=this.onScroll.bind(this)}initialize(){this.addHandles([(0,l.watch)((()=>this.feature),(()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),(0,l.whenOnce)((()=>!this.viewModel.updating)).then((()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(null===e||void 0===e?void 0:e.name)||null,this._attemptFocusOnNextRender=!0}))})),(0,l.watch)((()=>this.groupDisplay),(()=>this._syncGroupInputStates())),this.on("submit",(e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach((e=>this._inputsWithChanges.add(e))),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}})),(0,l.watch)((()=>[this.viewModel.activeRelationshipInput,this._listObserverNode]),(()=>this._onObserverChange()))])}loadDependencies(){return(0,_.W)({block:()=>Promise.all([n.e(39879),n.e(62785),n.e(48347),n.e(60731),n.e(48897),n.e(53794),n.e(24706),n.e(14388)]).then(n.bind(n,14388)),button:()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(75151),n.e(11309)]).then(n.bind(n,11309)),combobox:()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(48347),n.e(13859),n.e(85292),n.e(19246)]).then(n.bind(n,19246)),"combobox-item":()=>Promise.all([n.e(39879),n.e(79012)]).then(n.bind(n,79012)),"combobox-item-group":()=>Promise.all([n.e(39879),n.e(94282)]).then(n.bind(n,94282)),icon:()=>Promise.all([n.e(39879),n.e(95012)]).then(n.bind(n,95012)),input:()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(79545),n.e(56685)]).then(n.bind(n,29625)),"input-date-picker":()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(48347),n.e(60731),n.e(79671),n.e(51863)]).then(n.bind(n,51863)),"input-message":()=>Promise.all([n.e(39879),n.e(61047)]).then(n.bind(n,61047)),"input-number":()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(93073),n.e(75680)]).then(n.bind(n,23131)),"input-time-picker":()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(48347),n.e(60731),n.e(48897),n.e(53794),n.e(79671),n.e(4576)]).then(n.bind(n,4576)),"input-time-zone":()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(48347),n.e(13859),n.e(85292),n.e(65670)]).then(n.bind(n,65670)),label:()=>Promise.all([n.e(39879),n.e(65423)]).then(n.bind(n,65423)),list:()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(13859),n.e(79545),n.e(58838)]).then(n.bind(n,58838)),"list-item":()=>Promise.all([n.e(39879),n.e(62785),n.e(48897),n.e(3732)]).then(n.bind(n,84661)),loader:()=>n.e(76454).then(n.bind(n,76454)),notice:()=>Promise.all([n.e(39879),n.e(62785),n.e(81985)]).then(n.bind(n,81985)),"radio-button":()=>Promise.all([n.e(39879),n.e(95203),n.e(48381)]).then(n.bind(n,48381)),"radio-button-group":()=>Promise.all([n.e(39879),n.e(66577)]).then(n.bind(n,66577)),switch:()=>Promise.all([n.e(39879),n.e(95203),n.e(97813)]).then(n.bind(n,97813)),"text-area":()=>Promise.all([n.e(39879),n.e(62785),n.e(95203),n.e(65110)]).then(n.bind(n,65110))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return(0,s.Lx)(a.A.getLogger(this),"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"}),this.viewModel.view}set view(e){(0,s.Lx)(a.A.getLogger(this),"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"}),this.viewModel.view=e}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return(0,M.K)("div",{class:this.classes(y.base,F.D.widget,F.D.panel),onscroll:this.onScroll},"ready"===e?this._renderForm():null)}_renderForm(){return(0,M.K)("form",{class:y.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent())}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const t=null!=e.formTitle&&(0,M.K)(w.D,{key:"title",level:this.headingLevel},e.formTitle),n=null!=e.formDescription&&(0,M.K)("p",{class:y.description,key:"description"},e.formDescription);return(0,M.K)("div",{class:y.formHeader},t,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderActiveRelationshipInput(e.activeRelationshipInput):e.inputs.filter(o.Ru).filter((e=>e.visible)).map(((e,t)=>(0,v.Et)(e)?this._renderGroup(e,t):(0,v.rf)(e)?this._renderLabeledField(e):(0,v.nT)(e)?this._renderRelationshipInput(e):void 0))}_renderActiveRelationshipInput(e){return this._renderRelationshipInput(e)}_renderDescriptionOrEmpty(e,t){return null==e?null:(0,M.K)("div",{class:this.classes(y.description),id:t},e)}_renderGroup(e,t){const{disabled:n,formTemplate:i,headingLevel:o}=this,{description:s,inputs:a,label:l,open:r}=e,u=a.filter((e=>e.visible)),d=this.viewModel.findField(this._focusedFieldName),c=(null===d||void 0===d?void 0:d.group)===e,p="".concat(this.id,"_group_").concat(t),h="sequential"===this.groupDisplay;return(0,M.K)("calcite-block",{class:this.classes(y.group,h?y.groupSequential:null,c?y.groupActive:null,n?y.inputDisabled:null),collapsible:!0,"data-group":e,description:s||void 0,disabled:n,heading:"".concat(l),headingLevel:null!==i&&void 0!==i&&i.title?(0,w.S)(o):o,id:p,key:p,open:r,onCalciteBlockToggle:t=>{let{target:n}=t;return this._onGroupToggle(n,e)}},u.map((e=>(0,v.rf)(e)?this._renderLabeledField(e):(0,v.nT)(e)?this._renderRelationshipInput(e):void 0)))}_getFocusableInput(e,t){const n=this.viewModel.allFieldInputs,i="forward"===e?n:n.slice().reverse();let o;if(!t||(0,v.nT)(t))o=0;else if((0,v.Et)(t)){const e=t.inputs.find(v.rf);o=e?i.indexOf(e):0}else{let n;if((0,v.bx)(t)&&!t.group.open){const i=t.group.inputs.filter(v.rf);n="forward"===e?i[i.length-1]:i[0]}else n=t;o=i.indexOf(n)+1}for(let s=o;s<i.length;s++){const e=i[s];if(e.visible&&(0,v.rf)(e))return e}return null}_renderLabeledField(e){var t;const{dataType:n,feature:i,label:o,layer:s,required:a}=e,l={"aria-label":a?(0,I.V)(this.messages.requiredFieldLabel,{name:o}):o,class:y.label,key:"".concat(s.id,"-").concat(i.uid,"-").concat(e.name)},r=[(0,M.K)("div",{class:y.labelTextContent,key:"labelTextContainer"},o,a?(0,M.K)("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==n?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return"date"===n&&"coded-value"!==(null===(t=e.domain)||void 0===t?void 0:t.type)?(0,M.K)("label",{...l},r):(0,M.K)("calcite-label",{...l},r)}_renderFieldInput(e){const{dataType:t,domain:n,inputType:i,name:o}=e,s=this.getCommonInputProps(e);if("coded-value"===(null===n||void 0===n?void 0:n.type)){const t=this.viewModel.getFieldValueOptionsForField(o,this.messages.empty);return"switch"!==i||e.hasInvalidSwitchValue?"radio-buttons"===i?this._renderRadioButtonComponents(e,t.flat(),s):this._renderComboBoxComponent(e,t,s):this._renderSwitchComponent(e,s)}return"datetime-picker"===i||"date"===t?this._renderDateComponents(e,s):"number"===t?this._renderNumberComponent(e,s):this._renderStringComponent(e,s)}_renderStringComponent(e,t){return"text-area"===e.inputType?t.readOnly?(0,M.K)("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:e=>this._saveValueFromComponent(e.target)}):(0,M.K)("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:e=>this._saveValueFromComponent(e.target)}):(0,M.K)("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:e=>this._saveValueFromComponent(e.target)})}_renderNumberComponent(e,t){return(0,M.K)("calcite-input-number",{...t,integer:(0,d.R3)(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:e=>this._saveValueFromComponent(e.target)})}_renderDateComponents(e,t){const{field:n}=e;switch(n.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,(0,C.ZP)(n,t.value,{timeZone:this.timeZone,...(0,C.ZT)(n)}))}}_renderDateOnlyFieldComponent(e,t){const{range:n,valid:i,value:o}=e,{class:s,key:a,readOnly:l}=t,{rawMax:r,rawMin:u}=n;return(0,M.K)("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:s,"data-date-part":"date","data-field-name":t[E],key:"".concat(a,"-date-input"),max:(0,b.K)(r)?r:void 0,min:(0,b.K)(u)?u:void 0,numberingSystem:C.fb,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:l,value:null!=o?"".concat(o):void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)})}_renderTimeOnlyFieldComponent(e,t){const{valid:n,value:i}=e,{class:o,key:s,readOnly:a}=t;return(0,M.K)("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:o,"data-date-part":"time","data-field-name":t[E],key:"".concat(s,"-time-input"),numberingSystem:C.fb,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,step:e.timeStep,value:null!=i?"".concat(i):void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)})}_renderTimestampOffsetFieldComponents(e,t){var n,i,o,s,a;const{name:l,range:r,timeZone:u,valid:d,value:c}=e,{class:p,key:h,readOnly:m}=t,{rawMax:f,rawMin:v}=r,g={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!d,numberingSystem:C.fb,overlayPositioning:"fixed",readOnly:m,[E]:l,onfocus:this._onComponentFocus},_=(0,C.T8)(f,u),b=(0,C.T8)(v,u),F=(0,C.T8)(c,u);return(0,M.K)("div",{class:y.dateInputContainer,key:"".concat(h,"-date-time-container")},(0,M.K)("calcite-input-date-picker",{...g,class:p,"data-date-part":"date",key:"".concat(h,"-date-input"),max:null!==(n=null===_||void 0===_?void 0:_.date)&&void 0!==n?n:void 0,min:null!==(i=null===b||void 0===b?void 0:b.date)&&void 0!==i?i:void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:null!==(o=F.date)&&void 0!==o?o:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)}),(0,M.K)("calcite-input-time-picker",{...g,class:p,"data-date-part":"time",key:"".concat(h,"-time-input"),onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:e.timeStep,value:null!==(s=F.time)&&void 0!==s?s:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)}),e.includeTimeOffset?(0,M.K)("calcite-input-time-zone",{...g,class:p,"data-date-part":"timeZone",disabled:m,key:"".concat(h,"-timezone-input"),onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:null!==(a=F.timeZoneOffset)&&void 0!==a?a:"0",onCalciteInputTimeZoneChange:e=>this._saveValueFromDateComponent(e.target)}):null)}_renderDateFieldComponents(e,t){var n,i,o,s;const{includeTime:a,name:l,valid:r,value:u}=e,{class:d,key:c,max:p,min:h,readOnly:m}=t,{timeZone:f}=this,v={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!r,numberingSystem:C.fb,overlayPositioning:"fixed",readOnly:m,[E]:l,onfocus:this._onComponentFocus},g=(0,C.Q0)(u,f),_=(0,C.Q0)(p,f),b=(0,C.Q0)(h,f);return(0,M.K)("div",{class:y.dateInputContainer,key:"".concat(c,"-date-time-container")},(0,M.K)("calcite-input-date-picker",{...v,class:d,"data-date-part":"date",key:"".concat(c,"-date-input"),max:null!==(n=null===_||void 0===_?void 0:_.date)&&void 0!==n?n:void 0,min:null!==(i=null===b||void 0===b?void 0:b.date)&&void 0!==i?i:void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:null!==(o=g.date)&&void 0!==o?o:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)}),a?(0,M.K)("calcite-input-time-picker",{...v,class:d,"data-date-part":"time",key:"".concat(c,"-time-input"),onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:1,value:null!==(s=g.time)&&void 0!==s?s:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)}):null)}_renderReadOnlyComponent(e,t){const n=this.getCommonInputProps(e);return(0,M.K)("calcite-input",{...n,class:this.classes(y.fieldInput,y.inputDisabled),readOnly:!0,type:"text",value:null!=t?"".concat(t):n.value})}_renderComboBoxComponent(e,t,n){const{value:i,name:o}=e,{messages:s,messagesTemplates:a,viewModel:l,_inputsWithChanges:r}=this,u=t.map((e=>e.map((e=>{let{name:t,value:n}=e;return(0,M.K)("calcite-combobox-item",{key:"#".concat(n),selected:i===n,textLabel:t,value:"".concat(n)})})))),[d,c]=u;this.viewModel.fieldsWithInvalidCodedValue.has(e)&&c.unshift((0,M.K)("calcite-combobox-item",{key:"incompatible-option",readOnly:!0,textLabel:"".concat(e.value),value:"".concat(e.value)}));const p=c.length>0?[(0,M.K)("calcite-combobox-item-group",{key:"recommended",label:s.recommended},d),(0,M.K)("calcite-combobox-item-group",{key:"other",label:a.other},c)]:d,h="INSERT"===l.arcadeEditType,m=r.has(o),f=null==i&&(!h||m);e.showNoValueOptionEnabled&&p.unshift((0,M.K)("calcite-combobox-item",{key:"empty-option",selected:f,textLabel:e.showNoValueLabel||s.empty,value:""}));const y=h&&e.showNoValueOptionEnabled&&!m?()=>{}:n.onblur;return(0,M.K)("calcite-combobox",{...n,allowCustomValues:!1,clearDisabled:!0,disabled:n.readOnly,onblur:y,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxBeforeOpen:this._onComboboxOpen,onCalciteComboboxChange:e=>{let{target:t}=e;f&&0===t.selectedItems.length?this._ignoreDeselectionOfNoValueOption(t):this._saveValueFromComponent(t)},onCalciteComboboxClose:this._onComboboxClose},p)}_renderRadioButtonComponents(e,t,n){const{name:i,value:o}=e,s=t.map((e=>{let{name:t,value:s}=e;return this._renderRadioButtonComponent({key:t,label:t,name:i,value:s,selected:s===o,props:n})}));if(e.showNoValueOptionEnabled){const t="",a=e.showNoValueLabel||this.messages.empty,l=o===t||null===o;s.unshift(this._renderRadioButtonComponent({key:"empty-option",label:a,name:i,value:t,selected:l,props:n}))}return(0,M.K)("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:y.inputRadioGroup,"data-field-name":n[E],key:"".concat(n.key,"-radio-group"),layout:"vertical",name:n.key,required:n.required},s)}_renderSwitchComponent(e,t){const{value:n}=e,i=!!(0,v.HG)(e.element,"switch")&&n===e.element.input.onValue;return(0,M.K)("calcite-switch",{...t,checked:i,class:y.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:e=>this._saveValueFromComponent(e.target)})}_renderRadioButtonComponent(e){let{key:t,name:n,value:i,selected:o,label:s,props:a}=e;return(0,M.K)("calcite-label",{class:y.inputRadioLabel,key:t,layout:"inline"},(0,M.K)("calcite-radio-button",{...a,afterCreate:void 0,afterUpdate:void 0,checked:o,class:y.inputRadio,disabled:a.readOnly,name:n,onblur:()=>{this._focusedFieldName=null},value:i,onCalciteRadioButtonChange:e=>{let{target:t}=e;t.checked&&this._saveValueFromComponent(t)}}),s)}_renderAuxiliaryText(e){const t=e.name,n=this._inputsWithChanges.has(t)&&!e.valid?(0,v.tM)(e,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(t)?this.messages.validationErrors.valuesIncompatible:null!=e.valueExpressionExecutor&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=n?(0,M.K)("calcite-input-message",{icon:!0,status:"invalid"},n):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:t,relationshipId:n,showAllActionVisible:i}=e,{relatedRecordCallbacks:o}=this;if(!i||null===o||void 0===o||!o.showAllRelatedRecords)return;const s=this.messages;return(0,M.K)("calcite-list-item",{description:(0,I.V)(s.totalCount,{count:t}),label:s.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(n)},(0,M.K)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:n,relatedLayer:i}=e,{messages:o,relatedRecordCallbacks:s}=this;if(t&&null!==s&&void 0!==s&&s.addRelatedRecord&&i)return(0,M.K)("calcite-button",{alignment:"center",appearance:"outline-fill",class:y.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:"".concat(n,"-add-button"),onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(n,i)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?o.addRecord:o.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:n,description:i,title:o}=e,{feature:s,relatedRecordCallbacks:a}=this,{highlightHelper:l}=this.viewModel,r=l?()=>l.add(n):void 0,u=l?()=>l.remove(n):void 0;return(0,M.K)("calcite-list-item",{bind:this,description:i,key:"".concat(t,"-").concat(n.uid),label:o,onclick:()=>{null!==l&&void 0!==l&&l.removeAll(),(null===a||void 0===a?void 0:a.editRelatedRecord)&&s&&a.editRelatedRecord({parentFeature:s,relationshipId:t,relatedFeature:n})},onmouseenter:r,onmouseleave:u,value:o},(0,M.K)("calcite-icon",{icon:(0,v.l_)(n),scale:"m",slot:"content-start"}),(0,M.K)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:t,relationshipId:n,showAllEnabled:i}=e,o=i?null:this._renderDescriptionOrEmpty(e.description),s=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return(0,M.K)("calcite-label",{class:this.classes(y.label,y.relatedRecordsLabel),key:"relationship-".concat(n,"-container")},(0,M.K)("div",null,this._renderRelatedRecordsHeaderContainer(e),o,s),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var t;const n=e.updating||!e.loaded;return(0,M.K)("div",{class:y.relatedRecordsHeader,key:"relationship-".concat(e.relationshipId,"-header")},(0,M.K)("span",null,e.label),n?(0,M.K)("calcite-loader",{inline:!0,key:"loader",label:null===(t=this.messagesCommon)||void 0===t?void 0:t.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return(0,M.K)("calcite-list",{class:y.relatedRecordsList},e.relatedFeatureInfos.map((e=>this._renderRelatedRecordListItem(e,t))),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var t,n,i;const{messages:o}=this,s=e.relatedLayerIsTable?o.noOriginKeyRecord:o.noOriginKeyFeature,a=null===(t=e.relationship)||void 0===t?void 0:t.keyField,l=this.viewModel.findField(a),r=null===(n=e.layer)||void 0===n?void 0:n.fieldsIndex.get(a),u=(null===l||void 0===l?void 0:l.label)||(null===r||void 0===r?void 0:r.alias)||a,d=(0,I.V)(s,{relatedLayerName:null===(i=e.relatedLayer)||void 0===i?void 0:i.title,originKeyField:u});return(0,M.K)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,M.K)("div",{slot:"message"},d))}_renderNoRelatedRecordsNotice(){return(0,M.K)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,M.K)("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if(null!==(e=this.viewModel.activeRelationshipInput)&&void 0!==e&&e.showAllEnabled)return(0,M.K)("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:y.listObserver,key:"feature-observer"})}getCommonInputProps(e){const{disabled:t}=this,{editable:n,hint:i,label:o,maxLength:s,minLength:a,name:l,range:{max:r,min:u},required:d,valid:c,value:p}=e,h=this._inputsWithChanges.has(l),m=!n||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":c?"false":"true",class:this.classes(y.fieldInput,m?y.inputDisabled:null,h&&!c?y.inputInvalid:null),key:l,label:o,max:null!=r?r:void 0,min:null!=u?u:void 0,maxLength:s>-1?s:void 0,minLength:a>-1?a:void 0,placeholder:null!==i&&void 0!==i?i:void 0,readOnly:m,required:d,value:null==p?"":"".concat(p),onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[E]:l}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(E))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),n=e.dataset.datePart,i=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&null!=e.value){const t=e.value,n=new ResizeObserver((()=>{e.value=void 0,e.value=t,n.unobserve(e)}));n.observe(e)}if(null!=i)switch(n){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}else this._dateComponentMap.set(t.name,{[n]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);(0,v.Gq)(t)&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,n=e.querySelector("calcite-radio-button"),i=t||n;i&&this._afterComponentCreateOrUpdate(i)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,n=this._getFieldInputFromHTMLElement(e),i=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&i===n&&(this._attemptFocusOnNextRender=!1,(0,v.bx)(n)&&(n.group.open=!0),e.setFocus())}_onComponentFocus(e){const t=e.target,n=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=n.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,n=this._getFieldInputFromHTMLElement(e),i=n.field.type,{name:o,range:s}=n,a=this._dateComponentMap.get(o);if(!a)return;let l=this.viewModel.getValue(o),r=null;"date-only"===i?r=e.value:"time-only"===i?(l=(0,C.iP)(l),r=(0,C.iP)(e.value)):r="timestamp-offset"===i?null!=e.value?(0,C.Ng)({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:l,defaultTimeZone:t}):null:null!=e.value?(0,C.oh)({oldValue:l,dateComponent:a.date,timeComponent:a.time,timeZone:t,max:s.max,min:s.min}):null,null!==r&&e.value?l!==r&&this._updateFieldValue(o,r):this._updateFieldValue(o,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e);this._updateFieldValue(t.name,this._parseValue(e))}_onComponentKeyDown(e){let{key:t,target:n}=e;const i=this._getFieldInputFromHTMLElement(n);"Enter"===t&&(0,v.bx)(i)&&!i.group.open&&(i.group.open=!0)}_updateFieldValue(e,t){if(this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),this.viewModel.fieldsWithContingentValues.has(e)){const e=Object.fromEntries(Object.entries(this.getValues()).filter((e=>{let[t,n]=e;return null!=n})));this.viewModel.validateContingencyConstraints(e)}}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),n=e.value;return(0,v.HG)(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:null==n||""===n?null:"number"===t.dataType?"-0"===n||"-0."===n||"-0,"===n?n:parseFloat(n):"date"===t.field.type?parseFloat(n):n}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:n}=e;0===n.length&&t&&"selected"in t?t.selected=!0:a.A.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){var n;e.open?(t.open=!0,this._focusedFieldName=(null===(n=this._getFocusableInput("forward",t))||void 0===n?void 0:n.name)||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach((e=>{e!==t&&(e.open=!1)}))):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){"Enter"===e.key&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;null===e||void 0===e||e.incrementPage()}_syncGroupInputStates(){if("sequential"!==this.groupDisplay)return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter((e=>e.open));0===t.length?e[0].open=!0:t.length>1&&t.slice(1).forEach((e=>e.open=!1))}_onComboboxClose(e){this._activeComboboxClosedByWorkaround||this._activeCombobox!==e.target||(this._activeCombobox=null)}_onComboboxOpen(e){this._activeComboboxClosedByWorkaround=!1,this._activeCombobox=e.target}onScroll(e){if(this._activeCombobox){const t=this._activeCombobox.getBoundingClientRect(),n=e.target.getBoundingClientRect();t.bottom>n.bottom?(this._activeComboboxClosedByWorkaround=!0,this._activeCombobox.open=!1):(this._activeComboboxClosedByWorkaround&&(this._activeCombobox.open=!0,this._activeComboboxClosedByWorkaround=!1),this._activeCombobox.reposition())}}};(0,i._)([(0,r.MZ)()],R.prototype,"_listObserverNode",void 0),(0,i._)([(0,r.MZ)()],R.prototype,"_relatedRecordsEnabled",null),(0,i._)([(0,r.MZ)()],R.prototype,"disabled",null),(0,i._)([(0,r.MZ)()],R.prototype,"feature",null),(0,i._)([(0,r.MZ)()],R.prototype,"formTemplate",null),(0,i._)([(0,r.MZ)()],R.prototype,"groupDisplay",void 0),(0,i._)([(0,r.MZ)()],R.prototype,"headingLevel",void 0),(0,i._)([(0,r.MZ)()],R.prototype,"label",null),(0,i._)([(0,r.MZ)()],R.prototype,"layer",null),(0,i._)([(0,r.MZ)()],R.prototype,"map",null),(0,i._)([(0,r.MZ)(),(0,x.G)("esri/widgets/FeatureForm/t9n/FeatureForm")],R.prototype,"messages",void 0),(0,i._)([(0,r.MZ)(),(0,x.G)("esri/t9n/common")],R.prototype,"messagesCommon",void 0),(0,i._)([(0,r.MZ)(),(0,x.G)("esri/widgets/Feature/t9n/Feature")],R.prototype,"messagesFeature",void 0),(0,i._)([(0,r.MZ)(),(0,x.G)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],R.prototype,"messagesTemplates",void 0),(0,i._)([(0,r.MZ)()],R.prototype,"relatedRecordCallbacks",null),(0,i._)([(0,r.MZ)()],R.prototype,"relationshipId",null),(0,i._)([(0,r.MZ)()],R.prototype,"spatialReference",null),(0,i._)([(0,r.MZ)()],R.prototype,"strict",null),(0,i._)([(0,r.MZ)()],R.prototype,"timeZone",null),(0,i._)([(0,r.MZ)()],R.prototype,"view",null),(0,i._)([(0,r.MZ)(),(0,V.U)(["value-change","submit"])],R.prototype,"viewModel",void 0),R=(0,i._)([(0,u.$)("esri.widgets.FeatureForm")],R);const A=R},694:(e,t,n)=>{n.d(t,{A:()=>ye});var i=n(35143),o=n(39356),s=n(63241),a=n(54099),l=n(76460),r=n(30726),u=n(91291),d=n(68134),c=n(88685),p=n(46053),h=(n(81806),n(47249),n(85842)),m=n(19451),f=n(51228),y=n(91967);let v=class extends y.A{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};(0,i._)([(0,p.MZ)()],v.prototype,"objectType",void 0),(0,i._)([(0,p.MZ)()],v.prototype,"maxValue",void 0),(0,i._)([(0,p.MZ)()],v.prototype,"minValue",void 0),(0,i._)([(0,p.MZ)()],v.prototype,"codedValue",void 0),v=(0,i._)([(0,h.$)("esri.layers.support.ContingentValue")],v);const g=v;var _=n(70445),b=n(3825),C=n(18690),F=n(42553),w=n(49304),x=n(13096);let V=class extends y.A{constructor(e){super(e),this.isRetired=!1}};(0,i._)([(0,p.MZ)()],V.prototype,"id",void 0),(0,i._)([(0,p.MZ)()],V.prototype,"isRetired",void 0),(0,i._)([(0,p.MZ)()],V.prototype,"subtype",void 0),(0,i._)([(0,p.MZ)()],V.prototype,"values",void 0),V=(0,i._)([(0,h.$)("esri.layers.support.Contingency")],V);const M=V;let I=class extends y.A{constructor(e){super(e)}};(0,i._)([(0,p.MZ)()],I.prototype,"fieldGroup",void 0),(0,i._)([(0,p.MZ)()],I.prototype,"type",void 0),I=(0,i._)([(0,h.$)("esri.layers.support.ContingencyConstraintViolation")],I);const E=I;let R=class extends y.A{constructor(e){super(e)}};(0,i._)([(0,p.MZ)()],R.prototype,"contingentValuesAllGroups",void 0),(0,i._)([(0,p.MZ)()],R.prototype,"contingentValuesByFieldGroup",void 0),R=(0,i._)([(0,h.$)("esri.layers.support.ContingentValuesResult")],R);const A=R;let T=class extends y.A{constructor(e){super(e),this.fields=null,this.isEditingRestrictive=!1}};(0,i._)([(0,p.MZ)()],T.prototype,"name",void 0),(0,i._)([(0,p.MZ)()],T.prototype,"fields",void 0),(0,i._)([(0,p.MZ)()],T.prototype,"isEditingRestrictive",void 0),(0,i._)([(0,p.MZ)()],T.prototype,"contingencies",void 0),T=(0,i._)([(0,h.$)("esri.layers.support.FieldGroup")],T);const Z=T;var O,k=n(53430),L=n(17305);let S=O=class extends((0,F.Te)(w.A)){constructor(e){super(e),this.request=b.A,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){const{layer:e}=this;return"subtype-group"===e.type?e.subtypeField:e.typeIdField}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(void 0===e.layerId)return null;const n=t.hasContingentValuesDefinition;if(n)return new O({layer:e}).load();if(void 0===n){const t=(0,x.qg)(e.url);if(null==t)return null;const n=t.url.path;if((await O._staticFetchEnterpriseFeatureRoot(n)).supportsQueryDataElements){const t=e.layerId.toString(),i=await O._staticFetchEnterpriseFieldGroup(n,t);if(i){const t=i.map((t=>({name:t.name,isEditingRestrictive:t.isEditingRestrictive,fields:t.fieldNames.names.map((t=>e.fieldsIndex.normalizeFieldName(t)))})));return new O({layer:e,fieldGroupDefinitions:t}).load()}}}return null}async load(e){const t=this.layer.load(e).then((()=>this._initializeContingentValues(this.fieldGroupDefinitions,e)));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const n=Object.keys(e),i=[],o=[];for(const s of this.fieldGroups){const a=s.isEditingRestrictive?"error":"warning";if(t&&!s.fields.some((e=>t.includes(e))))continue;if(!s.fields.every((e=>n.includes(e)))){o.push(new E({fieldGroup:s,type:a}));continue}let l=!1;const r=e[this.subtypeFieldName],u=s.contingencies.filter((e=>!(!e.isRetired&&e.subtype)||e.subtype.code===r));for(const t of u){let n=!0;for(const i in t.values){const o=t.values[i];if("any"!==o.objectType)if("null"===o.objectType){if(null!=e[i]){n=!1;break}}else if("code"===o.objectType){if(e[i]!==o.codedValue.code){n=!1;break}}else if("range"===o.objectType){const t=e[i];if(t<o.minValue||t>o.maxValue){n=!1;break}}}if(n){l=!0;break}}l||i.push(new E({fieldGroup:s,type:a}))}return{invalid:i,incomplete:o}}getContingentValues(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e[this.subtypeFieldName],o=null!=i,s={};let a=[];const l=this.fieldGroups.filter((e=>e.fields.includes(t)));a.push(new g({objectType:"any"}));for(const r of l){let l=[];const u=r.contingencies.filter((e=>!(e.isRetired||e.subtype&&o&&e.subtype.code!==i)));let d=!1;const c={};for(const n of u){let i,o=!0;for(const s in n.values){const a=n.values[s];if(t!==s){if(void 0!==e[s]&&"any"!==a.objectType)if("null"===a.objectType)null!==e[s]&&(o=!1);else if("code"===a.objectType)e[s]!==a.codedValue.code&&(o=!1);else if("range"===a.objectType){const t=e[s];(t<a.minValue||t>a.maxValue)&&(o=!1)}}else i=a,d=d||"range"===a.objectType}if(i&&o){if("any"===i.objectType){l.length=0,l.push(i);break}const e=this._generateKey(i);c[e]||l.push(i),c[e]=!0}}d&&(l=this._joinRange(l)),s[r.name]=l,a=n?this._filterIntersection(a,l):[]}return 1===l.length&&n&&(a=[]),new A({contingentValuesAllGroups:a,contingentValuesByFieldGroup:s})}_generateKey(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}_joinRange(e){let t,n;e.sort(((e,t)=>"null"===e.objectType?-1:"null"===t.objectType?1:e.minValue-t.minValue));const i=[];for(const o of e)"null"!==o.objectType?null!=t&&null!=n?n<o.minValue?(i.push(new g({objectType:"range",minValue:t,maxValue:n})),t=o.minValue,n=o.maxValue):n<o.maxValue&&(n=o.maxValue):(t=o.minValue,n=o.maxValue):i.push(o);return i.push(new g({objectType:"range",minValue:t,maxValue:n})),i}_filterIntersection(e,t){var n,i;if(0===e.length||0===t.length)return[];if("any"===e[0].objectType)return t;if("any"===t[0].objectType)return e;const o="range"===e[0].objectType||"range"===(null===(n=e[1])||void 0===n?void 0:n.objectType),s="range"===t[0].objectType||"range"===(null===(i=t[1])||void 0===i?void 0:i.objectType);return o||s?this._intersectRanges(e,t):this._intersectValues(e,t)}_intersectRanges(e,t){const n=[];let i,o=0;for(const s of e)for(;o<t.length;o++){const e=t[o];if("null"===s.objectType&&"null"===e.objectType)n.push(new g({objectType:"null"}));else{if("null"===s.objectType)break;if("null"===e.objectType)continue}if(s.maxValue<e.minValue)break;if(s.maxValue===e.minValue){n.push(new g({objectType:"range",minValue:s.maxValue,maxValue:e.minValue}));break}if(!(s.minValue>e.maxValue))if(s.minValue!==e.maxValue){if(i=s.minValue>e.minValue?s.minValue:e.minValue,s.maxValue<e.maxValue){n.push(new g({objectType:"range",minValue:i,maxValue:s.maxValue}));break}n.push(new g({objectType:"range",minValue:i,maxValue:e.maxValue}))}else n.push(new g({objectType:"range",minValue:s.minValue,maxValue:e.maxValue}))}return n}_intersectValues(e,t){const n=[];for(const i of e)t.some((e=>{if(i.objectType===e.objectType)switch(i.objectType){case"any":case"null":return!0;case"code":return i.codedValue.code===e.codedValue.code&&i.codedValue.name===e.codedValue.name}return!1}))&&n.push(i);return n}static async _staticFetchEnterpriseFeatureRoot(e,t){return(0,b.A)(e,{responseType:"json",query:{f:"json"},...t}).then((e=>e.data))}static async _staticFetchEnterpriseFieldGroup(e,t,n){return(0,b.A)("".concat(e,"/queryDataElements"),{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then((e=>{var t,n;return null!==(t=null===(n=e.data.layerDataElements)||void 0===n?void 0:n[0].dataElement.fieldGroups)&&void 0!==t?t:[]}))}async _initializeContingentValues(e,t){const n=null!==e&&void 0!==e?e:await this._fetchFieldGroupDefs(t);if(0===n.length)return void(this.fieldGroups=[]);const i=await this._fetchContingentValues(n,t);this.fieldGroups=i}async _fetchFieldGroupDefs(e){if(void 0===this.layer.layerId)return[];const t=this.layer.sourceJSON,n=this.layer.layerId.toString(),i=(0,x.qg)(this.layer.url).url.path;return t.hasContingentValuesDefinition?(await this._fetchAGOLFieldGroup(i,n,e)).map((e=>({name:e.name,isEditingRestrictive:e.restrictive,fields:e.fields.map((e=>this.layer.fieldsIndex.normalizeFieldName(e)))}))):void 0!==t.hasContingentValuesDefinition?[]:this._fetchEnterpriseFeatureRoot(i,e).then((async t=>t.supportsQueryDataElements?(await this._fetchEnterpriseFieldGroup(i,n,e)).map((e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((e=>this.layer.fieldsIndex.normalizeFieldName(e)))}))):[]))}async _fetchAGOLFieldGroup(e,t,n){return(0,b.A)("".concat(e,"/").concat(t,"/fieldgroups"),{responseType:"json",query:{f:"json"},...n}).then((e=>{var t;return null!==(t=e.data.fieldGroups)&&void 0!==t?t:[]}))}async _fetchEnterpriseFieldGroup(e,t,n){return O._staticFetchEnterpriseFieldGroup(e,t,n)}async _fetchEnterpriseFeatureRoot(e,t){return O._staticFetchEnterpriseFeatureRoot(e,t)}async _fetchContingentValues(e,t){if(void 0===this.layer.layerId)return[];const n=this.layer.sourceJSON,i=this.layer.layerId.toString(),o=(0,x.qg)(this.layer.url).url.path;if(n.hasContingentValuesDefinition){const n=await this._fetchAGOLContingentValues(o,i,t);return this._constructFieldGroupsAGOL(e,n)}const s=await this._fetchEnterpriseContingentValues(o,i,t);return this._constructFieldGroupsEnterprise(e,s)}_constructFieldGroupsAGOL(e,t){return e.map((e=>{const n=t.contingentValuesDefinition.fieldGroups.find((t=>t.name===e.name));if(n){let i=[];return i=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(e,t,n.subTypes):this._parseAGOLFieldGroup(e,t,n.contingentValues),new Z({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:i})}return null})).filter(C.Ru)}_parseAGOLFieldGroupSubtype(e,t,n){let i=[];return null!==n&&void 0!==n&&n.forEach((n=>{const o=this._getSubtypeAGOL(n.name);i=i.concat(this._parseAGOLFieldGroup(e,t,n.contingentValues,o))})),i}_parseAGOLFieldGroup(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=[];for(const s of null!==n&&void 0!==n?n:[]){const n=this._parseAGOLContingency(s,e,t,i);o.push(n)}return o}_parseAGOLContingency(e,t,n,i){const o=e.id,s=!!e.retired&&1===e.retired,a={};for(let l=0,r=0;l<t.fields.length;l++){const o=t.fields[l],s=n.typeCodes[e.types[l]];if("Code"===s){let t=e.values[r];r++;const s=this._getDomain(i,o),l=this.layer.getField(o);if("string"===(null===l||void 0===l?void 0:l.type)){const e=n.stringDicts.find((e=>e.domain===(null===s||void 0===s?void 0:s.name)));e&&(t=e.entries[t])}const u=null===s||void 0===s?void 0:s.codedValues.find((e=>e.code===t)),d=new g({codedValue:u,objectType:"code"});a[o]=d}else if("Range"===s){const t=e.values[r];r++;const n=t.range[0],i=t.range[1],s=new g({minValue:n,maxValue:i,objectType:"range"});a[o]=s}else if("Any"===s){const e=new g({objectType:"any"});a[o]=e}else{const e=new g({objectType:"null"});a[o]=e}}return new M({id:o,isRetired:s,subtype:i,values:a})}_constructFieldGroupsEnterprise(e,t){const n=t.fieldGroups;return e.map((e=>{const i=n.find((t=>t.name===e.name));if(i){const n=i.contingencies.map((n=>{const i=n.id,o=n.isRetired||!1,s=this._getSubtypeEnterprise(n.subtypeCode),a={};for(let l=0;l<e.fields.length;l++){const i=e.fields[l];let o=n.values[l];if("number"==typeof o||"string"==typeof o){const e=this._getDomain(s,i),n=this.layer.getField(i);if((0,k.yM)(n))o=t.stringDictionary[o];else if((0,k.vE)(n)){const e=new Date("".concat(o,"+00:00"));o=e.getTime()}const l=null===e||void 0===e?void 0:e.codedValues.find((e=>e.code===o)),r=new g({codedValue:l,objectType:"code"});a[i]=r}else if("object"==typeof o){const e=o.minValue,t=o.maxValue,n=new g({minValue:e,maxValue:t,objectType:"range"});a[i]=n}else if(o){const e=new g({objectType:"any"});a[i]=e}else{const e=new g({objectType:"null"});a[i]=e}}return new M({id:i,isRetired:o,subtype:s,values:a})}));return new Z({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:n})}return null})).filter(C.Ru)}async _fetchEnterpriseContingentValues(e,t,n){return(0,b.A)("".concat(e,"/queryContingentValues"),{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then((e=>{var t;return null===(t=e.data.contingentValueSets)||void 0===t?void 0:t[0]}))}async _fetchAGOLContingentValues(e,t,n){return(0,b.A)("".concat(e,"/").concat(t,"/contingentValues"),{responseType:"json",query:{f:"json"},...n}).then((e=>e.data))}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find((t=>t.code===e));n=L.A.fromJSON(i)}return n||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find((t=>t.name===e));n=L.A.fromJSON(i)}return n||null}_findDomainByFieldName(e,t){const n=e.domains;if(n){const[e,i]=Object.entries(n).find((e=>{let[n]=e;return n.trim().toLowerCase()===t.trim().toLowerCase()}))||[];return i||null}return null}_getDomain(e,t){const n=e?this._findDomainByFieldName(e,t):this.layer.getFieldDomain(t);return"inherited"===(null===n||void 0===n?void 0:n.type)?this.layer.getFieldDomain(t):n}};(0,i._)([(0,p.MZ)({constructOnly:!0})],S.prototype,"layer",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],S.prototype,"request",void 0),(0,i._)([(0,p.MZ)({type:[Z]})],S.prototype,"fieldGroups",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],S.prototype,"fieldGroupDefinitions",void 0),(0,i._)([(0,p.MZ)()],S.prototype,"subtypeFieldName",null),S=O=(0,i._)([(0,h.$)("esri.layers.support.LayerContingentValuesCache")],S);const D=S;var N,G=n(67478),j=n(3320),K=n(65529),P=n(30550),U=n(50346);const H=Symbol("FormExpressionArcadeExecutor");let B=class extends y.A{constructor(e){super(e),this[N]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new m.U,this._executeAsyncDebounced=(0,U.sg)((async(e,t,n)=>{const i=await this.executor.executeAsync(e,{...t,abortSignal:n});return n.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=i,this._stale=!1,i)}))}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,t){this._abortController=new AbortController;const n=this.executor.execute(e,{...t,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=n,n}async executeAsync(e,t){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,null!==t&&void 0!==t?t:{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};N=H,(0,i._)([(0,p.MZ)()],B.prototype,"_lastEvaluatedValue",void 0),(0,i._)([(0,p.MZ)()],B.prototype,"_stale",void 0),(0,i._)([(0,p.MZ)()],B.prototype,"_updatingTracking",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],B.prototype,"executor",void 0),(0,i._)([(0,p.MZ)()],B.prototype,"isAsync",null),(0,i._)([(0,p.MZ)()],B.prototype,"fieldsUsed",null),(0,i._)([(0,p.MZ)()],B.prototype,"syntaxTree",null),(0,i._)([(0,p.MZ)()],B.prototype,"updating",null),(0,i._)([(0,p.MZ)()],B.prototype,"stale",null),(0,i._)([(0,p.MZ)()],B.prototype,"geometryUsed",null),(0,i._)([(0,p.MZ)()],B.prototype,"variablesUsed",null),(0,i._)([(0,p.MZ)()],B.prototype,"lastEvaluatedValue",null),B=(0,i._)([(0,h.$)("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],B);const $=async(e,t)=>{const n=(0,P.createArcadeProfile)("form-calculation"),i=await(0,P.createArcadeExecutor)(e,n,{});return null!==t&&void 0!==t&&t.fieldsIndex&&(i.fieldsUsed=(0,k.DB)(t.fieldsIndex,i.fieldsUsed)),new B({executor:i})};var W=n(87663);const q="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let z=class extends y.A{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter((e=>e.isAsync))}get _baseContext(){const{editType:e,layer:t,map:n,originalFeature:i,spatialReference:o,timeZone:s}=this.arcadeContextInfo,a="scene"===(null===t||void 0===t?void 0:t.type)&&null!=t.associatedLayer?t.associatedLayer:t;return[{$originalfeature:i,$editcontext:{editType:e},$layer:a,$featureset:a,$datastore:null===t||void 0===t?void 0:t.url,$map:n},{rawOutput:!0,spatialReference:null!==o&&void 0!==o?o:void 0,timeZone:s}]}set feature(e){this._latestFieldValues={...null===e||void 0===e?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:t,_latestFieldValues:n,feature:i}=this,o=new Set;for(const s of e)if(n[s]=i.getAttribute(s),t.has(s))for(const e of t.get(s))o.add(e);return this._evaluate([...o])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(q))return this._evaluate([...this._fieldReferencesLookup.get(q)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){const{_fieldReferencesLookup:e,_fieldsAffectedLookup:t,executors:n,preserveFieldValuesWhenHidden:i}=this,o=new Map(this.fieldInputs.map((e=>[e.name,e]))),s=!1===i,a=new Map(n.map((e=>[e,new Array])));for(const r of n){for(const n of r.fieldsUsed){var l;(0,W.tE)(e,n,(()=>new Set)).add(r);const i=o.get(n);[null===i||void 0===i?void 0:i.valueExpressionExecutor,null===i||void 0===i?void 0:i.editableExpressionExecutor,s?null===i||void 0===i||null===(l=i.group)||void 0===l?void 0:l.visibilityExpressionExecutor:null,s?null===i||void 0===i?void 0:i.visibilityExpressionExecutor:null].filter((e=>null!=e&&e!==r)).forEach((e=>{a.get(e).push(r),(0,W.tE)(t,e,(()=>new Set)).add(i)}))}r.geometryUsed&&(0,W.tE)(e,q,(()=>new Set)).add(r)}return a}async _evaluate(e){const t=new Map,{_dependencyGraph:n,_fieldsAffectedLookup:i,_latestFieldValues:o}=this;for(const a of e)J(a,t,n);for(const[a,{resolver:l,dependencyPromises:r}]of t)Promise.all(r).then((async()=>{const[e,t]=this._makeContext(o);return a.executeAsync(e,t)})).then((()=>{if(i.has(a))for(const e of i.get(a))this._latestFieldValues[e.name]=e.value;l.resolve()}),(e=>{!e||(0,U.zf)(e)||Y(e)||a.markStale(),l.reject(e)}));const s=(await Promise.allSettled(Array.from(t.values(),(e=>{let{resolver:t}=e;return t.promise})))).filter((e=>"rejected"===e.status&&!((0,U.zf)(e.reason)||Y(e.reason))));if(s.length>0)throw new AggregateError(s,"One or more expression executions failed")}_makeContext(e){const[t,n]=this._baseContext,i=this.feature.clone();return i.attributes=e,[{...t,$feature:i},n]}get test(){return{baseContext:this._baseContext}}};(0,i._)([(0,p.MZ)()],z.prototype,"_asyncExecutors",null),(0,i._)([(0,p.MZ)()],z.prototype,"_baseContext",null),(0,i._)([(0,p.MZ)()],z.prototype,"feature",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],z.prototype,"preserveFieldValuesWhenHidden",void 0),(0,i._)([(0,p.MZ)()],z.prototype,"executors",void 0),(0,i._)([(0,p.MZ)()],z.prototype,"fieldInputs",void 0),(0,i._)([(0,p.MZ)()],z.prototype,"arcadeContextInfo",void 0),z=(0,i._)([(0,h.$)("esri.widgets.FeatureForm.FormExpressionsManager")],z);const J=(e,t,n)=>{if(t.has(e))return;const i=(0,U.Tw)();t.set(e,{resolver:i,dependencyPromises:[]}),e.abort();const o=n.get(e);for(const s of o)J(s,t,n),t.get(s).dependencyPromises.push(i.promise)},Y=e=>e&&"object"==typeof e&&"message"in e&&"Cancelled"===e.message;var Q=n(84668);let X=class extends Q.A{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.type="group"}initialize(){this.addHandles([(0,d.watch)((()=>[this.visible,this.inputs]),(e=>{let[t]=e;const{inputs:n}=this,i=!!t&&void 0;for(const o of n)(0,j.rf)(o)&&(o.required=i)}),{initial:!0,equals:(e,t)=>t[0]===e[0]&&t[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map((e=>(0,d.watch)((()=>e.visible),(()=>this._dirtyEvaluatedVisibilityExpression()))))),this._set("inputs",e)}get label(){return this.element.label}set label(e){const{element:t}=this;t&&(t.label=e)}get open(){return"expanded"===this.initialState}set open(e){this._override("open",e)}get state(){return(0,s.Lx)(l.A.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open?"expanded":"collapsed"}set state(e){(0,s.Lx)(l.A.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open="expanded"===e}get visible(){return!1!==this.evaluatedVisibilityExpression&&this.inputs&&this.inputs.some((e=>e.visible))}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};(0,i._)([(0,p.MZ)()],X.prototype,"initialState",null),(0,i._)([(0,p.MZ)()],X.prototype,"inputs",null),(0,i._)([(0,p.MZ)()],X.prototype,"label",null),(0,i._)([(0,p.MZ)()],X.prototype,"open",null),(0,i._)([(0,p.MZ)()],X.prototype,"type",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"visible",null),X=(0,i._)([(0,h.$)("esri.widgets.FeatureForm.GroupInput")],X);const ee=X;var te=n(31933),ne=n(65023),ie=n(9912),oe=n(48397);let se=class extends oe.A{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([(0,d.watch)((()=>({feature:this.feature,element:this.element,layer:this.layer})),(e=>this._createRelationshipVM(e)),d.initial),(0,d.on)((()=>this.relatedLayer),"edits",(()=>{var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.refresh()}))])}destroy(){var e;null===(e=this._relationshipVM)||void 0===e||e.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:t,relationship:n}=this;if(!n||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:i,role:o}=n;return!("one-to-one"===i&&t>0)&&"many-to-many"!==i&&!("one-to-many"===i&&"destination"===o&&t>0)&&e}get displayCount(){var e;return null!==(e=this.element.displayCount)&&void 0!==e?e:3}get displayType(){return this.element.displayType}get editable(){var e;return!!this.relatedLayerAllowsEdits&&(null===(e=this.evaluatedEditableExpression)||void 0===e||e)}get featureCount(){var e,t;return null!==(e=null===(t=this._relationshipVM)||void 0===t?void 0:t.featureCount)&&void 0!==e?e:0}get loaded(){var e;return"loading"!==(null===(e=this._relationshipVM)||void 0===e?void 0:e.state)}get map(){return this._get("map")}set map(e){var t;e&&null!==(t=this._relationshipVM)&&void 0!==t&&t.set("map",e),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var e;const{_relationshipVM:t,timeZone:n}=this;if(null===t||void 0===t||null===(e=t.relatedFeatures)||void 0===e||!e.length||null===t||void 0===t||!t.relatedLayer)return[];const{itemDescriptionFieldName:i,relatedFeatures:o,relatedLayer:s}=t,a=s&&"formTemplate"in s&&s.formTemplate?s.formTemplate.title:void 0;return o.map((e=>{let t;if(i){const o=e.getAttribute(i),a=s.fieldsIndex.get(i);if(a){const e=(0,j.Ve)({values:[o],fields:[a],timeZone:null!==n&&void 0!==n?n:void 0})[i];null!=e&&(t=e.toString())}}return{feature:e,description:t,title:a?(0,j.LZ)({label:a,attributes:e.attributes,fieldsIndex:s.fieldsIndex,timeZone:n}):void 0}})).toArray()}get relatedLayer(){var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.relatedLayer}get relatedLayerIsTable(){var e;return!(null===(e=this.relatedLayer)||void 0===e||!e.isTable)}get relatedLayerAllowsAdds(){var e;const{relatedLayer:t}=this;if(!t||!this.relatedLayerAllowsEdits)return!1;const n=(0,te.BR)(t);return!(null===n||void 0===n||null===(e=n.operations)||void 0===e||!e.supportsAdd)}get relatedLayerAllowsEdits(){var e;const{relatedLayer:t}=this;if(!t)return!1;const n=(0,te.BR)(t);return!(null===n||void 0===n||null===(e=n.operations)||void 0===e||!e.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){var t;null!==(t=this._relationshipVM)&&void 0!==t&&t.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:t}=e;return"many-to-many"!==t&&(null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element)}get updating(){var e,t;return"loading"===(null===(e=this._relationshipVM)||void 0===e?void 0:e.state)||"querying"===(null===(t=this._relationshipVM)||void 0===t?void 0:t.state)}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){var t;return null===(t=this._relationshipVM)||void 0===t?void 0:t.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){var t;const{feature:n,element:i,layer:o}=e;if(null!==(t=this._relationshipVM)&&void 0!==t&&t.destroy(),!n||!i||!o)return;const{displayCount:s,map:a,orderByFields:l,relationshipId:r,showAllEnabled:u}=this;(0,ie.sS)(o)&&(this._relationshipVM=new ne.A({graphic:n,displayCount:s,layer:o,map:a,orderByFields:l,relationshipId:r,showAllEnabled:u}))}};(0,i._)([(0,p.MZ)()],se.prototype,"_relationshipVM",void 0),(0,i._)([(0,p.MZ)()],se.prototype,"canAddRelatedFeature",null),(0,i._)([(0,p.MZ)()],se.prototype,"displayCount",null),(0,i._)([(0,p.MZ)()],se.prototype,"displayType",null),(0,i._)([(0,p.MZ)()],se.prototype,"editable",null),(0,i._)([(0,p.MZ)()],se.prototype,"featureCount",null),(0,i._)([(0,p.MZ)()],se.prototype,"group",void 0),(0,i._)([(0,p.MZ)()],se.prototype,"loaded",null),(0,i._)([(0,p.MZ)()],se.prototype,"map",null),(0,i._)([(0,p.MZ)()],se.prototype,"orderByFields",null),(0,i._)([(0,p.MZ)()],se.prototype,"originHasValidKey",null),(0,i._)([(0,p.MZ)()],se.prototype,"relationship",null),(0,i._)([(0,p.MZ)()],se.prototype,"relationshipId",null),(0,i._)([(0,p.MZ)()],se.prototype,"relatedFeatureInfos",null),(0,i._)([(0,p.MZ)()],se.prototype,"relatedLayer",null),(0,i._)([(0,p.MZ)()],se.prototype,"relatedLayerIsTable",null),(0,i._)([(0,p.MZ)()],se.prototype,"relatedLayerAllowsAdds",null),(0,i._)([(0,p.MZ)()],se.prototype,"relatedLayerAllowsEdits",null),(0,i._)([(0,p.MZ)()],se.prototype,"showAllEnabled",null),(0,i._)([(0,p.MZ)()],se.prototype,"showAllActionVisible",null),(0,i._)([(0,p.MZ)({readOnly:!0})],se.prototype,"type",void 0),(0,i._)([(0,p.MZ)()],se.prototype,"visible",null),(0,i._)([(0,p.MZ)()],se.prototype,"updating",null),se=(0,i._)([(0,h.$)("esri.widgets.FeatureForm.RelationshipInput")],se);const ae=se,le=new o.A({attributes:{}}),re=["editableExpression","requiredExpression","valueExpression","visibilityExpression"],ue=["visibilityExpression"],de=["editableExpression","visibilityExpression"],ce="#JSAPI_CONTINGENT_VALUE_ANY_HASH",pe="esri.widgets.FeatureForm.FeatureFormViewModel",he=()=>l.A.getLogger(pe);let me=class extends((0,u.g)(a.A.EventedAccessor)){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=le.clone(),this._initialFeature=le.clone(),this._timeZone=null,this._updatingHandles=new m.U,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1}initialize(){const e=(0,d.watch)((()=>{var e;return[this.layer,!(null===(e=this.layer)||void 0===e||!e.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]}),(async e=>{let[t,n]=e;null!=t&&(n?this._updatingHandles.addPromise(this._updateInputs()):t.load().catch((()=>{})))}),{equals:(e,t)=>{let[n,i,o,s,a,l]=e,[r,u,d,c,p,h]=t;return n===r&&i===u&&o===d&&s===c&&a===p&&l===h},initial:!0}),t=(0,d.watch)((()=>this._arcadeContextInfo),(e=>{null!=this._expressionsManager&&(this._expressionsManager.arcadeContextInfo=e,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally((()=>this._afterExpressionsEvaluated()))))})),n=(0,d.watch)((()=>this.layer),(e=>{const t="subtype-sublayer"===(null===e||void 0===e?void 0:e.type)?e.parent:"feature"===(null===e||void 0===e?void 0:e.type)?e:null;t&&this.addResolvingPromise(D.createLoadedLayerContingentValuesCache(t).then((e=>{this._contingentValuesCache=e,this.notifyChange("fieldsWithContingentValues")})))}),{initial:!0});this.addHandles([e,t,n])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=(0,r.pR)(this._contingentValuesCache),null!==(e=this.highlightHelper)&&void 0!==e&&e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e;return new Map(null===(e=this.formTemplate)||void 0===e||null===(e=e.expressionInfos)||void 0===e?void 0:e.map((e=>[e.name,e])))}get activeRelationshipInput(){return this.allRelationshipInputs.find((e=>e.relationshipId===this.relationshipId))}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:t,layer:n,map:i,spatialReference:o,timeZone:s}=this;return{layer:(0,_.S)(n)?n:null,originalFeature:e,editType:t,map:i,spatialReference:o,timeZone:s}}get allFieldInputs(){return(0,j.Iy)(this.inputs)}get allGroupInputs(){return this.inputs.filter(j.Et)}get allRelationshipInputs(){return(0,j.cU)(this.inputs)}get _layerFieldsByName(){var e;return new Map(null===(e=this.layer)||void 0===e?void 0:e.fields.map((e=>[e.name,e])))}get feature(){return this._get("feature")}set feature(e){this._featureClone=e?e.clone():le.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach((t=>t.feature=e))):(this.inputs.forEach((e=>e.destroy())),this.inputs.length=0),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(null==this._contingentValuesCache)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap((e=>e.fields));return new Set(e)}get fieldsWithInvalidCodedValue(){const e=this.allFieldInputs;return new Set(e.filter((e=>{const{name:t,domain:n,value:i}=e;if("coded-value"===(null===n||void 0===n?void 0:n.type)){const e=this.getFieldValueOptionsForField(t);return null!=i&&""!==i&&!e.flat().some((e=>e.value===i))}return!1})))}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){void 0===e?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return null!==e&&void 0!==e&&e.description&&t?(0,j.LZ)({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return null!==e&&void 0!==e&&e.title&&t?(0,j.LZ)({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,formDescription:t,formTitle:n}=this;return!(e||!t&&!n)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return null!==(e=this.feature)&&void 0!==e&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(null!=e&&e===this.relationshipId||t.forEach((e=>e.showAllEnabled=!1)),null!=e){const n=t.find((t=>t.relationshipId===e));n&&(n.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e,t;return null!==(e=null===(t=this.layer)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return null!==(e=this.layer)&&void 0!==e&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter((e=>!e.valid)).every((e=>{let{submittable:t}=e;return t}))}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return G.n$;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===G.L5?t||G.n$:this._timeZone||G.qU}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every((e=>{let{valid:t}=e;return t}))}get view(){return(0,s.Lx)(he(),"view",{replacement:"FeatureForm.map",version:"4.27"}),this._get("view")}set view(e){(0,s.Lx)(he(),"view",{replacement:"FeatureForm.map",version:"4.27"}),this._set("view",e),(null===e||void 0===e?void 0:e.map)&&(this.map=e.map)}findField(e){return this.allFieldInputs.find((t=>t.name===e))}getFieldValueOptionsForField(e,t){var n;const i=this.findField(e);if(!i)return[[],[]];const o="coded-value"===(null===(n=i.domain)||void 0===n?void 0:n.type)?i.domain.codedValues.map((e=>{let{name:t,code:n}=e;return{name:t,value:n}})):[],s=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(s.length>0){const e=new Set(s.map((e=>e.value)));return[s,o.filter((t=>!e.has(t.value)))]}return[o,[]]}getValue(e){var t;const{_featureClone:n,layer:i}=this,o=!(null===i||void 0===i||!i.getField(e));return null!==(t=n.getAttribute(e))&&void 0!==t?t:o?null:void 0}setValue(e,t){const{_featureClone:n,strict:i}=this,o=this.findField(e);t=""===t?null:t,o&&n.getAttribute(e)!==t&&(o.value=t,i&&!o.valid||(this._afterValueChange(o),null!=this._expressionsManager&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([o.name]).finally((()=>this._afterExpressionsEvaluated())))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter((e=>e.valid)).map((e=>{let{name:t}=e;return t}))),n=e.filter((e=>!e.valid)).map((e=>{let{name:t}=e;return t})),i=this.getValues();if(this.validateContingencyConstraints(i,{includeIncompleteViolations:!0}).length>0)for(const[o,s]of this.contingencyConstraintViolations.entries())"error"===s.type&&(t.delete(o),n.push(o));this.emit("submit",{valid:[...t],invalid:n,values:i})}validateContingencyConstraints(e,t){const{_contingentValuesCache:n}=this,i=new Map;if(this.contingencyConstraintViolations=i,null==n)return[];const{invalid:o,incomplete:s}=n.validateContingencyConstraints(e),a=[...o,...null!==t&&void 0!==t&&t.includeIncompleteViolations?s:[]];for(const l of a)for(const e of l.fieldGroup.fields)i.set(e,l);return a}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:t,_featureClone:n}=this;n.geometry=t.geometry,null!=e&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally((()=>this._afterExpressionsEvaluated())))}_emitChangeEvent(e){let{name:t,valid:n,value:i}=e;this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:t,value:i,valid:n})}async _updateInputs(){this._stopExpressions();const{_featureClone:e,_initialFeature:t,arcadeEditType:n,formTemplate:i,inputs:o,layer:s,timeZone:a}=this;if(!s)return;const l={arcadeEditType:n,feature:e,initialFeature:t,layer:s,timeZone:a},r=o.slice(),u=null!==i&&void 0!==i&&i.elements&&i.elements.length>0?await this._updateInputsUsingFormElements(r,i.elements,l):this._updateInputsUsingLayerFields(r,null===s||void 0===s?void 0:s.fields,l);this.inputs=u,await this._startExpressions()}async _updateInputsUsingFormElements(e,t,n){const i=new Map;for(const a of e)if((0,j.Et)(a)){i.set(a.element,a);for(const e of a.inputs)e.element&&i.set(e.element,e)}else a.element&&i.set(a.element,a);const o=new Map,s=this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:t.filter(fe),sharedInitializationProperties:n,group:null,newExpressionExecutorPromises:o});for(const[a,l]of i.entries())i.delete(a),l.destroy();return await Promise.all(Array.from(o.values())),s}_updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:n,sharedInitializationProperties:i,group:o,newExpressionExecutorPromises:s}=e,a=[];for(const l of n){const e=t.has(l),n=e?t.get(l):(0,j.CG)(l)?this._makeGroupInputFromElement(l,i):(0,j.jt)(l)?this._makeFieldInputFromElement(l,i,o):(0,j.DN)(l)?this._makeRelationshipInputFromElement(l,i,o):null;if(n){if(a.push(n),this._assignExpressionExecutors(n,l,s),e)if(t.delete(l),(0,j.Et)(n)){const{feature:e,timeZone:t}=i;n.set({feature:e,timeZone:t})}else if((0,j.nT)(n)){const e=this.relationshipId===l.relationshipId;n.set(i),n.set({map:this.map,showAllEnabled:e})}else n.set(i);if((0,j.CG)(l)){const e=l.elements.filter((e=>fe(e)));n.inputs=this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:e,sharedInitializationProperties:i,group:n,newExpressionExecutorPromises:s})}}}return a}_updateInputsUsingLayerFields(e,t,n){if(!Array.isArray(t))return he().warn(this.declaredClass,"No attribute fields found."),[];const i=new Map;for(const h of e)if((0,j.Et)(h)){for(const e of h.inputs)e.destroy();h.inputs.length=0,h.destroy()}else(0,j.nT)(h)?h.destroy():(0,j.rf)(h)&&(null!==h.element?h.destroy():i.set(h.field,h));const o=[],{arcadeEditType:s,feature:a,initialFeature:l,layer:r,timeZone:u}=n;for(const h of t){var d,c,p;const e=null!==(d=i.get(h))&&void 0!==d?d:new K.A({arcadeEditType:s,field:h,feature:a,initialFeature:l,layer:r,value:null!==(c=null===a||void 0===a?void 0:a.getAttribute(h.name))&&void 0!==c?c:null,preservesValueWhenHidden:null===(p=this.formTemplate)||void 0===p?void 0:p.preserveFieldValuesWhenHidden,timeZone:u});o.push(e),i.delete(h)}for(const[h,m]of i.entries())i.delete(h),m.destroy();return o}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)}_makeFieldInputFromElement(e,t,n){var i,o;const{arcadeEditType:s,feature:a,initialFeature:l,layer:r,timeZone:u}=t,{fieldName:d}=e,c=d&&this._layerFieldsByName.get(d);return c?new K.A({arcadeEditType:s,element:e,field:c,value:null!==(i=null===a||void 0===a?void 0:a.getAttribute(e.fieldName))&&void 0!==i?i:null,feature:a,initialFeature:l,layer:r,group:n,preservesValueWhenHidden:null===(o=this.formTemplate)||void 0===o?void 0:o.preserveFieldValuesWhenHidden,timeZone:u}):null}_makeGroupInputFromElement(e,t){const{feature:n,layer:i}=t;return new ee({element:e,inputs:[],feature:n,layer:i})}_makeRelationshipInputFromElement(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const{map:i}=this,{feature:o,layer:s,timeZone:a}=t,l=new ae({element:e,feature:o,group:n,layer:s,map:i,timeZone:a});return l.addHandles((0,d.on)((()=>l.relatedLayer),"edits",(()=>{var e;return null===(e=this._expressionsManager)||void 0===e?void 0:e.evaluateAsyncExpressions()}))),l}_assignExpressionExecutors(e,t,n){const i=(0,j.CG)(t)?ue:(0,j.DN)(t)?de:re;for(const a of i){const i="".concat(a,"Executor");if(e[i]){this._useExecutor(e[i]);continue}const l=t[a],{_expressionExecutorLookup:r}=this;if(null!=l&&""!==l){var o,s;const t=null!==(o=null===(s=this._expressionInfosLookup.get(l))||void 0===s?void 0:s.expression)&&void 0!==o?o:l;if(r.has(t))e[i]=this._useExecutor(r.get(t));else if(n.has(t)){const o=n.get(t).then((t=>(e[i]=t,t)));n.set(t,o)}else{const o=$(t,this.layer).then((n=>(e[i]=this._useExecutor(n),r.set(t,n),n)));n.set(t,o)}}}return[]}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:n,allFieldInputs:i,formTemplate:o}=this;this._expressionsManager=new z({executors:e,feature:n,arcadeContextInfo:t,fieldInputs:i,preserveFieldValuesWhenHidden:!0===(null===o||void 0===o?void 0:o.preserveFieldValuesWhenHidden)})}async _startExpressions(){if(0===this._expressionExecutorsInUse.size)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally((()=>this._afterExpressionsEvaluated()))}_stopExpressions(){this._expressionsManager=(0,r.pR)(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){const{name:t,value:n}=e,{_featureClone:i,formTemplate:o,layer:s}=this;if(!s)return;const a=i.getAttribute(t);i.setAttribute(t,n);const{typeFieldName:l,types:r}=(0,j.CU)(s);if(t===l&&n!==a){if("subtype-sublayer"===s.type){var u;const e=null===(u=s.parent)||void 0===u?void 0:u.findSublayerForFeature(i);i.sourceLayer=this.feature.sourceLayer=e}const e=new Set;for(const t of r)if(t.domains&&"object"==typeof t.domains)for(const n of Object.keys(t.domains))e.add(n);for(const t of e){const e=this.findField(t);e&&e.notifyChange("domain")}}if(null!=o){const{description:e,title:n}=o;n&&(0,c.mk)(n,t)&&this.notifyChange("formTitle"),e&&(0,c.mk)(e,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(null==e)return[];const{typeFieldName:t}=(0,j.CU)(this.layer),n=t?this.getValue(t):null,i=[];for(const a of e.fieldGroups){const{contingencies:e,fields:t,name:o}=a,s=[];for(const i of e)i.isRetired||null!=i.subtype&&i.subtype.code!==n||s.push({values:i.values});s.length>0&&i.push({name:o,fields:t,contingencies:s})}const[o,s]=this._generateJoinPlan(i);return[...o.flatMap((e=>this._joinFieldGroupContingencies(e))),...s.flatMap((e=>e.contingencies))]}_generateJoinPlan(e){const t=new Map,n=[],i=new Set;for(const r of e)for(const e of r.fields)if(t.has(e)){const o=t.get(e),s=r,a=[o.name,s.name].sort().join("|");if(i.has(a))continue;n.push([o,s]),i.add(a),t.set(e,s)}else t.set(e,r);const o=new Set(n.flat()),s=new Set(e);for(const r of o)s.delete(r);const a=new Map,l=new Map;for(const r of new Set(n.flat())){const e=Symbol(r.name);a.set(e,new Set([r])),l.set(r,e)}for(const[r,u]of n){const e=l.get(r),t=l.get(u);if(e===t)continue;const n=a.get(e),i=a.get(t);for(const o of i)n.add(o),l.set(o,e);a.delete(t)}return[[...a.values()].map((e=>[...e])),[...s]]}_joinFieldGroupContingencies(e){const t=e.slice(),n=t.shift();let i=t.shift(),o=this._generateJoinKey(n.fields,i.fields),s=new Set([...n.fields,...i.fields]),a=new Map;for(const d of n.contingencies){var l;const[e]=this._hashContingency(d,o.codedValueFields,!0);a.has(e)?null===(l=a.get(e))||void 0===l||l.push(d):a.set(e,[d])}for(;t.length>0;){const e=new Map,n=t.shift(),l=this._generateJoinKey(s,n.fields);for(const t of i.contingencies){const[n,i]=this._hashContingency(t,o.codedValueFields),s=i?this._findMatchingContingenciesWithAnyHashMask(a,n):a.get(n);if(a.has(ce)&&null!==s&&void 0!==s&&s.push(...this._findMatchingContingenciesContainingAny(t,a.get(ce),o.codedValueFields)),null!=s)for(const a of s){var r;const n=o.rangeFields.length>0?this._joinContingenciesWithRangeDomains(a,t,o.rangeFields):this._joinContingencies(a,t);if(null==n)break;const[i]=this._hashContingency(n,l.codedValueFields,!0);e.has(i)?null===(r=e.get(i))||void 0===r||r.push(n):e.set(i,[n])}}a=e,i=n,o=l,s=new Set([...s,...i.fields])}const u=[];for(const d of i.contingencies){const[e,t]=this._hashContingency(d,o.codedValueFields),n=t?this._findMatchingContingenciesWithAnyHashMask(a,e):a.get(e);if(a.has(ce)&&n.push(...this._findMatchingContingenciesContainingAny(d,a.get(ce),o.codedValueFields)),null!=n)for(const i of n){const e=o.rangeFields.length>0?this._joinContingenciesWithRangeDomains(i,d,o.rangeFields):this._joinContingencies(i,d);null!=e&&u.push(e)}}return u}_joinContingencies(e,t){const n={values:{...e.values,...t.values}};for(const[i,o]of Object.entries(n.values))"any"===o.objectType&&null!=e.values[i]&&(n.values[i]=e.values[i]);return n}_joinContingenciesWithRangeDomains(e,t,n){const i=this._joinContingencies(e,t);for(const o of n){const n=e.values[o],s=t.values[o],{leftIsNull:a,rightIsNull:l,bothAreNull:r,leftIsAny:u,rightIsAny:d,bothAreAny:c,leftIsRange:p,rightIsRange:h}=this._compareObjectTypes(n.objectType,s.objectType);if(r||c)continue;if(a&&d||l&&u){i.values[o]=new g({objectType:"null"});continue}if(a&&h||l&&p)return null;u?(n.minValue=-1/0,n.maxValue=1/0):d&&(s.minValue=-1/0,s.maxValue=1/0);const m=Math.max(n.minValue,s.minValue),f=Math.min(n.maxValue,s.maxValue);if(m>f)return null;i.values[o]=new g({objectType:"range",minValue:m,maxValue:f})}return i}_findMatchingContingenciesContainingAny(e,t,n){return t.filter((t=>n.every((n=>{var i,o;const s=t.values[n],a=e.values[n];return"any"===s.objectType||"any"===a.objectType||(null===(i=s.codedValue)||void 0===i?void 0:i.code)===(null===(o=a.codedValue)||void 0===o?void 0:o.code)}))))}_findMatchingContingenciesWithAnyHashMask(e,t){const n=RegExp("".concat(t,"$")),i=[];for(const[o,s]of e){if(o===ce)break;n.test(o)&&i.push(...s)}return i}_generateJoinKey(e,t){const n=Array.isArray(e)?new Set(e):e,i=Array.isArray(t)?new Set(t):t,o=n.size<i.size?n:i,s=o===n?i:n,a=new Set,l=new Set;for(const u of o)if(s.has(u)){var r;const e=null===(r=this.layer)||void 0===r?void 0:r.getFieldDomain(u,{feature:this.feature});if(null==e)continue;switch(e.type){case"coded-value":a.add(u);break;case"range":l.add(u)}}return{codedValueFields:[...a],rangeFields:[...l]}}_contingencyIsValid(e,t){const n={};for(const{name:i,value:o}of this.allFieldInputs)this.fieldsWithContingentValues.has(i)&&null!=o&&i!==e&&(n[i]=o);return Object.entries(n).every((e=>{let[n,i]=e;return!t.values.hasOwnProperty(n)||(0,j.Kl)(i,t.values[n])}))}_getContingentValueOptionsForField(e,t){const n=this.joinedContingentValues.slice(),i=new Map,o={code:"",name:null!==t&&void 0!==t?t:"No value"};for(const s of n){const t=s.values[e];if("code"===(null===t||void 0===t?void 0:t.objectType)||"null"===(null===t||void 0===t?void 0:t.objectType)){const{code:n,name:a}=t.codedValue&&"null"!==t.objectType?t.codedValue:o;!i.has(n)&&this._contingencyIsValid(e,s)&&i.set(n,{name:a,value:n})}}return[...i.values()]}_hashContingency(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.length<1)return["#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",!1];const i=[];let o=!1;for(const a of t){var s;const t=e.values[a];if("any"===t.objectType){if(n)return[ce,!0];o=!0,i.push("".concat(a,":.*"))}else"null"===t.objectType?i.push("".concat(a,":").concat("#JSAPI_CONTINGENT_VALUE_NULL_HASH")):i.push("".concat(a,":").concat(null===(s=t.codedValue)||void 0===s?void 0:s.code))}return[i.sort().join("&"),o]}_compareObjectTypes(e,t){return{leftIsNull:"null"===e,rightIsNull:"null"===t,bothAreNull:"null"===e&&"null"===t,leftIsAny:"any"===e,rightIsAny:"any"===t,bothAreAny:"any"===e&&"any"===t,leftIsRange:"range"===e,rightIsRange:"range"===t}}};function fe(e){return"field"===e.type||"group"===e.type||"relationship"===e.type||(he().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported","Element ".concat(e.label," has unsupported type '").concat(e.type,"'")),!1)}(0,i._)([(0,p.MZ)()],me.prototype,"_expressionInfosLookup",null),(0,i._)([(0,p.MZ)()],me.prototype,"_featureClone",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"_timeZone",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"activeRelationshipInput",null),(0,i._)([(0,p.MZ)()],me.prototype,"_arcadeContextInfo",null),(0,i._)([(0,p.MZ)()],me.prototype,"allFieldInputs",null),(0,i._)([(0,p.MZ)()],me.prototype,"allGroupInputs",null),(0,i._)([(0,p.MZ)()],me.prototype,"allRelationshipInputs",null),(0,i._)([(0,p.MZ)()],me.prototype,"_layerFieldsByName",null),(0,i._)([(0,p.MZ)()],me.prototype,"arcadeEditType",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"contingencyConstraintViolations",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"disabled",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"feature",null),(0,i._)([(0,p.MZ)()],me.prototype,"fieldsWithContingentValues",null),(0,i._)([(0,p.MZ)()],me.prototype,"fieldsWithInvalidCodedValue",null),(0,i._)([(0,p.MZ)({type:f.A})],me.prototype,"formTemplate",null),(0,i._)([(0,p.MZ)()],me.prototype,"formDescription",null),(0,i._)([(0,p.MZ)()],me.prototype,"formTitle",null),(0,i._)([(0,p.MZ)()],me.prototype,"formHeaderVisible",null),(0,i._)([(0,p.MZ)()],me.prototype,"highlightHelper",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"inputs",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"joinedContingentValues",null),(0,i._)([(0,p.MZ)()],me.prototype,"layer",null),(0,i._)([(0,p.MZ)()],me.prototype,"map",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"relatedRecordCallbacks",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"relationshipId",null),(0,i._)([(0,p.MZ)()],me.prototype,"spatialReference",null),(0,i._)([(0,p.MZ)()],me.prototype,"state",null),(0,i._)([(0,p.MZ)()],me.prototype,"strict",void 0),(0,i._)([(0,p.MZ)()],me.prototype,"submittable",null),(0,i._)([(0,p.MZ)()],me.prototype,"timeZone",null),(0,i._)([(0,p.MZ)()],me.prototype,"updating",null),(0,i._)([(0,p.MZ)()],me.prototype,"valid",null),(0,i._)([(0,p.MZ)()],me.prototype,"view",null),(0,i._)([(0,p.MZ)()],me.prototype,"getValues",null),(0,i._)([(0,p.MZ)()],me.prototype,"submit",null),me=(0,i._)([(0,h.$)(pe)],me);const ye=me}}]);
//# sourceMappingURL=90564.9eba1b75.chunk.js.map
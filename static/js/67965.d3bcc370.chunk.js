"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[67965],{64693:(e,t,i)=>{i.d(t,{A:()=>c});var a=i(35143),o=i(45802),n=i(42553),r=i(46053),l=(i(81806),i(76460),i(47249),i(85842));const s=new o.J({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"});let u=class extends n.oY{constructor(e){super(e),this.description=null,this.type=null}};(0,a._)([(0,r.MZ)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,a._)([(0,r.MZ)({type:String,json:{read:s.read,write:s.write}})],u.prototype,"type",void 0),u=(0,a._)([(0,l.$)("esri.rest.support.GPMessage")],u);const c=u},67965:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Nt});var a=i(35143),o=i(19276),n=i(53084),r=i(76460),l=i(68134),s=i(90534),u=i(46053),c=(i(81806),i(85842)),d=i(54994),p=i(45802);const h=new p.J({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),y=h.fromJSON.bind(h),m=h.toJSON.bind(h);var v=i(25329),f=i(91967);i(47249);let b=class extends f.A{constructor(e){super(e),this.state="pending",this.url=""}initialize(){this.addHandles((0,l.watch)((()=>[this.extension,this.name]),(()=>this._setFormattedFileName()),l.initial))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?"".concat(this.name,"(").concat(this.count,")").concat(this.extension):"".concat(this.name,".").concat(this.extension))}};(0,a._)([(0,u.MZ)()],b.prototype,"count",void 0),(0,a._)([(0,u.MZ)()],b.prototype,"error",void 0),(0,a._)([(0,u.MZ)()],b.prototype,"extension",void 0),(0,a._)([(0,u.MZ)()],b.prototype,"formattedName",void 0),(0,a._)([(0,u.MZ)()],b.prototype,"name",void 0),(0,a._)([(0,u.MZ)()],b.prototype,"state",void 0),(0,a._)([(0,u.MZ)()],b.prototype,"url",void 0),b=(0,a._)([(0,c.$)("esri.widgets.Print.FileLink")],b);const g=b;var w,_=i(55171),S=i(3825),T=i(18690),x=i(50076),M=i(49304),O=i(50346),I=i(65256),P=i(38042),L=i(65308),D=i(36351),C=i(40565),A=i(76797),E=i(13312);let N=w=class extends f.A{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return(0,C.PZ)(w,e)}};(0,a._)([(0,u.MZ)({type:E.A})],N.prototype,"outSpatialReference",void 0),(0,a._)([(0,u.MZ)({type:A.A})],N.prototype,"processExtent",void 0),(0,a._)([(0,u.MZ)({type:E.A})],N.prototype,"processSpatialReference",void 0),(0,a._)([(0,u.MZ)({nonNullable:!0})],N.prototype,"returnColumnName",void 0),(0,a._)([(0,u.MZ)({nonNullable:!0})],N.prototype,"returnFeatureCollection",void 0),(0,a._)([(0,u.MZ)({nonNullable:!0})],N.prototype,"returnM",void 0),(0,a._)([(0,u.MZ)({nonNullable:!0})],N.prototype,"returnZ",void 0),N=w=(0,a._)([(0,c.$)("esri.rest.geoprocessor.GPOptions")],N);const Z=N;var F=i(1438),V=i(44135),k=i(42553);let G=class extends k.oY{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};(0,a._)([(0,u.MZ)({type:A.A})],G.prototype,"extent",void 0),(0,a._)([(0,u.MZ)()],G.prototype,"height",void 0),(0,a._)([(0,u.MZ)()],G.prototype,"href",void 0),(0,a._)([(0,u.MZ)()],G.prototype,"opacity",void 0),(0,a._)([(0,u.MZ)()],G.prototype,"rotation",void 0),(0,a._)([(0,u.MZ)()],G.prototype,"scale",void 0),(0,a._)([(0,u.MZ)()],G.prototype,"visible",void 0),(0,a._)([(0,u.MZ)()],G.prototype,"width",void 0),G=(0,a._)([(0,c.$)("esri.layer.support.MapImage")],G);const K=G;let R=class extends k.oY{constructor(e){super(e),this.itemId=null,this.url=null}};(0,a._)([(0,u.MZ)({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],R.prototype,"itemId",void 0),(0,a._)([(0,u.MZ)({type:String,json:{write:!0}})],R.prototype,"url",void 0),R=(0,a._)([(0,c.$)("esri.rest.support.DataFile")],R);const J=R;var j=i(77725);const U=new p.J({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1});let B=class extends k.oY{constructor(e){super(e),this.distance=0,this.units=null}};(0,a._)([(0,u.MZ)({json:{write:!0}})],B.prototype,"distance",void 0),(0,a._)([(0,u.MZ)({json:{read:U.read,write:U.write}})],B.prototype,"units",void 0),B=(0,a._)([(0,c.$)("esri.rest.support.LinearUnit")],B);const z=B;var q=i(6409);const $=new p.J({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPBoolean":"multi-value-boolean","GPMultiValue:GPDataFile":"multi-value-data-file","GPMultiValue:GPDate":"multi-value-date","GPMultiValue:GPDouble":"multi-value-double","GPMultiValue:GPFeatureRecordSetLayer":"multi-value-feature-record-set-layer","GPMultiValue:Field":"multi-value-field","GPMultiValue:GPLinearUnit":"multi-value-linear-unit","GPMultiValue:GPLong":"multi-value-long","GPMultiValue:GPRasterData":"multi-value-raster-data","GPMultiValue:GPRasterDataLayer":"multi-value-raster-data-layer","GPMultiValue:GPRecordSet":"multi-value-record-set","GPMultiValue:GPString":"multi-value-string"});let W=class extends k.oY{constructor(e){super(e),this.dataType=null,this.paramName=null,this.value=null}};(0,a._)([(0,q.e)($,{ignoreUnknown:!1})],W.prototype,"dataType",void 0),(0,a._)([(0,u.MZ)()],W.prototype,"paramName",void 0),(0,a._)([(0,u.MZ)()],W.prototype,"value",void 0),W=(0,a._)([(0,c.$)("esri.rest.support.ParameterValue")],W);const Y=W;let H=class extends k.oY{constructor(e){super(e),this.format=null,this.itemId=null,this.url=null}};(0,a._)([(0,u.MZ)()],H.prototype,"format",void 0),(0,a._)([(0,u.MZ)({json:{read:{source:"itemID"},write:{target:"itemID"}}})],H.prototype,"itemId",void 0),(0,a._)([(0,u.MZ)()],H.prototype,"url",void 0),H=(0,a._)([(0,c.$)("esri.rest.support.RasterData")],H);const Q=H;async function X(e,t,i,a,o){const n={},r={},l=[];return function(e,t,i){for(const a in e){const o=e[a];if(o&&"object"==typeof o&&o instanceof j.A){const{features:e}=o;i[a]=[t.length,t.length+e.length],e.forEach((e=>{t.push(e.geometry)}))}}}(a,l,n),(0,F.el)(l).then((l=>{const{outSpatialReference:s,processExtent:u,processSpatialReference:c,returnColumnName:p,returnFeatureCollection:h,returnM:y,returnZ:m}=i,{path:v}=(0,d.Dl)(e);for(const e in n){const[t,i]=n[e];r[e]=l.slice(t,i)}const f=s?s.wkid||s:null,b=c?c.wkid||c:null,g="execute"===t?{returnColumnName:p||void 0,returnFeatureCollection:h||void 0,returnM:y||void 0,returnZ:m||void 0}:null,w=te({...u?{context:{extent:u,outSR:f,processSR:b}}:{"env:outSR":f,"env:processSR":b},...a,...g,f:"json"},null,r),_={...o,query:w};return(0,S.A)("".concat(v,"/").concat(t),_)}))}function ee(e){const t=e.dataType,i=Y.fromJSON(e);switch(t){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return i;case"GPDate":i.value=new Date(i.value);break;case"GPDataFile":i.value=J.fromJSON(i.value);break;case"GPLinearUnit":i.value=z.fromJSON(i.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const t=e.value.url;i.value=t?J.fromJSON(i.value):j.A.fromJSON(i.value);break}case"GPRasterData":case"GPRasterDataLayer":{const t=e.value.mapImage;i.value=t?K.fromJSON(t):Q.fromJSON(i.value);break}case"Field":i.value=V.A.fromJSON(i.value);break;case"GPValueTable":break;case"GPMultiValue:GPDate":i.value=i.value.map((e=>new Date(e)));break;case"GPMultiValue:GPDataFile":i.value=i.value.map((e=>J.fromJSON(e)));break;case"GPMultiValue:GPLinearUnit":i.value=i.value.map((e=>z.fromJSON(e)));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":i.value=i.value.map((e=>j.A.fromJSON(e)));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":i.value=i.value.map((e=>e?K.fromJSON(e):Q.fromJSON(i.value)));break;case"GPMultiValue:Field":i.value=i.value.map((e=>V.A.fromJSON(e)))}return i}function te(e,t,i){for(const a in e){const t=e[a];Array.isArray(t)?e[a]=JSON.stringify(t.map((e=>te({item:e},!0).item))):t instanceof Date&&(e[a]=t.getTime())}return(0,d.lF)(e,t,i)}var ie=i(64693);async function ae(e,t,i,a){return X(e,"execute",i=Z.from(i||{}),null!==t&&void 0!==t?t:{},a).then((e=>{var t,i,a,o;let{data:n}=e;return{results:null!==(t=null===(i=n.results)||void 0===i?void 0:i.map(ee))&&void 0!==t?t:[],messages:null!==(a=null===(o=n.messages)||void 0===o?void 0:o.map((e=>ie.A.fromJSON(e))))&&void 0!==a?a:[]}}))}i(86560);var oe,ne=i(65215);i(23701),i(73548),i(80963),i(14556),i(35238),i(89189),i(66388),i(13904);const re=(0,p.O)()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});let le=oe=class extends k.oY{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._timer=void 0}async cancelJob(e){const{jobId:t,sourceUrl:i}=this,{path:a}=(0,d.Dl)(i),o={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer();const n="".concat(a,"/jobs/").concat(t,"/cancel"),{data:r}=await(0,S.A)(n,o),{messages:l,jobStatus:s,progress:u}=oe.fromJSON(r);return this.set({messages:l,jobStatus:s,progress:u}),this}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const{path:t}=(0,d.Dl)(this.sourceUrl),i={...this.requestOptions,...e,query:{f:"json"}},a="".concat(t,"/jobs/").concat(this.jobId),{data:o}=await(0,S.A)(a,i),{messages:n,jobStatus:r,progress:l}=oe.fromJSON(o);return this.set({messages:n,jobStatus:r,progress:l}),this}async fetchResultData(e,t,i){t=Z.from(t||{});const{returnColumnName:a,returnFeatureCollection:o,returnM:n,returnZ:r,outSpatialReference:l}=t,{path:s}=(0,d.Dl)(this.sourceUrl),u=te({returnColumnName:a||null,returnFeatureCollection:o||null,returnM:n||null,returnZ:r||null,outSR:l,returnType:"data",f:"json"},null),c={...this.requestOptions,...i,query:u},p="".concat(s,"/jobs/").concat(this.jobId,"/results/").concat(e),{data:h}=await(0,S.A)(p,c);return ee(h)}async fetchResultImage(e,t,i){const{path:a}=(0,d.Dl)(this.sourceUrl),o=te({...t.toJSON(),f:"json"}),n={...this.requestOptions,...i,query:o},r="".concat(a,"/jobs/").concat(this.jobId,"/results/").concat(e),{data:l}=await(0,S.A)(r,n);return ee(l)}async fetchResultMapImageLayer(){const{path:e}=(0,d.Dl)(this.sourceUrl),t=e.indexOf("/GPServer/"),a="".concat(e.substring(0,t),"/MapServer/jobs/").concat(this.jobId);return new(0,(await Promise.resolve().then(i.bind(i,82951))).default)({url:a})}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,signal:i,statusCallback:a}=e;return new Promise(((e,o)=>{(0,O.u7)(i,(()=>{this._clearTimer(),o((0,O.NK)())})),this._clearTimer();const n=setInterval((()=>{this._timer||o((0,O.NK)()),this.checkJobStatus(this.requestOptions).then((t=>{const{jobStatus:i}=t;switch(this.jobStatus=i,i){case"job-succeeded":this._clearTimer(),e(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":a&&a(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),o(this)}}))}),t);this._timer=n}))}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};(0,a._)([(0,u.MZ)()],le.prototype,"jobId",void 0),(0,a._)([(0,q.e)(re,{ignoreUnknown:!1})],le.prototype,"jobStatus",void 0),(0,a._)([(0,u.MZ)({type:[ie.A]})],le.prototype,"messages",void 0),(0,a._)([(0,u.MZ)()],le.prototype,"progress",void 0),(0,a._)([(0,u.MZ)()],le.prototype,"requestOptions",void 0),(0,a._)([(0,u.MZ)({json:{write:!0}})],le.prototype,"sourceUrl",void 0),le=oe=(0,a._)([(0,c.$)("esri.rest.support.JobInfo")],le);const se=le;var ue=i(76931),ce=i(53430),de=i(46530),pe=i(15492);const he=new p.J({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),ye=he.fromJSON.bind(he),me=he.toJSON.bind(he),ve="simple-marker",fe="picture-marker",be="simple-line",ge="simple-fill",we="shield-label-symbol",_e="text";function Se(e,t){const{graphic:i,renderer:a,symbol:o}=t,n=o.type;if(n===_e||n===we||!("visualVariables"in a)||!a.visualVariables)return;const r=a.getVisualVariablesForType("size"),l=a.getVisualVariablesForType("color"),s=a.getVisualVariablesForType("opacity"),u=a.getVisualVariablesForType("rotation"),c=r[0],d=l[0],p=s[0],h=u[0];if(c){const t=n===ve?o.style:null,a=(0,pe.getSize)(c,i,{shape:t});null!=a&&(n===ve?e.size=(0,ue.PN)(a):n===fe?(e.width=(0,ue.PN)(a),e.height=(0,ue.PN)(a)):n===be?e.width=(0,ue.PN)(a):e.outline&&(e.outline.width=(0,ue.PN)(a)))}if(d){const t=(0,pe.getColor)(d,i);(t&&n===ve||n===be||n===ge)&&(e.color=t?t.toJSON():void 0)}if(p){const t=(0,pe.getOpacity)(p,i);null!=t&&e.color&&(e.color[3]=Math.round(255*t))}h&&(e.angle=-(0,pe.getRotationAngle)(a,i))}function Te(e){return"bing-maps"===(null===e||void 0===e?void 0:e.type)}function xe(e){return e&&"blendMode"in e&&"effect"in e}function Me(e){return"csv"===(null===e||void 0===e?void 0:e.type)}function Oe(e){return"esri.views.2d.layers.GroupLayerView2D"===(null===e||void 0===e?void 0:e.declaredClass)}function Ie(e){const t=e.layer;if(xe(t)){const i=t.blendMode;if((!i||"normal"===i)&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}var Pe=i(70652);let Le=class extends f.A{constructor(e){super(e),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};(0,a._)([(0,u.MZ)()],Le.prototype,"attributionVisible",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"exportOptions",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"forceFeatureAttributes",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"format",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"includeCharts",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"includeTables",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"label",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"layout",void 0),(0,a._)([(0,u.MZ)({type:Pe.default})],Le.prototype,"layoutItem",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"layoutOptions",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"outScale",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"report",void 0),(0,a._)([(0,u.MZ)({type:Pe.default})],Le.prototype,"reportItem",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"reportOptions",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"scalePreserved",void 0),(0,a._)([(0,u.MZ)()],Le.prototype,"showLabels",void 0),Le=(0,a._)([(0,c.$)("esri.rest.support.PrintTemplate")],Le);const De=Le,Ce=new p.J({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"}),Ae=(Ce.fromJSON.bind(Ce),Ce.toJSON.bind(Ce)),Ee={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},Ne=new p.J({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Ze=new p.J({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Fe=new Map;async function Ve(e,t,i){const a=ke(e);let o=Fe.get(a);return Promise.resolve().then((()=>o?{data:o.gpMetadata}:(o={gpServerUrl:a,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},(0,S.A)(a,(0,d.jV)({f:"json"},i))))).then((e=>(o.gpMetadata=e.data,o.cimVersion=o.gpMetadata.cimVersion,o.is11xService=!!o.cimVersion,Fe.set(a,o),async function(e,t){t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const i=e.template||new De;null==i.showLabels&&(i.showLabels=!0);const a=i.exportOptions;let o;const n=me(i.layout);if(a&&(o={dpi:a.dpi},"map_only"===n.toLowerCase()||""===n)){const e=a.width,t=a.height;o.outputSize=null!=e&&null!=t?[e,t]:void 0}const r=i.layoutOptions;let l;if(r){let e,t;"Miles"===r.scalebarUnit||"Kilometers"===r.scalebarUnit?(e="Kilometers",t="Miles"):"Meters"!==r.scalebarUnit&&"Feet"!==r.scalebarUnit||(e="Meters",t="Feet"),l={titleText:r.titleText,authorText:r.authorText,copyrightText:r.copyrightText,customTextElements:r.customTextElements,elementOverrides:r.elementOverrides,scaleBarOptions:{metricUnit:Ne.toJSON(e),metricLabel:e?Ee[e]:void 0,nonMetricUnit:Ne.toJSON(t),nonMetricLabel:t?Ee[t]:void 0}}}let s=null;(null===r||void 0===r?void 0:r.legendLayers)&&(s=r.legendLayers.map((e=>{const i=e.layerId;t.legendLayerNameMap[i]=e.title;const a={id:i};return e.subLayerIds&&(a.subLayerIds=e.subLayerIds),a})));const u=await async function(e,t,i){const a=e.view;let o=a.spatialReference;const n={operationalLayers:await Ge(a,t,i)};t.includeTables&&(n.tables=await async function(e){const t=[],i=[];for(const r of e.map.allTables)"feature"!==r.type||r.loaded||i.push(r.load());i.length&&await Promise.allSettled(i);for(const r of e.map.allTables){var a;if("feature"===r.type&&r.loaded&&r.isTable&&"feature-layer"===(null===(a=r.source)||void 0===a?void 0:a.type)){var o;const e={id:(n=r.write()).id,title:n.title,customParameters:n.customParameters,layerDefinition:{definitionExpression:null===(o=n.layerDefinition)||void 0===o?void 0:o.definitionExpression},url:n.url};ot(e,r),t.push(e)}}var n;return t.length?t:void 0}(a));let r=i.ssExtent||e.extent||a.extent;if(o&&o.isWrappable&&(r=r.clone()._normalize(!0),o=r.spatialReference),n.mapOptions={extent:r&&r.toJSON(),spatialReference:o&&o.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,a.background&&(n.background=a.background.toJSON()),a.rotation&&(n.mapOptions.rotation=-a.rotation),t.scalePreserved&&(n.mapOptions.scale=t.outScale||a.scale),null!=a.timeExtent){const e=null!=a.timeExtent.start?a.timeExtent.start.getTime():null,t=null!=a.timeExtent.end?a.timeExtent.end.getTime():null;n.mapOptions.time=[e,t]}return t.reportOptions&&(n.reportOptions=t.reportOptions),n}(e,i,t);if(u.operationalLayers){const e=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),i=/[\u0600-\u06FF]/,a=t=>{var a;const o=t.text,n=t.font,r=null===n||void 0===n||null===(a=n.family)||void 0===a?void 0:a.toLowerCase();o&&n&&("arial"===r||"arial unicode ms"===r)&&(n.family=e.test(o)?"Arial Unicode MS":"Arial","normal"!==n.style&&i.test(o)&&(n.family="Arial Unicode MS"))},o=()=>{throw new x.A("print:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};for(const n of u.operationalLayers){var c,d;if(null!==(c=n.featureCollection)&&void 0!==c&&c.layers)for(const e of n.featureCollection.layers){var p,h;if(null!==(p=e.layerDefinition)&&void 0!==p&&null!==(p=p.drawingInfo)&&void 0!==p&&null!==(p=p.renderer)&&void 0!==p&&p.symbol){const i=e.layerDefinition.drawingInfo.renderer;"esriTS"===i.symbol.type?a(i.symbol):"CIMSymbolReference"!==i.symbol.type||t.is11xService||o()}if(null!==(h=e.featureSet)&&void 0!==h&&h.features)for(const i of e.featureSet.features)i.symbol&&("esriTS"===i.symbol.type?a(i.symbol):"CIMSymbolReference"!==i.symbol.type||t.is11xService||o())}else!t.is11xService&&(null===(d=n.layerDefinition)||void 0===d||null===(d=d.drawingInfo)||void 0===d?void 0:d.renderer)&&JSON.stringify(n.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&o()}}e.outSpatialReference&&(u.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(u,{exportOptions:o,layoutOptions:l||{}}),Object.assign(u.layoutOptions,{legendOptions:{operationalLayers:null!=s?s:t.legendLayers.slice()}}),t.legendLayers.length=0,Fe.set(t.gpServerUrl,t);const y={Web_Map_as_JSON:JSON.stringify(u),Format:m(i.format),Layout_Template:n,Layout_Item_ID:void 0,Report_Template:Ae(i.report),Report_Item_ID:void 0};if(i.layoutItem){delete y.Layout_Template;const e=i.layoutItem;await e.load(),"public"!==e.access&&_.id&&await _.id.getCredential(t.gpServerUrl),y.Layout_Item_ID=JSON.stringify({id:e.id})}if(i.reportItem){delete y.Report_Template;const e=i.reportItem;await e.load(),"public"!==e.access&&_.id&&await _.id.getCredential(t.gpServerUrl),y.Report_Item_ID=JSON.stringify({id:e.id})}return e.extraParameters&&Object.assign(y,e.extraParameters),y}(t,o)))).then((a=>{const n=st(o);let r;const l=e=>{var t;return"sync"===n?null===(t=e.results)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.value:r.fetchResultData("Output_File",null,i).then((e=>e.value))};return"async"===n?async function(e,t,i,a){return i=Z.from(i||{}),X(e,"submitJob",i,null!==t&&void 0!==t?t:{},a).then((t=>{let{data:i}=t;const a=se.fromJSON(i);return a.sourceUrl=e,a}))}(e,a,void 0,i).then((e=>(r=e,e.waitForJobCompletion({interval:t.updateDelay}).then(l)))):ae(e,a,void 0,i).then(l)}))}function ke(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}async function Ge(e,t,i){var a;const o=[],n={layerView:null,printTemplate:t,view:e};let r=0;t.scalePreserved&&(r=t.outScale||e.scale);const l=function(e,t){const i=e.allLayerViews.items;if(t===e.scale)return i.filter((e=>!e.suspended));const a=new Array;for(const o of i)Oe(o.parent)&&!a.includes(o.parent)||!o.visible||t&&"isVisibleAtScale"in o&&!o.isVisibleAtScale(t)||a.push(o);return a}(e,r);for(const s of l){const e=s.layer;if(!e.loaded||"group"===(null===e||void 0===e?void 0:e.type))continue;let t;n.layerView=s,t=Ie(s)?await He(e,n,i):Te(e)?Ke(e):Me(e)?await Re(e,n,i):"feature"===(null===e||void 0===e?void 0:e.type)?await je(e,n,i):"geojson"===(null===e||void 0===e?void 0:e.type)?await Ue(e,n,i):"graphics"===(null===e||void 0===e?void 0:e.type)?await Be(e,n,i):"imagery"===(null===e||void 0===e?void 0:e.type)?ze(e,i):"imagery-tile"===(null===e||void 0===e?void 0:e.type)?await qe(e,n,i):"kml"===(null===e||void 0===e?void 0:e.type)?await $e(e,n,i):"map-image"===(null===e||void 0===e?void 0:e.type)?We(e,n,i):"map-notes"===(null===e||void 0===e?void 0:e.type)?await Ye(n,i):"open-street-map"===(null===e||void 0===e?void 0:e.type)?{type:"OpenStreetMap"}:"stream"===(null===e||void 0===e?void 0:e.type)?await Qe(e,n,i):"tile"===(null===e||void 0===e?void 0:e.type)?Xe(e,i):"vector-tile"===(null===e||void 0===e?void 0:e.type)?await et(e,n,i):"web-tile"===(null===e||void 0===e?void 0:e.type)?tt(e):"wms"===(null===e||void 0===e?void 0:e.type)?it(e,i):"wmts"===(null===e||void 0===e?void 0:e.type)?at(e):await He(e,n,i),t&&(Array.isArray(t)?o.push(...t):(t.id=e.id,t.title=i.legendLayerNameMap[e.id]||e.title,t.opacity=s.fullOpacity,t.minScale=e.minScale||0,t.maxScale=e.maxScale||0,xe(e)&&e.blendMode&&"normal"!==e.blendMode&&(t.blendMode=e.blendMode),o.push(t)))}if(r)for(const s of o)s.minScale=0,s.maxScale=0;if(null!==(a=e.graphics)&&void 0!==a&&a.length){const a=await Je(null,e.graphics,t,i);a&&o.push(a)}return o}function Ke(e){return{culture:e.culture,key:e.key,type:"BingMaps"+("aerial"===e.style?"Aerial":"hybrid"===e.style?"Hybrid":"Road")}}async function Re(e,t,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const a=t.layerView,o=t.printTemplate;let n;return!i.is11xService||a.filter||e.portalItem&&"public"!==e.portalItem.access?Je(e,await lt(a),o,i):(n={type:"CSV"},e.write(n,{origin:"web-map"}),delete n.popupInfo,delete n.layerType,n.showLabels=o.showLabels&&e.labelsVisible,n)}async function Je(e,t,i,a){var o;let n;const r={layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}},l={layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}},s={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}},u={layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}},c={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}};if(c.layerDefinition.name="textLayer",delete c.layerDefinition.drawingInfo,e){if("esri.layers.FeatureLayer"===e.declaredClass||"esri.layers.StreamLayer"===e.declaredClass?r.layerDefinition.name=l.layerDefinition.name=s.layerDefinition.name=u.layerDefinition.name=a.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:"esri.layers.GraphicsLayer"===e.declaredClass&&(t=e.graphics.items),e.renderer){const t=e.renderer.toJSON(),i=r.layerDefinition.drawingInfo;i&&(i.renderer=t);const a=l.layerDefinition.drawingInfo;a&&(a.renderer=t);const o=s.layerDefinition.drawingInfo;o&&(o.renderer=t);const n=u.layerDefinition.drawingInfo;n&&(n.renderer=t)}if(i.showLabels&&e.labelsVisible&&"function"==typeof e.write){var d;const t=null===(d=e.write({},{origin:"web-map"}).layerDefinition)||void 0===d||null===(d=d.drawingInfo)||void 0===d?void 0:d.labelingInfo;if(t){n=!0;const e=r.layerDefinition.drawingInfo;e&&(e.labelingInfo=t);const i=l.layerDefinition.drawingInfo;i&&(i.labelingInfo=t);const a=s.layerDefinition.drawingInfo;a&&(a.labelingInfo=t);const o=u.layerDefinition.drawingInfo;o&&(o.labelingInfo=t)}}}let p;(null===e||void 0===e?void 0:e.renderer)||n||(delete r.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo);const h=null===e||void 0===e?void 0:e.fieldsIndex,y=null===e||void 0===e?void 0:e.renderer;if(h){const t=new Set;n&&await(0,ce.Im)(t,e),y&&"function"==typeof y.collectRequiredFields&&await y.collectRequiredFields(t,h),p=Array.from(t);const i=h.fields.map((e=>e.toJSON()));r.layerDefinition.fields=i,l.layerDefinition.fields=i,s.layerDefinition.fields=i,u.layerDefinition.fields=i}const m=null===(o=t)||void 0===o?void 0:o.length;let v;for(let M=0;M<m;M++){var f,b,g,w,_;const o=t[M]||t.at(M);if(!1===o.visible||!o.geometry)continue;if(v=o.toJSON(),v.hasOwnProperty("popupTemplate")&&delete v.popupTemplate,null!==(f=v.geometry)&&void 0!==f&&f.z&&delete v.geometry.z,null!==(b=v.symbol)&&void 0!==b&&b.outline&&"esriCLS"===v.symbol.outline.type&&!a.is11xService)continue;!a.is11xService&&(null===(g=v.symbol)||void 0===g||null===(g=g.outline)||void 0===g||null===(g=g.color)||void 0===g?void 0:g[3])&&(v.symbol.outline.color[3]=255);const n=(null===e||void 0===e?void 0:e.renderer)&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!v.symbol&&null!==e&&void 0!==e&&e.renderer&&n&&!a.is11xService){const t=e.renderer,i=await t.getSymbolAsync(o);if(!i)continue;v.symbol=i.toJSON(),"hasVisualVariables"in t&&t.hasVisualVariables()&&Se(v.symbol,{renderer:t,graphic:o,symbol:i})}if(v.symbol&&(v.symbol.angle||delete v.symbol.angle,ut(v.symbol)?v.symbol=await nt(v.symbol,a):v.symbol.text&&delete v.attributes),(!i||!i.forceFeatureAttributes)&&null!==(w=p)&&void 0!==w&&w.length){const e={};for(const t of p){var S;(null===(S=v.attributes)||void 0===S?void 0:S.hasOwnProperty(t))&&(e[t]=v.attributes[t])}v.attributes=e}"polygon"===o.geometry.type?r.featureSet.features.push(v):"polyline"===o.geometry.type?l.featureSet.features.push(v):"point"===o.geometry.type?null!==(_=v.symbol)&&void 0!==_&&_.text?c.featureSet.features.push(v):s.featureSet.features.push(v):"multipoint"===o.geometry.type?u.featureSet.features.push(v):"extent"===o.geometry.type&&(v.geometry=ne.A.fromExtent(o.geometry).toJSON(),r.featureSet.features.push(v))}const T=[r,l,u,s,c].filter((e=>e.featureSet.features.length>0));for(const M of T){var x;const e=M.featureSet.features.every((e=>e.symbol));if(e&&(!i||!i.forceFeatureAttributes))for(const t of M.featureSet.features)delete t.attributes;e&&delete M.layerDefinition.drawingInfo,(null===(x=M.layerDefinition.drawingInfo)||void 0===x?void 0:x.renderer)&&await rt(M.layerDefinition.drawingInfo.renderer,a)}return T.length?{featureCollection:{layers:T},showLabels:n}:null}async function je(e,t,i){var a,o,n,r;let l;const s=e.renderer,u=parseFloat(i.cimVersion);if("binning"===(null===(a=e.featureReduction)||void 0===a?void 0:a.type)||"cluster"===(null===(o=e.featureReduction)||void 0===o?void 0:o.type)&&(!i.is11xService||u<2.9)||"pie-chart"===(null===s||void 0===s?void 0:s.type)||"dot-density"===(null===s||void 0===s?void 0:s.type)&&(!i.is11xService||u<2.6))return He(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const c=t.layerView,{printTemplate:d,view:p}=t,h=s&&("valueExpression"in s&&s.valueExpression||"hasVisualVariables"in s&&s.hasVisualVariables()),y="feature-layer"!==(null===(n=e.source)||void 0===n?void 0:n.type)&&"ogc-feature"!==(null===(r=e.source)||void 0===r?void 0:r.type);if(!i.is11xService&&h||c.filter||y||!s||"field"in s&&null!=s.field&&("string"!=typeof s.field||!e.getField(s.field))){const t=await lt(c);l=await Je(e,t,d,i)}else{var m,v;if(l={id:(f=e.write()).id,title:f.title,url:f.url,layerType:f.layerType,customParameters:f.customParameters,layerDefinition:f.layerDefinition,charts:d.includeCharts?f.charts:void 0},l.showLabels=d.showLabels&&e.labelsVisible,ot(l,e),null!==(m=l.layerDefinition)&&void 0!==m&&null!==(m=m.drawingInfo)&&void 0!==m&&m.renderer&&(delete l.layerDefinition.minScale,delete l.layerDefinition.maxScale,await rt(l.layerDefinition.drawingInfo.renderer,i),"visualVariables"in s&&s.visualVariables&&s.visualVariables[0])){const e=s.visualVariables[0];if("size"===e.type&&e.maxSize&&"number"!=typeof e.maxSize&&e.minSize&&"number"!=typeof e.minSize){const t=(0,pe.getSizeRangeAtScale)(e,p.scale);l.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=t.minSize,l.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=t.maxSize}}const t=(0,de.E)(c);if(t&&(l.layerDefinition||(l.layerDefinition={}),l.layerDefinition.definitionExpression=l.layerDefinition.definitionExpression?"(".concat(l.layerDefinition.definitionExpression,") AND (").concat(t,")"):t),null!==(v=c.hasHighlight)&&void 0!==v&&v.call(c)&&"getHighlightIds"in c){const e=c;l.selectionObjectIds=e.getHighlightIds()}}var f;return l}async function Ue(e,t,i){var a,o;return"binning"===(null===(a=e.featureReduction)||void 0===a?void 0:a.type)||"cluster"===(null===(o=e.featureReduction)||void 0===o?void 0:o.type)?He(e,t,i):(e.legendEnabled&&i.legendLayers.push({id:e.id}),Je(e,await lt(t.layerView),t.printTemplate,i))}async function Be(e,t,i){let{printTemplate:a}=t;return Je(e,null,a,i)}function ze(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=e.write()).layerType,customParameters:a.customParameters};var a;if(i.bandIds=e.bandIds,i.compressionQuality=e.compressionQuality,i.format=e.format,i.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction||e.renderer)if(t.is11xService)e.rasterFunction&&(i.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(i.layerDefinition=i.layerDefinition||{},i.layerDefinition.drawingInfo=i.layerDefinition.drawingInfo||{},i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const t=e.exportImageServiceParameters.combineRendererWithRenderingRule();t&&(i.renderingRule=t.toJSON())}return ot(i,e),i}async function qe(e,t,i){var a;if("flow"===(null===(a=e.renderer)||void 0===a?void 0:a.type))return He(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const o={bandIds:(n=e.write()||{}).bandIds,customParameters:n.customParameters,interpolation:n.interpolation,layerDefinition:n.layerDefinition};var n;return o.layerType="ArcGISImageServiceLayer",ot(o,e),o}async function $e(e,t,i){const a=t.printTemplate;if(i.is11xService){const t={type:"kml"};return e.write(t,{origin:"web-map"}),delete t.layerType,t.url=(0,s.S8)(e.url),t}const o=[],n=t.layerView;n.allVisibleMapImages.forEach(((t,i)=>{const a={id:"".concat(e.id,"_image").concat(i),type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:n.fullOpacity,extent:t.extent};"data:image/png;base64,"===t.href.substr(0,22)?a.imageData=t.href.substr(22):a.url=t.href,o.push(a)}));const r=[...n.allVisiblePoints.items,...n.allVisiblePolylines.items,...n.allVisiblePolygons.items],l={id:e.id,...await Je(null,r,a,i)};return o.push(l),o}function We(e,t,i){var a;let o,{view:n}=t;const r={id:e.id,subLayerIds:[]};let l=[];const s=n.scale,u=e=>{const t=0===s,i=0===e.minScale||s<=e.minScale,a=0===e.maxScale||s>=e.maxScale;if(e.visible&&(t||i&&a))if(e.sublayers)e.sublayers.forEach(u);else{const t=e.toExportImageJSON(),i={id:e.id,name:e.title,layerDefinition:{drawingInfo:t.drawingInfo,definitionExpression:t.definitionExpression,source:t.source}};l.unshift(i),r.subLayerIds.push(e.id)}};var c;return e.sublayers&&e.sublayers.forEach(u),l.length&&(l=l.map((e=>{let{id:t,name:i,layerDefinition:a}=e;return{id:t,name:i,layerDefinition:a}})),o={layerType:(c=e.write()).layerType,customParameters:c.customParameters},o.layers=l,o.visibleLayers=null!==(a=e.capabilities)&&void 0!==a&&null!==(a=a.exportMap)&&void 0!==a&&a.supportsDynamicLayers?void 0:r.subLayerIds,ot(o,e),e.legendEnabled&&i.legendLayers.push(r)),o}async function Ye(e,t){let{layerView:i,printTemplate:a}=e;const o=[],n=i.layer;if(null!=n.featureCollections)for(const r of n.featureCollections){const e=await Je(r,r.source,a,t);e&&o.push(...e.featureCollection.layers)}else if(null!=n.sublayers)for(const r of n.sublayers){const e=await Je(null,r.graphics,a,t);e&&o.push(...e.featureCollection.layers)}return{featureCollection:{layers:o}}}async function He(e,t,i){var a;let{printTemplate:o,view:n}=t;const r={type:"image"},l={format:"png",ignoreBackground:!0,layers:[e]};0!==n.rotation&&(l.rotation=0);const u=i.ssExtent||n.extent.clone();let c=96,d=!0,p=!0;if(o.exportOptions){const e=o.exportOptions;null!=e.dpi&&e.dpi>0&&(c=e.dpi),null!=e.width&&e.width>0&&(d=e.width%2==n.width%2),null!=e.height&&e.height>0&&(p=e.height%2==n.height%2)}if("map-only"===o.layout&&o.scalePreserved&&(!o.outScale||o.outScale===n.scale)&&96===c&&(!d||!p)&&(l.area={x:0,y:0,width:n.width,height:n.height},d||(l.area.width-=1),p||(l.area.height-=1),!i.ssExtent)){const e=n.toMap((0,ue.tc)(l.area.width,l.area.height));u.ymin=e.y,u.xmax=e.x,i.ssExtent=u}r.extent=u.clone()._normalize(!0).toJSON();const h=await n.takeScreenshot(l);return r.imageData=null===(a=(0,s.r$)(h.dataUrl))||void 0===a?void 0:a.data,r}async function Qe(e,t,i){let{layerView:a,printTemplate:o}=t;return e.legendEnabled&&i.legendLayers.push({id:e.id}),Je(e,await lt(a),o,i)}function Xe(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(a=e.write()).layerType,customParameters:a.customParameters};var a;return ot(i,e),i}async function et(e,t,i){if(i.is11xService&&e.serviceUrl&&e.styleUrl){const t=(0,d.gf)(e.styleUrl,e.apiKey),a=(0,d.gf)(e.serviceUrl,e.apiKey);if(!t&&!a||"2.1.0"!==i.cimVersion){const i={type:"VectorTileLayer"};return i.styleUrl=(0,s.S8)(e.styleUrl),i.token=t,a!==t&&(i.additionalTokens=[{url:e.serviceUrl,token:a}]),i}}return He(e,t,i)}function tt(e){var t;const i={type:"WebTiledLayer",urlTemplate:null===(t=e.urlTemplate)||void 0===t?void 0:t.replace(/\${/g,"{"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(i.subDomains=e.subDomains),i}function it(e,t){let i;const a=[],o=e=>{e.visible&&(e.sublayers?e.sublayers.forEach(o):e.name&&a.unshift(e.name))};return e.sublayers&&e.sublayers.forEach(o),a.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:a}),i={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:a,url:(0,s.S8)(e.url),version:e.version}),i}function at(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:(0,s.S8)(e.url)}}function ot(e,t){t.url&&(e.url=(0,s.S8)(e.url||t.url),e.token=(0,d.gf)(e.url,t.apiKey))}async function nt(e,t){t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const a=t.canvas.getContext("2d");let o,n;if(e.path){var r;const t=new Path2D(e.path);t.closePath(),a.fillStyle=Array.isArray(e.color)?"rgba(".concat(e.color[0],",").concat(e.color[1],",").concat(e.color[2],",").concat(e.color[3]/255,")"):"rgb(0,0,0)",a.fill(t);const l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;const i=e.canvas.width,a=e.canvas.height,o=e.getImageData(0,0,i,a).data;let n,r,l,s,u,c;e:for(r=a;r--;)for(n=i;n--;)if(o[4*(i*r+n)+3]>t){c=r;break e}if(!c)return null;e:for(n=i;n--;)for(r=c+1;r--;)if(o[4*(i*r+n)+3]>t){u=n;break e}e:for(n=0;n<=u;++n)for(r=c+1;r--;)if(o[4*(i*r+n)+3]>t){l=n;break e}e:for(r=0;r<=c;++r)for(n=l;n<=u;++n)if(o[4*(i*r+n)+3]>t){s=r;break e}return{x:l,y:s,width:u-l,height:c-s}}(a);if(!l)return null;a.clearRect(0,0,i,i);const s=(0,ue.Lz)(e.size)/Math.max(l.width,l.height);a.scale(s,s);const u=i/s,c=u/2-l.width/2-l.x,d=u/2-l.height/2-l.y;if(a.translate(c,d),Array.isArray(e.color)&&a.fill(t),null!==(r=e.outline)&&void 0!==r&&r.width&&Array.isArray(e.outline.color)){const i=e.outline;a.lineWidth=(0,ue.Lz)(i.width)/s,a.lineJoin="round",a.strokeStyle="rgba(".concat(i.color[0],",").concat(i.color[1],",").concat(i.color[2],",").concat(i.color[3]/255,")"),a.stroke(t),l.width+=a.lineWidth,l.height+=a.lineWidth}l.width*=s,l.height*=s;const p=a.getImageData(512-l.width/2,512-l.height/2,Math.ceil(l.width),Math.ceil(l.height));o=p.width,n=p.height,a.canvas.width=o,a.canvas.height=n,a.putImageData(p,0,0)}else{const t="image/svg+xml"===e.contentType?"data:image/svg+xml;base64,"+e.imageData:e.url,i=(await(0,S.A)(t,{responseType:"image"})).data;o=(0,ue.Lz)(e.width),n=(0,ue.Lz)(e.height),a.canvas.width=o,a.canvas.height=n,a.drawImage(i,0,0,a.canvas.width,a.canvas.height)}return{type:"esriPMS",imageData:a.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:(0,ue.PN)(n),width:(0,ue.PN)(o),xoffset:e.xoffset,yoffset:e.yoffset}}async function rt(e,t){const i=e.type;if("simple"===i&&ut(e.symbol))e.symbol=await nt(e.symbol,t);else if("uniqueValue"===i||"classBreaks"===i){ut(e.defaultSymbol)&&(e.defaultSymbol=await nt(e.defaultSymbol,t));const a=e["uniqueValue"===i?"uniqueValueInfos":"classBreakInfos"];if(a)for(const e of a)ut(e.symbol)&&(e.symbol=await nt(e.symbol,t))}}async function lt(e){return e.queryFeatures(e.createQuery()).then((e=>e.features))}function st(e){var t;return null!==(t=e.gpMetadata)&&void 0!==t&&t.executionType?Ze.fromJSON(e.gpMetadata.executionType):"sync"}function ut(e){var t;return e&&(e.path||"image/svg+xml"===e.contentType||(null===(t=e.url)||void 0===t?void 0:t.endsWith(".svg")))}let ct=class extends f.A{constructor(e){super(e),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};(0,a._)([(0,u.MZ)()],ct.prototype,"extent",void 0),(0,a._)([(0,u.MZ)()],ct.prototype,"extraParameters",void 0),(0,a._)([(0,u.MZ)()],ct.prototype,"outSpatialReference",void 0),(0,a._)([(0,u.MZ)()],ct.prototype,"template",void 0),(0,a._)([(0,u.MZ)()],ct.prototype,"updateDelay",void 0),(0,a._)([(0,u.MZ)()],ct.prototype,"view",void 0),ct=(0,a._)([(0,c.$)("esri.rest.support.PrintParameters")],ct);const dt=ct;let pt=class extends k.oY{constructor(e){super(e),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null}};(0,a._)([(0,u.MZ)()],pt.prototype,"description",void 0),(0,a._)([(0,u.MZ)({json:{read:y}})],pt.prototype,"format",void 0),(0,a._)([(0,u.MZ)()],pt.prototype,"label",void 0),(0,a._)([(0,u.MZ)({json:{read:ye}})],pt.prototype,"layout",void 0),(0,a._)([(0,u.MZ)({type:Pe.default})],pt.prototype,"layoutItem",void 0),(0,a._)([(0,u.MZ)()],pt.prototype,"layoutOptions",void 0),(0,a._)([(0,u.MZ)()],pt.prototype,"layoutTemplateInfo",void 0),pt=(0,a._)([(0,c.$)("esri.widgets.Print.CustomTemplate")],pt);const ht=pt,yt=o.A.ofType(ht);let mt=class extends M.A{constructor(e){super(e),this._serviceTemplateCustomTextElements=null,this.allowedFormats="all",this.allowedLayouts="all",this.defaultTemplates=new yt,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.portal=L.A.getDefault(),this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null}destroy(){this.view=null}get effectivePrintServiceUrl(){var e;return null!==(e=this.printServiceUrl)&&void 0!==e?e:null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const e=(0,n.o8)(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach((t=>{const i=e[t];if(i){var a;const e=null===(a=this.templateCustomTextElements)||void 0===a?void 0:a[t];i.forEach((t=>{const[i]=Object.entries(t)[0];null===e||void 0===e||e.forEach((e=>{const[a,o]=Object.entries(e)[0];i===a&&(t[i]=o)}))}))}})),Object.freeze(e)}get state(){var e;return"loading"===this.loadStatus?"initializing":"failed"===this.loadStatus||this.error?"error":"loaded"===this.loadStatus&&null!==(e=this.view)&&void 0!==e&&e.ready?"ready":"disabled"}async load(e){return this.addResolvingPromise(this._loadResources(e).catch((e=>this.error=e))),this}async getLayoutTemplateInfo(e,t){const{id:i}=e;"public"!==e.access&&_.id&&await _.id.getCredential(this._printServiceLayoutsUrl);const a={Layout_Item_ID:JSON.stringify({id:i})},{results:o}=await ae(this._printServiceLayoutsUrl,a,null,t),n=o[0].value[0],r=n.layoutOptions.mapSurroundInfos.find((e=>{let{type:t}=e;return"CIMMarkerNorthArrow"===t}));return r&&(this.templateToNorthArrowInfo[i]=r),n}async print(e){const{view:t,extraParameters:i,updateDelay:a}=this;if(!t)throw new x.A("print:view-required","view is not set");!function(e){var t,i,a;if(null!==(t=e.layoutOptions)&&void 0!==t||(e.layoutOptions={}),null!==(a=(i=e.layoutOptions).customTextElements)&&void 0!==a||(i.customTextElements=[]),!e.layoutOptions.customTextElements.find((e=>"date"in e))){const{customTextElements:t}=e.layoutOptions;let i=(0,I.Yq)(Date.now(),(0,I.J2)("short-date"));"ar"===(0,P.Z0)()&&(i="\u200f"+i),t.push({date:i})}}(e);const o=new dt({view:t,template:e,extraParameters:i,updateDelay:a});try{return await Ve(this.effectivePrintServiceUrl,o,{timeout:this.printTimeout})}catch(fe){throw new x.A("print:export-error","An error occurred while exporting the web map.",{error:fe})}}toPrintTemplate(e){var t;let{attributionEnabled:i,author:a,copyright:o,customTextElements:n,dpi:r,forceFeatureAttributes:l,format:s,height:u,includeTables:c,layout:d,layoutItem:p,legendEnabled:h,northArrowEnabled:y,scale:m,scaleEnabled:v,title:f,width:b}=e;const g=new De({attributionVisible:i,forceFeatureAttributes:l,format:s,includeTables:c,layout:d,layoutItem:p,layoutOptions:{authorText:a||"",copyrightText:o||"",customTextElements:n,titleText:f||""},outScale:null!==m&&void 0!==m?m:0,scalePreserved:v});b&&(g.exportOptions.width=b),u&&(g.exportOptions.height=u),r&&(g.exportOptions.dpi=r),!h&&g.layoutOptions&&(g.layoutOptions.legendLayers=[]);const w=this.templateToNorthArrowInfo[null!==(t=null===p||void 0===p?void 0:p.id)&&void 0!==t?t:d];return w&&w.visible!==y&&g.layoutOptions&&(g.layoutOptions.elementOverrides={[w.name]:{visible:y}}),g}async _loadResources(e){var t;let i=[];if(!this.printServiceUrl){var a,o,n;if(this.destroyed)return;try{await this.portal.load(e)}catch(fe){throw new x.A("print:could-not-load-portal","Cannot load print resource information from portal",{error:fe,url:this.effectivePrintServiceUrl})}const t=null===(a=this.portal.helperServices)||void 0===a?void 0:a.printTask;t&&(this._set("effectivePrintServiceUrl",t.url),i=null!==(o=null===(n=t.templates)||void 0===n?void 0:n.map((e=>ht.fromJSON(e))))&&void 0!==o?o:[])}this.defaultTemplates.addMany(i);const r=null===(t=this.effectivePrintServiceUrl)||void 0===t?void 0:t.toLowerCase().split("/");if(null===r||void 0===r||!r.includes("gpserver"))throw new x.A("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});const[l,s]=await Promise.all([this._getPrintServiceLayouts(e),this._getPrintServiceTemplates(e)]);if(this._processPrintServiceLayouts(l),this._processPrintServiceTemplates(s),!this.printServiceUrl){const t=await this._getPortalCustomTemplates(e);this.defaultTemplates.addMany(t)}}async _getPortalCustomTemplates(e){const{layoutGroupQuery:t}=this.portal;if(!t)return[];const i=new D.A({query:t,disableExtraQuery:!0}),a=await this.portal.queryGroups(i,e);if(!a.total)return[];const o=a.results[0],n=new D.A({num:100,query:"type:Layout"}),r=(await o.queryItems(n,e)).results;return r.length?r.map((e=>new ht({label:e.title,layoutItem:e}))):[]}_processPrintServiceTemplates(e){this._set("templatesInfo",e)}async _getPrintServiceLayouts(e){let t=[];const i=async t=>(this._printServiceLayoutsUrl=this.effectivePrintServiceUrl.replace(/(\/GPServer\/).+/i,"$1".concat(encodeURI(t))),(await ae(this._printServiceLayoutsUrl,null,null,e)).results[0].value);try{t=await i("Get Layout Templates Info Task")}catch{}if(!t||t.length<1)try{t=await i("Get Layout Templates Info")}catch{}return t}_processPrintServiceLayouts(e){const t={},i={};e.forEach((e=>{let{layoutTemplate:a,layoutOptions:{customTextElements:o,mapSurroundInfos:n}}=e;const r=ye(a);t[r]=o,n&&(i[r]=n.find((e=>{let{type:t}=e;return"CIMMarkerNorthArrow"===t})))})),this._serviceTemplateCustomTextElements=Object.freeze(t),this.templateToNorthArrowInfo=i}async _getPrintServiceTemplates(e){let t;try{({data:t}=await(0,S.A)(this.effectivePrintServiceUrl,{...e,query:{f:"json"},timeout:this.printTimeout}))}catch(Z){throw(0,O.zf)(Z)?Z:new x.A("print:unavailable-service-info","Can't fetch templates info from service",{error:Z})}const{parameters:i}=t,a=i.find((e=>{let{name:t}=e;return"Format"===t})),o=i.find((e=>{let{name:t}=e;return"Layout_Template"===t}));return{format:this._getFormat(a),layout:this._getLayout(o)}}_getFormat(e){const t="all"===this.allowedFormats?e.choiceList:e.choiceList.filter((e=>this.allowedFormats.includes(y(e)))),i=(t.length?t:e.choiceList).map(y).filter(T.Ru),a=y(e.defaultValue),o=i.includes(a)?a:i[0];return{choiceList:i,defaultValue:o}}_getLayout(e){var t,i;const a=e.choiceList.filter((e=>"map_only"!==e.toLowerCase())),o="all"===this.allowedLayouts?a:a.filter((e=>this.allowedLayouts.includes(ye(e)))),n=(o.length?o:a).map(ye).filter(T.Ru),r=ye(e.defaultValue),l=n.includes(r)?r:null!==(t=null!==(i=n.find((e=>/(?=.*letter)(?=.*landscape)/i.test(e))))&&void 0!==i?i:n.find((e=>/(?=.*a4)(?=.*landscape)/i.test(e))))&&void 0!==t?t:n[0];return{choiceList:n,defaultValue:l}}};(0,a._)([(0,u.MZ)()],mt.prototype,"_serviceTemplateCustomTextElements",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"allowedFormats",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"allowedLayouts",void 0),(0,a._)([(0,u.MZ)({type:yt})],mt.prototype,"defaultTemplates",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"error",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"extraParameters",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"includeDefaultTemplates",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],mt.prototype,"effectivePrintServiceUrl",null),(0,a._)([(0,u.MZ)()],mt.prototype,"effectiveTemplateCustomTextElements",null),(0,a._)([(0,u.MZ)({type:L.A})],mt.prototype,"portal",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"printServiceUrl",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"printTimeout",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],mt.prototype,"state",null),(0,a._)([(0,u.MZ)({readOnly:!0})],mt.prototype,"templatesInfo",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"updateDelay",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"view",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"templateCustomTextElements",void 0),(0,a._)([(0,u.MZ)()],mt.prototype,"templateToNorthArrowInfo",void 0),mt=(0,a._)([(0,c.$)("esri.widgets.Print.PrintViewModel")],mt);const vt=mt;let ft=class extends f.A{constructor(e){super(e),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=!0,this.northArrowEnabled=!1,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null}};(0,a._)([(0,u.MZ)()],ft.prototype,"attributionEnabled",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"author",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"copyright",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"customTextElements",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"dpi",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"fileName",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"forceFeatureAttributes",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"format",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"height",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"includeTables",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"layout",void 0),(0,a._)([(0,u.MZ)({type:Pe.default})],ft.prototype,"layoutItem",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"legendEnabled",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"northArrowEnabled",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"scale",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"scaleEnabled",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"title",void 0),(0,a._)([(0,u.MZ)()],ft.prototype,"width",void 0),ft=(0,a._)([(0,c.$)("esri.widgets.Print.TemplateOptions")],ft);const bt=ft;var gt=i(77666),wt=i(98108),_t=i(87540),St=i(15062),Tt=i(76099),xt=i(63582),Mt=i(54761);const Ot=o.A.ofType(g),It="MAP_ONLY";var Pt;!function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab"}(Pt||(Pt={}));const Lt="esri-print",Dt="".concat(Lt,"__advanced-options-button"),Ct={base:Lt,widgetIcon:St.T.printer,headerTitle:"".concat(Lt,"__header-title"),inputText:"".concat(Lt,"__input-text"),layoutTabList:"".concat(Lt,"__layout-tab-list"),layoutTab:"".concat(Lt,"__layout-tab"),layoutSection:"".concat(Lt,"__layout-section"),mapOnlySection:"".concat(Lt,"__map-only-section"),scaleInput:"".concat(Lt,"__scale-input"),loader:"".concat(Lt,"__loader"),advancedOptionsButton:Dt,advancedOptionsButtonContainer:"".concat(Dt,"-container"),advancedOptionsButtonTitle:"".concat(Dt,"-title"),advancedOptionsButtonIconOpened:"".concat(Dt,"-icon--opened"),advancedOptionsButtonIconClosed:"".concat(Dt,"-icon--closed"),advancedOptionsButtonIconClosed_RTL:"".concat(Dt,"-icon--closed-rtl"),refreshButton:"".concat(Lt,"__refresh-button"),swapButton:"".concat(Lt,"__swap-button"),printButton:"".concat(Lt,"__export-button"),formSectionContainer:"".concat(Lt,"__form-section-container"),advancedOptionsSection:"".concat(Lt,"__advanced-options-section"),advancedOptionsContainer:"".concat(Lt,"__advanced-options-container"),authorInfoContainer:"".concat(Lt,"__author-info-container"),copyrightInfoContainer:"".concat(Lt,"__copyright-info-container"),exportedFilesContainer:"".concat(Lt,"__export-panel-container"),exportedFilesTitle:"".concat(Lt,"__export-title"),exportedFile:"".concat(Lt,"__exported-file"),exportedFileLink:"".concat(Lt,"__exported-file-link"),exportedFileLinkTitle:"".concat(Lt,"__exported-file-link-title"),heightContainer:"".concat(Lt,"__height-container"),legendInfoContainer:"".concat(Lt,"__legend-info-container"),printWidgetContainer:"".concat(Lt,"__container"),panelContainer:"".concat(Lt,"__panel-container"),scaleInfoContainer:"".concat(Lt,"__scale-info-container"),scaleInputContainer:"".concat(Lt,"__scale-input-container"),sizeContainer:"".concat(Lt,"__size-container"),widthContainer:"".concat(Lt,"__width-container"),panelError:"".concat(Lt,"__panel--error"),exportedFileError:"".concat(Lt,"__exported-file--error")};function At(e){return(null===e||void 0===e?void 0:e.toUpperCase())===It}let Et=class extends v.A{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this.exportedLinks=new Ot,this.headingLevel=3,this.iconClass=Ct.widgetIcon,this.icon=null,this.templateOptions=new bt,this.viewModel=new vt,this._onInput=e=>{this._layoutTabSelected?this.templateOptions.title=e.target.value:this.templateOptions.fileName=e.target.value},this._removeLink=e=>{const t=e.currentTarget["data-item"];t&&"error"===t.state&&this.exportedLinks.remove(t)},this._handleLinkClick=e=>{const t=e.currentTarget,{href:i}=t,a=(0,d.gf)(this.viewModel.effectivePrintServiceUrl);if(!a)return;if(!e.isTrusted)return void e.stopPropagation();e.preventDefault();const o=new URL(i);o.searchParams.set("token",a),t.href=o.href,t.click(),t.href=i},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([(0,l.watch)((()=>{var e;return[this.templateOptions.format,null===(e=this.viewModel.templatesInfo)||void 0===e?void 0:e.format.defaultValue]}),(e=>{let[t,i]=e;if(i&&!t)return void(this.templateOptions.format=i);if(!t||!i||!this.viewModel.templatesInfo)return;if(this.viewModel.templatesInfo.format.choiceList.includes(t))return;const a=this.viewModel.templatesInfo.format.choiceList.find((e=>e.toUpperCase().includes("(".concat(t.toUpperCase(),")"))));this.templateOptions.format=null!==a&&void 0!==a?a:i})),(0,l.watch)((()=>{var e;return[this.templateOptions.layout,null===(e=this.viewModel.templatesInfo)||void 0===e?void 0:e.layout.defaultValue]}),(e=>{let[t,i]=e;if(i&&!t)return void(this.templateOptions.layout=i);if(!t||!i||!this.viewModel.templatesInfo)return;if(this._layoutTabSelected=!At(t),!this._layoutTabSelected)return;this.viewModel.templatesInfo.layout.choiceList.includes(t)||(this.templateOptions.layout=i);const a=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=a?(0,n.o8)(a):null})),(0,l.watch)((()=>this.templateOptions.dpi),(e=>{e<=0&&(this.templateOptions.dpi=1)})),(0,l.watch)((()=>{var e;return null===(e=this.viewModel.view)||void 0===e?void 0:e.scale}),(e=>{!e||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=e)}))]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>{clearTimeout(i),this._awaitingServerResponse=!1}))}loadDependencies(){return(0,gt.W)({combobox:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(48347),i.e(13859),i.e(85292),i.e(19246)]).then(i.bind(i,19246)),"combobox-item":()=>Promise.all([i.e(39879),i.e(79012)]).then(i.bind(i,79012)),input:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(79545),i.e(56685)]).then(i.bind(i,29625)),label:()=>Promise.all([i.e(39879),i.e(65423)]).then(i.bind(i,65423))})}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var e,t,i;const{includeDefaultTemplates:a,messages:o,templateOptions:n,viewModel:r,view:l}=this,{attributionEnabled:s,author:u,copyright:c,dpi:d,format:p,height:h,layout:y,layoutItem:v,legendEnabled:f,northArrowEnabled:b,scaleEnabled:g,scale:w,width:_}=n,S="ready"!==r.state||this._awaitingServerResponse,T=this._renderTitleOrFileNameSection(),x=(0,Mt.K)("div",{class:Ct.formSectionContainer},(0,Mt.K)("calcite-label",null,o.fileFormatTitle,(0,Mt.K)("calcite-combobox",{clearDisabled:!0,label:o.formatDefaultOption,maxItems:6,placeholder:o.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:e=>{let{target:t}=e;this.templateOptions.format=t.selectedItems[0].value}},null===(e=r.templatesInfo)||void 0===e||null===(e=e.format)||void 0===e?void 0:e.choiceList.sort().map(((e,t)=>(0,Mt.K)("calcite-combobox-item",{key:"file-format-".concat(t),selected:e===this.templateOptions.format,textLabel:m(e),value:e})))))),M=r.defaultTemplates.length&&a?r.defaultTemplates.toArray().filter((e=>{let{label:t}=e;return!At(t)})).sort(((e,t)=>{var i,a;return(null!==(i=e.label)&&void 0!==i?i:"")>(null!==(a=t.label)&&void 0!==a?a:"")?1:-1})).map(((e,t)=>{var i,a,n;return(0,Mt.K)("calcite-combobox-item",{"data-item-id":null===(i=e.layoutItem)||void 0===i?void 0:i.id,key:"organization-template-".concat(t),textLabel:null!==(a=e.label)&&void 0!==a?a:o.untitled,title:null!==(n=e.description)&&void 0!==n?n:"",value:e.layout})})):null,O=null===(t=r.templatesInfo)||void 0===t||null===(t=t.layout)||void 0===t||!t.choiceList.length||a&&r.defaultTemplates.length?null:r.templatesInfo.layout.choiceList.map((e=>{var t;return{label:null!==(t=o[e])&&void 0!==t?t:e.replaceAll("_"," "),value:e}})).sort(((e,t)=>e.label>t.label?1:0)).map(((e,t)=>{let{label:i,value:a}=e;return(0,Mt.K)("calcite-combobox-item",{key:"service-template-".concat(t),selected:a===this.templateOptions.layout,textLabel:i,value:a})})),I=(0,Mt.K)("div",{class:Ct.formSectionContainer},(0,Mt.K)("calcite-label",null,o.template,(0,Mt.K)("calcite-combobox",{clearDisabled:!0,label:o.selectTemplate,maxItems:6,placeholder:o.selectTemplate,selectionMode:"single",onCalciteComboboxChange:e=>{let{target:t}=e;const i=t.selectedItems[0],a=i.getAttribute("data-item-id");if(a){const e=this.viewModel.defaultTemplates.find((e=>{let{layoutItem:t}=e;return a===(null===t||void 0===t?void 0:t.id)}));this._applyTemplate(e)}else this._applyTemplate(i.value)}},M,O))),P=(0,Mt.K)("div",{class:Ct.formSectionContainer},(0,Mt.K)("label",null,o.dpi,(0,Mt.K)("input",{bind:this,class:this.classes(Ct.inputText,wt.D.input),"data-input-name":"dpi",min:"1",onchange:this._handleDPIChange,tabIndex:0,type:"number",value:"".concat(d)}))),L=(0,Mt.K)("div",{class:this.classes(Ct.scaleInfoContainer,Ct.formSectionContainer)},(0,Mt.K)("label",null,(0,Mt.K)("input",{bind:this,checked:g,"data-option-name":"scaleEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),o.scale),(0,Mt.K)("div",{class:Ct.scaleInputContainer},(0,Mt.K)("input",{"aria-label":o.scaleLabel,"aria-valuenow":"".concat(w),bind:this,class:this.classes(Ct.inputText,wt.D.input,Ct.scaleInput),"data-input-name":"scale",disabled:!g,onchange:this._updateInputValue,role:"spinbutton",tabIndex:0,type:"number",value:"".concat(w)}),(0,Mt.K)("button",{"aria-label":o.reset,bind:this,class:this.classes(wt.D.widgetButton,Ct.refreshButton,St.T.refresh),onclick:this._resetToCurrentScale,tabIndex:0,type:"button"}))),D=this._advancedOptionsVisibleForLayout?(0,Mt.K)("div",{"aria-labelledby":"".concat(this.id,"__advancedOptionsForLayout"),class:Ct.advancedOptionsContainer},L,(0,Mt.K)("div",{class:this.classes(Ct.authorInfoContainer,Ct.formSectionContainer)},(0,Mt.K)("label",null,o.author,(0,Mt.K)("input",{bind:this,class:this.classes(Ct.inputText,wt.D.input),"data-input-name":"author",onchange:this._updateInputValue,tabIndex:0,type:"text",value:null!==u&&void 0!==u?u:""}))),(0,Mt.K)("div",{class:this.classes(Ct.copyrightInfoContainer,Ct.formSectionContainer)},(0,Mt.K)("label",null,o.copyright,(0,Mt.K)("input",{bind:this,class:this.classes(Ct.inputText,wt.D.input),"data-input-name":"copyright",onchange:this._updateInputValue,tabIndex:0,type:"text",value:null!==c&&void 0!==c?c:""}))),P,(0,Mt.K)("div",{class:this.classes(Ct.legendInfoContainer,Ct.formSectionContainer)},(0,Mt.K)("label",null,(0,Mt.K)("input",{bind:this,checked:f,"data-option-name":"legendEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),o.legend)),this.viewModel.templateToNorthArrowInfo[null!==(i=null===v||void 0===v?void 0:v.id)&&void 0!==i?i:y]?(0,Mt.K)("div",{class:this.classes(Ct.legendInfoContainer,Ct.formSectionContainer),key:"north-arrow"},(0,Mt.K)("label",null,(0,Mt.K)("input",{bind:this,checked:b,"data-option-name":"northArrowEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),o.northArrow)):null,this._renderCustomTextElementSection()):null,C=this._advancedOptionsVisibleForMapOnly?(0,Mt.K)("div",{"aria-labelledby":"".concat(this.id,"__advancedOptionsForMapOnly"),class:Ct.advancedOptionsContainer},L,P,(0,Mt.K)("div",{class:Ct.formSectionContainer},(0,Mt.K)("label",null,(0,Mt.K)("input",{bind:this,checked:s,"data-option-name":"attributionEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),o.attribution)),this._renderCustomTextElementSection()):null,A=this._layoutTabSelected?(0,Mt.K)("section",{"aria-labelledby":"".concat(this.id,"__layoutTab"),class:Ct.layoutSection,id:"".concat(this.id,"__layoutContent"),key:"esri-print__layoutContent",role:"tabpanel"},(0,Mt.K)("div",{class:Ct.panelContainer},T,I,this._layoutTabSelected?x:null),(0,Mt.K)("div",{class:this.classes(Ct.panelContainer,Ct.advancedOptionsSection)},(0,Mt.K)("button",{"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false","aria-label":o.advancedOptions,bind:this,class:Ct.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},(0,Mt.K)("div",{class:Ct.advancedOptionsButtonContainer},(0,Mt.K)("span",{"aria-hidden":"true",class:this.classes(St.T.rightTriangleArrow,Ct.advancedOptionsButtonIconClosed)}),(0,Mt.K)("span",{"aria-hidden":"true",class:this.classes(St.T.leftTriangleArrow,Ct.advancedOptionsButtonIconClosed_RTL)}),(0,Mt.K)("span",{"aria-hidden":"true",class:this.classes(St.T.downArrow,Ct.advancedOptionsButtonIconOpened)}),(0,Mt.K)("span",{class:Ct.advancedOptionsButtonTitle},o.advancedOptions))),D)):(0,Mt.K)("section",{"aria-labelledby":"".concat(this.id,"__mapOnlyTab"),class:Ct.mapOnlySection,id:"".concat(this.id,"__mapOnlyContent"),key:"esri-print__mapOnlyContent",role:"tabpanel"},(0,Mt.K)("div",{class:Ct.panelContainer},T,this._layoutTabSelected?null:x,(0,Mt.K)("div",{class:this.classes(Ct.sizeContainer,Ct.formSectionContainer)},(0,Mt.K)("div",{class:Ct.widthContainer},(0,Mt.K)("label",null,o.width,(0,Mt.K)("input",{bind:this,class:this.classes(Ct.inputText,wt.D.input),"data-input-name":"width",onchange:this._updateInputValue,tabIndex:0,type:"number",value:"".concat(_)}))),(0,Mt.K)("div",{class:Ct.heightContainer},(0,Mt.K)("label",null,o.height,(0,Mt.K)("input",{bind:this,class:this.classes(Ct.inputText,wt.D.input),"data-input-name":"height",onchange:this._updateInputValue,tabIndex:0,type:"number",value:"".concat(h)}))),(0,Mt.K)("button",{"aria-label":o.swap,bind:this,class:this.classes(wt.D.widgetButton,Ct.swapButton,St.T.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),(0,Mt.K)("div",{class:this.classes(Ct.panelContainer,Ct.advancedOptionsSection)},(0,Mt.K)("button",{"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false","aria-label":o.advancedOptions,bind:this,class:Ct.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},(0,Mt.K)("div",{class:Ct.advancedOptionsButtonContainer},(0,Mt.K)("span",{"aria-hidden":"true",class:this.classes(St.T.rightTriangleArrow,Ct.advancedOptionsButtonIconClosed)}),(0,Mt.K)("span",{"aria-hidden":"true",class:this.classes(St.T.leftTriangleArrow,Ct.advancedOptionsButtonIconClosed_RTL)}),(0,Mt.K)("span",{"aria-hidden":"true",class:this.classes(St.T.downArrow,Ct.advancedOptionsButtonIconOpened)}),(0,Mt.K)("span",{class:Ct.advancedOptionsButtonTitle},o.advancedOptions))),C))),E=this.exportedLinks.toArray(),N=this._renderExportedLink(E),Z={[wt.D.buttonDisabled]:S||!y&&!p},F=!l||"2d"!==l.type,V=(0,Mt.K)("div",{class:Ct.panelError},F?o.sceneViewError:o.serviceError),k=(0,Mt.K)("div",null,(0,Mt.K)("ul",{bind:this,class:Ct.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},(0,Mt.K)("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":"".concat(this._layoutTabSelected),class:Ct.layoutTab,"data-tab-id":Pt.layout,id:"".concat(this.id,"__layoutTab"),role:"tab",tabIndex:0},o.layoutTab),(0,Mt.K)("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":"".concat(!this._layoutTabSelected),class:Ct.layoutTab,"data-tab-id":Pt.mapOnly,id:"".concat(this.id,"__mapOnlyTab"),role:"tab",tabIndex:0},o.mapOnlyTab)),A,(0,Mt.K)("button",{"aria-label":o.exportDescription,bind:this,class:this.classes(Ct.printButton,wt.D.button,Z),disabled:S,onclick:this._handlePrintMap,tabIndex:0,type:"button"},o.export),(0,Mt.K)("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:Ct.exportedFilesContainer},(0,Mt.K)(_t.D,{class:Ct.exportedFilesTitle,level:this.headingLevel},o.exportText),E.length>0?null:(0,Mt.K)("div",null,(0,Mt.K)("div",null,o.exportHint)),N)),G=(0,Mt.K)("div",{class:Ct.printWidgetContainer},(0,Mt.K)("header",{class:Ct.headerTitle},o.export),this.error||F||!l?V:k),K="initializing"===r.state?this._renderLoader():G;return(0,Mt.K)("div",{bind:this,class:this.classes(Ct.base,wt.D.widget,wt.D.panel)},K)}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?(0,Mt.K)("div",{class:Ct.formSectionContainer,key:"custom-text-elements"},e.map((e=>{const[t,i]=Object.entries(e)[0];return"date"===t?null:(0,Mt.K)("label",{key:t},t,(0,Mt.K)("input",{bind:this,class:this.classes(Ct.inputText,wt.D.input),"data-input-custom":!0,"data-input-name":t,onchange:this._updateInputValue,type:"text",value:i}))}))):null}async _applyTemplate(e){var t,i,a,o,n;if(!e)return;if("string"==typeof e)return this.templateOptions.layout=e,void(this.templateOptions.layoutItem=null);if(!e.layoutTemplateInfo&&e.layoutItem)try{this._awaitingServerResponse=!0,e.layoutTemplateInfo=await this.viewModel.getLayoutTemplateInfo(e.layoutItem);const{hasLegend:t,mapSurroundInfos:i}=e.layoutTemplateInfo.layoutOptions,a=i.some((e=>{let{type:t,visible:i}=e;return"CIMMarkerNorthArrow"===t&&i}));e.layoutOptions={legend:t,northArrow:a}}catch(Z){r.A.getLogger(this).error("Failed to load layout info for ".concat(e.label),Z)}finally{this._awaitingServerResponse=!1}const{format:l,layoutItem:s}=e,u=null!==(t=e.layout)&&void 0!==t?t:this.templateOptions.layout,c=null!==(i=null===(a=e.layoutOptions)||void 0===a?void 0:a.legend)&&void 0!==i?i:this.templateOptions.legendEnabled,d=null!==(o=null===(n=e.layoutOptions)||void 0===n?void 0:n.northArrow)&&void 0!==o?o:this.templateOptions.northArrowEnabled;this.templateOptions.set({format:l,layout:u,layoutItem:s,legendEnabled:c,northArrowEnabled:d})}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:i,fileNamePlaceHolder:a}=this.messages,o=this._layoutTabSelected?e:t,n=this._layoutTabSelected?i:a,r=this._layoutTabSelected?this.templateOptions.title:this.templateOptions.fileName;return(0,Mt.K)("div",{class:Ct.formSectionContainer},(0,Mt.K)("calcite-label",null,o,(0,Mt.K)("calcite-input",{placeholder:n,value:null!==r&&void 0!==r?r:"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");("layoutTab"===t&&this._layoutTabSelected||"mapOnlyTab"===t&&!this._layoutTabSelected)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[Ct.loader]:this._awaitingServerResponse};return(0,Mt.K)("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,t){const i=t||this.messages.untitled,a=e.format.toLowerCase(),o=a.includes("png")?"png":a,n=i+o;return void 0!==this._exportedFileNameMap[n]?this._exportedFileNameMap[n]++:this._exportedFileNameMap[n]=0,new g({name:i,extension:o,count:this._exportedFileNameMap[n]})}_resetToCurrentScale(){var e;this.templateOptions.scale=null===(e=this.viewModel.view)||void 0===e?void 0:e.scale}_updateCustomTextElementValue(e,t,i){e.find((e=>{const[i]=Object.entries(e)[0];return i===t}))[t]=i}_updateInputValue(e){const t=e.target,i=t.getAttribute("data-input-name"),a=!!t["data-input-custom"],{templateOptions:o}=this;if(a)return void this._updateCustomTextElementValue(o.customTextElements,i,t.value);let n;if("number"===t.type){if(!function(e){return!isNaN(e)&&e>0}(t.valueAsNumber)){const e=o[i];return void(t.value="".concat(e))}n=t.valueAsNumber}else n=t.value;o[i]=n}_handleDPIChange(e){this._updateInputValue(e);const t=e.currentTarget.valueAsNumber,{height:i,width:a}=function(e){return{width:Math.round(8.3333*e),height:Math.round(11.4583*e)}}(t),{templateOptions:o}=this;o.height=i,o.width=a}_handlePrintMap(){var e;this._pendingExportScroll=!0;const{templateOptions:t}=this,i=this.viewModel.toPrintTemplate(t),a=this._layoutTabSelected?null===(e=i.layoutOptions)||void 0===e?void 0:e.titleText:t.fileName,o=this._createFileLink(i,a);this.exportedLinks.add(o),this.emit("submit",{link:o}),this.viewModel.print(i).then((e=>{o.set({url:e&&e.url,state:"ready"})})).catch((e=>{o.set({error:e,state:"error"})})).then((()=>{this.emit("complete",{link:o}),this.scheduleRender()}))}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:i}=e,a=i-t;a>0&&(e.scrollTop=a)}_toggleInputValue(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,"scaleEnabled"===i&&(this.templateOptions[i]||this._resetToCurrentScale())}_renderExportedLink(e){const t=this.messages;return e.map((e=>{var i,a;const{error:o,url:n,state:r}=e,l=null!==(i=e.formattedName)&&void 0!==i?i:"",u="error"===r,c="pending"===r,d="ready"===r,p={[wt.D.anchorDisabled]:c||u};let h=n||null;h&&(h=(0,s.yM)(h));const y=(0,s.FX)(n,location.href),m={[St.T.loadingIndicator]:c,[wt.D.rotating]:c,[St.T.download]:y&&d,[St.T.launchLinkExternal]:!y&&d,[St.T.error]:u,[Ct.exportedFileError]:u},v={[Ct.exportedFileError]:u};let f;f=c?t.pending:d?t.ready:t.errorMessage;const b=u?"print-task:cim-symbol-unsupported"===(null===o||void 0===o?void 0:o.name)?t.exportWebMapCIMError:t.exportWebMapError:"";return(0,Mt.K)("div",{"aria-label":f,class:Ct.exportedFile,"data-item":e,key:l,onclick:this._removeLink,title:b},(0,Mt.K)("a",{"aria-label":"".concat(l,". ").concat(t.linkReady),class:this.classes(Ct.exportedFileLink,wt.D.anchor,p),download:l,href:null!==(a=h)&&void 0!==a?a:"",onclick:this._handleLinkClick,rel:"noreferrer",tabIndex:0,target:"_blank"},(0,Mt.K)("span",{class:this.classes(m)}),(0,Mt.K)("span",{class:this.classes(Ct.exportedFileLinkTitle,v)},l)))}))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e){var t,i;let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._layoutTabSelected=e===Pt.layout,this.templateOptions.layout=this._layoutTabSelected?null!==(t=null===(i=this.viewModel.templatesInfo)||void 0===i||null===(i=i.layout)||void 0===i?void 0:i.defaultValue)&&void 0!==t?t:"letter-ansi-a-landscape":It,this.templateOptions.layoutItem=null,a&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,i=e.target.getAttribute("data-tab-id");if((0,Tt.OU)(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();"ArrowLeft"!==t&&"ArrowRight"!==t||(this._toggleTab(i===Pt.layout?Pt.mapOnly:Pt.layout),e.preventDefault(),e.stopPropagation())}};(0,a._)([(0,u.MZ)()],Et.prototype,"allowedFormats",null),(0,a._)([(0,u.MZ)()],Et.prototype,"allowedLayouts",null),(0,a._)([(0,u.MZ)()],Et.prototype,"error",null),(0,a._)([(0,u.MZ)({type:Ot})],Et.prototype,"exportedLinks",void 0),(0,a._)([(0,u.MZ)()],Et.prototype,"extraParameters",null),(0,a._)([(0,u.MZ)()],Et.prototype,"headingLevel",void 0),(0,a._)([(0,u.MZ)()],Et.prototype,"iconClass",void 0),(0,a._)([(0,u.MZ)()],Et.prototype,"icon",void 0),(0,a._)([(0,u.MZ)()],Et.prototype,"includeDefaultTemplates",null),(0,a._)([(0,u.MZ)()],Et.prototype,"label",null),(0,a._)([(0,u.MZ)(),(0,xt.G)("esri/widgets/Print/t9n/Print")],Et.prototype,"messages",void 0),(0,a._)([(0,u.MZ)()],Et.prototype,"portal",null),(0,a._)([(0,u.MZ)()],Et.prototype,"printServiceUrl",null),(0,a._)([(0,u.MZ)()],Et.prototype,"templateCustomTextElements",null),(0,a._)([(0,u.MZ)({type:bt})],Et.prototype,"templateOptions",void 0),(0,a._)([(0,u.MZ)()],Et.prototype,"view",null),(0,a._)([(0,u.MZ)({type:vt})],Et.prototype,"viewModel",void 0),Et=(0,a._)([(0,c.$)("esri.widgets.Print")],Et);const Nt=Et}}]);
//# sourceMappingURL=67965.d3bcc370.chunk.js.map
"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[94423],{45652:(e,t,i)=>{i.d(t,{$1:()=>d,H2:()=>h,MT:()=>v,VP:()=>w,WF:()=>c,Wt:()=>s,XQ:()=>f,hK:()=>p,nS:()=>u,uh:()=>r,xY:()=>l});var a=i(50076);const n="upload-assets",o=()=>new Error;class s extends a.A{constructor(){super("".concat(n,":unsupported"),"Layer does not support asset uploads.",o())}}class r extends a.A{constructor(){super("".concat(n,":no-glb-support"),"Layer does not support glb.",o())}}class l extends a.A{constructor(){super("".concat(n,":no-supported-source"),"No supported external source found",o())}}class d extends a.A{constructor(){super("".concat(n,":not-base-64"),"Expected gltf data in base64 format after conversion.",o())}}class c extends a.A{constructor(){super("".concat(n,":unable-to-prepare-options"),"Unable to prepare uploadAsset request options.",o())}}class u extends a.A{constructor(e,t){super("".concat(n,":bad-response"),"Bad response. Uploaded ".concat(e," items and received ").concat(t," results."),o())}}class p extends a.A{constructor(e,t){var i,a;super("".concat(n,"-layer:upload-failed"),"Failed to upload mesh file ".concat(e,". Error code: ").concat(null!==(i=null===t||void 0===t?void 0:t.code)&&void 0!==i?i:"-1",". Error message: ").concat(null!==(a=null===t||void 0===t?void 0:t.messages)&&void 0!==a?a:"unknown"),o())}}class h extends a.A{constructor(e){super("".concat(n,"-layer:unsupported-format"),"The service allowed us to upload an asset of FormatID ".concat(e,", but it does not list it in its supported formats."),o())}}class v extends a.A{constructor(){super("".concat(n,":convert3D-failed"),"convert3D failed.")}}class w extends a.A{constructor(){super("invalid-input:no-model","No supported model found")}}class f extends a.A{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}}},4955:(e,t,i)=>{function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){var i;return"number"==typeof e?e:null!==e&&void 0!==e&&null!==(i=e.stops)&&void 0!==i&&i.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const n=e[a].size;"number"==typeof n&&(t+=n,i++)}return t/i}(e.stops):t}function o(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(n(i,e)+n(a,e))/2}));let a=0;const o=i.length;if(0===o)return e;for(let n=0;n<o;n++)a+=i[n];const s=Math.floor(a/o);return Math.max(s,e)}function s(e){const t=null===e||void 0===e?void 0:e.renderer,i="touch"===(null===e||void 0===e?void 0:e.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?o(i,t.visualVariables):i;if("simple"===t.type)return a(n,t.symbol);if("unique-value"===t.type){var s;let e=n;return null!==(s=t.uniqueValueInfos)&&void 0!==s&&s.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return"dot-density"===t.type||t.type,n}i.d(t,{o:()=>s})},52447:(e,t,i)=>{i.d(t,{y:()=>r});var a=i(35143),n=i(54099),o=i(46053),s=(i(81806),i(76460),i(47249),i(85842));let r=class extends n.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,a._)([(0,o.MZ)({constructOnly:!0})],r.prototype,"graphic",void 0),(0,a._)([(0,o.MZ)()],r.prototype,"tracking",void 0),(0,a._)([(0,o.MZ)()],r.prototype,"displaying",void 0),(0,a._)([(0,o.MZ)()],r.prototype,"isDraped",void 0),r=(0,a._)([(0,s.$)("esri.views.3d.layers.graphics.GraphicState")],r)},20072:(e,t,i)=>{i.d(t,{A:()=>u});var a=i(35143),n=i(91967),o=i(46053),s=(i(81806),i(76460),i(47249),i(85842)),r=i(69120),l=i(90992),d=i(9912);let c=class extends n.A{constructor(e){super(e),this.view=null}add(e){const t=!e||Array.isArray(e)?e:[e];(null===t||void 0===t?void 0:t.length)&&t.forEach((e=>this._highlight(e)))}remove(e){const t=!e||Array.isArray(e)?e:[e];(null===t||void 0===t?void 0:t.length)&&t.forEach((e=>this._removeHighlight(e)))}removeAll(){this.removeAllHandles()}_highlight(e){const t=(0,r.i)(this.view,e.layer);(0,l.Of)(t)&&this.addHandles(t.highlight(e),(0,d.Fr)(e))}_removeHighlight(e){e&&this.removeHandles((0,d.Fr)(e))}};(0,a._)([(0,o.MZ)()],c.prototype,"view",void 0),c=(0,a._)([(0,s.$)("esri.views.draw.support.HighlightHelper")],c);const u=c},94277:(e,t,i)=>{function a(e,t){switch(e){case"point":case"multipoint":return"point";case"polyline":return function(e){return(null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}(t);case"polygon":return function(e){const t=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}(t);default:return}}i.d(t,{$:()=>a})},55754:(e,t,i)=>{i.d(t,{V:()=>s,t:()=>r});i(35238);var a=i(31633),n=i(4955),o=i(76797);function s(e,t,i){var n;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.A,r=0;if("2d"===i.type)r=t*(null!==(n=i.resolution)&&void 0!==n?n:0);else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),o=i.basemapSpatialReference;r=null==o||o.equals(i.spatialReference)?t*n:(0,a.GA)(o)/(0,a.GA)(i.spatialReference)}const l=e.x-r,d=e.y-r,c=e.x+r,u=e.y+r,{spatialReference:p}=i;return s.xmin=Math.min(l,c),s.ymin=Math.min(d,u),s.xmax=Math.max(l,c),s.ymax=Math.max(d,u),s.spatialReference=p,s}function r(e,t,i){const a=i.toMap(e);return null!=a&&s(a,(0,n.o)(),i,l).intersects(t)}const l=new o.A},94423:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Fi});var a=i(35143),n=(i(11265),i(63241)),o=i(76460),s=i(30726),r=i(50346),l=i(68134),d=i(46053),c=(i(81806),i(47249),i(85842)),u=i(28506),p=i(81594),h=i(90564),v=i(42062),w=i(55191),f=i(25329),m=i(15062);const g="esri-editor",y={base:g,helpMessage:"".concat(g,"__help-message"),updateActions:"".concat(g,"__update-actions"),updateActionsList:"".concat(g,"__update-actions-list"),featureTemplatesContainer:"".concat(g,"__feature-templates-container"),templateItemContentEnd:"".concat(g,"__template-item-content-end"),widgetIcon:m.T.edit};var _=i(98773),b=i(19276),k=i(50076),M=i(54099),A=i(54901),F=i(19451),I=i(63733),C=i(70445),E=i(31933),S=i(47437),W=i(97513),V=i(43184),O=i(83973),Z=i(78583),T=i(39356),P=i(18690),x=i(49723),L=i(94277),U=i(57308),K=i(3589),D=i(91967);let H=class extends D.A{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.parent=null,this.pendingFeatures=new b.A,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null,this.upload=null}};(0,a._)([(0,d.MZ)()],H.prototype,"creationInfo",void 0),(0,a._)([(0,d.MZ)()],H.prototype,"editorItem",void 0),(0,a._)([(0,d.MZ)()],H.prototype,"parent",void 0),(0,a._)([(0,d.MZ)({constructOnly:!0})],H.prototype,"sketchOptions",void 0),(0,a._)([(0,d.MZ)()],H.prototype,"snappingManager",void 0),(0,a._)([(0,d.MZ)()],H.prototype,"viewModel",void 0),(0,a._)([(0,d.MZ)()],H.prototype,"upload",void 0),H=(0,a._)([(0,c.$)("esri.widgets.Editor.CreateFeaturesWorkflowData")],H);var R=i(53084),G=i(76931),z=i(15011),N=i(53430),B=i(4955),q=i(3454),$=i(4815),j=i(15492),Q=i(31111),J=i(87708),X=i(8503),Y=i(52447),ee=i(55754),te=i(53787),ie=i(22741);function ae(e){const t=e.sourceLayer;if(!t||"feature"!==t.type||!function(e){switch(null===e||void 0===e?void 0:e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}(t.renderer))return{rotation:null,size:null};let a=null,n=null;const o=t.renderer.getVisualVariablesForType("rotation").filter((t=>(!t.axis||"heading"===t.axis)&&t.field&&!t.valueExpression&&null!=(0,j.getRotationAngle)(t,e)));1===o.length&&(a=function(e,t){var i;const a="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,n=e.field,o=t.fields&&t.fields.filter((e=>e.name===n)),s=o&&1===o.length?o[0].type:"double",r={initial:0,current:0};return{field:n,fieldType:s,getDefault:()=>Promise.resolve(0),getValue:e=>(r.current=r.initial-a*e,ne((r.current+360)%360,s)),initValue:e=>{r.initial=null!=e?e:r.current,r.current=0},isUpdatingInteractively:!1,rotationType:null!==(i=e.rotationType)&&void 0!==i?i:"geographic"}}(o[0],t));const s=t.renderer.getVisualVariablesForType("size").filter((t=>t.field&&!t.useSymbolValue&&!t.valueExpression&&(0,$.KZ)(t)===$._w.RealWorldSize&&null!=(0,j.getSize)(t,e)));return 1===s.length&&(n=function(e,t){var a;const n=e.field,o=e.axis,s=t.fields&&t.fields.filter((e=>e.name===n)),r=s&&1===s.length?s[0].type:"double",l={updating:!1,initial:0,current:0},d=null!==(a=q.j[e.valueUnit])&&void 0!==a?a:1;let c;return c="area"===e.valueRepresentation?e=>(e*d/2)**2*Math.PI:"radius"===e.valueRepresentation||"distance"===e.valueRepresentation?e=>e*d/2:e=>e*d,{field:n,fieldType:r,getDefault:async(e,t)=>ne(c(await async function(e,t,a){if(null==t)return 0;const{symbol:n}=(0,J.t)(t);if(null==n||"web-style"===n.type||"cim"===n.type)return 0;const o=n.symbolLayers.at(0);if(!o)return 0;switch(o.type){case"icon":{const{computeIconLayerResourceSize:e}=await i.e(44374).then(i.bind(i,44374));return o.size||Math.min(we.icon,(await e(o,we.icon))[0])||we.icon}case"text":return o.size||we.text;case"line":return o.size||we.line;case"object":{const{computeObjectLayerResourceSize:t}=await i.e(44374).then(i.bind(i,44374));return function(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}(await t(o,e.scale/we.viewScaleSizeFactor),a)}case"path":return(null!=o.width?o.width:o.height)||e.scale/we.viewScaleSizeFactor;case"extrude":return o.size||e.scale/we.viewScaleSizeFactor;default:return 0}}(t,e,o)),r),getValue:(e,t)=>(l.initial||(l.initial=t.pixelSizeAt(t.center)),l.current=l.initial*e,ne(l.current,r)),initValue:e=>{l.initial=null!=e?e:l.current,l.current=0},isUpdatingInteractively:!1,displayUnit:me(e.valueUnit),axis:e.axis}}(s[0],t)),{rotation:a,size:n}}function ne(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}async function oe(e,t,i){const a=await(0,X.Kf)(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:i});null!=(0,z.Ui)(e.symbol,a)&&(e.symbol=a)}async function se(e,t,i){var a,n,o;const s=t.layer,d={...null===(a=t.template)||void 0===a?void 0:a.prototype.attributes,...t.attributeOverrides};let c=null;const{view:u}=e,p="2d"===(null===u||void 0===u?void 0:u.type);if(await re(e,s,d,i,p?u.scale:null),p){const t=(0,r.sg)((t=>re(e,s,d,i,t)));c=(0,l.watch)((()=>u.scale),(e=>t(e)))}const{data:h,editing:v}=s.capabilities;return e.layer.elevationInfo=s.elevationInfo,null==t.geometryToPlace?await e.create(function(e){if(!e)throw new Error("no geometry type");return"multipatch"===e?"mesh":e}(s.geometryType),{graphicProperties:{attributes:d,sourceLayer:s},hasZ:h.supportsZ,defaultZ:null!==(n=p?v.zDefault:null)&&void 0!==n?n:e.defaultCreateOptions.defaultZ}):await e.place(t.geometryToPlace,{graphicProperties:{attributes:d,sourceLayer:s}}),null!==(o=c)&&void 0!==o?o:(0,A.hA)()}async function re(e,t,i,a,n){var o;const s=new T.A({sourceLayer:t,attributes:i}),{rotation:r,size:l}=ae(s);let d=await(0,X.Kf)(s,{useSourceLayer:!0,webStyleCache:a,scale:n}),c=!1;for(const u of[l,r])null!=u&&null==i[u.field]&&(i[u.field]=await u.getDefault(d,e.view),c=!0);switch(c&&(d=await(0,X.Kf)(s,{useSourceLayer:!0,webStyleCache:a,scale:n})),null===(o=d)||void 0===o?void 0:o.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=d;break;case"simple-line":case"line-3d":e.polylineSymbol=d;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=d;break;case"mesh-3d":e.meshSymbol=d}le(e.tooltipOptions,l,r)}function le(e,t,i){var a;e.visualVariables=null!=t||null!=i?{size:null!=t?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:null!=i?{valueType:i.fieldType,rotationType:null!==(a=i.rotationType)&&void 0!==a?a:"geographic"}:null}:null}async function de(e,t,i,a){switch(t.type){case"3d":return async function(e,t,i,a){if(0===e.length)return[];const{updatable:n,graphicsByLayer:o}=await i.async((async()=>{const{results:n}=await(0,r.qr)((0,te.oZ)(t,i),a),o=new Map,s=e=>{const t=e.layer,i=o.get(t);if(!i){const e=new Array;return o.set(t,e),e}return i};(0,te.h$)(n).forEach((e=>{let{graphic:t}=e;return s(t).push(t)}));const l=e.filter((e=>{let{capabilities:t,layer:i}=e;return t.update.enabled&&o.has(i)}));return 0!==l.length&&i.stopPropagation(),{updatable:l,graphicsByLayer:o}}));return(0,r.qr)(Promise.allSettled(n.map((async e=>{let{layer:t}=e;const i=o.get(t),n=ce(t);if(i.every((e=>(0,N.Kl)(n,e))))return i;const s=[];for(const a of i){s.push(a.getObjectId());const e=Object.keys(a.attributes);(0,P.FB)(n,e)}const r=t.createQuery();return r.returnGeometry=!1,r.objectIds=s,r.outFields=(0,N.DB)(t.fieldsIndex,n),t.queryFeatures(r,{signal:a}).then((e=>{let{features:t}=e;return t}))}))),a)}(e,t,i,a);case"2d":return async function(e,t,i,a){if(0===e.length)return[];const{mapPoint:n}=i;if(null==n)return[];let o=null;const s=await i.async((async()=>{const{results:n}=await(0,r.qr)(t.hitTest(i),a);if(0===n.length)return[];const s=new Set;o=(0,te.h$)(n),o.forEach((e=>{let{graphic:t}=e;return t&&s.add(t.layer)}));const l=e.filter((e=>s.has(e.layer)&&e.supportsUpdateWorkflow));return l.length>0&&i.stopPropagation(),l}));return(0,r.qr)(Promise.allSettled(s.map((async e=>{var s;let{layer:r}=e;const l=r.createQuery();l.returnGeometry=!1,l.outFields=ce(r);const d="renderer"in r?(0,B.o)({renderer:r.renderer,pointerType:i.pointerType}):0;l.geometry=(0,ee.V)(n,d,t),l.outSpatialReference=t.spatialReference;const{features:c}=await r.queryFeatures(l,{signal:a});return null!==(s=o)&&void 0!==s&&s.forEach((e=>{let{graphic:t}=e;t.layer!==r||c.some((e=>e.getObjectId()===t.getObjectId()))||c.push(t)})),c}))),a)}(e,t,i,a)}}function ce(e){return(0,N.DB)(e.fieldsIndex,[e.objectIdField,(0,N.mB)({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function ue(e){const{graphic:t,sketchViewModel:i,sourceLayer:a,visualVariables:n,webStyleCache:o}=e;let s=!1;const{rotation:r,size:l}=n;if([r,l].forEach((async e=>{if(null==e)return;const a=t.getAttribute(e.field);if(null!=a)e.initValue(a);else{const a=await e.getDefault(t.symbol,i.view);e.initValue(a),t.setAttribute(e.field,a),s=!0}})),s){var d;const e="2d"===(null===(d=i.view)||void 0===d?void 0:d.type)?i.view.scale:null;await oe(t,o,e)}const c={multipleSelectionEnabled:!1};return"point"===a.geometryType&&(c.enableRotation=null!=r,c.enableScaling=null!=l),le(i.tooltipOptions,l,r),i.layer.elevationInfo=a.elevationInfo,i.update(t,c)}async function pe(e,t,i,a,n){var o;if(null==t.geometry||"point"!==(null===(o=t.geometry)||void 0===o?void 0:o.type))return;const s=a.rotation,r=function(e){return null==e||"rotate-start"!==e.type&&"rotate"!==e.type&&"rotate-stop"!==e.type?null:e}(i.toolEventInfo);if(null!=s&&null!=r)if("rotate-stop"===r.type)s.isUpdatingInteractively=!1,s.initValue();else{s.isUpdatingInteractively=!0;const{field:i,getValue:a}=s;t.setAttribute(i,a(r.angle,e))}const l=a.size,d=function(e){return null==e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}(i.toolEventInfo);if(null!=l&&null!=d)if("scale-stop"===d.type)l.isUpdatingInteractively=!1,l.initValue();else{l.isUpdatingInteractively=!0;const{field:i,getValue:a}=l;t.setAttribute(i,a(d.xScale,e))}await oe(t,n,"2d"===e.type?e.scale:null)}async function he(e,t,i){const a=e.view;e.layer.add(i);const n=t.sourceLayer,o=t.layer,s=t.getAttribute(o.objectIdField);let d=null;function c(e){var t;null!==(t=d)&&void 0!==t&&t.abort(),d=(0,_.UT)((async t=>{var i;const o=await ye(a,n);(0,r.Te)(t),null===(i=o.setVisibility)||void 0===i||i.call(o,s,e)}))}return await async function(e,t){if("3d"===e.type){const i=new Y.y({graphic:t}),a=e.trackGraphicState(i);await(0,l.whenOnce)((()=>i.displaying)),a.remove()}else await(0,l.whenOnce)((()=>t.visible))}(a,i),c(!1),(0,A.vE)([ve(a,i,(e=>c(!e))),(0,A.hA)((async()=>{c(!0);try{const e=await ye(a,n);await(0,l.whenOnce)((()=>!e.updating))}finally{e.layer.remove(i)}}))])}function ve(e,t,i){if("3d"===e.type){const a=new Y.y({graphic:t});return(0,A.vE)([e.trackGraphicState(a),(0,l.watch)((()=>a.displaying),i)])}return(0,l.watch)((()=>t.visible),i)}const we={icon:(0,G.PN)(24),text:(0,G.PN)(12),line:(0,G.PN)(1),viewScaleSizeFactor:100};function fe(e,t,i){let a=!1;return e.filter((e=>!!a||(a=e===t,a))).map((e=>i[e]()))}function me(e){switch(e){case"unknown":case"decimal-degrees":return null;default:return e}}const ge=e=>/-stop/.test(e)||/vertex-/.test(e),ye=(e,t)=>{const i="subtype-sublayer"===t.type?t.parent:t;return e.whenLayerView(i)};function _e(e){const t=e.geometry;if("mesh"===(null===t||void 0===t?void 0:t.type)){var i,a;const n=e.cloneShallow();return n.attributes=(0,R.o8)(e.attributes),n.geometry=t.cloneShallow(),n.geometry.transform=null!==(i=null===(a=t.transform)||void 0===a?void 0:a.clone())&&void 0!==i?i:null,n}return e.clone()}function be(e){const t=e.cursor;return e.cursor="progress",(0,A.hA)((()=>e.cursor=t))}function ke(e){const t=null===e||void 0===e?void 0:e.layer;return"scene"===(null===t||void 0===t?void 0:t.type)}let Me=class extends M.A.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new F.U,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter((e=>!e.parent)).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,t=e&&e[this._stepIndex];return t&&t.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Promise.resolve(!0);this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!0};return!1!==e.force?this._cancel(e):new Promise(((t,i)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...e,force:!0}).then(t)},deny:()=>i(new k.A("workflow:cancel-denied","Request to cancel workflow was denied."))}})}))}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:t}=this,i=t.findIndex((t=>t.id===e));this._indexHistory.push(this._stepIndex),await this._go(i)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cancelCurrentStep:!1};await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=-1===this._stepIndex?0:this._stepIndex;await this._go(e)}async _cancel(){let{emitCancelEvent:e=!0,error:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&(this._set("started",!1),await this._transaction((()=>{var e;return null===(e=this.steps[this._stepIndex])||void 0===e?void 0:e.tearDown({canceled:!0})}))),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:t})}_go(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._transaction((async()=>{const{steps:i}=this;if(!(e<=-1||e>=i.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await i[this._lastStepIndex].tearDown({canceled:t});try{await i[e].setUp()}catch(a){(0,r.jH)(a)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}}))}async _transaction(e){const t=this._pendingOperation,i=(0,r.Tw)(),a=(null!==t&&void 0!==t?t:Promise.resolve()).then((()=>i.promise));this._pendingOperation=a,this._updatingHandles.addPromise(a);try{t&&await t,await e()}finally{i.resolve(),a===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};(0,a._)([(0,d.MZ)()],Me.prototype,"data",void 0),(0,a._)([(0,d.MZ)()],Me.prototype,"hasNextStep",null),(0,a._)([(0,d.MZ)()],Me.prototype,"hasPreviousStep",null),(0,a._)([(0,d.MZ)()],Me.prototype,"onCommit",void 0),(0,a._)([(0,d.MZ)()],Me.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.MZ)()],Me.prototype,"hasInvalidFormTemplate",null),(0,a._)([(0,d.MZ)()],Me.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.MZ)()],Me.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.MZ)()],Me.prototype,"started",void 0),(0,a._)([(0,d.MZ)({readOnly:!0})],Me.prototype,"stepId",null),(0,a._)([(0,d.MZ)()],Me.prototype,"steps",void 0),(0,a._)([(0,d.MZ)({readOnly:!0})],Me.prototype,"type",void 0),(0,a._)([(0,d.MZ)()],Me.prototype,"helpMessage",null),(0,a._)([(0,d.MZ)()],Me.prototype,"hasPendingEdits",null),(0,a._)([(0,d.MZ)()],Me.prototype,"keyboardCancellationEnabled",null),(0,a._)([(0,d.MZ)()],Me.prototype,"updating",null),Me=(0,a._)([(0,c.$)("esri.widgets.Editor.Workflow")],Me);const Ae=Me;var Fe,Ie=i(694),Ce=i(11337);const Ee=Symbol(),Se=Symbol(),We=Symbol();let Ve=Fe=class extends Ae{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new Ie.A,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=(0,r.sg)(((e,t,i)=>oe(e,t,i)))}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var e;if(this.numPendingFeatures>0)return!0;const{creationInfo:t,upload:i}=this.data,a=this._sketchViewModel,{activeComponent:n}=a,o=null===(e=a.createGraphic)||void 0===e||null===(e=e.geometry)||void 0===e?void 0:e.type;return!("polyline"!==o&&"polygon"!==o&&"multipoint"!==o||"draw-2d"!==(null===n||void 0===n?void 0:n.type)&&"draw-3d"!==(null===n||void 0===n?void 0:n.type))&&n.drawOperation.committedVertices.length>0||!(!i||"pending"!==i.state&&"success"!==i.state)||!(null===t||void 0===t||!t.geometryToPlace)}get helpMessage(){const{creationInfo:e,viewModel:t}=this.data;if("creating-features"!==this.stepId||!e)return;const a=e.layer.geometryType,n=this._sketchViewModel.createGraphic;if("mesh"===a){var o;this._getDrawMeshHelpMessage||i.e(76030).then(i.bind(i,76030)).then((e=>{this._getDrawMeshHelpMessage=e.getDrawMeshHelpMessage}));const{view:e}=t;return"3d"===(null===e||void 0===e?void 0:e.type)?null===(o=this._getDrawMeshHelpMessage)||void 0===o?void 0:o.call(this,n,e):void 0}return(0,L.$)(a,null===n||void 0===n?void 0:n.geometry)}get layer(){var e;return null===(e=this.data.creationInfo)||void 0===e?void 0:e.layer}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get parentLayer(){var e;return null===(e=this.parent)||void 0===e?void 0:e.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return 0===this.numPendingFeatures}get reliesOnOwnerAdminPrivileges(){var e,t;return null!==(e=null===(t=this.data.editorItem)||void 0===t?void 0:t.capabilities.create.reliesOnOwnerAdminPrivileges)&&void 0!==e&&e}get shouldShowAttachments(){var e,t;return null!==(e=null===(t=this.data.editorItem)||void 0===t?void 0:t.capabilities.create.attachments.enabled)&&void 0!==e&&e}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){return{addAttachment:(e,t)=>{this._attachmentFileInfos.set(e,t)},sketchViewModel:this._sketchViewModel}}async enter(){this._isActive=!0,"awaiting-feature-creation-info"!==this.stepId&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([We])}async updatePendingFeature(e,t){return this._preventDefaultActionOnCancel=!0,this._sketchViewModel.cancel(),(0,P.TF)(this._lastActiveGraphics,e),this._startUpdating(e,t)}async start(){var e;return await super.start(),(0,E.bI)(null===(e=this.data.creationInfo)||void 0===e?void 0:e.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}static create(e){var t;const{addAttachmentsCallback:i,applyEditsCallback:a,isNested:n,creationInfo:o,parent:s,snappingManager:r,startAt:l,viewModel:d}=e,c=null!==(t=e.sketchOptions)&&void 0!==t?t:new W.A,u=null===o||void 0===o?void 0:o.layer,p=u?d.findEditorItemForLayer(u):void 0,h=new Fe({data:new H({creationInfo:o,editorItem:p,parent:s,sketchOptions:c,snappingManager:r,viewModel:d}),isNested:n,onCommit:async e=>{var t;const{creationInfo:n}=e;if(!n)return;const o=e.pendingFeatures.toArray(),{layer:s}=n,r=(null===(t=s.capabilities)||void 0===t?void 0:t.editing.supportsGlobalId)&&"globalIdField"in s,l=h._attachmentFileInfos;if(r){const e=function(e,t,i){const a=[],n=t.globalIdField;return e.forEach(((t,o)=>{var s,r;null!==(r=(s=e[o].attributes)[n])&&void 0!==r||(s[n]=(0,x.yS)()),((null===i||void 0===i?void 0:i.get(t))||[]).forEach((e=>{let{file:i}=e;return a.push({feature:t,attachment:{globalId:(0,x.yS)(),data:i}})}))})),a.length?{addFeatures:e,addAttachments:a}:{addFeatures:e}}(o,s,l);return void await a(s,e,{globalIdUsed:!0})}const d=await a(s,{addFeatures:o});if(l.size>0){var c;const e=null!==(c=null===d||void 0===d?void 0:d.addFeatureResults)&&void 0!==c?c:[];await i(s,function(e,t,i,a){const n=[];return t.forEach(((t,o)=>{if(!t.error){const s=e[o],r=a.get(s)||[];s.attributes[i.objectIdField]=t.objectId,r.forEach((e=>{let{form:t}=e;return n.push({feature:s,attachment:t})}))}})),n}(o,e,s,l))}}});return h._set("steps",this._createWorkflowSteps(h,l)),h}_fadeExistingFeatures(e){if("effect"in e){const t=e.effect;return e.effect="saturate(0.6) opacity(0.8)",(0,A.hA)((()=>e.effect=t))}const t=e.opacity;return e.opacity=.7,(0,A.hA)((()=>e.opacity=t))}_highlight(e){const t=this.data.viewModel.view;"3d"===(null===t||void 0===t?void 0:t.type)&&this._highlightHandles.set(e,t.highlight(e))}_removeHighlight(e){(0,s.xt)(this._highlightHandles.get(e)),this._highlightHandles.delete(e)}async _startCreating(e){this.removeHandles(Se);const{creationInfo:t}=this.data;if(!t)return;this.createFeatureState="create-new";const i=await se(this._sketchViewModel,t,e);this.addHandles(i,Se)}async _startUpdating(e,t){var i;const{pendingFeatures:a}=this;a.includes(e)||a.add(e);const{_featureFormViewModel:n,_sketchViewModel:o}=this,{creationInfo:r,viewModel:d}=this.data,{attachmentsViewModel:c,layerInfos:u,view:p}=d;if(!p||!r)return;const h=r.layer,v=function(e,t){return null===e||void 0===e?void 0:e.find((e=>e.layer===t))}(u,h),w=null===v||void 0===v?void 0:v.formTemplate,f=p.spatialReference;if(n.set({arcadeEditType:"INSERT",feature:e,formTemplate:w,spatialReference:f,map:p.map}),"add"!==c.mode&&"edit"!==c.mode||null!==(i=d.activeWorkflow)&&void 0!==i&&i.previous(),c.graphic=e,c.fileInfos.removeAll(),c.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach((e=>{let{file:t,form:i}=e;return c.addFile(t,i)})),this._removeHighlight(e),await oe(e,t,"2d"===p.type?p.scale:null),this.removeHandles(Se),(0,s.xt)(this._featureFormHandle),"2d"===p.type){const i=(0,l.watch)((()=>p.scale),(i=>this._updateGraphicDebounced(e,t,i)));this.addHandles(i,Se)}return this._featureFormHandle=(0,A.vE)([n.on("value-change",(async()=>{e.attributes=n.getValues(),await oe(e,t,"2d"===p.type?p.scale:null)})),o.on(["update","undo","redo"],(e=>{("undo"===e.type||"redo"===e.type||"update"===e.type&&null!=e.toolEventInfo&&ge(e.toolEventInfo.type))&&n.notifyFeatureGeometryChanged()}))]),this.createFeatureState="update-pending",this._visualVariableAttributes=ae(e),(0,E.bI)(h)?void 0:ue({graphic:e,sketchViewModel:o,sourceLayer:h,visualVariables:this._visualVariableAttributes,webStyleCache:t})}static _createWorkflowSteps(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";const{data:a}=e,n=fe(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:t,viewModel:n}=a,{view:o}=n;o&&(ke(t)?e.addHandles(await async function(e){let{view:t,data:a,signal:n,next:o,cancel:s}=e;const{creationInfo:d}=a;if(!d)return(0,A.hA)();if(!ke(d))return(0,A.hA)();const{layer:c}=d,u=null!=d.geometryToPlace;if(d.geometryToPlace=null,u)return s(),(0,A.hA)();const{Upload:p}=await i.e(34881).then(i.bind(i,34881));(0,r.Te)(n);const h=new p;a.upload=h;let v=null;const w=()=>{var e;return null===(e=v)||void 0===e?void 0:e.remove()},f=(0,A.vE)([(0,l.watch)((()=>h.state),(e=>{switch(e){case"default":case"error":w();break;case"pending":w(),v=be(t);break;case"success":d.maxFeatures=1,d.geometryToPlace=h.result,w(),o()}})),(0,A.hA)((()=>{h.cancel(),w()}))]);return h.uploadTo(c),f}({view:o,data:a,next:()=>e.next(),cancel:()=>n.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(a.parent&&t&&(e.addHandles(n.lockFeatureTemplatesViewModel(),this.id),n.featureTemplatesViewModel.layers=[t.layer]),e.addHandles(n.featureTemplatesViewModel.on("select",(t=>{let{item:i}=t;i&&(a.creationInfo={...a.creationInfo,layer:i.layer,template:i.template},e.next())})),this.id)))},async tearDown(){e.removeHandles([this.id,Se])}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(t){const{viewModel:i}=a;t.canceled&&(e.removeHandles([We,Ee,Se]),i.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=a.viewModel,{graphic:i,fileInfos:n}=t;e._attachmentFileInfos.set(i,n.toArray()),t.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=a.viewModel,{graphic:i,fileInfos:n}=t;e._attachmentFileInfos.set(i,n.toArray()),t.mode="view"}})});return function(e,t){e.viewModel.syncFeatureTemplates();const i=e.creationInfo;if("awaiting-feature-creation-info"===t[0].id&&i){const e=i.layer,a=(0,ie.r)(e);1===a.length&&"scene"!==e.type&&(i.template=a[0],t.shift())}return t}(a,n)}static _configureSketchViewModel(e,t){const{data:i}=e,{creationInfo:a,viewModel:n}=i,{view:o}=n,r=e._sketchViewModel;let d=null;const c=[];if(!o)return(0,A.hA)();"2d"===o.type&&a&&c.push(e._fadeExistingFeatures(a.layer)),c.push(r.on("create",(async i=>{if("cancel"===i.state){if(e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(e._lastActiveGraphics.length<1)return e._startCreating(t);const i=e._lastActiveGraphics.pop();return e._startUpdating(i,t)}if("complete"===i.state&&i.graphic)return e._startUpdating(i.graphic,t)})),r.on("update",(async i=>{const{attachmentsViewModel:s}=n,{_featureFormViewModel:r}=e,c=i.graphics[0];if("complete"===i.state){var u;if(c!==d&&(e._lastActiveGraphics.push(c),e._highlight(c)),d=null,e.numPendingFeatures===(null===a||void 0===a?void 0:a.maxFeatures)){const i=e._lastActiveGraphics.pop();return e._startUpdating(i,t)}if(!r.submittable){r.submit();const i=e._lastActiveGraphics.pop();return e._startUpdating(i,t)}if("add"!==s.mode&&"edit"!==s.mode||null!==(u=n.activeWorkflow)&&void 0!==u&&u.previous(),i.aborted&&e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);e.addHandles([be(o),o.on("click",(e=>e.preventDefault()))],Ee),await(0,l.whenOnce)((()=>!r.updating)),e.removeHandles(Ee),e._startCreating(t)}"start"===i.state&&e._removeHighlight(c);const p=e._visualVariableAttributes;await pe(o,c,i,p,t);const h=c.attributes,{rotation:v,size:w}=p;if(null!=v){const{field:e}=v;r.setValue(e,h[e])}if(null!=w){const{field:e}=w;r.setValue(e,h[e])}})),r.on("delete",(async t=>{const i=t.graphics[0];e.pendingFeatures.remove(i),(0,P.TF)(e._lastActiveGraphics,i),d=i})),o.on("immediate-click",(async i=>{if(ke(a))return;const{results:n}=await o.hitTest(i,{include:r.layer}),s=n.find((e=>"graphic"===e.type&&e.graphic.sourceLayer===(null===a||void 0===a?void 0:a.layer)));if(!s)return;const l=s.graphic;if("transform"===r.activeTool||"reshape"===r.activeTool){if(r.updateGraphics.at(0)===l)return;if(!e._featureFormViewModel.submittable)return;await e.updatePendingFeature(l,t)}}),U.o.TOOL),(0,A.hA)((()=>{e._preventDefaultActionOnCancel=!0,r.cancel()})),function(e,t){let i=null;const a=()=>e.snappingOptions.featureSources,n=()=>(i=new K.A({layer:e.layer}),a().add(i),i),o=()=>{null!=i&&(a().remove(i),i=(0,s.pR)(i))};return(0,A.vE)([(0,l.watch)((()=>{var e,i;const n=null===(e=t.creationInfo)||void 0===e?void 0:e.layer,o=a().find((e=>e.layer===n));return{hasFeatureLayerSource:!!o,enabled:null!==(i=null===o||void 0===o?void 0:o.enabled)&&void 0!==i&&i}}),(e=>{var t;let{hasFeatureLayerSource:a,enabled:s}=e;if(!a)return o();null!==(t=i)&&void 0!==t||(i=n()),i.enabled=s}),l.syncAndInitial),(0,A.hA)(o)])}(r,i));const u=(0,A.vE)(c);return r.addHandles(u),u}_initializeSketchViewModel(){var e;const{data:t}=this,{view:i}=t.viewModel,a=new I.default({elevationInfo:null===(e=t.creationInfo)||void 0===e?void 0:e.layer.elevationInfo,internal:!0,listMode:"hide"}),n=new Ce.A({layer:a,sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,view:i});this._sketchViewModel=n,null!==i&&void 0!==i&&i.map.add(a),this.addHandles((0,A.hA)((()=>{null!==i&&void 0!==i&&i.destroyed||null!==i&&void 0!==i&&i.map.remove(a),a.destroy()})))}async _setUpCreatingFeaturesStep(){if(this.hasHandles(We))return;const{creationInfo:e,viewModel:t}=this.data,{attachmentsViewModel:i,view:a}=t;if(!a||null===e||void 0===e||!e.layer)throw new k.A("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:n,layer:o}=e,r=this._sketchViewModel,d=new Map,c=[];this._lastActiveGraphics=[],this._featureFormHandle=(0,s.xt)(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},this.data.editorItem=t.findEditorItemForLayer(e.layer),function(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}(i),c.push((0,l.watch)((()=>i.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})));const u=be(a);c.push(u);const p=(0,E.bI)(e.layer);try{if(p){var h;const t=null!==n&&void 0!==n?n:new T.A({attributes:{...null===(h=e.template)||void 0===h?void 0:h.prototype.attributes,...e.attributeOverrides},sourceLayer:o});await this._startUpdating(t,d)}else c.push(Fe._configureSketchViewModel(this,d)),n?(r.layer.add(n),await this._startUpdating(n,d)):await this._startCreating(d)}finally{u.remove()}const v=(0,A.hA)((()=>this.pendingFeatures.drain((e=>r.layer.remove(e))))),w=(0,l.watch)((()=>null===a||void 0===a?void 0:a.timeZone),(e=>this._featureFormViewModel.timeZone=e),l.initial),f=(0,A.hA)((()=>{ke(e)&&t.cancelWorkflow({warnIfNoWorkflow:!1})}));this._featureFormHandle&&c.push(this._featureFormHandle),this.addHandles(c,this._handleKeys.beforeCommit),this.addHandles([(0,A.hA)((()=>i.fileInfos.removeAll())),(0,A.vE)(c),f,v,w],We)}};(0,a._)([(0,d.MZ)({constructOnly:!0})],Ve.prototype,"isNested",void 0),(0,a._)([(0,d.MZ)()],Ve.prototype,"featureFormViewModel",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"hasPendingEdits",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"_getDrawMeshHelpMessage",void 0),(0,a._)([(0,d.MZ)()],Ve.prototype,"helpMessage",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"layer",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"parent",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"parentLayer",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"keyboardCancellationEnabled",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.MZ)()],Ve.prototype,"sketchViewModel",null),Ve=Fe=(0,a._)([(0,c.$)("esri.widgets.Editor.CreateFeaturesWorkflow")],Ve);const Oe=Ve;var Ze=i(59649),Te=i(41289),Pe=i(20072),xe=i(90992);function Le(e){return null==e?null:JSON.stringify(e)}let Ue=class extends D.A{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null}get attributesModified(){return this._stringifyAttributes(this.feature)!==this._stringifyAttributes(this.initialFeature)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){var e;this.initialFeature=null===(e=this.feature)||void 0===e?void 0:e.clone()}updateAttributes(e){const{feature:t}=this;t&&(t.attributes=e,this.notifyChange("attributesModified"))}updateGeometry(e){const{feature:t}=this;t&&(t.geometry=e,this.notifyChange("geometryModified"))}_stringifyAttributes(e){return Le(null===e||void 0===e?void 0:e.attributes)}_stringifyGeometry(e){const t=null===e||void 0===e?void 0:e.geometry;return Le("mesh"===(null===t||void 0===t?void 0:t.type)?{transform:t.transform,vertexSpace:t.vertexSpace}:t)}};var Ke;(0,a._)([(0,d.MZ)()],Ue.prototype,"_stagedForDelete",void 0),(0,a._)([(0,d.MZ)()],Ue.prototype,"attributesModified",null),(0,a._)([(0,d.MZ)()],Ue.prototype,"feature",void 0),(0,a._)([(0,d.MZ)()],Ue.prototype,"geometryModified",null),(0,a._)([(0,d.MZ)()],Ue.prototype,"initialFeature",void 0),(0,a._)([(0,d.MZ)()],Ue.prototype,"modified",null),Ue=(0,a._)([(0,c.$)("esri.widgets.Editor.Edits")],Ue);let De=Ke=class extends D.A{constructor(e){super(e),this.editorItem=null,this.edits=null,this.parent=null,this.relatedRecordCallbacks=null,this.viewModel=null}get attachmentsCapabilities(){const e=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:e,update:e,delete:e}}}get formTemplate(){return this.editorItem.formTemplate}static async create(e){const t=Ke._makeConstructorProps(e);return new Ke(t)}static _makeConstructorProps(e){const{feature:t,parent:i,relatedRecordCallbacks:a,viewModel:n}=e,o=n.editorItems.find((e=>e.layer===t.layer));if(!o)throw new k.A("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{editorItem:o,edits:new Ue({feature:t}),parent:i,relatedRecordCallbacks:a,viewModel:n}}};(0,a._)([(0,d.MZ)()],De.prototype,"attachmentsCapabilities",null),(0,a._)([(0,d.MZ)({constructOnly:!0})],De.prototype,"editorItem",void 0),(0,a._)([(0,d.MZ)()],De.prototype,"edits",void 0),(0,a._)([(0,d.MZ)()],De.prototype,"formTemplate",null),(0,a._)([(0,d.MZ)()],De.prototype,"parent",void 0),(0,a._)([(0,d.MZ)()],De.prototype,"relatedRecordCallbacks",void 0),(0,a._)([(0,d.MZ)()],De.prototype,"viewModel",void 0),De=Ke=(0,a._)([(0,c.$)("esri.widgets.Editor.UpdateRecordWorkflowData")],De);const He=De;var Re;let Ge=Re=class extends He{constructor(e){super(e),this.sketchOptions=null,this.snappingManager=null}static async create(e){var t;const{feature:i,snappingManager:a,viewModel:n}=e,o=null!==(t=e.sketchOptions)&&void 0!==t?t:new W.A,{view:s}=n;if(!s)throw new k.A("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const r=await ye(s,i.layer);return new Re({...Re._makeConstructorProps(e),layerView:r,sketchOptions:o,snappingManager:a})}};(0,a._)([(0,d.MZ)()],Ge.prototype,"layerView",void 0),(0,a._)([(0,d.MZ)({constructOnly:!0})],Ge.prototype,"sketchOptions",void 0),(0,a._)([(0,d.MZ)()],Ge.prototype,"snappingManager",void 0),Ge=Re=(0,a._)([(0,c.$)("esri.widgets.Editor.UpdateFeatureWorkflowData")],Ge);const ze=Ge;var Ne;const Be={exit:Symbol()};let qe=Ne=class extends Ae{constructor(e){super(e),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:e}=this,{edits:t}=e,{view:i}=e.viewModel,a=t.feature,n=new AbortController;this.addHandles((0,A.rE)(n)),this._updatingHandles.addPromise(async function(e,t,i){const{sourceLayer:a}=e,n=a.createQuery();n.objectIds=[e.getAttribute(a.objectIdField)],n.outFields=["*"],n.outSpatialReference=t,n.returnM=a.capabilities.data.supportsM,n.returnZ=a.capabilities.data.supportsZ,(0,Q.Vo)()&&(0,Q.lC)()&&"scene"===a.type&&null!=a.infoFor3D&&(n.returnGeometry=!0,n.formatOf3DObjects="3D_glb");const o=await a.queryFeatures(n,{signal:i});return(0,r.Te)(i),o.features[0]}(a,e.viewModel.view.spatialReference,n.signal).then((e=>{(0,r.G4)(n)||(this._onFullFeatureLoaded(e),this._initializeFeatureFormViewModel())}),(e=>this.cancel({force:!0,error:new k.A("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:e}})})))),i&&(this._highlightHelper=new Pe.A({view:i}),this.addHandles((0,A.hA)((()=>{var e;return null===(e=this._highlightHelper)||void 0===e?void 0:e.removeAll()}))))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var e;return null===(e=this.parent)||void 0===e?void 0:e.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const e=this.editorItem.capabilities;return e.update.reliesOnOwnerAdminPrivileges||e.delete.reliesOnOwnerAdminPrivileges}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel()}exit(e){this.removeHandles(Be.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:e,fullFeature:t}=this,{attachmentsCapabilities:i,viewModel:a}=e,{attachmentsViewModel:n}=a;n.set({capabilities:i,graphic:t,filesEnabled:!1,mode:"view"}),this.addHandles([(0,A.hA)((()=>n.fileInfos.removeAll())),(0,l.watch)((()=>n.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}))],Be.exit)}_initializeFeatureFormViewModel(){const{edits:e,formTemplate:t,viewModel:{view:i}}=this.data,a=this._featureFormViewModel=new Ie.A({arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:t,highlightHelper:this._highlightHelper,map:null===i||void 0===i?void 0:i.map,spatialReference:i.spatialReference,timeZone:null===i||void 0===i?void 0:i.timeZone});a.relatedRecordCallbacks={...this.data.relatedRecordCallbacks,showAllRelatedRecords:e=>a.relationshipId=e.relationshipId};const{initialFeature:n}=e;n&&a.overrideInitialFeature(n),this.addHandles([a.on("value-change",(()=>{e.updateAttributes(a.getValues()),this.fullFeature.attributes=e.feature.attributes})),(0,l.watch)((()=>null===i||void 0===i?void 0:i.timeZone),(e=>a.timeZone=e))])}_onFullFeatureLoaded(e){this.fullFeature=e;const{edits:t}=this.data;t.updateAttributes(e.attributes),t.trackChanges()}static async create(e){const t=new Ne({data:await He.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){const{attachmentsViewModel:t}=e.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){t.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){t.mode="view"}}]}};var $e;qe._onCommitFactory=e=>async t=>{const{edits:i}=t,{feature:a}=i;if(!a)return;const n=a.sourceLayer,o=a.clone();if(!i.attributesModified||i.stagedForDelete){const e=n.objectIdField;if(o.attributes={[e]:a.getAttribute(e)},(0,Q.Vo)()&&(0,Q.lC)()&&"scene"===n.type&&null!=n.infoFor3D){var s;const e=null===(s=n.associatedLayer)||void 0===s?void 0:s.globalIdField;null!=e&&o.setAttribute(e,a.getAttribute(e))}}i.geometryModified&&!i.stagedForDelete||(o.geometry=null);const r=i.stagedForDelete?"deleteFeatures":"updateFeatures";await e(n,{[r]:[o]})},(0,a._)([(0,d.MZ)()],qe.prototype,"editorItem",null),(0,a._)([(0,d.MZ)()],qe.prototype,"featureFormViewModel",null),(0,a._)([(0,d.MZ)()],qe.prototype,"fullFeature",void 0),(0,a._)([(0,d.MZ)()],qe.prototype,"hasPendingEdits",null),(0,a._)([(0,d.MZ)()],qe.prototype,"layer",null),(0,a._)([(0,d.MZ)()],qe.prototype,"parent",null),(0,a._)([(0,d.MZ)()],qe.prototype,"parentLayer",null),(0,a._)([(0,d.MZ)()],qe.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.MZ)()],qe.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.MZ)()],qe.prototype,"reliesOnOwnerAdminPrivileges",null),qe=Ne=(0,a._)([(0,c.$)("esri.widgets.Editor.UpdateRecordWorkflow")],qe);const je={...Be,highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol()};let Qe=$e=class extends qe{constructor(e){super(e),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){var e;null===(e=this._layerViewEditSession)||void 0===e||e.rollback()}async commit(){this.removeHandles(je.sketchGraphics);try{const e=this.data.edits.stagedForDelete;await super.commit();const t=this._layerViewEditSession;e?null===t||void 0===t||t.rollback():null===t||void 0===t||t.commit()}catch(Je){throw await this._configureSketchViewModel(),new k.A("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:Je})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles(this._featureFormViewModel.on("value-change",(e=>{var t;null===(t=this._layerViewEditSession)||void 0===t||t.setAttribute(e.fieldName,e.value)})))}_configureHighlight(){const{edits:e,layerView:t}=this.data;(0,xe.Of)(t)&&this.addHandles(t.highlight(e.feature),je.highlights)}async _configureSketchViewModel(){const e=this._sketchViewModel;if(!e)return;const{data:t,_featureFormViewModel:i,_sketchGraphicClone:a}=this,{edits:n,viewModel:o}=t,s=n.feature,{view:d}=o,c=ae(s),u=await async function(e){var t;let{feature:i,featureClone:a,visualVariableAttributes:n,sketchViewModel:o,view:s,onUpdate:d,webStyleCache:c}=e;await oe(a,c,"2d"===s.type?s.scale:null);let u=null;if("2d"===(null===o||void 0===o||null===(t=o.view)||void 0===t?void 0:t.type)){const e=(0,r.sg)((e=>oe(a,c,e)));u=(0,l.watch)((()=>{var e;return null===o||void 0===o||null===(e=o.view)||void 0===e?void 0:e.scale}),(t=>e(t)))}const p=a.sourceLayer,h=ye(s,p);await ue({graphic:a,sketchViewModel:o,sourceLayer:p,visualVariables:n,webStyleCache:c});let v=null;h.then((e=>v=e)).catch((()=>{}));const w=n.size,f=n.rotation,m=(0,l.watch)((()=>i.attributes),(async e=>{let t=!1;for(const i in e){const n=e[i];n!==a.getAttribute(i)&&(a.setAttribute(i,n),null==w||w.isUpdatingInteractively||w.field!==i||w.initValue(n),null==f||f.isUpdatingInteractively||f.field!==i||f.initValue(n),(null==v||v.requiredFields.includes(i))&&(t=!0))}t&&await oe(a,c,"2d"===s.type?s.scale:null)})),g=o.on("update",(async e=>{const t=e.graphics[0];if("complete"===e.state)return ue({graphic:t,sketchViewModel:o,sourceLayer:p,visualVariables:n,webStyleCache:c});await pe(s,t,e,n,c),d(_e(t),e)})),y=o.on(["undo","redo"],(async e=>{d(_e(e.graphics[0]),e)}));return(0,A.vE)([y,g,(0,A.hA)((()=>o.cancel())),m,u])}({feature:s,featureClone:a,visualVariableAttributes:c,sketchViewModel:e,view:d,onUpdate:(e,t)=>{let{geometry:a,attributes:o}=e;if(n.updateAttributes(o),n.updateGeometry(a),i.feature.geometry=a,null!=c.rotation){const{field:e}=c.rotation;i.setValue(e,o[e])}if(null!=c.size){const{field:e}=c.size;i.setValue(e,o[e])}("undo"===t.type||"redo"===t.type||"update"===t.type&&null!=t.toolEventInfo&&ge(t.toolEventInfo.type))&&i.notifyFeatureGeometryChanged()},webStyleCache:this._webStyleCache});this.addHandles(u,je.sketchGraphics),e.addHandles(u)}async _initializeSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,i=e.edits.feature,{capabilities:a,layer:n}=e.editorItem,{view:o}=e.viewModel;if(this.removeHandles([je.highlights,je.sketchGraphics,je.sketchViewModel]),!a.update.geometry)return{enter:async()=>{this.hasHandles(je.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([je.highlights])};const r=new I.default({elevationInfo:n.elevationInfo,internal:!0,listMode:"hide"}),l=new Ce.A({allowDeleteKey:!1,layer:r,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:o});return this._sketchViewModel=l,null!==o&&void 0!==o&&o.map.add(r),this.addHandles((0,A.hA)((()=>{null!==o&&void 0!==o&&o.destroyed||null!==o&&void 0!==o&&o.map.remove(r),r.destroy(),this._sketchViewModel=(0,s.pR)(l)})),je.sketchViewModel),await oe(t,this._webStyleCache,"2d"===(null===o||void 0===o?void 0:o.type)?o.scale:null),this.addHandles([await he(l,i,t)]),{enter:async()=>{this.hasHandles(je.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([je.sketchGraphics]),viewModel:l}}_onFullFeatureLoaded(e){super._onFullFeatureLoaded(e);const t=this._sketchGraphicClone=_e(e),{edits:i,layerView:a}=this.data;i.updateGeometry(e.geometry),i.trackChanges(),function(e){return"createInteractiveEditSession"in e}(a)&&(this._layerViewEditSession=a.createInteractiveEditSession(t))}static async create(e){const t=new $e({data:await ze.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}get test(){return{graphicClone:this._sketchGraphicClone,sketchViewModel:this._sketchViewModel}}};(0,a._)([(0,d.MZ)()],Qe.prototype,"_layerViewEditSession",void 0),(0,a._)([(0,d.MZ)()],Qe.prototype,"_sketchGraphicClone",void 0),(0,a._)([(0,d.MZ)()],Qe.prototype,"_sketchViewModel",void 0),Qe=$e=(0,a._)([(0,c.$)("esri.widgets.Editor.UpdateFeatureWorkflow")],Qe);let Je=class extends D.A{constructor(e){super(e),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.candidates=null,this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};(0,a._)([(0,d.MZ)()],Je.prototype,"addAttachmentsCallback",void 0),(0,a._)([(0,d.MZ)()],Je.prototype,"applyEditsCallback",void 0),(0,a._)([(0,d.MZ)()],Je.prototype,"candidates",void 0),(0,a._)([(0,d.MZ)()],Je.prototype,"rootFeature",void 0),(0,a._)([(0,d.MZ)({constructOnly:!0})],Je.prototype,"sketchOptions",void 0),(0,a._)([(0,d.MZ)()],Je.prototype,"snappingManager",void 0),(0,a._)([(0,d.MZ)()],Je.prototype,"viewModel",void 0),Je=(0,a._)([(0,c.$)("esri.widgets.Editor.UpdateWorkflowData")],Je);const Xe=Je;var Ye,et=i(9912);const tt="esri.widgets.Editor.UpdateWorkflow";let it=Ye=class extends Ae{constructor(e){super(e),this._workflowStack=new Ze.A(Te.HV),this._sketchStack=new Ze.A(Te.HV),this.type="update"}get activeEditorItem(){var e,t;return null!==(e=null===(t=this.activeWorkflow)||void 0===t?void 0:t.data.editorItem)&&void 0!==e?e:void 0}get activeFeatureFormViewModel(){var e;return null===(e=this.activeWorkflow)||void 0===e?void 0:e.featureFormViewModel}get activeSketchViewModel(){var e;return null===(e=this._sketchStack.peek())||void 0===e?void 0:e.viewModel}get activeWorkflow(){return this._workflowStack.last()}get hasUpdatableCandidates(){const{candidates:e,viewModel:t}=this.data;return e.some((e=>{var i;let{layer:a}=e;return null===(i=t.findEditorItemForLayer(a))||void 0===i?void 0:i.supportsUpdateWorkflow}))}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var e;return!(null===(e=this.activeEditorItem)||void 0===e||!e.capabilities.attachments.enabled)}get shouldAllowAttachmentEditing(){var e;return!(null===(e=this.activeEditorItem)||void 0===e||!e.capabilities.update.attachments.enabled)}get hasPendingEdits(){return Array.from(this._workflowStack).some((e=>e.hasPendingEdits))}get helpMessage(){var e;return null!==(e=this.activeWorkflow)&&void 0!==e&&e.helpMessage?this.activeWorkflow.helpMessage:"awaiting-feature-to-update"===this.stepId?"select":void 0}get reliesOnOwnerAdminPrivileges(){var e,t;return null!==(e=null===(t=this.activeWorkflow)||void 0===t?void 0:t.reliesOnOwnerAdminPrivileges)&&void 0!==e&&e}get hasInvalidFormTemplate(){var e;return!(null===(e=this.activeEditorItem)||void 0===e||!e.hasInvalidFormTemplate)}async back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Promise.resolve(!0);const{activeWorkflow:t}=this;if(null==(null===t||void 0===t?void 0:t.featureFormViewModel.relationshipId))if(t){if(t.hasPendingEdits&&!await e())return;t.hasPreviousStep?await t.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else t.featureFormViewModel.relationshipId=null}async cancelActiveWorkflow(e){var t;await(null===(t=this.activeWorkflow)||void 0===t?void 0:t.cancel(e)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack((e=>e.commit())),await super.commit()}static create(e){var t;const{viewModel:i,snappingManager:a,startAt:n,addAttachmentsCallback:o,applyEditsCallback:s}=e,r=null!==(t=e.sketchOptions)&&void 0!==t?t:new W.A,l=new Ye({data:new Xe({addAttachmentsCallback:o,applyEditsCallback:s,sketchOptions:r,snappingManager:a,viewModel:i}),onCommit:async()=>{}});return l._set("steps",this._createWorkflowSteps(l,n)),l}async save(){var e;this.nestedWorkflowCount>1?(await(null===(e=this.activeWorkflow)||void 0===e?void 0:e.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(e){try{const t=await this._createNestedCreateFeaturesWorkflow(e);await this._pushWorkflow(t)}catch(g){throw new k.A("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:g})}}async startUpdating(e){try{const t=await this._createNestedUpdateWorkflow(e);await this._pushWorkflow(t)}catch(g){throw new k.A("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:g})}}async deleteActiveFeature(){const{activeWorkflow:e}=this;if(!e)throw new k.A("editor:nothing-to-delete","There is no feature to delete");nt(e)?await e.deleteAndCommit():await e.cancel(),1===this.nestedWorkflowCount?await this.reset():await this._popWorkflow()}async cancelAll(){await this._drainWorkflowStack((e=>e.cancel({force:!0})))}async _createNestedCreateFeaturesWorkflow(e){var t;const{relatedLayer:i}=e,{addAttachmentsCallback:a,applyEditsCallback:n,sketchOptions:o,snappingManager:s,viewModel:r}=this.data;if(!(0,C.S)(i))throw new k.A("editor:unsupported-layer","Editing is not supported on the provided layer");const l=this._getCreationInfoForNestedCreateFeaturesWorkflow(e),d=l.template||l.initialFeature?"creating-features":"awaiting-feature-creation-info",c="create-features"!==(null===(t=this.activeWorkflow)||void 0===t?void 0:t.type)?this.activeWorkflow:void 0;return Oe.create({addAttachmentsCallback:a,applyEditsCallback:n,creationInfo:l,isNested:!0,parent:c,sketchOptions:o,snappingManager:s,startAt:d,viewModel:r})}_getCreationInfoForNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e;if(!(0,C.S)(t)||(0,E.F2)(t))throw new k.A("editor:unsupported-layer","Editing is not supported on the provided layer");const i={layer:t,maxFeatures:1},a=this._makeRelatedRecordAttributes(e),n=(0,ie.r)(t);return(null===n||void 0===n?void 0:n.length)>0?(i.attributeOverrides=a,1===n.length&&(i.template=n[0])):i.initialFeature=new T.A({sourceLayer:t,attributes:a}),i}async _createNestedUpdateWorkflow(e){var t;const i=(0,E.bI)(e.sourceLayer)?qe:Qe,{applyEditsCallback:a,sketchOptions:n,snappingManager:o,viewModel:s}=this.data,r="create-features"!==(null===(t=this.activeWorkflow)||void 0===t?void 0:t.type)?this.activeWorkflow:void 0,d=await i.create({feature:e,parent:r,sketchOptions:n,snappingManager:o,viewModel:s,applyEdits:a,relatedRecordCallbacks:{addRelatedRecord:async e=>await this.startCreatingRelatedRecord(e),editRelatedRecord:async e=>{let{relatedFeature:t}=e;return await this.startUpdating(t)}}});return await(0,l.whenOnce)((()=>!d.updating)),d}async _drainWorkflowStack(e){const t=this._workflowStack,i=[];for(;t.length>0;){const a=t.pop();this._sketchStack.pop();const n=e(a).then((()=>a.destroy()));this._updatingHandles.addPromise(n),i.push(n)}await Promise.all(i)}_makeRelatedRecordAttributes(e){var t,i;const{parentFeature:a,relatedLayer:n,relationshipId:o}=e;if(!(0,et.n1)(a))return;const s=null===(t=n.relationships)||void 0===t?void 0:t.find((e=>e.id===o));if(!s)return void at("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if("origin"===s.role)return void at("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const r=a.sourceLayer;s.relatedTableId!==r.layerId&&at("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const l=null===(i=r.relationships)||void 0===i?void 0:i.find((e=>e.id===o));if(!l)return void at("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const d=a.getAttribute(l.keyField);return d||at("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[s.keyField]:d}}async _popWorkflow(){var e;null!==(e=this._workflowStack.pop())&&void 0!==e&&e.destroy(),this._sketchStack.pop();const t=await this._reconcileWorkflowStack();if(t.failureCount>0)throw new k.A("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",t)}async _pushWorkflow(e){var t;const i=this._workflowRequiresSketchViewModel(e);null===(t=this.activeWorkflow)||void 0===t||t.exit({removeSketchHandles:i});const a=this._sketchStack,n=await(null===e||void 0===e?void 0:e.start()),o=a.peek();n?(null!==o&&void 0!==o&&o.exit(),a.push(n)):a.push(this._cloneSketchController(o)),this._workflowStack.push(e);const s=await this._reconcileWorkflowStack();if(s.failureCount>0)throw new k.A("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",s)}async _reconcileWorkflowStack(){const e=this._workflowStack,t=this._sketchStack;try{var i;const a=e.peek();return await(null===a||void 0===a?void 0:a.enter()),await(null===(i=t.peek())||void 0===i?void 0:i.enter()),{activeWorkflow:a,failureCount:0}}catch(y){e.pop().destroy(),t.pop();const{activeWorkflow:a,failureCount:n}=await this._reconcileWorkflowStack();return{activeWorkflow:a,failureCount:n+1}}}_cloneSketchController(e){var t,i;return{enter:null!==(t=null===e||void 0===e?void 0:e.enter)&&void 0!==t?t:async()=>{},exit:null!==(i=null===e||void 0===e?void 0:e.exit)&&void 0!==i?i:async()=>{},viewModel:null===e||void 0===e?void 0:e.viewModel}}_workflowRequiresSketchViewModel(e){var t;const{type:i}=e;return"update-feature"===i||"create-features"===i&&!(0,E.bI)(null===(t=e.data.creationInfo)||void 0===t?void 0:t.layer)}static _createWorkflowSteps(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-to-update";const{data:i}=e;return fe(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],t,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:t}=i.viewModel,a=i.viewModel.view;let n=null;e.addHandles((0,A.hA)((()=>{n=(0,s.DC)(n)})),this.id),i.rootFeature=null,i.candidates=[];const o=a.on("immediate-click",(async o=>{var s;t.location=o.mapPoint,t.visible=!0,null===(s=n)||void 0===s||s.abort();const{editorItems:l}=i.viewModel;n=new AbortController;const d=await o.async((()=>new Promise(((e,t)=>{var i,s;(0,r.u7)(null===(i=n)||void 0===i?void 0:i.signal,(()=>t((0,r.NK)()))),e(de(l,a,o,null===(s=n)||void 0===s?void 0:s.signal))}))));(0,r.Te)(n),i.candidates=d.filter((e=>"fulfilled"===e.status)).flatMap((e=>e.value)),t.visible=1===i.candidates.length,0!==i.candidates.length&&(o.stopPropagation(),1===i.candidates.length?(i.rootFeature=i.candidates[0],e.go("editing-existing-feature").catch((()=>{})).then((()=>t.visible=!1))):e.next())}),U.o.TOOL);a.focus(),e.addHandles(o,this.id)},async tearDown(){0===i.candidates.length&&(i.viewModel.spinnerViewModel.visible=!1),e.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){i.rootFeature=null;const{view:t}=i.viewModel;if(!t)return;const a=new Pe.A({view:t});e.addHandles([(0,l.watch)((()=>i.rootFeature),((e,t)=>{a.remove(t),a.add(e)}),l.sync),(0,A.hA)((()=>a.removeAll()))],this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:t,viewModel:i}=e.data;if(!t)throw new k.A("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await e.startUpdating(t),i.spinnerViewModel.visible=!1;const a=(0,r.sg)((async()=>{await(0,l.whenOnce)((()=>!e.updating)),e.previous()}));e.addHandles([(0,l.watch)((()=>e.nestedWorkflowCount),((e,t)=>{0===e&&0!==t&&a()}),l.sync)],this.id)},async tearDown(){await e.cancelAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}})})}};(0,a._)([(0,d.MZ)()],it.prototype,"activeEditorItem",null),(0,a._)([(0,d.MZ)()],it.prototype,"activeFeatureFormViewModel",null),(0,a._)([(0,d.MZ)()],it.prototype,"activeSketchViewModel",null),(0,a._)([(0,d.MZ)()],it.prototype,"activeWorkflow",null),(0,a._)([(0,d.MZ)()],it.prototype,"hasUpdatableCandidates",null),(0,a._)([(0,d.MZ)()],it.prototype,"nestedWorkflowCount",null),(0,a._)([(0,d.MZ)()],it.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.MZ)()],it.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.MZ)()],it.prototype,"hasPendingEdits",null),(0,a._)([(0,d.MZ)()],it.prototype,"helpMessage",null),(0,a._)([(0,d.MZ)()],it.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.MZ)()],it.prototype,"hasInvalidFormTemplate",null),it=Ye=(0,a._)([(0,c.$)(tt)],it);const at=(e,t)=>o.A.getLogger(tt).warn("editor:".concat(e),t,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),nt=e=>!!e&&/update-/.test(e.type),ot=it;let st=class extends D.A{constructor(e){super(e),this.layer=null}get attachments(){var e;return{enabled:this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.data.supportsAttachment)}}get create(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=this._createEnabled,n=a,o=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsAdd,s=!(null===t||void 0===t||!t.operations.supportsAdd);return{attachments:{enabled:a&&this.attachments.enabled},attributes:a,enabled:a,geometry:n,reliesOnOwnerAdminPrivileges:!o&&s}}get delete(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsDelete,n=!(null===t||void 0===t||!t.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!(null===t||void 0===t||!t.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!a&&n}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=this._updateEnabled,n=!(!a||null===t||void 0===t||!t.editing.supportsGeometryUpdate),o=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsUpdate,s=!(null===t||void 0===t||!t.operations.supportsUpdate),r=this.attachments.enabled,l=r&&this._canCreateOrUpdate;return{attachments:{enabled:r,create:l,update:l},attributes:a,enabled:a,geometry:n,reliesOnOwnerAdminPrivileges:!o&&s}}get _createEnabled(){var e;return this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.operations.supportsAdd)}get _updateEnabled(){var e;return this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return(0,E.tk)(this.layer)}get _effectiveCapabilities(){return(0,E.BR)(this.layer)}};(0,a._)([(0,d.MZ)()],st.prototype,"attachments",null),(0,a._)([(0,d.MZ)()],st.prototype,"create",null),(0,a._)([(0,d.MZ)()],st.prototype,"delete",null),(0,a._)([(0,d.MZ)()],st.prototype,"layer",void 0),(0,a._)([(0,d.MZ)()],st.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.MZ)()],st.prototype,"update",null),(0,a._)([(0,d.MZ)()],st.prototype,"_createEnabled",null),(0,a._)([(0,d.MZ)()],st.prototype,"_updateEnabled",null),(0,a._)([(0,d.MZ)()],st.prototype,"_canCreateOrUpdate",null),(0,a._)([(0,d.MZ)()],st.prototype,"_effectiveEnabled",null),(0,a._)([(0,d.MZ)()],st.prototype,"_effectiveCapabilities",null),st=(0,a._)([(0,c.$)("esri.layers.support.EditingCapabilities")],st);const rt=st;var lt=i(80963),dt=i(19463),ct=i(64465);const ut="esri.views.layers.support.editableLayerViews";let pt=class extends rt{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==(null===t||void 0===t?void 0:t.allowAttachments)&&!1!==(null===t||void 0===t?void 0:t.enabled)}}get create(){const{attachments:e,defaults:t,layerInfo:i,layer:a,layerView:n}=this,o=t.create,s=!1!==(null===i||void 0===i?void 0:i.enabled)&&!1!==(null===i||void 0===i?void 0:i.addEnabled),r=o.enabled&&s;return{attributes:r&&o.attributes,enabled:r,geometry:r&&o.geometry&&ht(a,n),attachments:{enabled:e.enabled&&r&&!1!==(null===i||void 0===i?void 0:i.attachmentsOnCreateEnabled)},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}get defaults(){return new rt({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,i=e.delete,a=!1!==(null===t||void 0===t?void 0:t.enabled)&&!1!==(null===t||void 0===t?void 0:t.deleteEnabled);return{enabled:i.enabled&&a,reliesOnOwnerAdminPrivileges:i.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return null!==t&&void 0!==t&&t.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){var e,t;const{layer:i}=this,a=!(!(0,et.sS)(i)||null===(e=i.relationships)||void 0===e||!e.length),n=!(null===(t=this.formTemplate)||void 0===t||null===(t=t.elements)||void 0===t||!t.some((e=>"relationship"===e.type)));return{enabled:a&&n}}get update(){const{attachments:e,defaults:t,layerInfo:i,layer:a,layerView:n}=this,o=t.update,s=!1!==(null===i||void 0===i?void 0:i.enabled)&&!1!==(null===i||void 0===i?void 0:i.updateEnabled),r=o.enabled&&s,l=r&&o.attributes&&!1!==(null===i||void 0===i?void 0:i.attributeUpdatesEnabled),d=r&&o.geometry&&!1!==(null===i||void 0===i?void 0:i.geometryUpdatesEnabled)&&ht(a,n),c=e.enabled&&!1!==(null===i||void 0===i?void 0:i.attachmentsOnUpdateEnabled);return{attributes:l,enabled:r,geometry:d,attachments:{enabled:c,create:c&&o.attachments.create,update:c&&o.attachments.update},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}};function ht(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&function(e,t){var i,a,n,s,r,l,d;const{associatedLayer:c}=e,u=null===c||void 0===c?void 0:c.infoFor3D;if(!u)return!1;const{supportedFormats:p,queryFormats:h}=u,v=null!==(i=(0,dt.R_)("model/gltf-binary",p))&&void 0!==i?i:(0,dt.E1)("glb",p);if(null==v||!h.includes(v))return o.A.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(a=e.title)&&void 0!==a?a:"Untitled layer",", ").concat(e.id,") does not support geometry edits because it does not support GLB queries.")),!1;const w=e.spatialReference,f=c.spatialReference;if(!(0,lt.aI)(w,f))return o.A.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(n=e.title)&&void 0!==n?n:"Untitled layer",", ").concat(e.id,") does not support geometry edits because its spatial reference (wkid:").concat(w.wkid,") is different from its associated FeatureLayer's spatial reference (wkid:").concat(f.wkid,").")),!1;const m=c.sourceJSON.sourceSpatialReference;if(null!=m&&!(0,lt.aI)(m,f))return o.A.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(s=e.title)&&void 0!==s?s:"Untitled layer",", ").concat(e.id,") does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:").concat(f.wkid,") is different from its source spatial reference (wkid:").concat(m.wkid,").")),!1;const{view:{spatialReference:g,state:{viewingMode:y}}}=t,_=(0,lt.EA)(w),b=y===ct.RT.Global;return _&&!b?(o.A.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(r=e.title)&&void 0!==r?r:"Untitled layer",", ").concat(e.id,") does not support geometry edits in local viewing mode because its spatial reference (wkid:").concat(w.wkid,") is geographic. Please consider changing the viewing mode to global.")),!1):!_&&b?(o.A.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(l=e.title)&&void 0!==l?l:"Untitled layer",", ").concat(e.id,") does not support geometry edits in global viewing mode because its spatial reference (wkid:").concat(w.wkid,") is projected. Please consider changing the viewing mode to local.")),!1):!!((0,lt.aI)(w,g)||b&&(0,lt.K8)(g)&&(0,lt.oT)(w))||(o.A.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(d=e.title)&&void 0!==d?d:"Untitled layer",", ").concat(e.id,") does not support geometry edits because its spatial reference (wkid:").concat(w.wkid,") does not match the view spatial reference (wkid:").concat(g.wkid,").")),!1)}(e,t)}(0,a._)([(0,d.MZ)()],pt.prototype,"attachments",null),(0,a._)([(0,d.MZ)()],pt.prototype,"create",null),(0,a._)([(0,d.MZ)()],pt.prototype,"defaults",null),(0,a._)([(0,d.MZ)()],pt.prototype,"delete",null),(0,a._)([(0,d.MZ)()],pt.prototype,"formTemplate",null),(0,a._)([(0,d.MZ)()],pt.prototype,"layerInfo",void 0),(0,a._)([(0,d.MZ)()],pt.prototype,"layerView",void 0),(0,a._)([(0,d.MZ)()],pt.prototype,"relationship",null),(0,a._)([(0,d.MZ)()],pt.prototype,"update",null),pt=(0,a._)([(0,c.$)("esri.widgets.Editor.support.EditorEditingCapabilities")],pt);const vt=pt;var wt=i(3320);let ft=class extends D.A{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var e;return!(null===(e=this.layerView)||void 0===e||!e.suspended)}get capabilities(){return new vt({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:i,delete:{enabled:a}}=this.capabilities,n=e.attachments.enabled||i.attachments.enabled;return!this.disabled&&(e.enabled||i.enabled||n||a||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return(0,wt.lB)(this.layer,this.formTemplate)}get isTable(){return(0,E.bI)(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;const{enabled:e,geometry:t}=this.capabilities.create;return this.isTable?e:e&&t}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};(0,a._)([(0,d.MZ)()],ft.prototype,"_suspended",null),(0,a._)([(0,d.MZ)()],ft.prototype,"capabilities",null),(0,a._)([(0,d.MZ)()],ft.prototype,"disabled",void 0),(0,a._)([(0,d.MZ)()],ft.prototype,"editable",null),(0,a._)([(0,d.MZ)()],ft.prototype,"formTemplate",null),(0,a._)([(0,d.MZ)()],ft.prototype,"hasInvalidFormTemplate",null),(0,a._)([(0,d.MZ)()],ft.prototype,"isTable",null),(0,a._)([(0,d.MZ)()],ft.prototype,"layer",void 0),(0,a._)([(0,d.MZ)()],ft.prototype,"layerInfo",void 0),(0,a._)([(0,d.MZ)()],ft.prototype,"layerView",void 0),(0,a._)([(0,d.MZ)()],ft.prototype,"supportsCreateFeaturesWorkflow",null),(0,a._)([(0,d.MZ)()],ft.prototype,"supportsUpdateWorkflow",null),(0,a._)([(0,d.MZ)()],ft.prototype,"visible",null),ft=(0,a._)([(0,c.$)("esri.widgets.editor.support.EditorItem")],ft);const mt=ft;var gt=i(24203),yt=i(44371);const _t="esri.widgets.Editor.EditorViewModel",bt=()=>o.A.getLogger(_t),kt=["create-features","update"];function Mt(e,t,i){bt().error(new k.A(e,t,i))}function At(e,t){return null===e||void 0===e?void 0:e.find((e=>e.layer===t))}let Ft=class extends M.A.EventedAccessor{constructor(e){var t;super(e),t=this,this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new I.default({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updatingHandles=new F.U,this._featureTemplatesViewModelLocked=!1,this.activeWorkflow=null,this._activityQueue=new b.A,this.editorItems=new b.A,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new Z.A({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new gt.A({disabledItemFunction:e=>{let{layer:t}=e;return this._itemIsSuspended(t)}}),this.ownSketchViewModel=new Ce.A({layer:this._sketchGraphicsLayer}),this.sketchOptions=new W.A,this.snappingOptions=new O.A,this.spinnerViewModel=new yt.A,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var e;this.canGoBack&&(null!==(e=this.activeWorkflow)&&void 0!==e&&e.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var e;const{featureFormViewModel:t}=this;if(t){if(t.submit(),!t.submittable)return;const e=t.getValues();if(t.validateContingencyConstraints(e,{includeIncompleteViolations:!0}).length>0)return}await(null===(e=this.activeWorkflow)||void 0===e?void 0:e.save())},this.selectFeature=function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=t.activeWorkflow;t._candidateCommitted||"update"!==(null===a||void 0===a?void 0:a.type)||(a.data.rootFeature=e,i&&(a.next(),t._candidateCommitted=!0))}}initialize(){this.addHandles([(0,l.watch)((()=>{var e;const t=this.view,i=null===t||void 0===t||null===(e=t.map)||void 0===e?void 0:e.editableLayers,a=null===t||void 0===t?void 0:t.allLayerViews,n=null===a||void 0===a?void 0:a.filter((e=>!(null===i||void 0===i||!i.includes(e.layer))));return[i,n,this.layerInfos,this.allowedWorkflows]}),(()=>this._updateEditorItems()),l.syncAndInitial),(0,l.watch)((()=>this.hideTemplatesForInactiveLayers),(()=>this.syncFeatureTemplates())),(0,l.on)((()=>this.activeWorkflow),"cancel",(()=>this.emit("workflow-cancel"))),(0,l.on)((()=>this.activeWorkflow),"commit",(()=>this.emit("workflow-commit"))),(0,l.on)((()=>this.activeWorkflow),"complete",(()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)})),(0,l.when)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map}),(e=>e.add(this._sketchGraphicsLayer)),l.initial),(0,l.on)((()=>this.editorItems),"change",(()=>this._afterEditorItemsChange())),(0,l.watch)((()=>[this.canCreate,this.canUpdateVisible]),(()=>this._afterEditorItemsChange())),(0,l.watch)((()=>this.page),((e,t)=>{const i=[...this.pageStack];if(-1===i.indexOf(e))i.push(e);else for(;i.length&&i.at(-1)!==e;)i.pop();this.pageStack=i}),l.syncAndInitial),(0,l.when)((()=>"awaiting-update-feature-candidate"===this.state),(()=>this._candidateCommitted=!1)),(0,l.on)((()=>this.featureTemplatesViewModel),"select",(async e=>{let{item:t,oldItem:i}=e;const{activeWorkflow:a}=this;if(a){var n;if("update"===a.type&&"awaiting-feature-creation-info"===(null===(n=a.activeWorkflow)||void 0===n?void 0:n.stepId))return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(i,{emit:!1})}}if(!t)return;const o={layer:t.layer,template:t.template};if(t.supportsUpload)return this.featureTemplatesViewModel.select(i,{emit:!1}),this.startCreateFeaturesWorkflow(o);this.startCreateFeaturesWorkflowAtFeatureCreation(o)})),(0,l.on)((()=>this.view),"key-down",(e=>{var t;"Escape"===e.key&&(null===(t=this.activeWorkflow)||void 0===t?void 0:t.keyboardCancellationEnabled)&&(e.stopPropagation(),this.back())})),(0,l.on)((()=>this.sketchViewModel),["create","delete","update"],(e=>{var t,i;const{activeWorkflow:a}=this,n="update"===(null===a||void 0===a?void 0:a.type),o=n?null===(t=a.activeWorkflow)||void 0===t?void 0:t.layer:null===a||void 0===a?void 0:a.layer,s=n?null===a||void 0===a||null===(i=a.activeWorkflow)||void 0===i?void 0:i.parentLayer:void 0,r="sketch-".concat(e.type);this.emit(r,{type:r,detail:e,layer:o,parentLayer:s})}),l.sync),(0,l.watch)((()=>this.view),(e=>{if(this._snappingManager=(0,s.pR)(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new V.g({view:e,options:t})}),l.syncAndInitial),(0,l.watch)((()=>this.snappingOptions),(e=>{this._snappingManager&&(this._snappingManager.options=e)}),l.syncAndInitial)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then((()=>{var e;null!==(e=this.view)&&void 0!==e&&null!==(e=e.map)&&void 0!==e&&e.remove(this._sketchGraphicsLayer),this.view=null})),this._updateItemsTask=(0,s.DC)(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=(0,s.xt)(this._sketchEventListenerHandle)}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(e){(0,n.Lx)(o.A.getLogger(this),"allowedWorkflows",{replacement:"Editor.visibleElements",version:"4.29",warnOnce:!0}),e&&0!==e.length||(e=[...kt]),this._set("allowedWorkflows",e)}get canCreate(){return this.editorItems.some((e=>e.supportsCreateFeaturesWorkflow))}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some((e=>e.supportsUpdateWorkflow))}get canUpdateVisible(){return this.editorItems.some((e=>e.supportsUpdateWorkflow&&e.visible))}get featureTemplatesLayers(){const e=new b.A;for(const t of this.editorItems){const i=t.supportsCreateFeaturesWorkflow&&!t.isTable,a=this.hideTemplatesForInactiveLayers&&!t.visible;i&&!a&&e.push(t.layer)}return e}get editableItems(){return(0,n.Lx)(o.A.getLogger(this),"editableItems",{replacement:"editorItems",version:"4.29",warnOnce:!0}),this.editorItems.map((e=>{const{capabilities:t,disabled:i,hasInvalidFormTemplate:a,layer:n}=e,o=[],s=t.create,r=t.update,l=t.delete;return s.enabled&&o.push("create"),r.enabled&&o.push("update"),l.enabled&&o.push("delete"),{layer:n,supports:o,suspended:i,attributeUpdatesEnabled:r.attributes,geometryUpdatesEnabled:r.geometry,attachmentsOnCreateEnabled:s.attachments.enabled,attachmentsOnUpdateEnabled:r.attachments.enabled,hasInvalidFormTemplate:a,hasAttachments:t.attachments.enabled}}))}get featureFormViewModel(){const{activeWorkflow:e}=this;return"update"===(null===e||void 0===e?void 0:e.type)?e.activeFeatureFormViewModel:"create-features"===(null===e||void 0===e?void 0:e.type)?e.featureFormViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}set layerInfos(e){(null===e||void 0===e?void 0:e.some((e=>"allowAttachments"in e)))&&(0,n.io)(bt(),"Property: layerInfo.allowAttachments",{replacement:"layerInfo.attachmentsOnCreateEnabled or layerInfo.attachmentsOnUpdateEnabled",version:"4.26"}),this._set("layerInfos",e)}get sketchViewModel(){const{activeWorkflow:e}=this;return"update"===(null===e||void 0===e?void 0:e.type)?e.activeSketchViewModel:"create-features"===(null===e||void 0===e?void 0:e.type)?e.sketchViewModel:this.ownSketchViewModel}get state(){var e,t;if(null===(e=this.view)||void 0===e||!e.ready)return"disabled";const i=this.attachmentsViewModel.mode;if("add"===i)return"adding-attachment";if("edit"===i)return"editing-attachment";const{activeWorkflow:a}=this;return null!==a&&void 0!==a&&a.stepId?"update"===a.type&&null!==(t=a.activeWorkflow)&&void 0!==t&&t.stepId?a.activeWorkflow.stepId:a.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var e;return this._updatingHandles.updating||!0===(null===(e=this.activeWorkflow)||void 0===e?void 0:e.updating)}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get page(){const{activeWorkflow:e,state:t}=this;if("update"===(null===e||void 0===e?void 0:e.type)&&"awaiting-feature-to-update"===e.stepId)return"ready";if("create-features"===(null===e||void 0===e?void 0:e.type)&&0===e.numPendingFeatures){const t=e.data.upload;if(t)return"default"===t.state?"ready":"creating-features-upload-details"}return null!==t&&void 0!==t?t:"disabled"}get featureFormDisabled(){var e;const{activeWorkflow:t}=this;return"update"===(null===t||void 0===t?void 0:t.type)&&!1===(null===(e=t.activeEditorItem)||void 0===e?void 0:e.capabilities.update.attributes)}get canGoBack(){return null!=this.activeWorkflow&&!this.syncing}get shouldShowDeleteButton(){var e;const{activeWorkflow:t}=this;return!!t&&"update"===t.type&&!(null===(e=t.activeEditorItem)||void 0===e||!e.capabilities.delete.enabled)}get hasPendingEdits(){var e,t;return null!==(e=null===(t=this.activeWorkflow)||void 0===t?void 0:t.hasPendingEdits)&&void 0!==e&&e}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";if(await(0,l.whenOnce)((()=>!this.updating)),!this.canCreate)throw new k.A("editing:unsupported-workflow","Creating features is unsupported or disabled.");const i=this._createUpdatingResolver();await this._cancelWorkflow();const a=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",a),await a.start(),i.resolve()}async startCreateFeaturesWorkflowAtFeatureEdit(e){await(0,l.whenOnce)((()=>!this.updating));const t=this._createUpdatingResolver(),{initialFeature:i}=e,a=i.sourceLayer=i.layer,n=a?this.findEditorItemForLayer(a):void 0;if(null===n||void 0===n||!n.supportsCreateFeaturesWorkflow)throw new k.A("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const o=this._createCreateFeaturesWorkflow({initialFeature:i,layer:n.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",o),await o.start(),t.resolve()}async startUpdateWorkflowAtFeatureSelection(){if(await(0,l.whenOnce)((()=>!this.updating)),!this.canUpdate)return void Mt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();await this._cancelWorkflow();const t=this._createUpdateWorkflow();this._set("activeWorkflow",t),await t.start(),e.resolve()}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await(0,l.whenOnce)((()=>!this.updating)),!this.canUpdate)return void Mt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();await this._cancelWorkflow();const i=this._createUpdateWorkflow("awaiting-update-feature-candidate");i.data.candidates=e,this._set("activeWorkflow",i),await i.start(),t.resolve()}async startUpdateWorkflowAtFeatureEdit(e){if(await(0,l.whenOnce)((()=>!this.updating)),!this.canUpdate)return void Mt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();await this._cancelWorkflow();const i=this._createUpdateWorkflow("editing-existing-feature");i.data.rootFeature=e,this._set("activeWorkflow",i),await i.start(),t.resolve()}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?await e.deleteActiveFeature():Mt("editing:unsupported-workflow","Deleting requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditorItemForLayer(e){return this.editorItems.find((t=>t.layer===e))}itemHasInvalidFormTemplate(e){var t;return null!=e&&!0===(null===(t=this.findEditorItemForLayer(e.layer))||void 0===t?void 0:t.hasInvalidFormTemplate)}syncFeatureTemplates(){this._featureTemplatesViewModelLocked||(this.featureTemplatesViewModel.layers=this.featureTemplatesLayers.toArray())}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&"awaiting-feature-to-update"===this.state?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}lockFeatureTemplatesViewModel(){return this._featureTemplatesViewModelLocked=!0,(0,A.hA)((()=>{this._featureTemplatesViewModelLocked=!1,this.syncFeatureTemplates()}))}async _getEditorItemCandidates(e){var t,i;const{view:a}=this;if(null===a||void 0===a||!a.map)return[];const{map:n}=a,o=null!==(t=n.editableLayers.toArray())&&void 0!==t?t:[],s=null!==(i=n.allTables.toArray().filter(E.yZ))&&void 0!==i?i:[];return await Promise.allSettled([...o.map((e=>"subtype-group"===e.type?e.loadAll():Promise.resolve())),...s.map((e=>e.load()))]),(0,r.Te)(e),[...o.reverse(),...s.reverse()].filter((e=>(0,C.S)(e)&&("mesh"!==e.geometryType||"3d"===a.type))).flatMap((e=>"subtype-group"===e.type?e.sublayers.toArray():e))}_drainEditorItems(){this.editorItems.drain((e=>e.destroy()))}async _updateEditorItems(){(0,s.DC)(this._updateItemsTask);const{view:e}=this,t=(0,_.UT)((async t=>{if(null===e||void 0===e||!e.map||null===e||void 0===e||!e.allLayerViews)return;const i=await this._getEditorItemCandidates(t);if(!i.length)return void this._drainEditorItems();const a=[],n=[],o=[],{layerInfos:s}=this;for(const l of i){const t=At(s,l),i=await ye(e,l).catch((()=>null));(t?a:i?n:o).push(new mt({layer:l,layerInfo:t,layerView:i}))}(null===s||void 0===s?void 0:s.length)&&a.sort(((e,t)=>s.findIndex((t=>{let{layer:i}=t;return i===e.layer}))-s.findIndex((e=>{let{layer:i}=e;return i===t.layer}))));const r=[...a,...n,...o];t.aborted||(this._drainEditorItems(),this.editorItems.addMany(r))}));this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;"create-features"!==e.type?"update"===e.type&&("awaiting-feature-to-update"===t&&!this.canUpdateVisible||"awaiting-update-feature-candidate"===t&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():"awaiting-feature-creation-info"!==t||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(t)return e&&!1===e.force?(await t.cancel(e),void this._set("activeWorkflow",null)):(this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await t.cancel(e));(null===e||void 0===e?void 0:e.warnIfNoWorkflow)&&Mt("editing:no-active-workflow","There is no active workflow to cancel.")}_createCreateFeaturesWorkflow(e,t){return Oe.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(e,t,i)=>this._applyEdits(e,t,i),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_createUpdateWorkflow(e){return ot.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(e,t,i)=>this._applyEdits(e,t,i),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_addAttachments(e,t){var i;const a=null!==(i=t.map((t=>this._addAttachment(e,t.feature,t.attachment))))&&void 0!==i?i:[];return Promise.all(a)}async _addAttachment(e,t,i){var a;let n=null;if(!("addAttachment"in e)||null==(null===(a=e.capabilities)||void 0===a?void 0:a.attachment))throw new k.A("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation((async()=>{var a,o;return n=null!==(a=await(null===(o=e.addAttachment)||void 0===o?void 0:o.call(e,t,i).catch((e=>{throw(null===e||void 0===e?void 0:e.error)||e}))))&&void 0!==a?a:null,n})),n}async _applyEdits(e,t,i){let a=null;const n=e.url?await(0,E.wI)(e.url):null,o={returnServiceEditsOption:n&&(0,S.p)(n)||RegExp("/hosted/","i").test(e.url)?void 0:"original-and-current-features",...i};return await this._queueOperation((async()=>{const{view:i}=this;if(!i)return null;const n=await ye(i,e).catch((()=>null));return a=await e.applyEdits(t,o),n&&await(0,l.whenOnce)((()=>!n.updating)),a})),a}_queueOperation(e){this._activityQueue.push(e);const t=(e,t)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)};return e().then((e=>{if(null!=e&&"error"in e&&null!=e.error)throw e.error;if(null!=e&&"addFeatureResults"in e){const{addFeatureResults:t,deleteFeatureResults:i,updateFeatureResults:a}=e,n=t.find((e=>!!e.error))||a.find((e=>!!e.error))||i.find((e=>!!e.error));if(n)throw n.error}return e})).catch((i=>{Mt("editing:operation-error","An error occurred.",{error:i});const a={error:i,retry:()=>(t(a,this.failures),this._queueOperation(e)),cancel:()=>{t(a,this.failures)}};this._set("failures",[...this.failures,a])})).then((()=>{t(e,this._activityQueue)}))}_createUpdatingResolver(){const e=(0,r.Tw)();return this._updatingHandles.addPromise(e.promise),e}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return null!=t&&(!t.visible||t.disabled)}};(0,a._)([(0,d.MZ)({readOnly:!0})],Ft.prototype,"activeWorkflow",void 0),(0,a._)([(0,d.MZ)({readOnly:!0})],Ft.prototype,"_activityQueue",void 0),(0,a._)([(0,d.MZ)({value:[...kt]})],Ft.prototype,"allowedWorkflows",null),(0,a._)([(0,d.MZ)({readOnly:!0})],Ft.prototype,"canCreate",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"canCreateVisible",null),(0,a._)([(0,d.MZ)({readOnly:!0})],Ft.prototype,"canUpdate",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"canUpdateVisible",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"featureTemplatesLayers",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"editableItems",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"editorItems",void 0),(0,a._)([(0,d.MZ)({readOnly:!0})],Ft.prototype,"failures",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"hideTemplatesForInactiveLayers",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"attachmentsViewModel",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"featureFormViewModel",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"featureTemplatesViewModel",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"labelOptions",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"layerInfos",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"ownSketchViewModel",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"sketchOptions",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"sketchViewModel",null),(0,a._)([(0,d.MZ)({type:O.A,nonNullable:!0})],Ft.prototype,"snappingOptions",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"spinnerViewModel",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"state",null),(0,a._)([(0,d.MZ)({readOnly:!0})],Ft.prototype,"syncing",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"updating",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"tooltipOptions",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"valueOptions",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"view",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"pageStack",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"showDiscardEditsPrompt",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"_candidateCommitted",void 0),(0,a._)([(0,d.MZ)()],Ft.prototype,"page",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"featureFormDisabled",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"canGoBack",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"shouldShowDeleteButton",null),(0,a._)([(0,d.MZ)()],Ft.prototype,"hasPendingEdits",null),Ft=(0,a._)([(0,c.$)(_t)],Ft);const It=Ft,Ct="exclamation-mark-triangle";var Et=i(61750);let St=class extends D.A{constructor(e){super(e),this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.labelsToggle=!0,this.snappingControls=!0,this.snappingControlsElements=new Et.A,this.tooltipsToggle=!0,this.undoRedoButtons=!1}};(0,a._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"createFeaturesSection",void 0),(0,a._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"directionModePicker",void 0),(0,a._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"editFeaturesSection",void 0),(0,a._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"labelsToggle",void 0),(0,a._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"snappingControls",void 0),(0,a._)([(0,d.MZ)({type:Et.A,nonNullable:!0})],St.prototype,"snappingControlsElements",void 0),(0,a._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"tooltipsToggle",void 0),(0,a._)([(0,d.MZ)({type:Boolean,nonNullable:!0})],St.prototype,"undoRedoButtons",void 0),St=(0,a._)([(0,c.$)("esri.widgets.Editor.VisibleElements")],St);const Wt=St;var Vt=i(77666),Ot=i(76099),Zt=i(54761);const Tt="esri-editor__panel-content",Pt={base:Tt,message:"".concat(Tt,"__message"),section:"".concat(Tt,"__section"),sectionGroup:"".concat(Tt,"__section__group"),scrimContainer:"".concat(Tt,"__scrim-container")},xt=()=>(0,Vt.W)({scrim:()=>Promise.all([i.e(39879),i.e(62785),i.e(3735)]).then(i.bind(i,3735))});function Lt(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Zt.K)("div",{class:(0,Ot.Ly)(Pt.base,null!==e&&void 0!==e&&e.showScrimOverlay?Pt.scrimContainer:void 0),key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content"},...a,null!==e&&void 0!==e&&e.showScrimOverlay?(0,Zt.K)("calcite-scrim",null):void 0)}function Ut(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Zt.K)("div",{class:Pt.message,"data-testid":"panel-content-message",key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content-message"},...a)}function Kt(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Zt.K)("div",{class:Pt.section,key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content-section"},...a)}function Dt(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Zt.K)("div",{class:Pt.sectionGroup,key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content-section-group"},...a)}function Ht(e){let{helpMessage:t}=e;return(0,Zt.K)(Lt,{key:"creating-features-panel-content"},(0,Zt.K)(Ut,{key:"content-message"},t))}var Rt=i(37391);function Gt(e){let{editorItems:t,filterText:i,id:a,messagesTemplates:n,onFilterTextChange:o,onSelectFeature:s,workflow:r}=e;const l=new Map,d=r.data.candidates;let c=0;d.map((e=>({label:zt(e),id:e.attributes[e.layer.objectIdField],data:e}))).filter((e=>{let{label:a,data:n}=e;const o=i.toLowerCase(),{title:s}=n.layer,r=t.find((e=>e.layer===n.sourceLayer));return r?r.supportsUpdateWorkflow&&(!o||(null===a||void 0===a?void 0:a.toLowerCase().includes(o))||(null===s||void 0===s?void 0:s.toLowerCase().includes(o))):null})).filter(P.Ru).forEach((e=>{var t,i;c++;const a=e.data.layer;l.has(a)?null===(t=l.get(a))||void 0===t||t.items.push(e):l.set(a,{id:"".concat(a.id),label:null!==(i=a.title)&&void 0!==i?i:"",items:[e]})}));const u=t.toArray().map((e=>{let{layer:t}=e;return l.get(t)})).filter(P.Ru),p=c>10||i.length>0;return(0,Zt.K)(Lt,{key:"feature-list"},(0,Zt.K)(Kt,null,(0,Rt.kk)({enableListScroll:!1,filterEnabled:p,filterText:i,id:a,items:u,messages:{filterPlaceholder:n.filterPlaceholder,noItems:n.noItems,noMatches:n.noMatches},onFilterChange:e=>o(e),onItemMouseEnter:e=>s(e.data),onItemMouseLeave:()=>s(null),onItemSelect:e=>s(e.data,!0)})))}function zt(e){const t=e.layer;if(!t)return null;const i=t.fieldsIndex.get(t.objectIdField),a=i.alias||i.name,{attributes:n}=e,o=(0,N.mB)(t);return o&&n[o]&&"".concat(n[o])||"".concat(a,": ").concat(n[i.name])}const Nt={base:"esri-editor__actions"},Bt=()=>(0,Vt.W)({button:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(75151),i.e(11309)]).then(i.bind(i,11309))});function qt(e){let{buttons:t,key:i}=e;return(0,Zt.K)("div",{class:Nt.base,key:null!==i&&void 0!==i?i:"footer-actions",slot:"footer"},t.filter(P.Ru).map(((e,t)=>{let{disabled:i,onClick:a,label:n,...o}=e;return(0,Zt.K)("calcite-button",{disabled:null!==i&&void 0!==i&&i,key:"action-".concat(t),onclick:()=>{i||a()},slot:"footer-actions",width:"full",...o},n)})))}const $t={notice:"esri-editor__notice"},jt=()=>(0,Vt.W)({notice:()=>Promise.all([i.e(39879),i.e(62785),i.e(81985)]).then(i.bind(i,81985))});function Qt(e){let{workflow:t,messages:i}=e;return(0,Zt.K)(Zt.w,null,null!==t&&void 0!==t&&t.reliesOnOwnerAdminPrivileges?(0,Zt.K)(Jt,{message:i.ownerAdminNotice}):void 0,null!==t&&void 0!==t&&t.hasInvalidFormTemplate?(0,Zt.K)(Jt,{icon:Ct,message:i.formFieldUpdateError}):void 0)}function Jt(e){let{message:t,...i}=e;return(0,Zt.K)("calcite-notice",{class:$t.notice,open:!0,scale:"s",...i},(0,Zt.K)("div",{slot:"message"},t))}var Xt=i(78431),Yt=i(76137);const ei={settingsContainer:"esri-editor__settings"};function ti(e){var t;let{editorViewModel:i,messagesCommon:a,visibleElements:n}=e;const{snappingOptions:o,sketchOptions:s,view:r}=i,l=[],d={directionModePicker:n.directionModePicker,labelsToggle:n.labelsToggle,tooltipsToggle:n.tooltipsToggle};return(0,Ot.Mb)(d)&&l.push((0,Zt.K)(Xt.A,{sketchOptions:s,viewType:null===r||void 0===r?void 0:r.type,visibleElements:d})),n.snappingControls&&l.push((0,Zt.K)(Yt.A,{afterCreate:e=>e.layerListOpen=!1,snappingOptions:o,view:r,visibleElements:null!==(t=n.snappingControlsElements)&&void 0!==t?t:new Et.A})),0===l.length?null:(0,Zt.K)("calcite-accordion",{appearance:"transparent",class:ei.settingsContainer,key:"settings"},(0,Zt.K)("calcite-accordion-item",{"data-testid":"settings",heading:a.settings,iconStart:"gear"},l))}const ii="esri-editor__panel-toolbar";function ai(e){let{editorViewModel:t,messagesCommon:i,visibleElements:a}=e;const{sketchViewModel:n}=t;return(0,Zt.K)("div",{class:ii,key:"panel-toolbar"},(0,Zt.K)(ti,{editorViewModel:t,messagesCommon:i,visibleElements:a}),a.undoRedoButtons?[(0,Zt.K)("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(null!==n&&void 0!==n&&n.canUndo()),iconStart:"undo",key:"undo-button",kind:"neutral",label:i.undo,onclick:()=>null===n||void 0===n?void 0:n.undo(),scale:"l"},i.undo),(0,Zt.K)("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(null!==n&&void 0!==n&&n.canRedo()),iconStart:"redo",key:"redo-button",kind:"neutral",label:i.redo,onclick:()=>null===n||void 0===n?void 0:n.redo(),scale:"l"},i.redo)]:null)}var ni=i(87540);const oi="esri-editor__prompt",si={base:oi,header:"".concat(oi,"__header"),heading:"".concat(oi,"__header__heading"),message:"".concat(oi,"__message"),divider:"".concat(oi,"__divider"),actions:"".concat(oi,"__actions")};function ri(e){let{actions:t,context:i,headingLevel:a,message:n,title:o}=e;const s=t.secondary;let r;switch(i){case"danger":r="danger";break;case"info":r="brand";break;default:r="neutral"}const l=(0,Zt.K)("calcite-button",{afterCreate:li,appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:r,onclick:t.primary.action,scale:"m",width:s?"half":"full"},t.primary.label),d=s&&(0,Zt.K)("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:r,onclick:s.action,scale:"m",width:"half"},s.label);return(0,Zt.K)("calcite-scrim",{"data-testid":"prompt",key:"prompt"},(0,Zt.K)("div",{class:"".concat(si.base,"--").concat(i)},(0,Zt.K)("div",{class:si.header},(0,Zt.K)("calcite-icon",{icon:Ct}),(0,Zt.K)(ni.D,{class:si.heading,level:a},o)),(0,Zt.K)("div",{class:si.message},n),(0,Zt.K)("div",{class:si.divider}),(0,Zt.K)("div",{class:si.actions},d,l)))}function li(e){requestAnimationFrame((()=>e.setFocus()))}var di=i(39348);function ci(e){let{editorViewModel:t,headingLevel:i,messages:a,messagesCommon:n,onDelete:o,onSave:s,renderAttachments:r,renderFeatureForm:l}=e;const{activeWorkflow:d,featureFormViewModel:c,syncing:u}=t;if(!d||!c)return null;const p=d.type,h="activeWorkflow"in d?d.activeWorkflow:void 0,v=null===h||void 0===h?void 0:h.type,w=h&&!h.hasPendingEdits||"update"===p&&!d.hasPendingEdits||u||c.updating,f="update"===p&&"create-features"!==v?n.update:n.create,m="create-features"===p&&"create-new"===d.createFeatureState,g="create-features"===p?d.numPendingFeatures:0,y=g>1?(0,di.V)(a.createFeaturesTemplate,{numFeatures:g}):f,_=d.shouldShowAttachments&&!c.activeRelationshipInput,b=c.inputs.every((e=>!e.visible))&&!_?(0,Zt.K)(Ut,{key:"panel-content-message"},(0,di.V)(a.clickToFinishTemplate,{button:f})):(0,Zt.K)(Kt,{key:"panel-content-section"},(0,Zt.K)(Qt,{messages:a,workflow:d}),(0,Zt.K)(Dt,null,l(),_?(0,Zt.K)("div",{key:"attachments"},(0,Zt.K)(ni.D,{level:(0,ni.S)(i)},a.attachments),r()):null));return(0,Zt.K)(Zt.w,null,(0,Zt.K)(Lt,{key:"attribute-panel-content",showScrimOverlay:m},b),(0,Zt.K)(qt,{buttons:[{onClick:s,disabled:w,label:y},t.shouldShowDeleteButton?{appearance:"outline",onClick:o,disabled:u,kind:"danger",label:n.delete}:void 0]}))}var ui=i(45652);const pi="esri-editor__upload-details",hi={base:pi,status:"".concat(pi,"__status"),titleWrapper:"".concat(pi,"__title-wrapper"),title:"".concat(pi,"__title"),description:"".concat(pi,"__description"),loader:"".concat(pi,"__loader"),iconSuccess:"".concat(pi,"__icon ").concat(pi,"__icon--success"),iconError:"".concat(pi,"__icon ").concat(pi,"__icon--error"),fileList:"".concat(pi,"__file-list"),file:"".concat(pi,"__file"),fileIcon:"".concat(pi,"__file-icon"),fileName:"".concat(pi,"__file-name")};function vi(e){const{messages:t,key:i,upload:a}=e;return(0,Zt.K)(Zt.w,null,(0,Zt.K)(Lt,{key:null!==i&&void 0!==i?i:"upload-details"},(0,Zt.K)(Kt,null,function(e){const t=function(e){let{helpMessage:t,messages:i,upload:a}=e;switch(a.state){case"pending":{const{title:e,description:t}=i.modelUploads.pending;return{title:e,description:t,iconContent:(0,Zt.K)("calcite-loader",{"aria-hidden":"true",class:hi.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*a.progress),1===a.progress?100:99)})}}case"success":{const{title:e}=i.modelUploads.success;return{title:e,description:t||i.helpMessages3d.mesh,iconContent:(0,Zt.K)("calcite-icon",{class:(0,Ot.Ly)(hi.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:e}=i.modelUploads.error;return{title:e,description:wi(a.error,i),iconContent:(0,Zt.K)("calcite-icon",{class:(0,Ot.Ly)(hi.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}(e);return t?(0,Zt.K)("div",{class:hi.base,"data-testid":"upload-details",key:"upload-details-content"},(0,Zt.K)("div",{class:hi.status,key:"status"},t.iconContent,(0,Zt.K)("div",{class:hi.titleWrapper,key:"text"},(0,Zt.K)("div",{class:hi.title,key:"title"},t.title),(0,Zt.K)("div",{class:hi.description,key:"description"},t.description))),function(e){return(0,Zt.K)("div",{class:hi.fileList,key:"file-list"},e.files.map((e=>(0,Zt.K)("div",{class:hi.file,key:"file-".concat(e.name)},(0,Zt.K)("calcite-icon",{class:hi.fileIcon,icon:fi(e),scale:"s"}),(0,Zt.K)("span",{class:hi.fileName},function(e){var t,i;return null!==(t=null===(i=e.split("/").pop())||void 0===i?void 0:i.split("\\").pop())&&void 0!==t?t:""}(e.name))))))}(e.upload)):null}(e))),"error"===a.state?(0,Zt.K)(qt,{buttons:[{onClick:()=>a.retry(),label:t.modelUploads.error.uploadNew,iconStart:"upload-to"}],key:"upload-details-footer-actions"}):null)}function wi(e,t){if(!e)return null;const i=t.modelUploads.error.messages;switch(e.constructor){case ui.VP:return i.noModel;case ui.XQ:return i.multipleModels;case ui.MT:return i.conversionFailed;default:return i.default}}function fi(e){var t,i;const a=null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase();return null!==(i=a?_i[a]:null)&&void 0!==i?i:mi}const mi="file",gi="file-shape",yi="file-image",_i={glb:gi,gltf:gi,jpeg:yi,jpg:yi,png:yi,svg:yi,zip:"file-zip"};var bi=i(98108),ki=i(63582),Mi=i(12254);let Ai=class extends f.A{constructor(e,t){var i;super(e,t),i=this,this._featureForm=new h.default,this._attachments=new p.default({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new v.default({enableListScroll:!1,renderItemContentEnd:e=>e.supportsUpload?(0,Zt.K)("calcite-icon",{class:y.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:e=>e.label,renderCustomGroupContent:e=>this._renderCustomTemplateGroupContent(e)}),this._filterText="",this._prompt=null,this._spinner=new w.A,this.headingLevel=4,this.iconClass=y.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new It,this.visibleElements=new Wt,this._renderSelectIcon=()=>(0,Zt.K)("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=function(e){var t;let{heading:a,key:n}=e;for(var o=arguments.length,s=new Array(o>1?o-1:0),r=1;r<o;r++)s[r-1]=arguments[r];return(0,Zt.K)("calcite-flow-item",{closable:!1,heading:a,headingLevel:i.headingLevel,key:n,loading:i._loading,onCalciteFlowItemBack:i._onBack,onCalciteFlowItemScroll:null===(t=i._featureForm)||void 0===t?void 0:t.onScroll},(0,Zt.K)(ai,{editorViewModel:i.viewModel,messagesCommon:i.messagesCommon,visibleElements:i.visibleElements}),...s)},this._showDiscardEditsPrompt=()=>{var e;const{messages:t,activeWorkflow:i}=this;return"create-features"===(null===i||void 0===i?void 0:i.type)&&ke(i.data.creationInfo)?this._showPrompt("success"===(null===(e=i.data.upload)||void 0===e?void 0:e.state)?t.modelUploads.cancelPlacementPrompt:t.modelUploads.cancelUploadPrompt):this._showPrompt({title:t.cancelEditTitle,message:t.cancelEditWarningMessage,yesLabel:t.discardEdits,noLabel:t.continueEditing})},this._showGenericCancelPrompt=()=>{const{messages:e,messagesCommon:t}=this;return this._showPrompt({title:e.cancelRequestTitle,message:e.cancelRequestWarningMessage,yesLabel:t.form.yes,noLabel:t.form.no})},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteWarningTitle,message:e.deleteWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:e.keepFeature,action:this._clearPrompt}}}},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=e=>(null!==e&&void 0!==e&&e.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var e;const{activeWorkflow:t}=this.viewModel;t&&("create-features"===t.type||"update"===t.type&&"create-features"===(null===(e=t.activeWorkflow)||void 0===e?void 0:e.type)?(this._attachments.addFile(),t.back()):this._attachments.addAttachment().then((()=>t.back())))},this._onAttachmentUpdate=()=>{const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type?(this._attachments.updateFile(),e.back()):this._attachments.updateAttachment().then((()=>e.back())))},this._onAttachmentDelete=()=>{const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:e.keepAttachment,action:this._clearPrompt}}}},this._onAttachmentDeleteConfirm=async()=>{const e=this._attachments,{activeWorkflow:t}=this.viewModel;t&&("create-features"===t.type?e.deleteFile():(await e.deleteAttachment(e.viewModel.activeAttachmentInfo),this._clearPrompt()),await t.back(),this._clearPrompt())},this._onAttachmentsError=e=>{this._prompt={title:this.messages.errorWarningTitle,message:e.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}}},this._clearPrompt=()=>{this._prompt=null}}initialize(){this.addHandles([(0,l.watch)((()=>(0,ni.S)(this.headingLevel)),(e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e}),l.initial),(0,l.on)((()=>this.viewModel.activeWorkflow),"cancel-request",(e=>{let{controller:t}=e;(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then((e=>e?t.allow():t.deny()))})),(0,l.when)((()=>this.viewModel.featureFormViewModel),(e=>{this._featureForm.viewModel=e}),l.initial),(0,l.watch)((()=>this.viewModel),(e=>{var t,i,a;this._attachments.viewModel=null!==(t=null===e||void 0===e?void 0:e.attachmentsViewModel)&&void 0!==t?t:null,this._featureTemplates.viewModel=null!==(i=null===e||void 0===e?void 0:e.featureTemplatesViewModel)&&void 0!==i?i:null,this._spinner.viewModel=null!==(a=null===e||void 0===e?void 0:e.spinnerViewModel)&&void 0!==a?a:null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt}),l.initial),(0,l.watch)((()=>this.view),((e,t)=>{const i="editor-".concat(this.id,"-spinner");null!==t&&void 0!==t&&t.ui.remove(this._spinner,i),null===e||void 0===e||e.ui.add(this._spinner,{key:i,position:"manual"})}),l.initial),(0,l.watch)((()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel]),(e=>{var t;let[i]=e;i&&(this._featureForm.set(i.featureForm),this._attachments.set(i.attachments),this._featureTemplates.set(i.featureTemplates),null===(t=this.viewModel.sketchViewModel)||void 0===t||t.set(i.sketch))}),l.initial),(0,l.when)((()=>{var e;return null===(e=this._attachments)||void 0===e?void 0:e.error}),(e=>this._onAttachmentsError(e))),(0,l.when)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.failures}),(e=>{const{messages:t}=this,[{error:i,retry:a,cancel:n}]=e;this._prompt={title:t.errorWarningTitle,message:(0,di.V)(t.errorWarningMessageTemplate,{errorMessage:i.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{a(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{n(),this._clearPrompt()}}}}})),(0,l.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.state}),(e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}})),(0,l.watch)((()=>this.viewModel.featureFormDisabled),(e=>this._featureForm.disabled=e))])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return Promise.all([(0,Vt.W)({"flow-item":()=>Promise.all([i.e(39879),i.e(62785),i.e(48347),i.e(60731),i.e(48897),i.e(53794),i.e(24706),i.e(46269),i.e(40661)]).then(i.bind(i,40661)),flow:()=>i.e(14961).then(i.bind(i,14961)),icon:()=>Promise.all([i.e(39879),i.e(95012)]).then(i.bind(i,95012)),list:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(13859),i.e(79545),i.e(58838)]).then(i.bind(i,58838))}),xt(),xt(),Bt(),jt(),xt(),Promise.all([(0,Vt.W)({button:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(75151),i.e(11309)]).then(i.bind(i,11309))}),(0,Vt.W)({accordion:()=>i.e(69007).then(i.bind(i,69007)),"accordion-item":()=>Promise.all([i.e(39879),i.e(57815)]).then(i.bind(i,57815))})]),(0,Vt.W)({button:()=>Promise.all([i.e(39879),i.e(62785),i.e(95203),i.e(75151),i.e(11309)]).then(i.bind(i,11309)),icon:()=>Promise.all([i.e(39879),i.e(95012)]).then(i.bind(i,95012)),scrim:()=>Promise.all([i.e(39879),i.e(62785),i.e(3735)]).then(i.bind(i,3735))}),Promise.all([Bt(),jt(),xt()]),Promise.all([(0,Vt.W)({icon:()=>Promise.all([i.e(39879),i.e(95012)]).then(i.bind(i,95012)),loader:()=>i.e(76454).then(i.bind(i,76454))}),Bt(),xt()])])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get _loading(){const{viewModel:e}=this;return e.syncing||e.updating||this._attachments.submitting}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(e){(0,n.Lx)(o.A.getLogger(this),"allowedWorkflows",{replacement:"visibleElements",version:"4.29",warnOnce:!0}),this.viewModel.allowedWorkflows=e}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(e){this.viewModel.hideTemplatesForInactiveLayers=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureEdit(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{viewModel:e}=this,t=this.classes(y.base,bi.D.widget,bi.D.panel);return e?(0,Zt.K)("div",{class:t,key:"base"},(0,Zt.K)("calcite-flow",{key:"flow"},e.pageStack.map((e=>this._renderPage(e)))),this._prompt?(0,Zt.K)(ri,{...this._prompt,headingLevel:this.headingLevel}):void 0):(0,Zt.K)("div",{class:t,key:"empty"})}_renderPage(e){switch(e){case"disabled":break;case"ready":return this._renderReady();case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo();case"creating-features-upload-details":return this._renderUploadDetails();case"creating-features":return this._renderCreatingFeatures();case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature();case"awaiting-update-feature-candidate":return this._renderFeatureList();case"adding-attachment":return this._renderAttachmentAdding();case"editing-attachment":return this._renderAttachmentEditing()}return(0,Zt.K)("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(){const{EditorPanel:e,messages:t}=this;return(0,Zt.K)(e,{heading:t.selectTemplate,key:"templates-panel"},(0,Zt.K)(Lt,{key:"feature-templates"},(0,Zt.K)(Kt,null,this._featureTemplates.render())))}_renderUploadDetails(){const{EditorPanel:e,activeWorkflow:t,messages:i}=this;if("create-features"!==(null===t||void 0===t?void 0:t.type))return null;const a=t.data.upload;return a?(0,Zt.K)(e,{heading:i.createFeatures,key:"upload-details-panel"},(0,Zt.K)(vi,{helpMessage:this._helpMessage,messages:i,upload:a})):null}_renderCreatingFeatures(){var e,t;const{EditorPanel:i,activeWorkflow:a,messages:n,messagesCommon:o,headingLevel:s,viewModel:r}=this;if(!a)return null;const l="create-features"===a.type&&a.numPendingFeatures>0||"update"===a.type&&"create-features"===(null===a||void 0===a||null===(e=a.activeWorkflow)||void 0===e?void 0:e.type)&&(null===(t=a.activeWorkflow)||void 0===t?void 0:t.numPendingFeatures)>0;return(0,Zt.K)(i,{heading:n.createFeatures,key:"create-features-panel"},l?(0,Zt.K)(ci,{editorViewModel:r,headingLevel:s,messages:n,messagesCommon:o,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}):(0,Zt.K)(Ht,{helpMessage:this._helpMessage}))}_renderUpdateFeature(){const{EditorPanel:e,messages:t,messagesCommon:i,headingLevel:a,viewModel:n}=this;return(0,Zt.K)(e,{heading:t.editFeature,key:"update-feature-panel"},(0,Zt.K)(ci,{editorViewModel:n,headingLevel:a,messages:t,messagesCommon:i,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:i}=this,a=(0,s.Pb)(e.group.items,(e=>i.itemHasInvalidFormTemplate(e)?t.formFieldCreateError:void 0));return a?(0,Zt.K)(Jt,{icon:Ct,message:a}):null}_renderAttachmentAdding(){const{EditorPanel:e,_attachments:t,messages:i,messagesCommon:a}=this;return(0,Zt.K)(e,{heading:i.addAttachment,key:"attachment-adding-panel"},(0,Zt.K)(Lt,{key:"attachments"},t.render()),(0,Zt.K)(qt,{buttons:[{label:t.submitting?a.cancel:a.add,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentAdd}]}))}_renderAttachmentEditing(){const{EditorPanel:e,_attachments:t,activeWorkflow:i,messages:a,messagesCommon:n}=this;return i?(0,Zt.K)(e,{heading:a.editAttachment,key:"attachment-editing-panel"},(0,Zt.K)(Lt,{key:"attachments"},t.render()),i.shouldAllowAttachmentEditing?(0,Zt.K)(qt,{buttons:[{label:n.update,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:t.submitting,label:n.delete}]}):void 0):null}_renderReady(){const{EditorPanel:e,messages:t,viewModel:i,visibleElements:a}=this,n=this._helpMessage;return(0,Zt.K)(e,{heading:t.widgetLabel,key:"landing-panel"},(0,Zt.K)(Lt,{key:"landing-content"},i.editorItems.length?[a.editFeaturesSection?(0,Zt.K)(Kt,{key:"edit-actions"},this._renderUpdateActions()):null,a.createFeaturesSection&&i.canCreateVisible?(0,Zt.K)(Kt,{key:"create-actions"},this._renderCreateActions()):null]:(0,Zt.K)(Ut,{key:"no-content"},t.noEditableLayers)),n?(0,Zt.K)("div",{class:y.helpMessage,key:"footer-actions",slot:"footer"},n):void 0)}get _helpMessage(){var e;const{activeWorkflow:t,messages:i,view:a}=this,n=null===t||void 0===t?void 0:t.helpMessage;return n?null===(e=i["3d"===(null===a||void 0===a?void 0:a.type)?"helpMessages3d":"helpMessages2d"])||void 0===e?void 0:e[n]:void 0}_renderUpdateActions(){var e;const{messages:t,messagesCommon:i,viewModel:a}=this,n={id:"select",label:i.select};return(0,Zt.K)("div",{class:y.updateActions,key:"update-actions"},(0,Zt.K)(ni.D,{level:(0,ni.S)(this.headingLevel)},t.editFeatures),(0,Zt.K)("calcite-list",{class:y.updateActionsList,selectionAppearance:"border",selectionMode:"single"},(0,Rt.Gx)({disabled:!a.canUpdateVisible,grouped:!1,item:n,selectedItem:"awaiting-feature-to-update"===(null===(e=a.activeWorkflow)||void 0===e?void 0:e.stepId)?n:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return(0,Zt.K)("div",{key:"create-actions"},(0,Zt.K)(ni.D,{level:(0,ni.S)(this.headingLevel)},this.messages.createFeatures),(0,Zt.K)("div",{class:y.featureTemplatesContainer,key:"templates"},this._featureTemplates.render()))}_renderFeatureList(){const{EditorPanel:e,viewModel:t}=this,{activeWorkflow:i}=t;if("update"!==(null===i||void 0===i?void 0:i.type))return null;const a=i.data.candidates,n=(0,di.V)(this.messages.multipleFeaturesTemplate,{total:a.length});return(0,Zt.K)(e,{heading:n,key:"feature-list"},(0,Zt.K)(Gt,{editorItems:t.editorItems,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:i,onFilterTextChange:e=>this._filterText=e,onSelectFeature:(e,i)=>t.selectFeature(e,i)}))}_showPrompt(e){let{title:t,message:i,yesLabel:a,noLabel:n}=e;const o=(0,r.Tw)(),{view:s}=this,l=null===s||void 0===s?void 0:s.focused;return this._prompt={title:t,message:i,context:"danger",actions:{primary:{label:a,action:()=>o.resolve(!0)},secondary:{label:n,action:()=>o.resolve(!1)}}},o.promise.finally((()=>{this._clearPrompt(),l&&(null===s||void 0===s||s.focus())}))}};(0,a._)([(0,d.MZ)()],Ai.prototype,"_featureForm",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"_attachments",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"_featureTemplates",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"_filterText",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"_prompt",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"_spinner",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"_deleteButtonCommonInfo",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"_loading",null),(0,a._)([(0,d.MZ)({readOnly:!0})],Ai.prototype,"activeWorkflow",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"allowedWorkflows",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"headingLevel",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"hideTemplatesForInactiveLayers",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"iconClass",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"label",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"labelOptions",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"layerInfos",null),(0,a._)([(0,d.MZ)(),(0,ki.G)("esri/widgets/Editor/t9n/Editor")],Ai.prototype,"messages",void 0),(0,a._)([(0,d.MZ)(),(0,ki.G)("esri/t9n/common")],Ai.prototype,"messagesCommon",void 0),(0,a._)([(0,d.MZ)(),(0,ki.G)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],Ai.prototype,"messagesTemplates",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"snappingOptions",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"tooltipOptions",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"supportingWidgetDefaults",void 0),(0,a._)([(0,d.MZ)({type:u.A,nonNullable:!0})],Ai.prototype,"valueOptions",null),(0,a._)([(0,d.MZ)()],Ai.prototype,"view",null),(0,a._)([(0,d.MZ)(),(0,Mi.U)(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],Ai.prototype,"viewModel",void 0),(0,a._)([(0,d.MZ)({type:Wt,nonNullable:!0})],Ai.prototype,"visibleElements",void 0),(0,a._)([(0,d.MZ)()],Ai.prototype,"_helpMessage",null),Ai=(0,a._)([(0,c.$)("esri.widgets.Editor")],Ai);const Fi=Ai},55191:(e,t,i)=>{i.d(t,{A:()=>f});var a=i(35143),n=i(50346),o=i(68134),s=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),l=i(25329),d=i(44371),c=(i(76099),i(54761));const u="esri-spinner",p=u,h="".concat(u,"--start"),v="".concat(u,"--finish");let w=class extends l.A{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new d.A}initialize(){this.addHandles((0,o.watch)((()=>this.visible),(e=>this._visibleChange(e))))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:i}=null!==e&&void 0!==e?e:{};t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,a=e&&i,n=!e&&i,o={[h]:a,[v]:n},s=this._getPositionStyles();return(0,c.K)("div",{class:this.classes(p,o),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,n.Pl)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(null==t||null==e)return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,a._)([(0,s.MZ)()],w.prototype,"location",null),(0,a._)([(0,s.MZ)()],w.prototype,"view",null),(0,a._)([(0,s.MZ)({type:d.A})],w.prototype,"viewModel",void 0),(0,a._)([(0,s.MZ)()],w.prototype,"visible",null),w=(0,a._)([(0,r.$)("esri.widgets.Spinner")],w);const f=w},44371:(e,t,i)=>{i.d(t,{A:()=>l});var a=i(35143),n=i(46053),o=(i(81806),i(76460),i(47249),i(85842)),s=i(68999);let r=class extends s.A{constructor(e){super(e),this.visible=!1}};(0,a._)([(0,n.MZ)()],r.prototype,"visible",void 0),r=(0,a._)([(0,o.$)("esri.widgets.CompassViewModel")],r);const l=r},68999:(e,t,i)=>{i.d(t,{A:()=>c});var a=i(35143),n=i(54099),o=i(68134),s=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),l=i(9624);let d=class extends n.A.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,o.when)((()=>{const e=this.screenLocationEnabled?this.view:null;return e?[e.size,"3d"===e.type?e.camera:e.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),(0,o.watch)((()=>this.screenLocation),((e,t)=>{null!=e&&null!=t&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,a=null===t||void 0===t?void 0:t.spatialReference,n=a?(0,l.projectOrLoad)(e,a).geometry:null;return i&&n&&null!==t&&void 0!==t&&t.ready?t.toScreen(n):null}};(0,a._)([(0,s.MZ)()],d.prototype,"location",void 0),(0,a._)([(0,s.MZ)()],d.prototype,"screenLocation",null),(0,a._)([(0,s.MZ)()],d.prototype,"screenLocationEnabled",void 0),(0,a._)([(0,s.MZ)()],d.prototype,"view",void 0),d=(0,a._)([(0,r.$)("esri.widgets.support.AnchorElementViewModel")],d);const c=d}}]);
//# sourceMappingURL=94423.ba3b3865.chunk.js.map
"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[36302],{83491:(e,t,i)=>{i.d(t,{w:()=>c});var l=i(35143),s=i(54901),a=i(50346),n=i(68134),r=i(46053),o=(i(81806),i(76460),i(47249),i(85842)),h=i(47700);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),(0,h.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,s.hA)((()=>e.abort()))),await(0,n.whenOnce)((()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),t),(0,a.Te)(t);const i=(0,h.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!(null!==e&&void 0!==e&&e.minScale)||!e.maxScale||e.minScale>=e.maxScale)}getSuspendInfo(){const e=super.getSuspendInfo(),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}};return(0,l._)([(0,r.MZ)()],t.prototype,"view",void 0),(0,l._)([(0,r.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,l._)([(0,o.$)("esri.views.3d.layers.LayerView3D")],t),t}},96453:(e,t,i)=>{i.d(t,{E:()=>d});var l=i(35143),s=i(50076),a=i(68134),n=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),o=i(65768),h=i(93938),c=i(4225);const d=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataScaleRange(){const e=this.tileInfo.lods;let t=e[0].scale,i=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const{effectiveMinLOD:e,effectiveMaxLOD:l}=this.layer.tilemapCache;t=this.tileInfo.lodAt(e).scale,i=this.tileInfo.lodAt(l).scale}return{minScale:t,maxScale:i}}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,t)}get displayLevelRange(){const e=this.layer.minScale||this.dataScaleRange.minScale,t=this.layer.maxScale||this.dataScaleRange.maxScale,i=this.levelRangeFromScaleRange(e,t);return this.layer.maxScale&&i.maxLevel++,i}get performanceInfo(){return new o.P(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(e,t,i){return this.layer.getTileUrl(e,t,i)}_addTilingSchemeMatchPromise(){if(null==this.fullExtent)return this.addResolvingPromise(Promise.reject(new s.A("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(e)return this.addResolvingPromise(Promise.reject(e));const t=(0,a.whenOnce)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.basemapTerrain)||void 0===e?void 0:e.tilingSchemeLocked})).then((()=>{const e=this.view.basemapTerrain.tilingScheme,t=this._getTileInfoCompatibilityError(this.tileInfo,e);if(t)throw t}));this.addResolvingPromise(t)}_getTileInfoSupportError(e,t){const i=(0,c._y)(e,t,this.view.spatialReference,this.view.state.viewingMode);if(i){const e={layer:this.layer,error:i};let t;switch(i.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":t=new s.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",e);break;default:t=new s.A("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",e)}return t}return null}_getTileInfoCompatibilityError(e,t){return null!=e&&t.compatibleWith(e)?null:new s.A("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,t){const i={minLevel:0,maxLevel:1/0},l=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!l)return i;const s=l.levels[0],a=e=>{const t=Math.log(s.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(i.minLevel=Math.max(0,a(e))),null!=t&&t>0&&(i.maxLevel=Math.max(0,a(t))),i}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return(0,l._)([(0,n.MZ)({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),(0,l._)([(0,n.MZ)({readOnly:!0})],t.prototype,"updating",void 0),(0,l._)([(0,n.MZ)(h.S)],t.prototype,"updatingProgress",void 0),(0,l._)([(0,n.MZ)(h.b)],t.prototype,"updatingProgressValue",void 0),(0,l._)([(0,n.MZ)()],t.prototype,"fullExtent",null),(0,l._)([(0,n.MZ)({readOnly:!0})],t.prototype,"isOpaque",null),(0,l._)([(0,n.MZ)()],t.prototype,"dataScaleRange",null),(0,l._)([(0,n.MZ)({readOnly:!0})],t.prototype,"dataLevelRange",null),(0,l._)([(0,n.MZ)({readOnly:!0})],t.prototype,"displayLevelRange",null),(0,l._)([(0,n.MZ)()],t.prototype,"layer",void 0),t=(0,l._)([(0,r.$)("esri.views.3d.layers.TiledLayerView3D")],t),t}},36302:(e,t,i)=>{i.r(t),i.d(t,{default:()=>z});var l=i(35143),s=i(50076),a=i(81806),n=i(30726),r=i(50346),o=i(68134),h=i(46053),c=(i(76460),i(47249),i(85842));class d{constructor(e,t,i){this._scale=e,this._shift=t,this._levelShift=i}getLevelRowColumn(e){const t=this.getLevelShift(e[0]),i=this._shift+t;return i?[e[0]-t,e[1]>>i,e[2]>>i]:e}getLevelShift(e){return Math.min(e,this._levelShift)}getOffset(e,t){let i=0,l=0;const s=this._shift+this.getLevelShift(e[0]);if(s){const a=(1<<s)-1,n=t/(this._scale*(1<<s-1));i=(e[2]&a)*n,l=(e[1]&a)*n}return[i,l]}getScale(e){return this._scale*(1<<this._shift+this.getLevelShift(e))}}var u=i(79369),g=i(85827),p=i(2413),y=i(92678),m=i(542),v=i(36458),f=i(69113),_=i(34278),w=i(249),S=i(6645),R=i(76418);var b=i(18374),C=i(93453);class M extends y.d{constructor(e,t,i,l){super(e,t,i,e.tileInfo.lods.length-1),this._memCache=l,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map,this._tileInfoView=new b.A(e.tileInfo,e.fullExtent)}destroy(){super.destroy(),this._ongoingRequestToController.forEach((e=>e.abort())),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()}async getVectorTile(e,t,i,l){const s=new C.A(e,t,i,0);let a=this._memCache.get(s.id);if(null!=a)return a.retain(),a;const n=await this._getVectorTileData(s);if((0,r.Te)(l),!this._layer)return null;if(a=this._memCache.get(s.id),null!=a)return a.retain(),a;const o=this._layer.tileInfo.getTileBounds((0,p.vt)(),s),h=this._tileInfoView.getTileResolution(e);return a=new m.c(s,h,o[0],o[3],512,512,this._styleRepository,this._memCache),n?(a.setData(n),a.retain(),this._memCache.put(s.id,a,a.usedMemory,u.Ti)):a.setData(null),a.neededForCoverage=!0,a.transforms.tileUnitsToPixels=(0,g.fA)(1/8,0,0,0,1/8,0,0,0,1),function(e){const t=[],i=new w.t(4096,t,(()=>{const e=new v.S;return e.show=!1,e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1}),e})),l=new _.q(t,i,((t,i,l)=>new f.s(t,i,l,e.styleRepository,e.key.level,0)),((e,t)=>{(0,S.jy)(e,t,!1)}),(()=>0),(t=>{const i=e.styleRepository.getStyleLayerByUID(t).getLayoutProperty("visibility");return!i||i.getValue()!==R.bv.NONE}));t.push(e),i.add(e),l.setScreenSize(512,512),l.continue(1/0)}(a),a}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const i=new AbortController,l={signal:i.signal},s=this._getParsedVectorTileData(e,l).then((e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e))).catch((()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null)));return this._ongoingTileRequests.set(t,s),this._ongoingRequestToController.set(t,i),s}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then((i=>this.parseTileData({key:e,data:i},t)))}}var L=i(38134),T=i(43106),I=i(51519),x=i(56012),E=i(114);const P={vtlBackground:L.F,vtlFill:I.I,vtlLine:x.$,vtlCircle:T.p,vtlSymbol:E.P};var O=i(37356),D=i(93345);const H=1e-6;class A{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache=new Map,this._vtlMaterialManager=new O.A}dispose(){this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache=null),this._vtlMaterialManager=(0,n.WD)(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawSymbols(e,t,i){const l=i.layers;e.renderPass="translucent";for(let s=0;s<l.length;s++){const i=l[s];if(i.type!==R.Dc.SYMBOL)continue;const a=i.getLayoutProperty("visibility");if(a&&a.getValue()===R.bv.NONE)continue;const n=e.displayLevel;void 0!==i.minzoom&&i.minzoom>n+H||void 0!==i.maxzoom&&i.maxzoom<=n-H||(e.styleLayerUID=i.uid,e.styleLayer=i,this._drawWithBrush(e,t,"vtlSymbol"))}}drawBackground(e,t,i){if(0===i.backgroundBucketIds.length)return;const{context:l,displayLevel:s,requiredLevel:a}=e;t.key.level=a,l.setBlendingEnabled(!0),l.setDepthTestEnabled(!1),l.setStencilTestEnabled(!1),e.renderPass="background",i.backgroundBucketIds.forEach((l=>{const a=i.getLayerById(l);if(a.type!==R.Dc.BACKGROUND)return;const n=a.getLayoutProperty("visibility");n&&n.getValue()===R.bv.NONE||void 0!==a.minzoom&&a.minzoom>s+H||void 0!==a.maxzoom&&a.maxzoom<=s-H||(e.styleLayerUID=a.uid,e.styleLayer=a,this._drawWithBrush(e,t,"vtlBackground"))}))}drawTile(e,t,i,l){const{context:s}=e,a=i.layers;s.setBlendingEnabled(!1),s.setDepthTestEnabled(!0),s.setDepthWriteEnabled(!0),s.setDepthFunction(D.MT.LEQUAL),e.renderPass="opaque";for(let n=a.length-1;n>=0;n--){const i=a[n];null!=l&&l!==i.type||this._renderStyleLayer(i,e,t,!1)}s.setDepthWriteEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunctionSeparate(D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA,D.dn.ONE,D.dn.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(let n=0;n<a.length;n++){const i=a[n];null!=l&&l!==i.type||this._renderStyleLayer(i,e,t,!1)}s.setDepthTestEnabled(!1),s.bindVAO()}_renderStyleLayer(e,t,i,l){if(!(l||e&&i.layerData.has(e.uid)))return;const s=e.getLayoutProperty("visibility");if(s&&s.getValue()===R.bv.NONE)return;const{renderPass:a}=t;let n;switch(e.type){case R.Dc.BACKGROUND:if("background"!==a)return;n="vtlBackground";break;case R.Dc.FILL:if("opaque"!==a&&"translucent"!==t.renderPass)return;n="vtlFill";break;case R.Dc.LINE:if("translucent"!==a)return;n="vtlLine";break;case R.Dc.CIRCLE:if("translucent"!==a)return;n="vtlCircle";break;case R.Dc.SYMBOL:if("translucent"!==a)return;n="vtlSymbol"}const r=t.displayLevel;if(void 0!==e.minzoom&&e.minzoom>r+H||void 0!==e.maxzoom&&e.maxzoom<=r-H)return;const{context:o}=t;o.setStencilTestEnabled(!1),o.setStencilWriteMask(0),t.styleLayerUID=e.uid,t.styleLayer=e,this._drawWithBrush(t,i,n)}_drawWithBrush(e,t,i){if(!this._brushCache.has(i)){const e=P[i];this._brushCache.set(i,new e)}this._brushCache.get(i).drawMany(e,[t])}}var k=i(45995),q=i(83491),Z=i(96453),V=i(4225),B=i(91196);let N=class extends((0,Z.E)((0,q.w)(B.A))){constructor(){super(...arguments),this._tileHandlerController=null,this.type="vector-tile-3d",this.levelShift=(0,a.A)("disable-feature:vtl-level-shift")?0:1}initialize(){if(null==this.layer.fullExtent)return void this.addResolvingPromise(Promise.reject(new s.A("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));const{basemapTerrain:e,spatialReference:t,state:i,viewingMode:l}=this.view,a="local"===l&&!(0,V.bA)(t)||V.t6.force512VTL,n=this.layer.tileInfo.spatialReference.isGeographic,h=a?this.layer.tileInfo:this.layer.tileInfo.getOrCreateCompatible(256,n?1:2),c=this._getTileInfoSupportError(h,this.layer.fullExtent);if(null!=c)return this.addResolvingPromise(Promise.reject(c));const u=(0,o.whenOnce)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.basemapTerrain)||void 0===e?void 0:e.tilingSchemeLocked})).then((()=>{var t,i,l;const s=e.tilingScheme,a=s.pixelSize,n=256===a?1:2,r=null!==(t=e.spatialReference)&&void 0!==t&&t.isGeographic&&256===a?1:0,o=null!==(i=e.spatialReference)&&void 0!==i&&i.isGeographic||256!==a?0:1;let h;if(this.schemaHelper=new d(n,r,this.levelShift+o),256===a){const e=this.layer.tileInfo.spatialReference.isGeographic;h=this.layer.tileInfo.getOrCreateCompatible(256,e?1:2)}else h=null!==(l=this.view.spatialReference)&&void 0!==l&&l.isGeographic?this.layer.tileInfo.getOrCreateCompatible(512,.5):this.layer.tileInfo;const c=this._getTileInfoCompatibilityError(h,s);if(c)throw c;this.tileInfo=h}));this._tileHandlerController=new AbortController;const g=this.view.resourceController;this._memCache=g.memoryController.newCache("vtl-".concat(this.layer.uid),(e=>{e.release()})),this.addHandles((0,o.watch)((()=>this.view.qualitySettings.memoryLimit),(e=>this._memCache.maxSize=Math.ceil(e/10*1048576)),o.syncAndInitial));const p=new k.A(this.layer.currentStyleInfo.style);this._tileHandler=new M(this.layer,p,i.contentPixelRatio,this._memCache);const y=this._tileHandlerController.signal,m=function(e){return t=>e.immediate.schedule(t)}(g),v=this._tileHandler.start({signal:y,schedule:m}),f=this._tileHandler.spriteMosaic;f.then((e=>{!(0,r.G4)(y)&&this._tileHandler&&(this.painter=new A(e,this._tileHandler.glyphMosaic))})),v.then((()=>this._tileHandlerController=null)),this._updatingHandles.add((()=>{var e;return{style:this.layer.currentStyleInfo.style,pixelRatio:null===(e=this.view.state)||void 0===e?void 0:e.contentPixelRatio}}),(e=>{let{style:t,pixelRatio:i}=e;this._tileHandlerController&&this._tileHandlerController.abort(),this._tileHandlerController=new AbortController,this._memCache.clear();const l=new k.A(t),s=new M(this.layer,l,i,this._memCache),a=s.start({signal:this._tileHandlerController.signal,schedule:m}),n=s.spriteMosaic;a.then((()=>this._tileHandlerController=null)),this._updatingHandles.addPromise(Promise.all([a,n]).then((e=>{let[,t]=e;const i=this._tileHandler,l=this.painter;this.painter=new A(t,s.glyphMosaic),this._tileHandler=s,this.emit("data-changed"),i.destroy(),l&&l.dispose()})))}));const _=Promise.all([u,v,f]);this.addResolvingPromise(_)}destroy(){this.painter=(0,n.WD)(this.painter),this._tileHandlerController=(0,n.DC)(this._tileHandlerController),this._tileHandler=(0,n.pR)(this._tileHandler),this._memCache=(0,n.pR)(this._memCache)}get contentZoom(){return(0,a.A)("disable-feature:vtl-level-shift")?1:this.view.qualitySettings.tiledSurface.vtlContentZoom}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,i=this.layer.maxScale||e[e.length-1].scale,l=this.levelRangeFromScaleRange(t,i);return this.layer.maxScale?l.maxLevel++:l.maxLevel+=this.levelShift,l}get dataScaleRange(){const e=this.tileInfo.lods;return{minScale:e[0].scale,maxScale:e[e.length-1].scale}}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange,i=this.levelRangeFromScaleRange(e,t);return 1===i.minLevel&&256===this.tileInfo.size[0]&&(i.minLevel=0),i.maxLevel+=this.levelShift,i}async fetchTile(e,t,i,l){return this._tileHandler.getVectorTile(e,t,i,l)}};(0,l._)([(0,h.MZ)()],N.prototype,"layer",void 0),(0,l._)([(0,h.MZ)()],N.prototype,"levelShift",void 0),(0,l._)([(0,h.MZ)()],N.prototype,"contentZoom",null),(0,l._)([(0,h.MZ)()],N.prototype,"displayLevelRange",null),(0,l._)([(0,h.MZ)()],N.prototype,"tileInfo",void 0),(0,l._)([(0,h.MZ)()],N.prototype,"dataScaleRange",null),(0,l._)([(0,h.MZ)()],N.prototype,"dataLevelRange",null),(0,l._)([(0,h.MZ)()],N.prototype,"updatingProgressValue",void 0),N=(0,l._)([(0,c.$)("esri.views.3d.layers.VectorTileLayerView3D")],N);const z=N}}]);
//# sourceMappingURL=36302.52a0e9ee.chunk.js.map
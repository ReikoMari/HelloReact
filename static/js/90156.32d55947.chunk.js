"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[90156],{90156:(e,t,s)=>{s.r(t),s.d(t,{default:()=>H});var i=s(35143),n=s(50346),o=s(46053),a=(s(81806),s(76460),s(47249),s(85842)),l=s(25329),r=s(12245),h=s(78059),c=s(60664),d=s(19276),u=s(3975),y=s(54901),v=s(68134),w=s(12482),_=s(39356),p=s(91967),g=s(13904);let T=class extends p.A{constructor(e){super(e),this.location=null,this.intersectedLocation=null,this.intersectedGraphic=null,this.visible=void 0}};(0,i._)([(0,o.MZ)({type:g.A})],T.prototype,"location",void 0),(0,i._)([(0,o.MZ)({type:g.A})],T.prototype,"intersectedLocation",void 0),(0,i._)([(0,o.MZ)({type:_.A})],T.prototype,"intersectedGraphic",void 0),(0,i._)([(0,o.MZ)({type:Boolean})],T.prototype,"visible",void 0),T=(0,i._)([(0,a.$)("esri.widgets.lineOfSight.LineOfSightTarget")],T);const A=T;var M=s(29078);const V=d.A.ofType(A);let b=class extends M.D{constructor(e){super(e),this.analysis=null,this.supportedViewType="3d",this.unsupportedErrorMessage="LineOfSightViewModel is only supported in 3D views.",this._vmTargetsToConnection=new Map,this._analysisTargetsToConnection=new Map}initialize(){this.addHandles([this.targets.on("after-add",(e=>this._onViewModelTargetAdded(e.item))),this.targets.on("after-remove",(e=>this._onViewModelTargetRemoved(e.item))),(0,v.watch)((()=>this.analysis),(e=>this._onAnalysisChange(e)),v.syncAndInitial)])}destroy(){this._analysisTargetsToConnection.forEach((e=>e.remove()))}get state(){return this.disabled||!this.ready?"disabled":null==this.tool?"ready":this.tool.state}get observer(){const{observer:e}=this.analysis;return null==(null===e||void 0===e?void 0:e.position)?null:this._convertAnalysisPointToAbsoluteHeight(e.position,e.elevationInfo)}set observer(e){let t=null;e&&(t=e.clone(),t.hasZ||(t.z=0)),this.analysis.observer=new h.A({position:t})}get targets(){return this._get("targets")||new V}set targets(e){this._set("targets",(0,u.V)(e,this.targets,V))}continue(){null!=this.tool&&this.tool.continue()}stop(){null!=this.tool&&this.tool.stop()}get testInfo(){return{analysisView:this.analysisView,getAnalysisTargetFromViewModelTarget:e=>{var t;return null===(t=this._vmTargetsToConnection.get(e))||void 0===t?void 0:t.analysisTarget}}}constructAnalysis(){return new r.A}async onConnectToAnalysisView(e){this.addHandles([e.on("result-changed",(e=>{const t=this._analysisTargetsToConnection.get(e.target);t&&(null!=e.result?(t.viewModelTarget.intersectedGraphic=e.result.intersectedGraphic,t.viewModelTarget.intersectedLocation=e.result.intersectedLocation,t.viewModelTarget.visible=e.result.visible):(t.viewModelTarget.intersectedGraphic=null,t.viewModelTarget.intersectedLocation=null,t.viewModelTarget.visible=void 0))}))],"view")}onDisconnectFromAnalysisView(){this.removeHandles("view")}_onViewModelTargetAdded(e){if(this._vmTargetsToConnection.get(e))return;const t=new c.A({position:e.location});this._connectViewModelWithAnalysisTarget(e,t),this.analysis.targets.add(t)}_onViewModelTargetRemoved(e){const t=this._vmTargetsToConnection.get(e);t&&(t.remove(),this.analysis.targets.remove(t.analysisTarget))}_onAnalysisTargetAdded(e){if(this._analysisTargetsToConnection.get(e))return;const{position:t}=e,s=new A({location:t?this._convertAnalysisPointToAbsoluteHeight(t,e.elevationInfo):null});this._connectViewModelWithAnalysisTarget(s,e),this.targets.add(s)}_onAnalysisTargetRemoved(e){const t=this._analysisTargetsToConnection.get(e);t&&(t.remove(),this.targets.remove(t.viewModelTarget))}_connectViewModelWithAnalysisTarget(e,t){let s=!1;const i=(0,y.vE)([(0,v.watch)((()=>({position:t.position,elevationInfo:t.elevationInfo})),(t=>{let{position:i,elevationInfo:n}=t;s||(s=!0,e.location=i?this._convertAnalysisPointToAbsoluteHeight(i,n):null,s=!1)}),v.sync),(0,v.watch)((()=>e.location),(e=>{if(!s){s=!0;let i=null;e&&(i=e.clone(),i.hasZ||(i.z=0)),t.position=i,t.elevationInfo=null,s=!1}}),v.sync)]),n={analysisTarget:t,viewModelTarget:e,remove:()=>{i.remove(),this._vmTargetsToConnection.delete(e),this._analysisTargetsToConnection.delete(t)}};this._vmTargetsToConnection.set(e,n),this._analysisTargetsToConnection.set(t,n)}_onAnalysisChange(e){const t="analysis";this.removeHandles(t),this.addHandles([this.analysis.targets.on("after-add",(e=>this._onAnalysisTargetAdded(e.item))),this.analysis.targets.on("after-remove",(e=>this._onAnalysisTargetRemoved(e.item)))],t),this.targets.removeAll(),e.targets.forEach((e=>{this._onAnalysisTargetAdded(e)}))}_convertAnalysisPointToAbsoluteHeight(e,t){const s=e.clone();if(null!=this.view){const i=(0,w.bK)(e.hasZ,t);s.z=(0,w.wS)(this.view,e,i,w.qt)}return s}};(0,i._)([(0,o.MZ)({type:r.A})],b.prototype,"analysis",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],b.prototype,"state",null),(0,i._)([(0,o.MZ)()],b.prototype,"observer",null),(0,i._)([(0,o.MZ)({type:V,cast:u.H,nonNullable:!0})],b.prototype,"targets",null),b=(0,i._)([(0,a.$)("esri.widgets.lineOfSight.LineOfSightViewModel")],b);const m=b;var f=s(77666),C=s(98108),O=s(15062),I=(s(76099),s(63582)),Z=s(54761);const N="esri-line-of-sight",D={base:N,actions:"".concat(N,"__actions"),container:"".concat(N,"__container"),error:"".concat(N,"__error"),hint:"".concat(N,"__hint"),hintText:"".concat(N,"__hint-text"),newAnalysisButton:"".concat(N,"__new-analysis-button"),widgetIcon:O.T.lineOfSight},R={newAnalysisButton:"".concat(N,"__new-button"),continueButton:"".concat(N,"__continue-button"),doneButton:"".concat(N,"__done-button")};let k=class extends l.A{constructor(e,t){super(e,t),this.iconClass=D.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new m,this._onNewAnalysis=()=>{(0,n.QZ)(this.viewModel.start())},this._onDone=()=>{this.viewModel.stop()},this._onContinue=()=>{this.viewModel.continue()}}loadDependencies(){return(0,f.W)({button:()=>Promise.all([s.e(39879),s.e(62785),s.e(95203),s.e(75151),s.e(11309)]).then(s.bind(s,11309))})}get active(){return this.viewModel.active}get analysis(){return this.viewModel.analysis}set analysis(e){this.viewModel.analysis=e}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}render(){return(0,Z.K)("div",{class:this.classes(D.base,C.D.widget,C.D.panel),role:"presentation"},this._renderContainerNode())}_renderContainerNode(){if(!this.visible)return null;if(!this.viewModel.supported)return this._renderUnsupportedMessage();let e=null;const t=[this._renderNewAnalysisButton()];return"creating"===this.viewModel.state?(e=this._renderHint(),t.unshift(this._renderDoneButton())):"created"===this.viewModel.state&&this.viewModel.targets.length>0&&t.unshift(this._renderContinueButton()),(0,Z.K)("div",{class:D.container},e,(0,Z.K)("div",{class:D.actions},t))}_renderUnsupportedMessage(){return(0,Z.K)("div",{class:D.error,key:"esri-line-of-sight__unsupported"},(0,Z.K)("p",null,this.messages.unsupported))}_renderHint(){return(0,Z.K)("div",{class:D.hint,key:"esri-line-of-sight__hint"},(0,Z.K)("p",{class:D.hintText},this.messages.hint))}_renderNewAnalysisButton(){return this._renderButton({className:D.newAnalysisButton,id:R.newAnalysisButton,label:this.messages.newAnalysis,onClick:this._onNewAnalysis,primary:!0})}_renderDoneButton(){return this._renderButton({id:R.doneButton,label:this.messages.done,onClick:this._onDone,primary:!1})}_renderContinueButton(){return this._renderButton({id:R.newAnalysisButton,label:this.messages.continueAnalysis,onClick:this._onContinue,primary:!1})}_renderButton(e){let{className:t,id:s,label:i,onClick:n,primary:o}=e;const a="disabled"===this.viewModel.state;return(0,Z.K)("calcite-button",{appearance:o?"solid":"outline-fill",class:t,"data-id":s,disabled:a,key:s,onclick:n},i)}get test(){return{IDS:R}}};(0,i._)([(0,o.MZ)()],k.prototype,"active",null),(0,i._)([(0,o.MZ)({constructOnly:!0,nonNullable:!0})],k.prototype,"analysis",null),(0,i._)([(0,o.MZ)()],k.prototype,"iconClass",void 0),(0,i._)([(0,o.MZ)()],k.prototype,"icon",void 0),(0,i._)([(0,o.MZ)()],k.prototype,"label",null),(0,i._)([(0,o.MZ)(),(0,I.G)("esri/widgets/LineOfSight/t9n/LineOfSight")],k.prototype,"messages",void 0),(0,i._)([(0,o.MZ)()],k.prototype,"view",null),(0,i._)([(0,o.MZ)({type:m})],k.prototype,"viewModel",void 0),(0,i._)([(0,o.MZ)()],k.prototype,"visible",null),k=(0,i._)([(0,a.$)("esri.widgets.LineOfSight")],k);const H=k},29078:(e,t,s)=>{s.d(t,{D:()=>v});var i,n,o=s(35143),a=s(91967),l=s(98773),r=s(76460),h=s(30726),c=s(50346),d=s(68134),u=s(46053),y=(s(81806),s(47249),s(85842));(n=i||(i={}))[n.PENDING=0]="PENDING",n[n.WAIT_FOR_VIEW_READY=1]="WAIT_FOR_VIEW_READY",n[n.RUNNING=2]="RUNNING";let v=class extends a.A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.view=null,this.analysisView=null,this._reconnectViewTask=null,this._forceInteractiveHandle=null,this._parentChangeFromReconnect=!1,this._startUserOperation=null,this.logger=r.A.getLogger(this);const t=null===e||void 0===e?void 0:e.analysis;null!=t?this.analysis=t:(this._set("analysis",this.constructAnalysis()),this._set("isAnalysisOwner",!0)),null!=(null===e||void 0===e?void 0:e.visible)&&(this.visible=e.visible)}normalizeCtorArgs(e){const{analysis:t,...s}=e;return s}initialize(){this.addHandles([(0,d.watch)((()=>({readyAndNotSupported:null!=this.view&&this.view.ready&&!this.supported})),(e=>{let{readyAndNotSupported:t}=e;t&&this.logger.errorOnce(this.unsupportedErrorMessage)}),d.syncAndInitial),(0,d.watch)((()=>{var e;return null===(e=this.analysis)||void 0===e?void 0:e.parent}),(e=>{this._parentChangeFromReconnect||e===this.view||this._set("isAnalysisOwner",!1);const t=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,t&&this._scheduleViewReconnect()}),d.sync),(0,d.watch)((()=>({view:this.view,ready:null!=this.view&&this.view.ready,supported:this.supported})),((e,t)=>{let{view:s}=e;const i=null===t||void 0===t?void 0:t.view;s!==i&&(this._startUserOperation=(0,h.DC)(this._startUserOperation),this._disconnectFromView(i)),this._scheduleViewReconnect()}),d.syncAndInitial)])}destroy(){this._reconnectViewTask=(0,h.DC)(this._reconnectViewTask),this._startUserOperation=(0,h.DC)(this._startUserOperation),null!=this.analysisView&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),this._set("view",null),null!=this.analysis&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set("analysis",null))}get supported(){return null==this.view||this.view.type===this.supportedViewType}set visible(e){this._set("visible",e),null!=this.analysisView&&(this.analysisView.visible=e)}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}set analysis(e){e!==this._get("analysis")&&(this._startUserOperation=(0,h.DC)(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(e),this._scheduleViewReconnect())}get ready(){return null!=this.analysisView&&!this.connectingToView}get connectingToView(){return null!=this._reconnectViewTask}get isAnalysisOwner(){return this._get("isAnalysisOwner")}get tool(){return null!=this.analysisView?this.analysisView.tool:null}clear(){this._startUserOperation=(0,h.DC)(this._startUserOperation),this._resetInteractiveCreationState(),null!=this.tool&&null!=this.view&&this.view.activeTool===this.tool&&(this.view.activeTool=null)}async start(){this.clear();const e={task:null,abort:null,state:i.PENDING},t=(0,l.UT)((async t=>{if(e.state=i.WAIT_FOR_VIEW_READY,await(0,d.whenOnce)((()=>this.ready),t),e.state=i.RUNNING,null==this.analysisView||null==this.view)return;const s=this.analysisView.tool;null!=s&&(this.view.activeTool=s,(0,d.when)((()=>s.created),(()=>{s.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0}))}));return e.task=t,e.abort=()=>t.abort(),this._startUserOperation=e,t.promise}onConnectToAnalysisView(e){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=(0,h.DC)(this._reconnectViewTask);const e=(0,l.UT)((async t=>{try{await this._reconnectView(t)}catch(s){if((0,c.Te)(t),!(0,c.zf)(s))return void this.logger.warn("Failed to use analysis in view model",s);throw s}finally{e===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=e}async _reconnectView(e){const{view:t}=this,s=null!=t&&t.ready&&this.supported,i=this.analysis;if(this._startUserOperation=w(this._startUserOperation),this._disconnectFromView(t),s&&null!=t&&null!=i){if(this.isAnalysisOwner){if(null!=i.parent)return void this.logger.errorOnce("expected owned analysis to have null parent when connecting to view");this._parentChangeFromReconnect=!0,t.analyses.add(i)}this.analysisView=await t.whenAnalysisView(i),(0,c.G4)(e)?this._startUserOperation=w(this._startUserOperation):(this.analysisView.visible=this.visible,this._forceInteractiveHandle=this.analysisView.forceInteractiveForViewModel(),this.addHandles(this._forceInteractiveHandle),this.onConnectToAnalysisView(this.analysisView))}}_disconnectFromView(e){null!=e&&this.isAnalysisOwner&&e.analyses.includes(this.analysis)&&(this._parentChangeFromReconnect=!0,this.analysis.clear(),e.analyses.remove(this.analysis)),this.onDisconnectFromAnalysisView(),this._forceInteractiveHandle=(0,h.xt)(this._forceInteractiveHandle),this.analysisView=null}_setExternalAnalysis(e){null==this.analysisView||this.isAnalysisOwner||(this.analysisView.visible=void 0,this._forceInteractiveHandle=(0,h.xt)(this._forceInteractiveHandle)),this.analysisView=null,this._set("isAnalysisOwner",!1),this._set("analysis",e),this._parentChangeFromReconnect=!1}_resetInteractiveCreationState(){this.analysis.clear(),null!=this.tool&&this.tool.resetCreated()}get testInfo(){return{analysisView:this.analysisView}}};function w(e){return null!=e&&e.state>=i.RUNNING?(e.abort(),null):e}(0,o._)([(0,u.MZ)()],v.prototype,"supported",null),(0,o._)([(0,u.MZ)()],v.prototype,"view",void 0),(0,o._)([(0,u.MZ)({type:Boolean,value:!0})],v.prototype,"visible",null),(0,o._)([(0,u.MZ)()],v.prototype,"active",null),(0,o._)([(0,u.MZ)()],v.prototype,"disabled",null),(0,o._)([(0,u.MZ)({nonNullable:!0})],v.prototype,"analysis",null),(0,o._)([(0,u.MZ)()],v.prototype,"analysisView",void 0),(0,o._)([(0,u.MZ)()],v.prototype,"ready",null),(0,o._)([(0,u.MZ)()],v.prototype,"connectingToView",null),(0,o._)([(0,u.MZ)({readOnly:!0})],v.prototype,"isAnalysisOwner",null),(0,o._)([(0,u.MZ)()],v.prototype,"_reconnectViewTask",void 0),(0,o._)([(0,u.MZ)()],v.prototype,"_forceInteractiveHandle",void 0),(0,o._)([(0,u.MZ)()],v.prototype,"tool",null),v=(0,o._)([(0,y.$)("esri.widgets.support.AnalysisViewModel")],v)}}]);
//# sourceMappingURL=90156.32d55947.chunk.js.map
/*! For license information please see 89466.90a39f64.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[89466],{89466:(e,t,i)=>{i.r(t),i.d(t,{arcgis_version_management:()=>g});var n=i(85643),s=i(83308);function o(e,t){let i=e;for(;i;){if(i===t)return!0;if(!i.parentNode)return!1;i=i.parentNode instanceof ShadowRoot?i.parentNode.host:i.parentNode}return!1}function r(e,t,i){var n,s;return null!==(n=null===(s=function(e,t){let i=e;for(;i;){let e=i.closest(t);if(e)return e;let n=i.getRootNode();if(n===document)return null;i=n.host}return null}(e,"[".concat(t,"]")))||void 0===s?void 0:s.getAttribute(t))&&void 0!==n?n:i}var a=new Set(["ar","bg","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),l=new Map;async function c(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n="".concat(t,"/").concat(i).concat(e,".json");if(l.has(n))return l.get(n);try{let s=await fetch(n);if(s.ok){let e=await s.json();return l.set(n,e),e}if("en"===e)return void l.set(n,void 0);let o=await c("en",t,i);return l.set(n,o),o}catch{return void l.set(n,void 0)}}var h=new WeakMap,d=new WeakMap,v=new WeakMap;async function u(e,t,i){d.set(e,t),h.set(e,function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};if(!t||t.length<=0)return;let n=new MutationObserver((t=>{for(let n of t)o(e,n.target)&&i()}));return n.observe(document.documentElement,{attributes:!0,attributeFilter:t,subtree:!0}),n}(e._hostElement,["lang"],(()=>{w(e,i).catch(console.error)}))),await w(e,i)}async function w(e,t){let{lang:i,t9nLocale:n}=function(e){let t=r(e,"lang",navigator.language||"en");if(a.has(t))return{lang:t,t9nLocale:t};let i=t.slice(0,2);return{lang:t,t9nLocale:a.has(i)?i:"en"}}(e._hostElement);if(i===e._lang&&n===e._t9nLocale||(i!==e._lang&&(e._lang=i),n===e._t9nLocale))return;let s=v.get(e);if(!s){var o;let t=null!==(o=d.get(e))&&void 0!==o?o:"",i=e._hostElement.tagName.toLowerCase().replace("arcgis-",""),r="".concat(t,"/").concat(i,"/t9n"),a="".concat(i,".t9n.");s=await c(n,r,a)}n!==e._t9nLocale&&(e._t9nLocale=n,e._t9nStrings=s,await(null===t||void 0===t?void 0:t.call(e)))}const g=class{constructor(e){(0,n.r)(this,e),this._watchHandles=[],this.label=void 0,this.position="top-right",this.view=void 0,this._lang="",this._t9nLocale="",this._t9nStrings=void 0,this.state=void 0}positionWatcher(e){void 0!==e&&this.viewModel&&this.view.ui.move(this._hostElement,e)}async componentDidLoad(){const{watch:e}=await(0,s.i)();this._watchHandles.push(e((()=>this.viewModel.state),(e=>{this.state=e})))}async componentWillLoad(){await u(this,(0,n.a)("./assets")),await this._checkForView(),this.viewModel=await(0,s.a3)({view:this.view}),this.label=this.label?this.label:this._t9nStrings.label}disconnectedCallback(){!function(e){var t;null!==(t=h.get(e))&&void 0!==t&&t.disconnect(),h.delete(e),d.delete(e)}(this),this._watchHandles.forEach((e=>{e.remove()})),this._watchHandles=[]}render(){const{_t9nStrings:e,label:t,viewModel:i,viewModel:{state:s,loadError:o}}=this,r=Array.from(this.viewModel.serviceNameLookup,(e=>{let[t,i]=e;return{url:t,name:i}}));return(0,n.h)(n.H,null,(0,n.h)("calcite-flow",{ref:e=>{this.flowElement=e},class:"flow-main"},(0,n.h)("calcite-flow-item",{heading:t},(0,n.h)("calcite-panel",{class:"panel-services",loading:"loading"===s},r.map((s=>(0,n.h)("arcgis-version-management-service-item",{flowElement:this.flowElement,heading:t,serviceUrl:s.url,strings:e,viewModel:i,onVersionItemActionClickedEventWithServiceUrl:e=>{this._handleVersionItemActionClick(e,this.flowElement).catch(console.error)},onVersionListActionClickedEvent:e=>{this._handleVersionListActionClick(e,this.flowElement).catch(console.error)}}))),"disabled"===s?(0,n.h)("calcite-notice",{class:"notice",closable:!1,kind:"warning",open:!0,scale:"s",slot:"footer"},(0,n.h)("div",{slot:"message"},this._getLoadError(o))):void 0))))}async _checkForView(){const e=this._hostElement.closest("arcgis-map");null!==e&&void 0!==e&&e.view&&(await e.view.map.load(),this.view=e.view,this.view.ui.add(this._hostElement,this.position))}_createVersionPropertiesFlow(e,t){const{flowElement:i,viewModel:n}=this;if(!i)return null;const s=document.createElement("arcgis-version-management-version-properties");return s.flowElement=i,s.serviceUrl=e,s.strings=this._t9nStrings,s.versionInfo=t,s.viewModel=n,s.addEventListener("versionPropertiesSaveClickedEvent",(async e=>{const{serviceUrl:t,versionInfo:s}=e.detail,o=s.versionIdentifier.name,r=o.split(".").length>1?o.split(".")[1]:o,a=o.split(".").length>1?o.split(".")[0]:n.userLookup.get(t);if(""===s.versionIdentifier.guid?await n.createVersion({access:s.access,description:s.description,featureServerUrl:t,ownerName:a,versionName:r}):await n.alterVersion({access:s.access,description:s.description,featureServerUrl:t,ownerName:a,versionIdentifier:{name:"",guid:s.versionIdentifier.guid},versionName:r}),"ready"===n.state){const e=i.getElementsByTagName("arcgis-version-management-version-list")[0];e.versionInfos=[];const s=await n.getVersionInfos(t,!0);e.versionInfos=s,await i.back()}})),s}_getLoadError(e){const{_t9nStrings:t}=this;switch(e){case"no-feature-services":return t.loadErrors.noFeatureServices;case"no-layers-property":return t.loadErrors.noLayersProperty;default:return e}}async _handleVersionItemActionClick(e,t){const{actionType:i,serviceUrl:n,versionInfo:s}=e.detail;switch(i){case"changeVersion":await this._switchToVersion(n,s.versionIdentifier.name,s.versionIdentifier.guid);break;case"editVersion":{const e=this._createVersionPropertiesFlow(n,s);if(!e)break;null===t||void 0===t||t.append(e);break}}}async _handleVersionListActionClick(e,t){const{actionType:i,serviceUrl:n}=e.detail;switch(i){case"newVersion":{const e=this._createVersionPropertiesFlow(n,void 0);if(!e)break;null===t||void 0===t||t.append(e);break}case"refreshVersions":{var s;const e=null===(s=this.flowElement)||void 0===s?void 0:s.getElementsByTagName("arcgis-version-management-version-list")[0];if(!e)break;e.versionInfos=[];const t=await this.viewModel.getVersionInfos(n,!0);e.versionInfos=t;break}}}async _switchToVersion(e,t,i){await this.viewModel.changeVersion(e,t,i)}static get assetsDirs(){return["assets"]}get _hostElement(){return(0,n.g)(this)}static get watchers(){return{position:["positionWatcher"]}}};g.style=".div-content{background-color:var(--calcite-ui-foreground-1);padding:0.75rem}.flow-main{width:330px}.notice{width:-webkit-fill-available}.panel-services{max-height:400px}.panel-versions{max-height:400px}"}}]);
//# sourceMappingURL=89466.90a39f64.chunk.js.map
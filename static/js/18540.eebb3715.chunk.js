"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[18540,63733],{70961:(e,t,o)=>{o.d(t,{A:()=>g});var i,a=o(35143),n=o(31633),r=o(46053),s=(o(81806),o(76460),o(47249),o(85842)),l=o(34111),p=o(13904),d=o(65215),c=o(13312),h=o(7137),u=o(45417),v=o(85996);let y=i=class extends d.A{constructor(){super(...arguments),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let o;if(null!==e&&void 0!==e&&e.center)o=e;else{if(null!==e&&void 0!==e&&e.rings)return super.normalizeCtorArgs(e,t);o={center:e}}return{...super.normalizeCtorArgs(),...o,...t}}initialize(){var e;const t=this.center,o=this.numberOfPoints;if(this.hasZ=null!==(e=null===t||void 0===t?void 0:t.hasZ)&&void 0!==e&&e,0!==this.rings.length||!t)return;const i=(0,n.oU)(this.radius,this.radiusUnit,"meters"),a=t.spatialReference;let r,s="geographic";if(a.isWebMercator?s="webMercator":(null!=(a.wkid&&v.A[a.wkid])||(a.wkt2||a.wkt)&&(0,n.x1)(a.wkt2||a.wkt))&&(s="projected"),this.geodesic){let e;switch(s){case"webMercator":e=(0,u.ci)(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":e=t}r=this._createGeodesicCircle(e,i,o),"webMercator"===s&&(r=(0,u.Gh)(r))}else{let e;"webMercator"===s||"projected"===s?e=i/(0,n.Ao)(t.spatialReference):"geographic"===s&&(e=(0,n.vl)(i,"meters",(0,l.tO)(t.spatialReference).radius)),r=this._createPlanarCircle(t,e,o)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:o,radiusUnit:a,geodesic:n}=this;return new i({center:null===e||void 0===e?void 0:e.clone(),numberOfPoints:t,radius:o,radiusUnit:a,geodesic:n})}_createGeodesicCircle(e,t,o){let i=0;const a=[];for(;i<360;){const n=[0,0],r=[e.x,e.y];(0,h.vN)(n,r,i,t,c.A.WGS84),this.hasZ&&n.push(e.z),a.push(n),i+=360/o}return a.push(a[0]),new d.A(a)}_createPlanarCircle(e,t,o){const i=[],a=2*Math.PI/o;for(let n=0;n<o;++n){const o=a*n,r=[e.x+Math.cos(-o)*t,e.y+Math.sin(-o)*t];this.hasZ&&r.push(e.z),i.push(r)}return i.push(i[0]),new d.A({spatialReference:e.spatialReference,rings:[i]})}};(0,a._)([(0,r.MZ)({type:p.A})],y.prototype,"center",void 0),(0,a._)([(0,r.MZ)()],y.prototype,"geodesic",void 0),(0,a._)([(0,r.MZ)()],y.prototype,"numberOfPoints",void 0),(0,a._)([(0,r.MZ)()],y.prototype,"radius",void 0),(0,a._)([(0,r.MZ)()],y.prototype,"radiusUnit",void 0),y=i=(0,a._)([(0,s.$)("esri.geometry.Circle")],y);const g=y},64232:(e,t,o)=>{o.d(t,{W:()=>s,g:()=>r});var i=o(9392),a=o(9624),n=o(45308);function r(e,t,o,i){var r,s;if((0,a.canProjectWithoutEngine)(e.spatialReference,o)){var p;l[0]=e.x,l[1]=e.y;const a=e.z;return l[2]=null!==(p=null!==a&&void 0!==a?a:i)&&void 0!==p?p:0,(0,n.projectBuffer)(l,e.spatialReference,0,t,o,0,1)}const d=(0,a.tryProjectWithZConversion)(e,o);return!!d&&(t[0]=null===d||void 0===d?void 0:d.x,t[1]=null===d||void 0===d?void 0:d.y,t[2]=null!==(r=null!==(s=null===d||void 0===d?void 0:d.z)&&void 0!==s?s:i)&&void 0!==r?r:0,!0)}async function s(e,t,o,i,n){return await(0,a.initializeProjection)(e.spatialReference,o,null,n),r(e,t,o,i)}const l=(0,i.vt)()},14487:(e,t,o)=>{o.d(t,{F:()=>n});o(9624);var i=o(13312),a=o(64232);function n(e,t,o,i,n){return!(null==t||null==i||e.length<2)&&(r.x=e[0],r.y=e[1],r.z=e[2],r.spatialReference=t,(0,a.g)(r,o,i,n))}const r=(0,o(18117).T)(0,0,0,i.A.WGS84)},98799:(e,t,o)=>{o.d(t,{H:()=>n});var i=o(9392),a=o(482);function n(e,t,o){if(null==t)return!1;const i=(0,a.Yz)(t);return null!=i&&(i(e,0,r,0),o!==r&&(o[0]=r[0],o[1]=r[1],o.length>2&&(o[2]=r[2])),!0)}const r=(0,i.vt)()},63733:(e,t,o)=>{o.r(t),o.d(t,{default:()=>u});var i=o(35143),a=o(46053),n=(o(81806),o(76460),o(47249),o(85842)),r=o(5364),s=o(25515),l=o(65624),p=o(5682),d=o(64519),c=o(731);let h=class extends((0,l.d)((0,p.j)(s.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new d.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i._)([(0,a.MZ)({type:c.A})],h.prototype,"elevationInfo",void 0),(0,i._)([(0,a.MZ)((0,r.C)(d.Y,"graphics"))],h.prototype,"graphics",void 0),(0,i._)([(0,a.MZ)({type:["show","hide"]})],h.prototype,"listMode",void 0),(0,i._)([(0,a.MZ)()],h.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],h.prototype,"type",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],h.prototype,"internal",void 0),h=(0,i._)([(0,n.$)("esri.layers.GraphicsLayer")],h);const u=h},18117:(e,t,o)=>{function i(e,t,o,i){return{x:e,y:t,z:o,hasZ:null!=o,hasM:!1,spatialReference:i,type:"point"}}o.d(t,{T:()=>i})},12482:(e,t,o)=>{o.d(t,{$7:()=>O,B:()=>E,Fo:()=>f,M7:()=>M,NN:()=>h,Q5:()=>_,Tq:()=>S,Up:()=>b,XF:()=>G,Ze:()=>v,bK:()=>s,bh:()=>c,id:()=>y,ky:()=>d,qt:()=>T,tW:()=>w,w7:()=>l,wF:()=>r,wS:()=>g,xS:()=>m,ze:()=>p});var i=o(31633),a=o(59097);function n(e){return e?T:S}function r(e,t){return null!==t&&void 0!==t&&t.mode?t.mode:n(e).mode}function s(e,t){return null!=t?t:n(e)}function l(e,t){return r(null!=e&&e.hasZ,t)}function p(e,t){return s(null!=e&&!!e.hasZ,t)}function d(e){const t=u(e);return l(e.geometry,t)}function c(e){const t=u(e),o=l(e.geometry,t);return{mode:o,offset:null!=t&&"on-the-ground"!==o?M(t):0}}function h(e){if("on-the-ground"===d(e))return!1;const t=u(e),o=null!==t&&void 0!==t&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!o||"0"===o)}function u(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function v(e,t){if(null===e||void 0===e||!e.offset)return 0;const{offset:o,unit:a}=e;if("decimal-degrees"===a)return 0;const n="unknown"!==a&&a?a:"meters",r=(0,i.mq)(t);return r?(0,i.oU)(o,n,r):0}function y(e,t,o){var i,a;if(null===o||void 0===o||!o.mode)return;const n=e.hasZ?e.z:0,r=v(o,e.spatialReference);switch(o.mode){case"absolute-height":return n-r;case"on-the-ground":return 0;case"relative-to-ground":return n-((null!==(i=t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"ground"))&&void 0!==i?i:0)+r);case"relative-to-scene":return n-((null!==(a=t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"scene"))&&void 0!==a?a:0)+r)}}function g(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return f(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,o,i)}function m(e,t,o,i){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return f(e,t[0],t[1],t.length>2?t[2]:0,o,i,a)}function f(e,t,o,i,a,n){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==n)return;const s=null!=r?r.mode:"absolute-height";if("on-the-ground"===s)return 0;const{absoluteZ:l}=_(t,o,i,a,e,n);return function(e,t,o,i,a,n,r,s){var l,p;const d=v(r,a);switch(s){case"absolute-height":return e-d;case"relative-to-ground":return e-((null!==(l=n.elevationProvider.getElevation(t,o,i,a,"ground"))&&void 0!==l?l:0)+d);case"relative-to-scene":return e-((null!==(p=n.elevationProvider.getElevation(t,o,i,a,"scene"))&&void 0!==p?p:0)+d)}}(l,t,o,i,a,e,r,s)}function _(e,t,o,i,a,n){const r=v(n,i);switch(n.mode){case"absolute-height":return{absoluteZ:o+r,elevation:0};case"on-the-ground":{var s;const o=null!==(s=a.elevationProvider.getElevation(e,t,0,i,"ground"))&&void 0!==s?s:0;return{absoluteZ:o,elevation:o}}case"relative-to-ground":{var l;const n=null!==(l=a.elevationProvider.getElevation(e,t,o,i,"ground"))&&void 0!==l?l:0;return{absoluteZ:o+n+r,elevation:n}}case"relative-to-scene":{var p;const n=null!==(p=a.elevationProvider.getElevation(e,t,o,i,"scene"))&&void 0!==p?p:0;return{absoluteZ:o+n+r,elevation:n}}}}function b(e,t){if(null==t)return!1;const{mode:o}=t;return null!=o&&("scene"===e&&"relative-to-scene"===o||"ground"===e&&"absolute-height"!==o)}function E(e,t,o){return o&&o.mode!==t?"".concat(e," only support ").concat(t," elevation mode"):null}function O(e,t,o){return(null===o||void 0===o?void 0:o.mode)===t?"".concat(e," do not support ").concat(t," elevation mode"):null}function w(e,t){return null!=(null===t||void 0===t?void 0:t.featureExpressionInfo)&&"0"!==t.featureExpressionInfo.expression?"".concat(e," do not support featureExpressionInfo"):null}function G(e,t){t&&e.warn(".elevationInfo=",t)}function M(e){var t;return(null!==(t=null===e||void 0===e?void 0:e.offset)&&void 0!==t?t:0)*(0,a.Ao)(null===e||void 0===e?void 0:e.unit)}const T={mode:"absolute-height",offset:0},S={mode:"on-the-ground",offset:null}},51795:(e,t,o)=>{o.d(t,{d:()=>a,e:()=>i});var i;o(81806);function a(e){switch(e){case i.SUPPORTED:break;case i.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case i.GEOMETRY_MISSING:return"no geometry";case i.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case i.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case i.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(i||(i={}))},4656:(e,t,o)=>{o.d(t,{N:()=>n});o(81806);var i=o(12482),a=o(51795);function n(e){var t;if("graphics"!==(null===(t=e.layer)||void 0===t?void 0:t.type))return a.e.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return a.e.GEOMETRY_MISSING;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return a.e.GEOMETRY_TYPE_UNSUPPORTED}return"on-the-ground"!==(0,i.ky)(e)&&(0,i.NN)(e)?a.e.ELEVATION_MODE_UNSUPPORTED:a.e.SUPPORTED}},34205:(e,t,o)=>{o.d(t,{N:()=>r,g:()=>s});var i=o(70961),a=o(12482),n=o(51795);function r(e){return l(e).result}function s(e){return l(e).geometry}function l(e){var t;if("graphics"!==(null===(t=e.layer)||void 0===t?void 0:t.type))return{result:n.e.GRAPHICS_LAYER_MISSING,geometry:null};const{geometry:o}=e;if(null==o)return{result:n.e.GEOMETRY_MISSING,geometry:null};if("on-the-ground"!==(0,a.ky)(e)&&(0,a.NN)(e))return{result:n.e.ELEVATION_MODE_UNSUPPORTED,geometry:null};const r=o.type;return"point"!==r&&"mesh"!==r&&"polyline"!==r&&("polygon"!==r||e.geometry instanceof i.A)?{result:n.e.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:n.e.SUPPORTED,geometry:o}}},69120:(e,t,o)=>{function i(e,t,o){if(!t||null===e||void 0===e||!e.map)return;const{map:i}=e,a=i.layers.find((e=>e===t));a||i.add(t,o),a&&null!=o&&i.layers.reorder(a,o)}function a(e,t){const o="subtype-sublayer"===(null===t||void 0===t?void 0:t.type)?t.parent:t;return e.allLayerViews.find((e=>{const t=e.layer;return t===o||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(o)}))}o.d(t,{Y:()=>i,i:()=>a})},95327:(e,t,o)=>{o.d(t,{A:()=>l});var i=o(35143),a=o(91967),n=o(46053),r=(o(81806),o(76460),o(47249),o(85842));let s=class extends a.A{constructor(e){super(e),this.enabled=!1}};(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],s.prototype,"enabled",void 0),s=(0,i._)([(0,r.$)("esri.views.interactive.sketch.SketchLabelOptions")],s);const l=s},97513:(e,t,o)=>{o.d(t,{A:()=>c});var i=o(35143),a=o(91967),n=o(46053),r=(o(81806),o(76460),o(47249),o(85842)),s=o(95327),l=o(357),p=o(28506);let d=class extends a.A{constructor(e){super(e),this.labels=new s.A,this.tooltips=new l.A,this.values=new p.A}};(0,i._)([(0,n.MZ)({nonNullable:!0,type:s.A})],d.prototype,"labels",void 0),(0,i._)([(0,n.MZ)({nonNullable:!0,type:l.A})],d.prototype,"tooltips",void 0),(0,i._)([(0,n.MZ)({nonNullable:!0,type:p.A})],d.prototype,"values",void 0),d=(0,i._)([(0,r.$)("esri.views.interactive.sketch.SketchOptions")],d);const c=d},357:(e,t,o)=>{o.d(t,{A:()=>c});var i=o(35143),a=o(91967),n=o(46053),r=(o(81806),o(76460),o(47249),o(85842));let s=class extends a.A{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};(0,i._)([(0,n.MZ)({type:String,nonNullable:!0})],s.prototype,"mode",void 0),s=(0,i._)([(0,r.$)("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],s);let l=class extends a.A{constructor(e){super(e),this.area=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}toJSON(){return{area:this.area,direction:this.direction,distance:this.distance,elevation:this.elevation,header:this.header,helpMessage:this.helpMessage,orientation:this.orientation,radius:this.radius,rotation:this.rotation,scale:this.scale,size:this.size,totalLength:this.totalLength}}};(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"area",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"direction",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"distance",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"elevation",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"header",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"helpMessage",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"orientation",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"radius",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"rotation",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"scale",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"size",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"totalLength",void 0),l=(0,i._)([(0,r.$)("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],l);const p=l;let d=class extends a.A{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.inputEnabled=!0,this.elevation=new s,this.visibleElements=new p,this.visualVariables=null}get effectiveEnabled(){return this.forceEnabled||this.enabled}};(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],d.prototype,"enabled",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"forceEnabled",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"effectiveEnabled",null),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],d.prototype,"inputEnabled",void 0),(0,i._)([(0,n.MZ)({type:s,nonNullable:!0})],d.prototype,"elevation",void 0),(0,i._)([(0,n.MZ)({type:p,nonNullable:!0})],d.prototype,"visibleElements",void 0),(0,i._)([(0,n.MZ)()],d.prototype,"visualVariables",void 0),d=(0,i._)([(0,r.$)("esri.widgets.sketch.SketchTooltipOptions")],d);const c=d},28506:(e,t,o)=>{o.d(t,{A:()=>p});var i=o(35143),a=o(91967),n=o(46053),r=(o(81806),o(76460),o(47249),o(85842)),s=o(89646);let l=class extends a.A{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?s.rZ.RelativeBilateral:s.rZ.Relative;case"absolute":return s.rZ.Absolute}}};(0,i._)([(0,n.MZ)({type:String,nonNullable:!0})],l.prototype,"directionMode",void 0),(0,i._)([(0,n.MZ)({type:Boolean,nonNullable:!0})],l.prototype,"relativeDirectionIsBilateral",void 0),(0,i._)([(0,n.MZ)()],l.prototype,"effectiveDirectionMode",null),l=(0,i._)([(0,r.$)("esri.views.interactive.sketch.SketchValueOptions")],l);const p=l},53787:(e,t,o)=>{async function i(e,t){var o;if("2d"===e.type)return e.hitTest(t);const i=await e.hitTest(t);if(0===i.results.length)return i;const n=i.results[0],r=(null!==(o=n.distance)&&void 0!==o?o:0)*(1+a),s=i.results.findIndex((e=>{var t;return(null!==(t=e.distance)&&void 0!==t?t:0)>r}));return-1!==s&&(i.results=i.results.slice(0,s)),n&&i.ground.distance>r&&(i.ground.mapPoint=null),i}o.d(t,{h$:()=>s,oZ:()=>i,zF:()=>r});const a=.05;function n(e){return"graphic"===(null===e||void 0===e?void 0:e.type)}function r(e){var t;return null!==(t=e.find(n))&&void 0!==t?t:null}function s(e){return e.filter(n)}},90992:(e,t,o)=>{function i(e){return e&&"function"==typeof e.highlight}function a(e){return e&&"function"==typeof e.maskOccludee}function n(e,t,o){return null==e||e>o&&(0===t||e<t)}function r(e,t){return null!=e&&e>0||null!=t&&t>0}function s(e){var t,o;const i=e.effectiveScaleRange;return{minScale:null!==(t=null===i||void 0===i?void 0:i.minScale)&&void 0!==t?t:0,maxScale:null!==(o=null===i||void 0===i?void 0:i.maxScale)&&void 0!==o?o:0}}function l(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatures"in e&&"layer"in e&&"view"in e}o.d(t,{Cf:()=>s,JU:()=>n,Of:()=>i,Uk:()=>a,WK:()=>r,lO:()=>l})},11337:(e,t,o)=>{o.d(t,{A:()=>oe});var i=o(35143),a=o(95444),n=o(19276),r=o(50076),s=o(54099),l=o(76460),p=o(30726),d=o(50346),c=o(68134),h=o(46053),u=(o(81806),o(47249),o(85842)),v=o(34111),y=o(9624),g=o(5262),m=o(80963),f=o(63733),_=o(31933),b=o(51795),E=o(4656),O=o(34205),w=o(12482);var G=o(69120),M=o(57308),T=o(82307),S=o(95327),A=o(97513),R=o(357),P=o(28506),k=o(43184),C=o(83973),I=o(70330),U=o(53787),D=o(11500),Z=o(4212);let H=class extends s.A.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,Z.Xb)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;null===(e=this.activeComponent)||void 0===e||e.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};(0,i._)([(0,h.MZ)()],H.prototype,"activeComponent",void 0),(0,i._)([(0,h.MZ)()],H.prototype,"cancelled",void 0),(0,i._)([(0,h.MZ)()],H.prototype,"history",void 0),(0,i._)([(0,h.MZ)()],H.prototype,"tool",null),(0,i._)([(0,h.MZ)()],H.prototype,"type",void 0),(0,i._)([(0,h.MZ)()],H.prototype,"canUndo",null),(0,i._)([(0,h.MZ)()],H.prototype,"canRedo",null),(0,i._)([(0,h.MZ)()],H.prototype,"onEnd",void 0),(0,i._)([(0,h.MZ)()],H.prototype,"undo",null),(0,i._)([(0,h.MZ)()],H.prototype,"redo",null),(0,i._)([(0,h.MZ)()],H.prototype,"toggleTool",void 0),(0,i._)([(0,h.MZ)()],H.prototype,"addToSelection",void 0),(0,i._)([(0,h.MZ)()],H.prototype,"removeFromSelection",void 0),H=(0,i._)([(0,u.$)("esri.widgets.Sketch.support.OperationHandle")],H);let N=class extends H{};(0,i._)([(0,h.MZ)()],N.prototype,"activeComponent",void 0),N=(0,i._)([(0,u.$)("esri.widgets.Sketch.support.CreateOperationHandle")],N);let x=class extends H{};(0,i._)([(0,h.MZ)()],x.prototype,"activeComponent",void 0),x=(0,i._)([(0,u.$)("esri.widgets.Sketch.support.UpdateOperationHandle")],x);var L=o(76940),V=o(86875),Y=o(86645),F=o(94918),z=o(84847);const B={defaultZ:0},K={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let W=class extends s.A.EventedAccessor{constructor(e){var t,o,i;super(e),this._numUpdating=0,this._defaultSnappingManager=null,this._internalGraphicsLayer=new f.default({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new L.default({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new V.default({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Y.default({color:[130,130,130,1],width:2}),this.meshSymbol=new F.A({symbolLayers:new n.A([new z.A])}),this.updateGraphics=new n.A,this.updateOnGraphicClick=!0,this.vertexSymbol=new L.default({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new A.A,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalPopupEnabled=null,this.defaultCreateOptions=B,this.defaultUpdateOptions=K,this.snappingOptions=null!==(t=null!==(o=null===e||void 0===e||null===(i=e.snappingManager)||void 0===i?void 0:i.options)&&void 0!==o?o:null===e||void 0===e?void 0:e.snappingOptions)&&void 0!==t?t:new C.A}initialize(){this.addHandles([(0,c.on)((()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.map)||void 0===e?void 0:e.layers}),"change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),(0,c.on)((()=>{var e;return null===(e=this.layer)||void 0===e?void 0:e.graphics}),"change",(e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),(0,c.watch)((()=>{var e,t;return null!==(e=null===(t=this.layer)||void 0===t?void 0:t.elevationInfo)&&void 0!==e?e:null}),(e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)}),c.syncAndInitial),(0,c.watch)((()=>this.view),(e=>{this._defaultSnappingManager=(0,p.pR)(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new k.g({view:e,options:this.snappingOptions})),"2d"===e.type?Promise.all([o.e(87878),o.e(86268),o.e(23018),o.e(7236),o.e(99270),o.e(53181),o.e(53078),o.e(19508)]).then(o.bind(o,45924)):"3d"===e.type&&(Promise.all([o.e(98433),o.e(88105),o.e(59231),o.e(87878),o.e(86268),o.e(23018),o.e(24473),o.e(47387),o.e(39840),o.e(47447),o.e(58842),o.e(22216),o.e(99785),o.e(70177),o.e(99469),o.e(88),o.e(7236),o.e(75655),o.e(99270),o.e(56878),o.e(85893),o.e(53078),o.e(14826),o.e(26088)]).then(o.bind(o,94801)),Promise.all([o.e(98433),o.e(60324),o.e(401),o.e(88105),o.e(27391),o.e(59231),o.e(86268),o.e(24473),o.e(47387),o.e(39840),o.e(47447),o.e(58842),o.e(22216),o.e(99785),o.e(70177),o.e(96090),o.e(52784),o.e(7323),o.e(57308),o.e(77096)]).then(o.bind(o,42208))))}),c.syncAndInitial),(0,c.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.spatialReference}),((e,t)=>{e&&t&&!e.equals(t)&&this.cancel()}))]),(0,I.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,p.pR)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){var e;return"3d"===(null===(e=this.view)||void 0===e?void 0:e.type)?"move":"transform"}get updating(){return this._numUpdating>0||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){var e,t;return null!==(e=null===(t=this._operationHandle)||void 0===t?void 0:t.tool)&&void 0!==e?e:null}get activeComponent(){var e,t;return null!==(e=null===(t=this._operationHandle)||void 0===t?void 0:t.activeComponent)&&void 0!==e?e:null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...B,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...K,...e,reshapeOptions:{...K.reshapeOptions,...null===e||void 0===e?void 0:e.reshapeOptions},highlightOptions:{...K.highlightOptions,...null===e||void 0===e?void 0:e.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){var e,t;return null!==(e=null===(t=this.snappingManager)||void 0===t?void 0:t.options)&&void 0!==e?e:this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,p.pR)(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new k.g({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){var e;const t=!(null===(e=this.view)||void 0===e||!e.ready||!this.layer),o=this._operationHandle;return t&&o?"active":t?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:o}=t;e&&(t.cursor=null),null!==o&&void 0!==o&&o.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const o="view-ready";this.removeHandles(o),e&&this.addHandles((0,c.when)((()=>e.ready),(t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)}),c.syncAndInitial),o),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,p.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,p.DC)(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:o}=this,i=t.toArray();o.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map((e=>e.clone())).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:o,layer:i}=this;if(!o||"disabled"===this.state)throw i||this._logMissingLayer(),(0,d.NK)();if(null!=o.activeTool&&(o.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,G.Y)(o,this._internalGraphicsLayer);const a=await this._setupCreateOperation(e,t);if(null==a||this.destroyed)return void o.map.remove(this._internalGraphicsLayer);a.on("complete",(()=>{if(a===this._operationHandle){var t;const o=this.createGraphic,n=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),null!==(t=this.view)&&void 0!==t&&t.map&&this.view.map.remove(this._internalGraphicsLayer),a.cancelled||null==o||i.add(o),this.emit("create",{graphic:o,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}})),this._operationHandle=a,o.ready&&o.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:o,view:i,state:a}=this;if(!i||"disabled"===a)throw o||this._logMissingLayer(),(0,d.NK)();null!=i.activeTool&&(i.activeTool=null);const n=Array.isArray(e)?e:[e];if(null==e||null===n||void 0===n||!n.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some((e=>e.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0))))return;const r=await this._setupUpdateOperation(n,t);this.destroyed||null==r||te(r)||((0,G.Y)(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(r,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:r.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){this._beginAsyncOperation(),e=Array.isArray(e)?e:[e];for(const o of e)null==o.geometry||"mesh"===o.geometry.type||(0,m.aI)(o.geometry.spatialReference,t.spatialReference)||((0,y.canProjectWithoutEngine)(o.geometry.spatialReference,t.spatialReference)||(0,y.isLoaded)()||await(0,y.load)(),o.geometry=(0,y.project)(o.geometry,t.spatialReference));this._endAsyncOperation()}else this._logMissingView()}undo(){var e;this.canUndo()&&(null===(e=this._operationHandle)||void 0===e||e.undo())}redo(){var e;this.canRedo()&&(null===(e=this._operationHandle)||void 0===e||e.redo())}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const o=[];t.map.allLayers.forEach((e=>{"vector-tile"!==e.type&&"imagery"!==e.type||o.push(e)}));const i=await t.hitTest(e,{exclude:o});return(0,U.zF)(i.results)}const o=[t.map.ground];t.map.allLayers.forEach((e=>{(0,_.Eq)(e.type)&&o.push(e)}));const i=await t.hitTest(e,{exclude:o});if(i.results.length>0){var a;const e=i.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(null!==(a=e.distance)&&void 0!==a?a:0)>-Math.min(3*i.ground.distance,"global"===t.viewingMode?(0,v.tO)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",(async t=>{var o;const i="active"===this.state&&"create"===(null===(o=this._operationHandle)||void 0===o?void 0:o.type);if("disabled"===this.state||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const a=await t.async((()=>this._getFirstHit((0,D.ZV)(t))));let n=null;if(null!=a){const o=a.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(t.stopPropagation(),n=o):"2d"!==e.type||this._isComponentGraphic(o)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==n||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()}),M.o.WIDGET)]}async _setupCreateOperation(e,t){const o=this.view;if(!o)return this._logMissingView(),null;const i={hasZ:"3d"===o.type,...this.defaultCreateOptions,...t},a=await this._setupDrawGraphicTool(e,o,i);return null==a?null:(o.tools.add(a),o.activeTool=a,this._setupCreateOperationHandle(a))}async _setupDrawGraphicTool(e,t,o){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:a,hasZ:n,geometryToPlace:r,graphicProperties:s,mode:l,preserveAspectRatio:p}=o,d="rectangle"===e||"circle"===e?"hybrid":"click",c=null!==p&&void 0!==p?p:"rectangle"!==e,h={centered:"rectangle"!==e&&!("circle"===e&&!c),cursor:i,defaultZ:a,forceUniformSize:c,graphicProperties:s,geometryToPlace:r,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:n,mode:null!==l&&void 0!==l?l:d,snappingManager:this.snappingManager,snapToScene:!1,view:t};return"2d"===t.type?this._makeDrawGraphicTool2D(h):this._makeDrawGraphicTool3D(h)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(Promise.all([o.e(87878),o.e(86268),o.e(23018),o.e(7236),o.e(99270),o.e(53181),o.e(53078),o.e(19508)]).then(o.bind(o,45924)));return te(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:j(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(Promise.all([o.e(98433),o.e(88105),o.e(59231),o.e(87878),o.e(86268),o.e(23018),o.e(24473),o.e(47387),o.e(39840),o.e(47447),o.e(58842),o.e(22216),o.e(99785),o.e(70177),o.e(99469),o.e(88),o.e(7236),o.e(75655),o.e(99270),o.e(56878),o.e(85893),o.e(53078),o.e(14826),o.e(26088)]).then(o.bind(o,94801)));if(te(t)||this.destroyed)return null;const{elevationInfo:i}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:i,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let o=null;const i=e.forceUniformSize,a=e.centered,n=[t.on("key-down",(t=>{if(t.key===T.NE.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===T.NE.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==T.NE.vertexAdd||t.repeat)t.key===T.NE.undo?(t.stopPropagation(),r.undo()):t.key===T.NE.redo?(t.stopPropagation(),r.redo()):t.key!==T.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===T.NE.center&&(t.repeat||(e.centered=!a,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation());else{const o=e.drawOperation.geometryType;"polyline"!==o&&"polygon"!==o&&"multipoint"!==o||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}}),M.o.WIDGET),t.on("key-up",(t=>{t.key===T.NE.pan?e.enabled=!0:t.key!==T.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===T.NE.center&&(e.centered=a,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())}),M.o.WIDGET),e.on("vertex-add",(t=>{switch(o=null==o?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:o,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}})),e.on("complete",(e=>{this._set("createGraphic",e.graphic),o="complete",e.aborted?r&&r.cancel():r&&r.complete()})),(0,c.watch)((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t}))],r=new N({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{var o;n.forEach((e=>e.remove())),n.length=0,null===(o=t.tools)||void 0===o||o.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return r}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:o,view:i}=this;if(!i)return this._logMissingView(),null;const a={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...null===t||void 0===t?void 0:t.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...null===t||void 0===t?void 0:t.highlightOptions}};let n=a.tool;for(const s of e)o.remove(s),o.add(s);if("3d"===i.type){if(0===e.length)return null;switch(n){case"move":return this._setupMove3DOperation(e,a,i,n);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,O.N)(e[0]);return t===b.e.SUPPORTED?this._setupReshape3DOperation(e[0],a,i):(this._logError("sketch:reshape","Reshape operation not supported for provided graphic(s) (".concat((0,b.d)(t),").")),null)}case"transform":return this._setupGraphicTransform3DOperation(e,a,i)}}switch(n){case"move":return this._setupMove2DOperation(e,a,i);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=(0,O.N)(e[0]);return t===b.e.SUPPORTED?this._setupTransformOrReshape2DOperation(e,n,a,i):(this._logError("sketch:reshape","Reshape operation not supported for provided graphic(s) (".concat((0,b.d)(t),").")),null)}case"transform":if(1===e.length){var r;const t=null===(r=e[0].geometry)||void 0===r?void 0:r.type;"point"!==t&&"multipoint"!==t||(n="reshape")}return this._setupTransformOrReshape2DOperation(e,n,a,i)}}async _setupMove3DOperation(e,t,i,a){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(const o of e){const e=(0,E.N)(o);if(e!==b.e.SUPPORTED)return this._logError("sketch:move","Move operation not supported for provided graphic(s) (".concat((0,b.d)(e),").")),null}const r=await this._requireModule(Promise.all([o.e(98433),o.e(88105),o.e(59231),o.e(87878),o.e(86268),o.e(23018),o.e(24473),o.e(47387),o.e(39840),o.e(47447),o.e(58842),o.e(22216),o.e(99785),o.e(70177),o.e(99469),o.e(88),o.e(7236),o.e(75655),o.e(99270),o.e(56878),o.e(85893),o.e(53078),o.e(14826),o.e(26088)]).then(o.bind(o,94801)));if(te(r))return r;const s=new r.module.GraphicMoveTool({view:i,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(s),s.graphics.addMany(e),n||this.updateGraphics.addMany(e);const l=[],p=new x({activeComponent:s,tool:a,type:"update",onEnd:()=>{var e;l.forEach((e=>e.remove())),l.length=0,null!==(e=i.tools)&&void 0!==e&&e.remove(s),s.destroyed||s.destroy()},undo:()=>{J(p,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{Q(p,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:e=>{this.updateGraphics.push(e),s.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);p.history.undo.forEach((e=>e.updates.splice(t,1))),p.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?s.graphics.remove(e):p.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==a)return;const e=this.updateGraphics.at(0);if((0,O.N)(e)!==b.e.SUPPORTED)return;p.onEnd(),p.destroy();const o=await this._setupReshape3DOperation(e,t,i,!0);te(o)||this._setUpdateOperationHandle(o,t)}});return l.push(...this._getHandlesForComponent(p,t),i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(p,e,t)),M.o.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(p,e)}),M.o.WIDGET)),p}_setupGraphicTransform3DOperation(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(1===e.length&&function(e){var t;if("graphics"!==(null===(t=e.layer)||void 0===t?void 0:t.type))return b.e.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return b.e.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.e.SUPPORTED;default:return b.e.GEOMETRY_TYPE_UNSUPPORTED}const o=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return o&&o.some((e=>"object"===e.type))?"on-the-ground"!==(0,w.ky)(e)&&(0,w.NN)(e)?b.e.ELEVATION_MODE_UNSUPPORTED:b.e.SUPPORTED:b.e.SYMBOL_TYPE_UNSUPPORTED}(e[0])===b.e.SUPPORTED){const a=e[0],n=a.geometry;if(null!=n&&("point"===n.type||"mesh"===n.type))return this._setupPointTransform3DOperation(a,t,o);if(null!=n&&("polygon"===n.type||"polyline"===n.type))return this._setupPolyTransform3DOperation(a,t,o,i)}return this._setupMove3DOperation(e,t,o,"transform",i)}async _setupPointTransform3DOperation(e,t,i){const a="transform",{enableRotation:n,enableScaling:r,enableZ:s}=t,l=await this._requireModule(Promise.all([o.e(98433),o.e(88105),o.e(59231),o.e(87878),o.e(86268),o.e(23018),o.e(24473),o.e(47387),o.e(39840),o.e(47447),o.e(58842),o.e(22216),o.e(99785),o.e(70177),o.e(99469),o.e(88),o.e(7236),o.e(75655),o.e(99270),o.e(56878),o.e(85893),o.e(53078),o.e(14826),o.e(26088)]).then(o.bind(o,94801)));if(te(l))return l;const p=new l.module.GraphicTransformTool({graphic:e,view:i,enableRotation:n,enableScaling:r,enableZ:s,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(p),this.updateGraphics.add(e);const d=[],c=new x({activeComponent:p,tool:a,type:"update",onEnd:()=>{var e;d.forEach((e=>e.remove())),d.length=0,null!==(e=i.tools)&&void 0!==e&&e.remove(p),p.destroyed||p.destroy()},undo:()=>{J(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{Q(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),c.onEnd(),c.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);te(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),c.complete()},toggleTool:()=>{}});return d.push(...this._getHandlesForComponent(c,t),i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e,t)),M.o.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e)}),M.o.WIDGET)),c}async _setupPolyTransform3DOperation(e,t,i){var a;let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="transform",{enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:d}=t,c=await this._requireModule(Promise.all([o.e(98433),o.e(88105),o.e(59231),o.e(87878),o.e(86268),o.e(23018),o.e(24473),o.e(47387),o.e(39840),o.e(47447),o.e(58842),o.e(22216),o.e(99785),o.e(70177),o.e(99469),o.e(88),o.e(7236),o.e(75655),o.e(99270),o.e(56878),o.e(85893),o.e(53078),o.e(14826),o.e(26088)]).then(o.bind(o,94801)));if(te(c))return c;const h=null===(a=this.view)||void 0===a||null===(a=a.inputManager)||void 0===a?void 0:a.isModifierKeyDown(T.NE.constraint),u=new c.module.ExtentTransformTool({graphic:e,view:i,enableRotation:s,enableScaling:l,enableZ:p,preserveAspectRatio:!!d!=!!h,sketchOptions:this.sketchOptions});i.tools.add(u),n||this.updateGraphics.add(e);const v=[],y=new x({activeComponent:u,tool:r,type:"update",onEnd:()=>{var e;v.forEach((e=>e.remove())),v.length=0,null!==(e=i.tools)&&void 0!==e&&e.remove(u),u.destroyed||u.destroy()},canUndo:()=>u.canUndo,undo:()=>{u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},canRedo:()=>u.canRedo,redo:()=>{u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);te(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.at(0);if((0,O.N)(e)!==b.e.SUPPORTED)return;y.onEnd(),y.destroy();const o=await this._setupReshape3DOperation(e,t,i,!0);te(o)||this._setUpdateOperationHandle(o,t)}});return v.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(y,e,t)),M.o.WIDGET),i.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(y,e)),M.o.WIDGET),i.on("key-down",(e=>{e.key!==T.NE.constraint||e.repeat||(u.preserveAspectRatio=!u.preserveAspectRatio,e.stopPropagation())}),M.o.WIDGET),i.on("key-up",(e=>{e.key===T.NE.constraint&&(u.preserveAspectRatio=!u.preserveAspectRatio,e.stopPropagation())}),M.o.WIDGET)),y}async _setupMove2DOperation(e,t,o){const i="move";this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const a=await this._getGraphicMover(e,t,o);if(te(a))return a;const n=new x({activeComponent:a,tool:i,type:"update",onEnd:()=>{var e;this._displayDefaultCursor(),l.forEach((e=>e.remove())),s.forEach((e=>e.remove())),l=[],s=[],a.destroy(),null===(e=this._internalGraphicsLayer)||void 0===e||e.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();J(n,e),n.refreshComponent(),this._emitUndoEvent({graphics:e,tool:i})},redo:()=>{const e=this.updateGraphics.toArray();Q(n,e),n.refreshComponent(),this._emitRedoEvent({graphics:e,tool:i})},addToSelection:async e=>{await this._updateSpatialReference(e),this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach((e=>e.updates.splice(t,1))),n.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics=o:n.complete()}});let r=!1,s=[o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(n,e,t)),M.o.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key!==T.NE.constraint||e.repeat||(r=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)}),M.o.WIDGET),o.on("key-up",(e=>{e.key===T.NE.constraint&&r&&(r=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)}),M.o.WIDGET)],l=this._getHandlesForComponent(n,t);return n}async _setupReshape3DOperation(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n="reshape",r=await this._requireModule(Promise.all([o.e(98433),o.e(88105),o.e(59231),o.e(87878),o.e(86268),o.e(23018),o.e(24473),o.e(47387),o.e(39840),o.e(47447),o.e(58842),o.e(22216),o.e(99785),o.e(70177),o.e(99469),o.e(88),o.e(7236),o.e(75655),o.e(99270),o.e(56878),o.e(85893),o.e(53078),o.e(14826),o.e(26088)]).then(o.bind(o,94801)));if(te(r))return r;const s=t.reshapeOptions,l=new r.module.GraphicReshapeTool({view:i,graphic:e,enableZVertex:t.enableZ&&"move"===(null===s||void 0===s?void 0:s.vertexOperation),enableZShape:t.enableZ&&"move"===(null===s||void 0===s?void 0:s.shapeOperation),enableMoveGraphic:"move"===(null===s||void 0===s?void 0:s.shapeOperation)||"move-xy"===(null===s||void 0===s?void 0:s.shapeOperation),enableMidpoints:"split"===(null===s||void 0===s?void 0:s.edgeOperation),enableEdgeOffset:"offset"===(null===s||void 0===s?void 0:s.edgeOperation),snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(l),a||this.updateGraphics.add(e);const p=[],d=new x({activeComponent:l,tool:n,type:"update",onEnd:()=>{var e;p.forEach((e=>e.remove())),p.length=0,null!==(e=i.tools)&&void 0!==e&&e.remove(l),l.destroyed||l.destroy()},canUndo:()=>l.canUndo,undo:()=>{l.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},canRedo:()=>l.canRedo,redo:()=>{l.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),d.onEnd(),d.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);te(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),d.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;d.onEnd(),d.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);te(e)||this._setUpdateOperationHandle(e,t)}});return p.push(...this._getHandlesForComponent(d,t),i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(d,e,t)),M.o.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(d,e)}),M.o.WIDGET)),d}async _setupTransformOrReshape2DOperation(e,t,o,i){this.updateGraphics.addMany(e),await this._updateSpatialReference(e);const a="transform"===t?await this._getBox(e,o,i):await this._getReshape(e,o,i);if(te(a))return a;const n=new x({activeComponent:a,type:"update",onEnd:()=>{s.forEach((e=>e.remove())),r.forEach((e=>e.remove())),s=[],r=[],n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{J(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{Q(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async e=>{let t=n.activeComponent;if("reshape"===(null===t||void 0===t?void 0:t.type)){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),n.onEnd(),n.destroy();const a=await this._setupTransformOrReshape2DOperation(t,"transform",o,i);if(te(a))return;this._setUpdateOperationHandle(a,o)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach((e=>e.updates.splice(t,1))),n.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();if(0===o.length)n.complete();else{const e=o[0].geometry;1!==o.length||null==e||"point"!==e.type&&"multipoint"!==e.type?n.activeComponent.graphics=o:n.toggleTool()}this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{var e;if(this.updateGraphics.length>1)return;const t=this.updateGraphics.at(0),a=t.geometry;if(null!=a&&("reshape"===n.tool&&("point"===a.type||"multipoint"===a.type)||"transform"===n.tool&&"extent"===a.type))return;let r=null;"transform"===n.tool?r=await this._getReshape([t],o,i):"reshape"===n.tool&&(r=await this._getBox([t],o,i)),te(r)||(null!==(e=n.activeComponent)&&void 0!==e&&e.destroy(),n.activeComponent=r,n.activeComponent&&(s.forEach((e=>e.remove())),s=this._getHandlesForComponent(n,o)))}});let r=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(n,e,o)),M.o.WIDGET),i.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key===T.NE.constraint&&!e.repeat&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),M.o.WIDGET),i.on("key-up",(e=>{if(e.key===T.NE.constraint&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),M.o.WIDGET)],s=this._getHandlesForComponent(n,o);return n}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:a,highlightOptions:n}=t,r=await this._requireModule(Promise.all([o.e(75971),o.e(91720)]).then(o.bind(o,61472)));return te(r)?r:new r.module.default({enableMoveAllGraphics:a,highlightsEnabled:!(null===n||void 0===n||!n.enabled),indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-start"},type:"update"})},onGraphicMove:e=>{let{dx:t,dy:o,graphic:i}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move"},type:"update"})},onGraphicMoveStop:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){var a;const{enableRotation:n,enableScaling:r,highlightOptions:s,preserveAspectRatio:l}=t,p=await this._requireModule(Promise.all([o.e(99270),o.e(75971),o.e(59463)]).then(o.bind(o,20819)));if(te(p))return p;const d=null===(a=this.view)||void 0===a||null===(a=a.inputManager)||void 0===a?void 0:a.isModifierKeyDown(T.NE.constraint);return new p.module.default({graphics:e,enableRotation:n,enableScaling:r,highlightsEnabled:!(null===s||void 0===s||!s.enabled),preserveAspectRatio:!!l!=!!d,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,i){var a,n,r;const s="split"===(null===(a=t.reshapeOptions)||void 0===a?void 0:a.edgeOperation),l="move"===(null===(n=t.reshapeOptions)||void 0===n?void 0:n.shapeOperation),p=!(null===(r=t.highlightOptions)||void 0===r||!r.enabled),d=await this._requireModule(Promise.all([o.e(87878),o.e(99270),o.e(53181),o.e(75971),o.e(24546)]).then(o.bind(o,42046)));return te(d)?d:new d.module.default({enableMidpoints:s,enableMovement:l,graphic:e[0],highlightsEnabled:p,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:i,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:e=>{let{mover:t,type:o}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t,type:o},type:"update"})},onMoveStart:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onMove:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onMoveStop:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onVertexAdd:e=>{let{added:t,type:o,vertices:i}=e;const a=t.map((e=>(0,g.$K)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:a,vertices:i,type:o},type:"update"})},onVertexRemove:e=>{let{removed:t,type:o,vertices:i}=e;const a=t.map((e=>(0,g.$K)(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:a,vertices:i,type:o},type:"update"})}}})}_getHandlesForComponent(e,t){const o=e.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",(t=>{var o;let{graphic:i,viewEvent:a}=t;(null===(o=a.native)||void 0===o?void 0:o.shiftKey)&&(a.stopPropagation(),e.removeFromSelection(i))})),o.on("graphic-move-start",(t=>e.addToHistory(ee(t.allGraphics))))];case"box":return[o.on("graphic-click",(o=>this._onTransformOrReshape2DGraphicClick(e,t,o))),o.on("move-start",(t=>e.addToHistory(ee(t.graphics)))),o.on("rotate-start",(t=>e.addToHistory(ee(t.graphics)))),o.on("scale-start",(t=>e.addToHistory(ee(t.graphics))))];case"reshape":return[o.on("graphic-click",(o=>this._onTransformOrReshape2DGraphicClick(e,t,o))),o.on("move-start",(t=>e.addToHistory(ee([t.mover])))),o.on("reshape-start",(t=>e.addToHistory(ee([t.graphic])))),o.on("vertex-add",(t=>e.addToHistory(ee([t.oldGraphic])))),o.on("vertex-remove",(t=>e.addToHistory(ee([t.oldGraphic]))))];case"move-3d":return[o.on("graphic-move-start",(t=>{e.addToHistory(ee(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})})),o.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})})),o.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[o.on("record-undo",(t=>{let{record:o}=t;e.addToHistory({updates:[o]})})),o.on("graphic-translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),o.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),o.on("graphic-rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),o.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),o.on("graphic-scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),o.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),o.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),o.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})})),o.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[o.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool()}))]}}_onTransformOrReshape2DGraphicClick(e,t,o){var i;const{graphic:a,viewEvent:n}=o;return null!==(i=n.native)&&void 0!==i&&i.shiftKey&&a.layer===this.layer?(n.stopPropagation(),e.removeFromSelection(a)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){var o;this._operationHandle=e;const i=null===(o=this.view)||void 0===o?void 0:o.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),a=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:a,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,o){const i=(0,D.ZV)(t),a=await t.async((()=>this._getFirstHit(i)));null!=a&&(t.native.shiftKey&&this._toggleSelection([a.graphic],e,o)||this.updateGraphics.includes(a.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,o){const i=!!o.multipleSelectionEnabled;return e.some((e=>null!=e&&!(!i||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0)))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const o=t.key;o===T.NE.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===T.NE.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===T.NE.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&T.NE.delete.includes(o)&&this._onDeleteKey(t)}_onDeleteKey(e){var t;if(!this._operationHandle||"update"!==this._operationHandle.type)return;const o=this.activeComponent,i=this.updateGraphics.toArray();null!=o&&"reshape-3d"!==o.type&&("reshape"!==o.type||1===i.length&&"point"===(null===(t=i[0].geometry)||void 0===t?void 0:t.type))&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){var e;this._internalGraphicsLayer&&(null!==(e=this.view)&&void 0!==e&&null!==(e=e.map)&&void 0!==e&&e.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,p.pR)(this._internalGraphicsLayer))}_isComponentGraphic(e){var t;const{activeComponent:o}=this;return!(!e||null==o)&&((null===(t=e.attributes)||void 0===t?void 0:t.esriSketchTool)||"draw-2d"===o.type&&o.graphic===e||("box"===o.type||"reshape"===o.type)&&o.isUIGraphic(e))}_displayPointerCursor(){var e;(null===(e=this.view)||void 0===e?void 0:e.container)&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){var e;(null===(e=this.view)||void 0===e?void 0:e.container)&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){var e;(null===(e=this.view)||void 0===e?void 0:e.container)&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,o){l.A.getLogger(this).error(new r.A(e,t,o))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){return{operationHandle:this._operationHandle,snappingManager:this.snappingManager,defaultUpdateOptions:K}}wait(){return(0,c.whenOnce)((()=>!this.updating))}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var t,o;return"3d"!==(null===(t=this.view)||void 0===t?void 0:t.type)||this.updateOnGraphicClick||null!==(o=null===e||void 0===e?void 0:e.toggleToolOnClick)&&void 0!==o&&o}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?((0,p.DC)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,d.qr)((0,c.whenOnce)((()=>null===e||void 0===e?void 0:e.ready)),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",$("view"))}_logMissingLayer(){this._logError(q,$("layer"))}};(0,i._)([(0,h.MZ)()],W.prototype,"_defaultSnappingManager",void 0),(0,i._)([(0,h.MZ)()],W.prototype,"updating",null),(0,i._)([(0,h.MZ)()],W.prototype,"_operationHandle",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],W.prototype,"activeTool",null),(0,i._)([(0,h.MZ)()],W.prototype,"activeFillSymbol",void 0),(0,i._)([(0,h.MZ)()],W.prototype,"activeLineSymbol",void 0),(0,i._)([(0,h.MZ)()],W.prototype,"activeVertexSymbol",void 0),(0,i._)([(0,h.MZ)()],W.prototype,"allowDeleteKey",void 0),(0,i._)([(0,h.MZ)({readOnly:!0})],W.prototype,"createGraphic",null),(0,i._)([(0,h.MZ)()],W.prototype,"defaultCreateOptions",null),(0,i._)([(0,h.MZ)()],W.prototype,"defaultUpdateOptions",null),(0,i._)([(0,h.MZ)({type:S.A,nonNullable:!0})],W.prototype,"labelOptions",null),(0,i._)([(0,h.MZ)()],W.prototype,"layer",void 0),(0,i._)([(0,h.MZ)({types:a.Es})],W.prototype,"pointSymbol",void 0),(0,i._)([(0,h.MZ)({types:a.Es})],W.prototype,"polygonSymbol",void 0),(0,i._)([(0,h.MZ)({types:a.Es})],W.prototype,"polylineSymbol",void 0),(0,i._)([(0,h.MZ)()],W.prototype,"meshSymbol",void 0),(0,i._)([(0,h.MZ)({type:C.A,nonNullable:!0})],W.prototype,"snappingOptions",null),(0,i._)([(0,h.MZ)()],W.prototype,"snappingManager",null),(0,i._)([(0,h.MZ)({readOnly:!0})],W.prototype,"state",null),(0,i._)([(0,h.MZ)({type:R.A,nonNullable:!0})],W.prototype,"tooltipOptions",null),(0,i._)([(0,h.MZ)({readOnly:!0})],W.prototype,"updateGraphics",void 0),(0,i._)([(0,h.MZ)()],W.prototype,"updateOnGraphicClick",void 0),(0,i._)([(0,h.MZ)({type:P.A,nonNullable:!0})],W.prototype,"valueOptions",null),(0,i._)([(0,h.MZ)({types:a.Es})],W.prototype,"vertexSymbol",void 0),(0,i._)([(0,h.MZ)({value:null})],W.prototype,"view",null),(0,i._)([(0,h.MZ)({constructOnly:!0,type:A.A})],W.prototype,"sketchOptions",void 0),W=(0,i._)([(0,u.$)("esri.widgets.Sketch.SketchViewModel")],W);const q="sketch:missing-property",$=e=>"Property '".concat(e,"' is missing on SketchViewModel.");function j(e){return"polygon"===e||"rectangle"===e||"circle"===e}function J(e,t){X("undo",e.history.undo,e.history.redo,t)}function Q(e,t){X("redo",e.history.redo,e.history.undo,t)}function X(e,t,o,i){const a=t.pop();if(!a)return;const n=a.updates,r=[];i.forEach(((t,o)=>{const i=n[o];null!=i&&("geometry"in i&&null!=i.geometry&&(r.push({geometry:t.geometry}),t.geometry=i.geometry),"symbol"in i&&null!=i.symbol&&(r.push({symbol:t.symbol}),t.symbol=i.symbol),"undo"in i&&(r.push(i),i[e](t)))})),o.push({updates:r})}function ee(e){return{updates:e.map((e=>({geometry:e.geometry})))}}function te(e){return"requireError"in e&&"aborted"===e.requireError}const oe=W}}]);
//# sourceMappingURL=18540.eebb3715.chunk.js.map
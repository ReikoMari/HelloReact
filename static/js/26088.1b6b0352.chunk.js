"use strict";(self.webpackChunkhelloworld=self.webpackChunkhelloworld||[]).push([[26088,76030],{53514:(t,e,i)=>{i.d(e,{T:()=>a,d:()=>_});const a={Base64:0,Hex:1,String:2,Raw:3},n=8,o=(1<<n)-1;function s(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function r(t){const e=[];for(let i=0,a=t.length*n;i<a;i+=n)e[i>>5]|=(t.charCodeAt(i/n)&o)<<i%32;return e}function l(t){const e=[];for(let i=0,a=32*t.length;i<a;i+=n)e.push(String.fromCharCode(t[i>>5]>>>i%32&o));return e.join("")}function h(t,e,i,a,n,o){return s(function(t,e){return t<<e|t>>>32-e}(s(s(e,t),s(a,o)),n),i)}function p(t,e,i,a,n,o,s){return h(e&i|~e&a,t,e,n,o,s)}function c(t,e,i,a,n,o,s){return h(e&a|i&~a,t,e,n,o,s)}function u(t,e,i,a,n,o,s){return h(e^i^a,t,e,n,o,s)}function d(t,e,i,a,n,o,s){return h(i^(e|~a),t,e,n,o,s)}function g(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,a=-271733879,n=-1732584194,o=271733878;for(let r=0;r<t.length;r+=16){const e=i,l=a,h=n,g=o;i=p(i,a,n,o,t[r],7,-680876936),o=p(o,i,a,n,t[r+1],12,-389564586),n=p(n,o,i,a,t[r+2],17,606105819),a=p(a,n,o,i,t[r+3],22,-1044525330),i=p(i,a,n,o,t[r+4],7,-176418897),o=p(o,i,a,n,t[r+5],12,1200080426),n=p(n,o,i,a,t[r+6],17,-1473231341),a=p(a,n,o,i,t[r+7],22,-45705983),i=p(i,a,n,o,t[r+8],7,1770035416),o=p(o,i,a,n,t[r+9],12,-1958414417),n=p(n,o,i,a,t[r+10],17,-42063),a=p(a,n,o,i,t[r+11],22,-1990404162),i=p(i,a,n,o,t[r+12],7,1804603682),o=p(o,i,a,n,t[r+13],12,-40341101),n=p(n,o,i,a,t[r+14],17,-1502002290),a=p(a,n,o,i,t[r+15],22,1236535329),i=c(i,a,n,o,t[r+1],5,-165796510),o=c(o,i,a,n,t[r+6],9,-1069501632),n=c(n,o,i,a,t[r+11],14,643717713),a=c(a,n,o,i,t[r],20,-373897302),i=c(i,a,n,o,t[r+5],5,-701558691),o=c(o,i,a,n,t[r+10],9,38016083),n=c(n,o,i,a,t[r+15],14,-660478335),a=c(a,n,o,i,t[r+4],20,-405537848),i=c(i,a,n,o,t[r+9],5,568446438),o=c(o,i,a,n,t[r+14],9,-1019803690),n=c(n,o,i,a,t[r+3],14,-187363961),a=c(a,n,o,i,t[r+8],20,1163531501),i=c(i,a,n,o,t[r+13],5,-1444681467),o=c(o,i,a,n,t[r+2],9,-51403784),n=c(n,o,i,a,t[r+7],14,1735328473),a=c(a,n,o,i,t[r+12],20,-1926607734),i=u(i,a,n,o,t[r+5],4,-378558),o=u(o,i,a,n,t[r+8],11,-2022574463),n=u(n,o,i,a,t[r+11],16,1839030562),a=u(a,n,o,i,t[r+14],23,-35309556),i=u(i,a,n,o,t[r+1],4,-1530992060),o=u(o,i,a,n,t[r+4],11,1272893353),n=u(n,o,i,a,t[r+7],16,-155497632),a=u(a,n,o,i,t[r+10],23,-1094730640),i=u(i,a,n,o,t[r+13],4,681279174),o=u(o,i,a,n,t[r],11,-358537222),n=u(n,o,i,a,t[r+3],16,-722521979),a=u(a,n,o,i,t[r+6],23,76029189),i=u(i,a,n,o,t[r+9],4,-640364487),o=u(o,i,a,n,t[r+12],11,-421815835),n=u(n,o,i,a,t[r+15],16,530742520),a=u(a,n,o,i,t[r+2],23,-995338651),i=d(i,a,n,o,t[r],6,-198630844),o=d(o,i,a,n,t[r+7],10,1126891415),n=d(n,o,i,a,t[r+14],15,-1416354905),a=d(a,n,o,i,t[r+5],21,-57434055),i=d(i,a,n,o,t[r+12],6,1700485571),o=d(o,i,a,n,t[r+3],10,-1894986606),n=d(n,o,i,a,t[r+10],15,-1051523),a=d(a,n,o,i,t[r+1],21,-2054922799),i=d(i,a,n,o,t[r+8],6,1873313359),o=d(o,i,a,n,t[r+15],10,-30611744),n=d(n,o,i,a,t[r+6],15,-1560198380),a=d(a,n,o,i,t[r+13],21,1309151649),i=d(i,a,n,o,t[r+4],6,-145523070),o=d(o,i,a,n,t[r+11],10,-1120210379),n=d(n,o,i,a,t[r+2],15,718787259),a=d(a,n,o,i,t[r+9],21,-343485551),i=s(i,e),a=s(a,l),n=s(n,h),o=s(o,g)}return[i,a,n,o]}function _(t){const e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.Hex)||a.Base64,i=g(r(t),t.length*n);switch(e){case a.Raw:return i;case a.Hex:return function(t){const e="0123456789abcdef",i=[];for(let a=0,n=4*t.length;a<n;a++)i.push(e.charAt(t[a>>2]>>a%4*8+4&15)+e.charAt(t[a>>2]>>a%4*8&15));return i.join("")}(i);case a.String:return l(i);case a.Base64:return function(t){const e=[];for(let i=0,a=4*t.length;i<a;i+=3){const a=(t[i>>2]>>i%4*8&255)<<16|(t[i+1>>2]>>(i+1)%4*8&255)<<8|t[i+2>>2]>>(i+2)%4*8&255;for(let n=0;n<4;n++)8*i+6*n>32*t.length?e.push("="):e.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-n)&63))}return e.join("")}(i)}}},60216:(t,e,i)=>{i.d(e,{C:()=>r,E:()=>s});var a=i(9392),n=i(9624),o=i(14487);function s(t,e,i){return!!(0,o.F)(t,e,l,i.spatialReference)&&(i.x=l[0],i.y=l[1],i.z=l[2],!0)}async function r(t,e,i,a){return await(0,n.initializeProjection)(e,i.spatialReference,null,a),s(t,e,i)}const l=(0,a.vt)()},88954:(t,e,i)=>{i.d(e,{E$:()=>x,Gs:()=>I,Jq:()=>w,PX:()=>E,Sj:()=>_,U9:()=>O,US:()=>S,Ui:()=>M,b:()=>d,jI:()=>f,lt:()=>b,oJ:()=>m,vf:()=>y,vt:()=>u,xW:()=>T});var a=i(34761),n=i(20664),o=i(9392),s=i(34111),r=i(13312),l=i(98510),h=i(5568),p=i(79650),c=i(93582);function u(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function d(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function g(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(t){return{operations:t,value:t.create()}}(t);return i.operations=t,t.copy(e,i.value),i}function _(t){return g(c.s,(0,c.f)(0,0,0,(0,s.tO)(t).radius))}const v=2**50;function m(){return g(p.b,(0,p.f)([0,0,0],[v,0,0],[0,v,0]))}function f(t,e,i){return t.operations.axisAt(t.value,e,h._.Z,i)}function y(t,e,i,a){return t.operations.axisAt(t.value,e,i,a)}function M(t,e,i){return t.operations.intersectRay(t.value,e,i)}function b(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function S(t,e){return t.operations.altitudeAt(t.value,e)}function x(t,e,i,a){return t.operations.setAltitudeAt(t.value,e,i,a)}function w(t,e,i,o){return e!==o&&(0,a.C)(o,e),(0,n.s)(A,o[12],o[13],o[14]),x(t,A,i,A),o[12]=A[0],o[13]=A[1],o[14]=A[2],o}function T(t,e,i){return t.operations.elevate(t.value,e,i.value)}const A=(0,o.vt)();function E(t,e,i,a,o){return o[0]=(0,n.k)(t,e),o[1]=(0,n.k)(t,i),o[2]=(0,n.k)(t,a),o}function O(t,e,i,a,o){(0,n.c)(i,t),(0,n.c)(R,e),(0,n.n)(R,R),(0,n.b)(a,R,i),(0,n.b)(o,a,i)}function I(t,e){return t?(0,l.lO)(e):e.isGeographic?r.A.PlateCarree:e}const R=(0,o.vt)()},10760:(t,e,i)=>{i.d(e,{h:()=>o});let a=t=>({vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}),n=(t,e,i)=>{for(let o=0,s=e.length;o<s;o++){let s=e[o];Array.isArray(s)?n(t,s,i):null!=s&&!1!==s&&("string"==typeof s&&(s=a(s)),i.push(s))}};function o(t,e,i){if(Array.isArray(e))i=e,e=void 0;else if(e&&("string"==typeof e||e.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,o;return i&&1===i.length&&"string"==typeof i[0]?a=i[0]:i&&(o=[],n(t,i,o),0===o.length&&(o=void 0)),{vnodeSelector:t,properties:e,children:o,text:""===a?void 0:a,domNode:null}}},94801:(t,e,i)=>{i.r(e),i.d(e,{DrawGraphicTool3D:()=>ht,ExtentTransformTool:()=>Ki,GraphicMoveTool:()=>Ze,GraphicReshapeTool:()=>si,GraphicTransformTool:()=>Oi});var a=i(35143),n=i(59784),o=i(54901),s=i(30726),r=i(68134),l=i(46053),h=i(81806),p=(i(76460),i(47249),i(85842)),c=i(20664),u=i(9392),d=i(12482),g=i(731),_=i(76931),v=(i(50076),i(69539)),m=i(91967),f=i(98773),y=i(15941),M=i(50346),b=i(11113),S=i(31633),x=i(19555),w=i(72745),T=i(5262),A=i(75762),E=i(63860),O=i(19747),I=i(28048),R=i(68655);const G={default:15,far:25};let D=class extends m.A{constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const t=(0,f.UT)((async t=>{const e=await(0,E.ud)("esri/core/t9n/Units");(0,M.Te)(t),this._messagesUnits=e}));this.addHandles([(0,r.watch)((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((t=>(0,r.on)((()=>{var t;return null===(t=this.context)||void 0===t?void 0:t.editGeometryOperations}),t,(()=>this._update())))),(0,o.hA)((()=>t.abort())),(0,r.watch)((()=>this._colors),(t=>this._updateStyle(t)))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((t=>t.label.text))}}get _edgeDistancePixels(){return G[this.edgeDistance]}get _colors(){var t,e;const i=null!==(t=null===(e=this.context)||void 0===e?void 0:e.view.effectiveTheme.textColor)&&void 0!==t?t:v.A.fromArray([255,255,255]);return{textColor:i,backgroundColor:(0,n._L)((0,n.bJ)(i,n.pW.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:t,stagedVertex:e}=this;if(!t)return this._destroyUnusedLabels();const{editGeometryOperations:i}=t,{components:a,geometry:n,coordinateHelper:o}=i.data;if(!n)return this._destroyUnusedLabels();const s=a.length;for(let r=0;r<s;++r){const a=Z(n,i,e,o,r);if(a.length<2||!C(a,t.view,t.elevationInfo,o.spatialReference))continue;const l=1===s&&!(0,T.$3)(a);let h=k,p=H;this.toScreenPointArray(t,a[0],h);for(let e=1;e<a.length;++e){const i=a[e-1],n=a[e];this.toScreenPointArray(t,n,p),this._addLabel(t,i,h,n,p,l),[h,p]=[p,h]}}this._destroyUnusedLabels()}_updateStyle(t){let{textColor:e,backgroundColor:i}=t;const a=this._nextLabelIndex,n=this._labelInfos;for(let o=0;o<a;++o){const{label:t}=n[o];t.textColor=e,t.backgroundColor=i}}_addLabel(t,e,i,a,n,o){const{label:s}=this._getOrCreateLabel(t);if(!this.visible||(0,x.hG)(i,n)<3025)return void(s.visible=!1);const{spatialReference:r}=t.editGeometryOperations.data,l=(0,R.Do)(e,a,r),h=this._messagesUnits,p=(0,O.c)(t.view);s.text=null!=h&&null!=l?(0,b.ix)(h,l,p):"",s.visible=!0;const c=n[0]-i[0],u=n[1]-i[1];o?(0,x.hZ)(z,-u,c):(0,x.hZ)(z,u,-c),(0,x.S8)(z,z),(0,x.hs)(z,z,this._edgeDistancePixels),(0,x.Cc)(L,i,n,.5),(0,x.WQ)(L,L,z),s.position=[L[0],L[1]],Math.abs(z[0])>Math.abs(z[1])?s.anchor=z[0]>0?"left":"right":s.anchor=-z[1]<0?"top":"bottom"}_getOrCreateLabel(t){var e;const i=this._labelInfos.length>this._nextLabelIndex,{textColor:a,backgroundColor:n}=this._colors;if(i){const t=this._labelInfos[this._nextLabelIndex++],{label:e}=t;return e.textColor=a,e.backgroundColor=n,t}const o=new I.A({anchor:"center",fontSize:8,textColor:a,backgroundColor:n});null===(e=t.view.overlay)||void 0===e||e.items.add(o);const s={label:o};return this._labelInfos.push(s),this._nextLabelIndex=this._labelInfos.length,s}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel(t){var e;let{label:i}=t;null!==(e=this.context)&&void 0!==e&&null!==(e=e.view.overlay)&&void 0!==e&&e.items.remove(i),i.destroy()}};function Z(t,e,i,a,n){const o=[];if(e.data.components[n].iterateVertices((t=>{o.push(a.toXYZ(t.pos,A.rq.get()))})),0===n&&null!=i&&o.push(a.toXYZ(i,A.rq.get())),o.length<2)return o;const s=o[0],r=o[o.length-1];return"polygon"===t.type&&o.length>2&&!(0,c.G)(s,r)&&o.push(s),o}function C(t,e,i,a){var n;if("2d"===e.type)return!0;const o=null!==(n=(0,S.Ao)(a))&&void 0!==n?n:1,s=(0,S.G9)(a),r=t=>{var n;return null!==(n=(0,d.xS)(e,t,a,i,d.qt))&&void 0!==n?n:0};for(let l=1;l<t.length;++l){const e=t[l-1],i=t[l],a=(i[0]-e[0])*o,n=(i[1]-e[1])*o,h=(r(i)-r(e))*s;if(Math.abs(h)/Math.sqrt(a*a+n*n)>P)return!1}return!0}(0,a._)([(0,l.MZ)()],D.prototype,"context",void 0),(0,a._)([(0,l.MZ)()],D.prototype,"stagedVertex",void 0),(0,a._)([(0,l.MZ)()],D.prototype,"visible",void 0),(0,a._)([(0,l.MZ)()],D.prototype,"edgeDistance",void 0),(0,a._)([(0,l.MZ)()],D.prototype,"updating",null),(0,a._)([(0,l.MZ)()],D.prototype,"_messagesUnits",void 0),(0,a._)([(0,l.MZ)()],D.prototype,"_edgeDistancePixels",null),(0,a._)([(0,l.MZ)()],D.prototype,"_colors",null),D=(0,a._)([(0,p.$)("esri.views.interactive")],D);const P=(0,y.kU)(5),z=(0,w.vt)(),L=(0,w.vt)(),k=(0,_.gs)(),H=(0,_.gs)();var V=i(17072);let U=class extends D{getCameraOrExtent(t){let{view:e}=t;return e.state.camera}toScreenPointArray(t,e){let{view:i,elevationInfo:a,editGeometryOperations:n}=t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,_.gs)();const{spatialReference:s}=n.data.coordinateHelper;return(0,V.XG)(e,s,a,i,X),i.state.camera.projectToScreen(X,o),o}};U=(0,a._)([(0,p.$)("esri.views.3d.interactive.SegmentLabels3D")],U);const X=(0,u.vt)();var Y=i(70836),N=i(99773),F=i(80963),B=i(82062),q=i(64465);function j(t,e){const{graphic:i}=t;return[(0,r.watch)((()=>t.displaying),(t=>{t?function(t,e){const{geometry:i}=t;Q(i,e)&&t.notifyMeshTransformChanged({action:B.$.EnableFastUpdates})}(i,e):$(i,e)}),{...r.syncAndInitial}),(0,o.hA)((()=>$(i,e)))]}function $(t,e){const{geometry:i}=t;Q(i,e)&&t.notifyMeshTransformChanged({action:B.$.DisableFastUpdates})}function Q(t,e){let{state:{viewingMode:i},spatialReference:a}=e;if("mesh"!==(null===t||void 0===t?void 0:t.type))return!1;const{vertexSpace:n,spatialReference:o}=t;if(!(0,N.Hq)(n))return!1;const{type:s}=n;return i===q.RT.Global&&"local"===s||i===q.RT.Local&&(0,F.aI)(a,o)&&"georeferenced"===s&&!o.isGeographic}var W=i(14835),J=i(75655),K=i(73074),tt=i(85937),et=i(67425),it=i(49296),at=i(52447),nt=i(45463),ot=i(7811),st=i(35384),rt=i(66812),lt=i(76030);let ht=class extends ot.Nt{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new W.w({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:e,unit:i}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new g.A({mode:t,offset:e,unit:i});const a=this.geometryToPlace;a&&this.addHandles([(0,r.watch)((()=>a.vertexSpace.origin),(()=>{var t;return null===(t=this.graphic)||void 0===t?void 0:t.notifyMeshTransformChanged()}),r.sync),(0,r.watch)((()=>({vertexAttributes:a.vertexAttributes,alwaysUpdate:{}})),(()=>{var t;return null===(t=this.graphic)||void 0===t?void 0:t.notifyGeometryChanged()}),r.sync)])}normalizeCtorArgs(t){if(!t.elevationInfo){var e;const i=null===(e=t.hasZ)||void 0===e||e;return{...t,elevationInfo:(0,d.bK)(i)}}return t}initializeGraphic(t){const{view:e}=this,i=this._createGraphicState=new at.y({graphic:t});return(0,o.vE)([e.maskOccludee(t),e.trackGraphicState(i),(0,r.watch)((()=>({element:this._outlineVisualElement,isDraped:i.isDraped})),(t=>{let{element:e,isDraped:i}=t;e&&(e.isDraped=i)}),r.syncAndInitial),this._setupLoadingIndicator(i),...j(i,e)])}updateDrawMeshTooltipInfo(t){const{graphic:e,sketchOptions:i,view:a}=this;t.sketchOptions=i,t.viewType=a.type,t.helpMessage=(0,lt.getDrawMeshHelpMessage)(e,this.view),this.updateElevation(t.elevation)}makeDrawOperation(){const{geometryType:t}=this,e="circle"!==t&&"rectangle"!==t;return new st.O0({view:this.view,manipulators:this.manipulators,geometryType:(0,ot.ld)(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new rt.IX(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new rt.rT(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Y.s,segmentLabels:e?new U:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,d.wF)(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){const{view:e}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[t],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(t),(0,o.hA)();const i=this._settings,a=i.manipulators.vertex,l=new tt.I({view:e,spatialReference:e.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=l;const h=i.visualElements.zVerticalLine,p=new J.U({view:e,extensionType:h.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=p;const c=(0,o.vE)([(0,r.watch)((()=>i.visualElements.zVerticalLine),(t=>t.apply(p)),r.initial),(0,r.watch)((()=>({selectedColor:(0,n.QP)(i.colors.selected),outlineColor:(0,n.QP)(i.manipulators.vertex.outlineColor)})),(t=>{let{selectedColor:e,outlineColor:i}=t;l.color=e,l.outlineColor=i}),r.initial),(0,o.hA)((()=>{this._activeVertexVisualElement=(0,s.pR)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,s.pR)(this._verticalLineVisualElement)}))]);return l.attached=!0,this._updateVerticalLineVisualElement(t),c}_updateVerticalLineVisualElement(t){const e=this._verticalLineVisualElement;if(!e)return;const{renderCoordsHelper:i,elevationProvider:a}=this.view;(0,c.s)(ct,t[0],t[1],t[2]),pt.setFromElevationInfo(this.elevationInfo),ct[2]=(0,et.nG)(ct,a,pt,i),i.toRenderCoords(ct,this.view.spatialReference,ct)?(e.setStartEndFromWorldDownAtLocation(ct),e.attached=!0):e.attached=!1}onOutlineChanged(t){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=t,(0,o.hA)();const e=this.internalGraphicsLayer.elevationInfo,{view:i}=this,a=this._settings,n=new K.P({view:i,geometry:t,elevationInfo:e,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,d.wF)(this.hasZ,e),attached:!1,isDecoration:!0});this._outlineVisualElement=n;const l=(0,o.vE)([(0,r.watch)((()=>a.visualElements.lineGraphics.outline),(t=>t.apply(n)),r.initial),(0,r.watch)((()=>a.visualElements.lineGraphics.shadowStyle),(t=>t.apply(n)),r.initial),(0,o.hA)((()=>{this._outlineVisualElement=(0,s.pR)(this._outlineVisualElement)}))]);return n.attached=!0,n.laserlineEnabled=!0,l}onRegularVerticesChanged(t){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=t,(0,o.hA)();const{view:e}=this,i=this._settings,a=i.manipulators.vertex,l=new tt.I({view:e,spatialReference:e.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0}),h=(0,o.vE)([(0,r.watch)((()=>({color:(0,n.QP)(i.manipulators.vertex.color),outlineColor:(0,n.QP)(i.manipulators.vertex.outlineColor)})),(t=>{let{color:e,outlineColor:i}=t;l.color=e,l.outlineColor=i}),r.initial),(0,o.hA)((()=>{this._verticesVisualElement=(0,s.pR)(this._verticesVisualElement)}))]);return l.attached=!0,this._verticesVisualElement=l,h}updateGraphicGeometry(t){if("mesh"!==this.geometryType||"point"!==(null===t||void 0===t?void 0:t.type))super.updateGraphicGeometry(t);else{const e=this.geometryToPlace;null===e||void 0===e||e.centerAt(t);const i=this._graphic;e&&i.geometry===e||(i.geometry=e)}}_setupLoadingIndicator(t){const{drawOperation:e}=this;if(!this.geometryToPlace)return e.loading=!1,null;e.loading=!0;const i=(0,o.hA)((()=>{e.loading=!1}));let a;const n=()=>a&&cancelAnimationFrame(a);return(0,o.vE)([(0,r.when)((()=>t.displaying),(()=>{n(),a=requestAnimationFrame((()=>i.remove()))}),{...r.syncAndInitial,once:!0}),(0,o.hA)(n),i])}};(0,a._)([(0,l.MZ)({constructOnly:!0})],ht.prototype,"elevationInfo",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],ht.prototype,"geometryType",void 0),(0,a._)([(0,l.MZ)()],ht.prototype,"type",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],ht.prototype,"view",void 0),ht=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],ht);const pt=new it.F,ct=(0,u.vt)();var ut=i(19276),dt=i(54099),gt=i(24648),_t=i(19451),vt=i(18117),mt=i(38317),ft=i(53494);function yt(t){const e=Mt(t);return(0,w.fA)(Math.cos(e),Math.sin(e))}function Mt(t){if(null==t||"polyline"!==t.type&&"polygon"!==t.type)return 0;const e="polyline"===t.type?t.paths:t.rings,i=(0,ft.FD)();for(const a of e)for(let t=0;t<a.length-1;t++){const e=a[t],n=a[t+1],o=e[0]-n[0],s=e[1]-n[1];if(o*o+s*s>i)return Math.atan2(n[1]-e[1],n[0]-e[0])}return 0}var bt,St,xt=i(51795),wt=i(86507),Tt=i(75540),At=i(56121);!function(t){t[t.NONE=0]="NONE",t[t.ANY=1]="ANY",t[t.Z=2]="Z",t[t.XY=4]="XY"}(bt||(bt={})),function(t){t[t.TRANSLATE_Z=0]="TRANSLATE_Z",t[t.TRANSLATE_XY=1]="TRANSLATE_XY",t[t.SCALE=2]="SCALE",t[t.ROTATE=3]="ROTATE",t[t.SCALE_ROTATE=4]="SCALE_ROTATE"}(St||(St={}));class Et{constructor(){this.grabbingState=bt.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=bt.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator(((t,e)=>{if(e===St.TRANSLATE_Z&&(this.zManipulator=t),t instanceof At.q&&(t.selected&&(0===this.numSelected&&(this.firstSelected=t),this.numSelected++),null==this.firstGrabbedXY&&t.grabbing&&e===St.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=bt.ANY,e){case St.TRANSLATE_Z:this.grabbingState|=bt.Z;break;case St.TRANSLATE_XY:this.grabbingState|=bt.XY}}))}}var Ot=i(99469);function It(t){const{view:e,graphic:i}=t,a=new at.y({graphic:i}),n=function(t,e){const{view:i,graphic:a}=t,n=new K.P({view:i,geometry:Gt(a)?a.geometry:null,elevationInfo:(0,d.bh)(a),attached:!1,isDecoration:!0}),s=new W.w({getTheme:()=>i.effectiveTheme}),l=()=>{n.attached=e.displaying},h=(0,o.vE)([(0,r.watch)((()=>s.visualElements.lineGraphics.outline),(t=>t.apply(n)),r.initial),(0,r.watch)((()=>s.visualElements.lineGraphics.shadowStyle),(t=>t.apply(n)),r.initial),(0,r.watch)((()=>e.displaying),l),(0,r.watch)((()=>e.isDraped),(t=>{n.isDraped=t})),e.on("changed",(()=>n.geometry=Gt(a)?a.geometry:null)),(0,o.DQ)(n)]);return l(),{visualElement:n,remove:()=>h.remove()}}(t,a),s=[n,Rt(t,n.visualElement,a),e.maskOccludee(i),e.trackGraphicState(a)];return{visualElement:n.visualElement,remove:()=>(0,o.a0)(s)}}function Rt(t,e,i){const{graphic:a,view:n}=t,s=[],l=(0,d.bh)(a),h="on-the-ground"===l.mode||!l.offset&&"absolute-height"!==l.mode,p=new Et,u=new W.w({getTheme:()=>n.effectiveTheme}),g=u.visualElements,_=new J.U({view:n,extensionType:g.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0}),v=(0,y.kU)(g.heightPlaneAngleCutoff),m=new Ot.o({view:n,attached:!1,angleCutoff:v,isDecoration:!0}),f=(0,Tt.v)(1);s.push((0,r.watch)((()=>({lineShadowStyle:u.visualElements.lineGraphics.shadowStyle,pointShadowStyle:u.visualElements.pointGraphics.shadowStyle,alpha:f.value})),(t=>{let{lineShadowStyle:i,pointShadowStyle:a,alpha:n}=t;i.apply(e,n),a.apply(_,n)}),r.initial));const M=(0,Tt.v)(1);s.push((0,r.watch)((()=>({heightPlane:u.visualElements.heightPlane,alpha:M.value})),(t=>{let{heightPlane:e,alpha:i}=t;return e.apply(m,i)}),r.initial));const b=()=>{if(p.update(t),!i.displaying||h&&(i.isDraped||!Gt(a)||!a.geometry.hasZ))return e.laserlineEnabled=!1,_.attached=!1,void(m.attached=!1);e.laserlineEnabled=!0;const n=p.grabbingState&bt.XY?g.laserlineAlphaMultiplier:1;f.value=n;const o=p.grabbingState&bt.Z?g.laserlineAlphaMultiplier:1;M.value=o,function(t,e){const i=1===e.numSelected?e.firstSelected:e.numSelected>1&&null!=e.firstGrabbedXY?e.firstGrabbedXY:null;null!=i?(t.setStartEndFromWorldDownAtLocation(i.renderLocation),t.attached=!0):t.attached=!1}(_,p),function(t,e,i,a){if(a.numSelected>0){(0,c.s)(Dt,0,0,0);let e=0;t.forEachManipulator(((t,i)=>{i===St.TRANSLATE_XY&&t.selected&&t instanceof At.q&&((0,c.g)(Dt,Dt,t.renderLocation),e++)})),e>0?(i.heightManifoldTarget=(0,c.h)(Dt,Dt,1/e),i.attached=!0):i.attached=!1}else{const a=e.attachmentOrigin;null!=a&&t.view.renderCoordsHelper.toRenderCoords(a,Dt)?(i.heightManifoldTarget=Dt,i.attached=!0):i.attached=!1}}(t,e,m,p)};s.push((0,r.watch)((()=>u.visualElements.zVerticalLine),(t=>t.apply(_)),r.initial)),s.push(i.on("changed",b),(0,r.watch)((()=>i.displaying),b),e.events.on("attachment-origin-changed",b),(0,o.DQ)(_),(0,o.DQ)(m));const S=[],x=()=>{(0,o.a0)(S),S.length=0,t.forEachManipulator((t=>S.push(t.events.on("grab-changed",b)))),t.forEachManipulator((t=>S.push(t.events.on("select-changed",b)))),b()};return x(),s.push(t.onManipulatorsChanged(x),(0,o.a2)((()=>(0,o.vE)(S)))),(0,o.vE)(s)}function Gt(t){return null!=t.geometry&&("polygon"===t.geometry.type||"polyline"===t.geometry.type)}const Dt=(0,u.vt)();var Zt=i(64232),Ct=i(14487),Pt=i(42294),zt=i(2413),Lt=i(83574);function kt(t){const{view:e,graphic:i}=t,a=new at.y({graphic:i}),n=[],s=function(t,e,i){const{view:a,graphic:n}=t,s=new Lt.l({view:a,geometry:Ht(n),elevationInfo:(0,d.bh)(n),isDecoration:!0});return function(t,e,i,a){const n=()=>{e.attached=i.displaying},s=new W.w({getTheme:()=>t.view.effectiveTheme});(function(t,e,i,a){const{view:n,graphic:s}=t;let r=null;const l=t=>{null!=r&&(r.remove(),r=null),i.isDraped&&null!=t&&(r=function(t,e,i){const a=t.elevationProvider.spatialReference;(0,Zt.g)(e,Vt,a);const n=Vt[0],o=Vt[1];return t.elevationProvider.on("elevation-change",(t=>{(0,zt.Rj)(t.extent,n,o)&&i()}))}(n,t,(()=>{e.geometry=t})))},h=()=>{const t=Ht(s);l(t),e.geometry=t};a.push(i.on("changed",h),(0,o.a2)((()=>r))),h()})(t,e,i,a),s.visualElements.pointGraphics.outline.apply(e),a.push((0,r.watch)((()=>i.displaying),n,r.initial))}(t,s,e,i),i.push((0,o.DQ)(s)),s}(t,a,n);return function(t,e,i,a){const{view:n,graphic:s}=t,l=new W.w({getTheme:()=>n.effectiveTheme}),h=new J.U({view:n,extensionType:l.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0});i.push((0,r.watch)((()=>l.visualElements.zVerticalLine),(t=>t.apply(h)),r.initial));const p=new Ot.o({view:n,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),u=(0,y.kU)(l.visualElements.heightPlaneAngleCutoff),g=new Ot.o({view:n,attached:!1,angleCutoff:u,isDecoration:!0}),_=(0,d.bh)(t.graphic),v=it.F.fromElevationInfo(_),m="on-the-ground"===_.mode||!_.offset&&"absolute-height"!==_.mode,f=new Et,M=(0,Tt.v)(1);i.push((0,r.watch)((()=>({heightPlane:l.visualElements.heightPlane,alpha:M.value})),(t=>{let{heightPlane:e,alpha:i}=t;return e.apply(g,i)}),r.initial));const b=(0,Tt.v)(1);i.push((0,r.watch)((()=>({shadowStyle:l.visualElements.pointGraphics.shadowStyle,alpha:b.value})),(t=>{let{shadowStyle:e,alpha:i}=t;return e.apply(p,i)}),r.initial));const S=()=>{f.update(t);const i=Ht(s),o=m&&(e.isDraped||null==i||!i.hasZ);let r=!0;if(o||null==i)r=!1;else{const t=(0,et.nG)(i,n.elevationProvider,v,n.renderCoordsHelper);(0,c.s)(Vt,i.x,i.y,t),(0,Ct.F)(Vt,i.spatialReference,Vt,n.renderCoordsHelper.spatialReference),h.setStartEndFromWorldDownAtLocation(Vt),p.intersectsWorldUpAtLocation=Vt}const u=f.grabbingState&bt.Z?l.visualElements.laserlineAlphaMultiplier:1;M.value=u;const d=(0,Pt.Ie)(Ut);!o&&e.displaying&&a.calculateMapBounds(d)&&(0,Ct.F)((0,Pt.pg)(d,Vt),n.spatialReference,Vt,n.renderCoordsHelper.spatialReference)?(g.heightManifoldTarget=Vt,g.attached=!0):g.attached=!1;const _=f.grabbingState&bt.XY?l.visualElements.laserlineAlphaMultiplier:1;b.value=_;const y=r&&e.displaying&&!o;p.attached=y,h.attached=y};i.push((0,r.watch)((()=>[e.displaying,e.isDraped]),S),e.on("changed",S)),t.forEachManipulator((t=>{i.push(t.events.on("grab-changed",S))})),i.push((0,o.DQ)(p)),i.push((0,o.DQ)(h)),i.push((0,o.DQ)(g)),S()}(t,a,n,s),n.push(e.trackGraphicState(a)),{visualElement:s,remove:()=>(0,o.a0)(n)}}function Ht(t){const e=t.geometry;return null==e?null:"point"===e.type?e:"mesh"===e.type?e.anchor.clone():null}const Vt=(0,u.vt)(),Ut=(0,Pt.vt)();function Xt(t){switch(t.graphic.geometry.type){case"point":case"mesh":return kt(t);case"polygon":case"polyline":return It(t);default:return null}}const Yt=70,Nt=Math.ceil(Yt/3*2),Ft=160,Bt=5*Math.PI/12,qt=1*Math.PI/3;var jt=i(88321);class $t{constructor(){this._available=!0}set location(t){this._forEachManipulator3D((e=>e.location=t))}set elevationAlignedLocation(t){this._forEachManipulator3D((e=>e.elevationAlignedLocation=t))}set elevationInfo(t){this._forEachManipulator3D((e=>e.elevationInfo=t))}get renderLocation(){let t;return this._forEachManipulator3D((e=>{t||(t=e.renderLocation)})),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D((e=>e.available=t))}get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}_forEachManipulator3D(t){this.forEachManipulator(((e,i)=>{e instanceof At.q&&t(e,i)}))}}var Qt=i(34761),Wt=i(13191),Jt=i(91175),Kt=i(7947),te=i(17046);function ee(t,e,i){const a=(i,a)=>e({action:i,graphic:t,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY});return i(((e,i,n)=>(i.next((t=>("start"===t.action&&a("start",t),t))).next((0,te.n5)(t)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&a("update",t);break;case"end":a("end",t)}return t})),{steps:i,cancel:n=n.next((0,te.Yl)(t)).next((t=>(a("end",{screenDeltaX:0,screenDeltaY:0}),t)))})))}function ie(t){if(null==(null===t||void 0===t?void 0:t.axis))return 1;const{mapStart:e,mapEnd:i,axis:a}=t,n=[i.x-e.x,i.y-e.y];return n[0]*a[0]+n[1]*a[1]>0?1:-1}var ae=i(83490),ne=i(62577),oe=i(76956),se=i(76336);class re extends $t{constructor(t){super(),this._handles=new jt.A,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=Yt,this._updateAfterDrag=!1,this.events=new dt.A,this._tool=t.tool,this._view=t.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}set orthogonalAvailable(t){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t)}destroy(){this._handles=(0,s.pR)(this._handles),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:e}of this._arrowManipulatorInfos)t(e,St.TRANSLATE_XY)}createGraphicDragPipeline(t,e,i){const a=e.graphic,n=(0,d.bh)(a),o=a.geometry.spatialReference;return ee(a,i,(e=>this.createDragPipeline(((i,a,n,o,s)=>(({steps:a,cancel:n}=t(i,a,n,o,s)),e(i,a,n))),n,o,a)))}createDragPipeline(t,e,i,a){return(0,o.vE)(this._arrowManipulatorInfos.map(((n,o)=>{let{manipulator:s}=n;return(0,te.Xt)(s,((n,s,r,l,h)=>{const p=s.next((t=>({...t,manipulatorType:St.TRANSLATE_XY}))).next((0,te.Tp)(this._view,n.elevationAlignedLocation)).next((0,Kt.PW)(this._view,n.elevationAlignedLocation,e,i,a)).next((0,te.an)(n.location,this.angle+(o+1)*Math.PI*.5)).next((0,te.sO)());t(n,p,r,l,h)}))})))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator(t,e){let{manipulator:i,transform:a}=t;const n=this._radius/Yt,o=54*n,s=o*Math.sqrt(3)/2,r=(0,ne._B)(this._opaqueMaterial,s,o/2,o/2,.02);(0,ne.xh)(r,(0,Qt.kN)(A.Rc.get(),(0,c.s)(A.rq.get(),0,-s/3,0))),i.renderObjects=[new Jt.M(r,se.p7.Focused),new Jt.M(r.instantiate({material:this._transparentMaterial}),se.p7.Unfocused)],i.radius=s/3*2*1.2;const l=(0,Qt.N9)(A.Rc.get(),e*Math.PI/2),h=(0,Qt.kN)(A.Rc.get(),(0,c.s)(A.rq.get(),0,100*n,0));(0,Qt.lw)(a,l,h)}_createManipulators(){for(let t=0;t<4;t++){const e=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(e)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,e=(0,Qt.$0)(A.Rc.get(),t,(0,u.fA)(0,0,1));if(null==e)return;const i=(0,Qt.CV)(A.Rc.get(),(0,c.s)(A.rq.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,Qt.lw)(A.Rc.get(),i,e);for(const n of this._arrowManipulatorInfos){const t=(0,Qt.lw)(A.Rc.get(),a,n.transform);n.manipulator.modelTransform=t}}_createArrowManipulator(t){const e=new At.q({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,u.fA)(0,0,1)}}),i={manipulator:e,transform:(0,Wt.vt)()};return this._updateArrowManipulator(i,t),this._handles.add(e.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=new oe.v({cullFace:ae.s2.Back,renderOccluded:nt.m$.Transparent,isDecoration:!0});return this._handles.add((0,r.watch)((()=>v.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=t,e.setParameters({color:i})}),r.initial)),e}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((t=>{let{manipulator:e}=t;return e}))}}}class le{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent&&null!=this._next){const e=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if(null!=i){const a={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===t?i:e,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(a)}}this._enabled=t}_snap(t){const e=null!=this._view?this._view.toMap(t,{exclude:[]}):null;return null!=e&&null!=this._view&&(e.z=(0,d.id)(e,this._view,this._elevationInfo)),e}createDragEventPipelineStep(t,e){this._view=t,this._elevationInfo=e,this._lastDragEvent=null;const i=new te.rh;return this._next=i,[t=>{if(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled){const e=this._snap(t.screenEnd);return null!=e?{action:t.action,mapStart:t.mapStart,mapEnd:e,screenStart:t.screenStart,screenEnd:t.screenEnd}:null}return{action:t.action,mapStart:t.mapStart,mapEnd:t.mapEnd,screenStart:t.screenStart,screenEnd:t.screenEnd}},i]}}class he extends $t{constructor(t){super(),this._handles=new jt.A,this._snapToScene=new le,this._scale=1,this._radius=Yt,this._view=t.view,this._tool=t.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles=(0,s.pR)(this._handles),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,St.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,e,i){const a=e.graphic,n=(0,d.bh)(a),o=a.geometry.spatialReference;return ee(a,i,(e=>this.createDragPipeline(((i,a,n,o,s)=>(({steps:a,cancel:n}=t(i,a,n,o,s)),e(i,a,n))),n,o,a)))}createDragPipeline(t,e,i,a){const n=this._view;return(0,te.Xt)(this._manipulator,((o,s,r,l,h)=>{const p=s.next((0,te.Tp)(n,o.elevationAlignedLocation)).next((0,Kt.PW)(n,o.elevationAlignedLocation,e,i,a)).next(...this._snapToScene.createDragEventPipelineStep(n,e)).next((t=>({...t,manipulatorType:St.TRANSLATE_XY}))).next((0,te.sO)());t(o,p,r,l,h)}))}_updateManipulatorTransform(){const t=(0,Qt.CV)(A.Rc.get(),(0,c.s)(A.rq.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){const t=this._view;this._manipulator=new At.q({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,u.fA)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=(0,ne.nW)(this._discMaterial,.02,1,128,(0,u.fA)(0,0,1),(0,u.fA)(0,0,0));t.transformation=(0,Qt.CV)((0,Wt.vt)(),(0,u.fA)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new Jt.M(t,se.p7.Focused),new Jt.M(t.instantiate({material:this._discMaterialTransparent}),se.p7.Unfocused)],this._manipulator.radius=this._radius/Yt*80}_createMaterial(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=new oe.v({cullFace:ae.s2.Back,renderOccluded:nt.m$.Transparent,isDecoration:!0});return this._handles.add((0,r.watch)((()=>v.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=t,e.setParameters({color:i})}),r.initial)),e}get test(){return{discManipulator:this._manipulator}}}class pe extends $t{constructor(t){super(),this._radius=Yt,this.events=new dt.A,this._tool=t.tool,this._view=t.view;const e=new W.w({getTheme:()=>this._view.effectiveTheme});this._settings=e,null!=t.radius&&(this._radius=t.radius);const i=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:(0,mt.UM)(this._createDarkenedColor(i,1,.25),nt.m$.Occlude),materialFocused:(0,mt.UM)(this._createDarkenedColor(i,1,0),nt.m$.Occlude),materialOccludedUnfocused:(0,mt.UM)(this._createDarkenedColor(i,.7,0),e.zManipulator.renderOccluded),materialOccludedFocused:(0,mt.UM)(this._createDarkenedColor(i,.85,0),e.zManipulator.renderOccluded)},this._themeHandle=(0,r.watch)((()=>this._view.effectiveTheme.accentColor),(t=>{const e=this._createDarkenedColor(t,1,.25),i=this._createDarkenedColor(t,1,0),a=this._createDarkenedColor(t,.7,0),n=this._createDarkenedColor(t,.85,0),{materialUnfocused:o,materialFocused:s,materialOccludedUnfocused:r,materialOccludedFocused:l}=this._materials;o.setParameters({color:e}),s.setParameters({color:i}),r.setParameters({color:a}),l.setParameters({color:n})})),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._themeHandle=(0,s.xt)(this._themeHandle),this._manipulator.applyObjectTransform=ge,this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()}))}forEachManipulator(t){t(this._manipulator,St.TRANSLATE_Z)}createGraphicDragPipeline(t,e,i){const a=e.graphic.geometry.spatialReference;return ee(e.graphic,i,(e=>this.createDragPipeline(((i,a,n,o,s)=>(({steps:a,cancel:n}=t(i,a,n,o,s)),e(i,a,n))),a)))}createDragPipeline(t,e){const i=this._view;return(0,te.Xt)(this._manipulator,((a,n,o,s,r)=>{const l=n.next((t=>({...t,manipulatorType:St.TRANSLATE_Z}))).next((0,Kt.iv)(i,a.renderLocation,e)).next((0,te.sO)());t(a,l,o,s,r)}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._settings,e=this._radius/Yt,i=t.zManipulator.height*e,a=t.zManipulator.coneHeight*e,n=t.zManipulator.coneWidth*e,o=t.zManipulator.width*e,s=[(0,u.fA)(0,0,0),(0,u.fA)(0,0,i)],r=[(0,u.fA)(0,0,0),(0,u.fA)(0,0,i+a)],l=(t=>{const e=(0,Wt.vt)();if((0,Qt.Tl)(e,e,[0,0,i]),(0,Qt.eL)(e,e,Math.PI/2),t){const i=1+2*t/n;(0,Qt.hs)(e,e,[i,i,i])}return e})(0),{materialUnfocused:h,materialFocused:p,materialOccludedUnfocused:c,materialOccludedFocused:d}=this._materials,g=(0,ne.Nb)(h,s,o/2,16,!1),_=(0,ne.EE)(h,a,n/2,16,!1);_.transformation=l,this._manipulator.renderObjects=[new Jt.M(_,se.p7.Unfocused),new Jt.M(g,se.p7.Unfocused),new Jt.M(_.instantiate({material:p}),se.p7.Focused),new Jt.M(g.instantiate({material:p}),se.p7.Focused),new Jt.M(_.instantiate({material:c}),se.p7.Unfocused),new Jt.M(g.instantiate({material:c}),se.p7.Unfocused),new Jt.M(_.instantiate({material:d}),se.p7.Focused),new Jt.M(g.instantiate({material:d}),se.p7.Focused)],this._manipulator.radius=o/2+2,this._manipulator.collisionType={type:"line",paths:[r]}}_createManipulator(){const t=this._view,e=new At.q({view:t,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const i=t.state.camera,a=ce;t.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,a);const n=(0,c.o)(i.eye,a),o=i.computeRenderPixelSizeAtDist(n),s=(0,c.f)(ue,a,i.eye);(0,c.n)(s,s);const r=de;t.renderCoordsHelper.worldUpAtPosition(ce,r);const l=Math.abs((0,c.k)(s,r)),h=(0,c.b)(ue,s,r),p=(0,c.b)(ue,h,r),u=(0,y.qE)(l,.01,1),d=1-Math.sqrt(1-u*u)/u/i.fullWidth,g=this._settings,_=this._radius/Yt,v=g.zManipulator.width*_;(0,c.h)(p,(0,c.n)(p,p),(1/d-1)*n+o*v),e[12]-=ue[0],e[13]-=ue[1],e[14]-=ue[2]},this._manipulator=e,this._updateManipulator()}_createDarkenedColor(t,e,i){const a=(0,n.e$)(t,i);return a.a*=e,v.A.toUnitRGBA(a)}get test(){return{manipulator:this._manipulator}}}const ce=(0,u.vt)(),ue=(0,u.vt)(),de=(0,u.vt)(),ge=()=>{};class _e extends $t{constructor(t){super(),this._handles=new jt.A,this._interactive=!0;const{tool:e,view:i,snapToScene:a,radius:n}=t;this._view=i,this.xyManipulation=new he({tool:e,view:i,snapToScene:a,radius:n}),this.xyAxisManipulation=new re({tool:e,view:i,radius:n}),this.zManipulation=new pe({tool:e,view:i,radius:n}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((t=>this._handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,e,i){return(0,o.vE)([this.xyManipulation.createGraphicDragPipeline(((e,i,a,n,o)=>t(me.XY,e,i,a,n,o)),e,i),this.xyAxisManipulation.createGraphicDragPipeline(((e,i,a,n,o)=>t(me.XY_AXIS,e,i,a,n,o)),e,i),this.zManipulation.createGraphicDragPipeline(((e,i,a,n,o)=>t(me.Z,e,i,a,n,o)),e,i)])}createDragPipeline(t,e,i,a){return(0,o.vE)([this.xyManipulation.createDragPipeline(((e,i,a,n,o)=>t(me.XY,e,i,a,n,o)),e,i,a),this.xyAxisManipulation.createDragPipeline(((e,i,a,n,o)=>t(me.XY_AXIS,e,i,a,n,o)),e,i,a),this.zManipulation.createDragPipeline(((e,i,a,n,o)=>t(me.Z,e,i,a,n,o)),i)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator((e=>t(e,St.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((e=>t(e,St.TRANSLATE_XY))),this.zManipulation.forEachManipulator((e=>t(e,St.TRANSLATE_Z)))}get _xyAxisVisible(){const t=this.xyManipulation.someManipulator((t=>t.focused))||this.xyAxisManipulation.someManipulator((t=>t.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,e=this.xyManipulation;if((0,h.A)("esri-mobile"))return;const i=[];e.forEachManipulator((t=>i.push(t))),t.forEachManipulator((t=>i.push(t)));const a=()=>{const e=[];this._xyAxisVisible||t.forEachManipulator((t=>e.push(t.disableDisplay()))),this._handles.remove(ve),this._handles.add(e,ve)};for(const n of i)this._handles.add(n.events.on("focus-changed",a));this._view.inputManager&&this._handles.add((0,r.when)((()=>{var t;return null===(t=this._view.inputManager)||void 0===t?void 0:t.latestPointerType}),a)),a()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator((e=>{e.interactive=!t&&this._interactive||e.grabbing}))}static radiusForSymbol(t){const e=null!=t&&"point-3d"===t.type&&t.symbolLayers;return e&&e.some((t=>"icon"===t.type))?Nt:Yt}}const ve="disable-xy-axis-display";var me;!function(t){t[t.XY=0]="XY",t[t.XY_AXIS=1]="XY_AXIS",t[t.Z=2]="Z"}(me||(me={}));var fe=i(91720);class ye extends $t{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,St.TRANSLATE_XY)}createGraphicDragPipeline(t){return ee(this._graphicState.graphic,t,(t=>this.createDragPipeline(t)))}createDragPipeline(t){const e=this._view,i=this._graphicState.graphic,a=null!=i.geometry?i.geometry.spatialReference:null;return(0,te.Xt)(this._manipulator,((n,o,s,r,l)=>{const h=o.next((0,Kt.OW)(l,e,i,a)).next((0,te.EX)()).next((0,te.sO)());t(n,h,s,r,l)}))}_createManipulator(){const t=this._view,e=this._graphicState.graphic;this._manipulator=new fe.l({graphic:e,view:t,selectable:!0,cursor:"move"})}}var Me=i(4656),be=i(56829),Se=i(87878),xe=i(97513),we=i(13284),Te=i(61237),Ae=i(18975),Ee=i(72236),Oe=i(29772);class Ie{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class Re{constructor(t,e,i){this.dx=t,this.dy=e,this.allGraphics=i,this.type="graphic-move"}}class Ge{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}const De="manipulators";let Ze=class extends(dt.A.EventedMixin(be.g)){constructor(t){super(t),this._infos=new Map,this.graphics=new ut.A,this.enableZ=!0,this.sketchOptions=new xe.A,this.type="move-3d",this.tooltip=null,this._updatingHandles=new _t.U,this._moveManipulation=null,this._latestTooltipInfo=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{view:t}=this;this.addHandles([this.graphics.on("change",(t=>{t.removed.forEach((t=>this.removeHandles(t))),this._updateGraphicInfos(t),this._setupFastTransformUpdates(t.added),this._refreshManipulators()})),(0,r.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled),(e=>{this.tooltip=e?new Ae.m({info:this._latestTooltipInfo,view:t}):(0,s.pR)(this.tooltip)}),r.syncAndInitial)]);const e=this.graphics.toArray();this._updateGraphicInfos({added:e,removed:[]}),this._setupFastTransformUpdates(e),this._refreshManipulators(),this.finishToolCreation()}destroy(){this.tooltip=(0,s.pR)(this.tooltip),this._moveManipulation=(0,s.pR)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}reset(){}_updateGraphicInfos(t){let{added:e,removed:i}=t;for(const n of e){if((0,Me.N)(n)!==xt.e.SUPPORTED)continue;const t=new Ce(n),e=this.view.trackGraphicState(t.state);this._infos.set(t.graphic,{info:t,handle:e})}for(const n of i){var a;null!==(a=this._infos.get(n))&&void 0!==a&&a.handle.remove(),this._infos.delete(n)}}_setupFastTransformUpdates(t){const{view:e}=this;for(const i of t){const{info:t}=this._infos.get(i);this.addHandles(j(t.state,e),i)}}_refreshManipulators(){if(this.removeHandles(De),this._moveManipulation=(0,s.pR)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const t=Array.from(this._infos.values(),(t=>{let{info:e}=t;return e}));this._createManipulators(t),this._createVisualElements(t),this._updateMoveManipulation(t)}_createManipulators(t){for(const e of t){const i=e.state;e.manipulationXY=new ye({tool:this,view:this.view,graphicState:i}),e.manipulationXY.forEachManipulator((t=>this.addHandles([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:i.graphic}),t.stopPropagation()})),t.events.on("grab-changed",(t=>{let{action:e}=t;"start"===e?this._showTooltip(me.XY):this._hideTooltip()}))],De))),this.addHandles(e.manipulationXY.createDragPipeline(((e,i,a,n)=>this._buildDragEventPipeline(t,me.XY,e,i,a,n))),De)}this._createMoveManipulation(t)}_createMoveManipulation(t){const e=new _e({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?_e.radiusForSymbol(t[0].graphic.symbol):Yt});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator((t=>{this.addHandles(t.events.on("immediate-click",(i=>{e.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.at(0)}),i.stopPropagation()})),De)}));const i=t=>e=>{this.addHandles([e.events.on("focus-changed",(e=>{let{action:i}=e;"focus"===i?this._showTooltip(t):this._hideTooltip()})),e.events.on("grab-changed",(()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=gt.r7)}))],De)};this._moveManipulation.xyManipulation.forEachManipulator(i(me.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(me.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(me.Z));const a=()=>this._updateMoveManipulation(t);for(const o of t)this.addHandles([o.state.on("changed",a),(0,r.watch)((()=>o.state.displaying),a)],De);const n=t[t.length-1];this.addHandles(n.state.on("changed",(()=>this._updateMoveManipulationAngle(n))),De),this.addHandles(e.createDragPipeline(((e,i,a,n,o)=>this._buildDragEventPipeline(t,e,i,a,n,o)),(0,d.bh)(n.graphic),n.graphic.geometry.spatialReference,n.graphic),De),this._updateMoveManipulationAngle(n)}_createVisualElements(t){for(const e of t){const i=e.graphic,a=Xt({view:this.view,graphic:i,forEachManipulator:t=>{var i,a;null!==(i=e.manipulationXY)&&void 0!==i&&i.forEachManipulator(t),null===(a=this._moveManipulation)||void 0===a||a.forEachManipulator(t)},onManipulatorsChanged:()=>(0,o.hA)()});null!=a&&(e.geometryRepresentation=a.visualElement,e.geometryRepresentation instanceof K.P&&this.addHandles([e.geometryRepresentation.events.on("attachment-origin-changed",(()=>{e.state.isDraped||this._updateMoveManipulation(t)})),(0,r.watch)((()=>e.state.isDraped),(()=>this._updateMoveManipulation(t)))],De),this.addHandles(a,De))}}_updateMoveManipulationAngle(t){this._moveManipulation&&(this._moveManipulation.angle=Mt(t.graphic.geometry))}_updateMoveManipulation(t){const e=(0,vt.T)(0,0,0,this.view.spatialReference);let i=0,a=!1;const n=this._moveManipulation;if(n){var o;for(const n of t){if(!n.state.displaying)continue;const t=n.state.graphic;this.enableZ&&(0,wt.o)(t)&&(a=!0);const o=n.geometryRepresentation instanceof K.P&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:(0,mt.Yk)(this.view,t);if(null!=o){var s;const{x:t,y:a,z:n}=o;e.x+=t,e.y+=a,n&&(null!==(s=e.z)&&void 0!==s||(e.z=0),e.z+=n),i++}}i>0?(e.x/=i,e.y/=i,null!==(o=e.z)&&void 0!==o||(e.z=0),e.z/=i,n.location=e,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=a):n.available=!1}}_buildDragEventPipeline(t,e,i,a,n,o){const s=[],r=[];let l=null,h=null;const p=()=>{for(const t of s)t.dragging=!1;s.length=0,r.length=0,l=null,h=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===t.length&&e===me.XY){const e=t[0].graphic;({steps:a,cancel:n}=this._buildSnappingPipelineSteps(e,(0,d.bh)(e),a,n,o))}return n=n.next((t=>{var e;return null===(e=h)||void 0===e?void 0:e(t)})).next((()=>(this.emit("graphic-move-stop",new Ge(r)),this.destroyed||p(),null))),{steps:a=a.next((e=>{if("start"===e.action){s.length=0,r.length=0;for(const e of t){var a,n;e.dragging||(null===(a=e.manipulationXY)||void 0===a||!a.hasManipulator(i))&&(null===(n=e.manipulationXY)||void 0===n?void 0:n.grabbing)||(s.push(e),r.push(e.graphic),e.dragging=!0)}if(0!==r.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=(0,te.qh)(r),h=(0,te.ns)(r),this.emit("graphic-move-start",new Ie(r)),this.destroyed))return null}return 0!==r.length?e:null})).next((t=>{var e;return null===(e=l)||void 0===e?void 0:e(t)})).next((t=>(this._updateMoveTooltip(e,t),t))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const e=this.view.toScreen(t.mapStart),i=this.view.toScreen(t.mapEnd),a=i.x-e.x,n=i.y-e.y;if(this.emit("graphic-move",new Re(a,n,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Ge(r)),this.destroyed)return null;p()}return null})),cancel:n}}_showTooltip(t){this._updateMoveTooltip(t),this._latestTooltipInfo&&(this._latestTooltipInfo.distance=gt.r7)}_hideTooltip(){var t;null!==(t=this.tooltip)&&void 0!==t&&t.clear(),this._latestTooltipInfo=null}_updateMoveTooltip(t,e){var i,a,n;const{sketchOptions:o,tooltip:s}=this;switch(t){case me.XY:this._latestTooltipInfo=null!==(i=this._translateGraphicTooltipInfo)&&void 0!==i?i:this._translateGraphicTooltipInfo=new Ee.ar({sketchOptions:o}),this._updateMoveTooltipDistance(this._latestTooltipInfo,e,((t,e)=>(0,R.Kt)(t,e)));break;case me.XY_AXIS:this._latestTooltipInfo=null!==(a=this._translateGraphicXYTooltipInfo)&&void 0!==a?a:this._translateGraphicXYTooltipInfo=new Ee.nW({sketchOptions:o}),this._updateMoveTooltipDistance(this._latestTooltipInfo,e,((t,i)=>(0,gt.hs)((0,R.Kt)(t,i),ie(e))));break;case me.Z:this._latestTooltipInfo=null!==(n=this._translateGraphicZTooltipInfo)&&void 0!==n?n:this._translateGraphicZTooltipInfo=new Ee.YI({sketchOptions:o}),this._updateMoveTooltipDistance(this._latestTooltipInfo,e,Oe.e5)}this._latestTooltipInfo.sketchOptions=o,s&&(s.info=this._latestTooltipInfo)}_updateMoveTooltipDistance(t,e,i){if(null==e||"end"===e.action)return;const{mapStart:a,mapEnd:n}=e,o=i(a,n);t.distance=null!=o?o:gt.r7}_buildSnappingPipelineSteps(t,e,i,a,n){const o=t.geometry;if(null==o||"point"!==o.type&&"mesh"!==o.type)return{steps:i,cancel:a};const s=("point"===o.type?o:o.anchor).clone(),r=new we.e({elevationInfo:e,pointer:n,editGeometryOperations:Se.p.fromGeometry(s,this.view.state.viewingMode),visualizer:new Y.s,excludeFeature:t}),l=this.snappingManager,{snappingStep:h,cancelSnapping:p}=(0,Te.L)({snappingContext:r,snappingManager:l,updatingHandles:this._updatingHandles});return a=a.next(p),{steps:i=i.next((e=>(s.z=(0,d.wS)(this.view,s,(0,d.bh)(t),{mode:"absolute-height",offset:0}),{...e,snapOrigin:r.coordinateHelper.pointToVector(s)}))).next(...h),cancel:a}}};(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ze.prototype,"view",void 0),(0,a._)([(0,l.MZ)()],Ze.prototype,"graphics",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ze.prototype,"enableZ",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,type:xe.A})],Ze.prototype,"sketchOptions",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],Ze.prototype,"snappingManager",void 0),(0,a._)([(0,l.MZ)()],Ze.prototype,"type",void 0),(0,a._)([(0,l.MZ)()],Ze.prototype,"updating",null),(0,a._)([(0,l.MZ)()],Ze.prototype,"tooltip",void 0),Ze=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Ze);class Ce{constructor(t){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new at.y({graphic:t})}get graphic(){return this.state.graphic}}var Pe=i(34205),ze=(i(35238),i(18690)),Le=i(23701),ke=i(13927),He=i(94439),Ve=i(36996);function Ue(t,e,i){const a="on-the-ground"===i.mode?Ve.B.XY:Ve.B.XYZ;return new Ve.L(t,a,e,0)}function Xe(t,e,i){const a=(0,u.vt)();if(!t.renderCoordsHelper.toRenderCoords(e,a))return null;const n=Ye(t,e,(0,ke.Qj)(i.plane)),o=Ye(t,e,i.edgeDirection);if(null==n||null==o)return null;const s=(0,c.b)((0,u.vt)(),n,o);return(0,ke.O_)(a,s,(0,ke.vt)())}function Ye(t,e,i){const a=(0,vt.T)(e.x+i[0],e.y+i[1],e.z+i[2],e.spatialReference),n=(0,u.vt)(),o=(0,u.vt)();return t.renderCoordsHelper.toRenderCoords(e,n)&&t.renderCoordsHelper.toRenderCoords(a,o)?(0,c.E)(o,n,o):null}var Ne=i(64921),Fe=i(32167),Be=i(73697);let qe=class extends Be.w{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=gt.r7,this.area=null,this.totalLength=null}};(0,a._)([(0,l.MZ)()],qe.prototype,"type",void 0),(0,a._)([(0,l.MZ)()],qe.prototype,"distance",void 0),(0,a._)([(0,l.MZ)()],qe.prototype,"area",void 0),(0,a._)([(0,l.MZ)()],qe.prototype,"totalLength",void 0),qe=(0,a._)([(0,p.$)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],qe);var je=i(86855),$e=i(71008),Qe=i(92854),We=i(13312);let Je=class extends(dt.A.EventedMixin(m.A)){constructor(t){super(t),this._selectedIndex=0,this._manipulatorHandles=new jt.A,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=ni.NONE,this._updatingHandles=new _t.U,this._recreatingManipulators=!1,this._settings=new W.w({getTheme:()=>this.view.effectiveTheme}),this._latestTooltipInfo=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null,this._translateVertexTooltipInfo=null,this._translateVertexXYTooltipInfo=null,this._translateVertexZTooltipInfo=null,this._edgeOffsetTooltipInfo=null,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:t,view:e}=this,i=this._settings.manipulators,a=i.vertex;this._vertexManipulatorMaterial=(0,mt.UM)((0,n.QP)(a.color),a.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,mt.QI)((0,n.QP)(a.outlineColor),a.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,mt.QI)((0,n.QP)(a.hoverOutlineColor),a.renderOccluded);const o=i.edge;this._edgeManipulatorMaterial=(0,mt.UM)((0,n.QP)(o.color),o.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,mt.QI)((0,n.QP)(o.outlineColor),o.renderOccluded);const s=i.edgeOffset;this._edgeOffsetManipulatorMaterial=(0,mt.UM)((0,n.QP)(s.color),s.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,mt.UM)((0,n.QP)(s.hoverColor),s.renderOccluded,!1);const l=i.selected;this._selectedManipulatorMaterial=(0,mt.UM)((0,n.QP)(l.color),l.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,mt.QI)((0,n.QP)(l.outlineColor),l.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,mt.QI)((0,n.QP)(l.hoverOutlineColor),l.renderOccluded);const h=this._graphicState=new at.y({graphic:t});this.tooltip=new Ae.m({view:e}),this.addHandles([(0,r.watch)((()=>{const t=this._settings.manipulators;return{vertexSettings:t.vertex,edgeSettings:t.edge,edgeOffsetSettings:t.edgeOffset,selectedSettings:t.selected}}),(t=>{let{vertexSettings:e,edgeSettings:i,edgeOffsetSettings:a,selectedSettings:n}=t;e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),i.applyColor(this._edgeManipulatorMaterial),i.applyOutline(this._edgeManipulatorOutlineMaterial),a.applyColor(this._edgeOffsetManipulatorMaterial),a.applyHover(this._edgeOffsetManipulatorHoverMaterial),n.applyColor(this._selectedManipulatorMaterial),n.applyOutline(this._selectedManipulatorOutlineMaterial),n.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),(0,r.watch)((()=>h.displaying),(t=>{for(const e of this._manipulatorInfos)e.manipulator.available=t})),(0,r.watch)((()=>({labels:this._segmentLabels,enabled:this.sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(t=>{let{labels:e,enabled:i,edgeOffsetEnabled:a}=t;null!=e&&(e.visible=i,e.edgeDistance=a?"far":"default")}),r.initial),(0,r.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled),(t=>{this.tooltip.info=t?this._latestTooltipInfo:null}),r.initial),this.view.trackGraphicState(h)])}destroy(){this._segmentLabels=(0,s.pR)(this._segmentLabels),this.tooltip=(0,s.pR)(this.tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get inputGeometry(){return null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null}set inputGeometry(t){this._recreateEditGeometryAndManipulators(t)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){const t=this._manipulatorInfos.filter((t=>t.manipulator.selected&&"vertex"===t.type));this._removeVertices(t)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,s.pR)(this._moveManipulation),this._graphicMoveManipulation=(0,s.pR)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(t){if(null==this._editGeometryOperations)return;const e=(0,d.bh)(this.graphic);for(const i of this._editGeometryOperations.data.components){const a=null===t||void 0===t?void 0:t.byComponentIndex.get(i.index);for(const t of i.vertices){const i=null===a||void 0===a?void 0:a.has(t.index);this._createVertexOrEdgeManipulator(t,e,i)}for(const t of i.edges)this._createVertexOrEdgeManipulator(t,e)}this._createGraphicMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements()}get canRedo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canRedo}get canUndo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canUndo}redo(){if(null==this._editGeometryOperations)return null;const t=this._editGeometryOperations.redo();return null!=t&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}undo(){if(null==this._editGeometryOperations)return null;this.emit("undo");const t=this._editGeometryOperations.undo();return null!=t&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._hideTooltip(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(t){const e={byComponentIndex:new Map};if(null!=t&&null!=this.inputGeometry&&(0,T.It)(t,this.inputGeometry))for(const n of this._manipulatorInfos)if("vertex"===n.type&&n.manipulator.selected){const{index:t,component:{index:i}}=n.handle,{byComponentIndex:a}=e,o=a.get(i)||new Set;o.add(t),a.set(i,o)}if(this._recreatingManipulators=!0,this._removeManipulators(),this._hideTooltip(),this._editGeometryOperations=(0,s.pR)(this._editGeometryOperations),this._segmentLabels=(0,s.pR)(this._segmentLabels),null==t)return void(this._recreatingManipulators=!1);const i="mesh"===t.type?t.anchor:t;this._editGeometryOperations=Se.p.fromGeometry(i,this.view.state.viewingMode),this._createManipulators(e);const a=this.sketchOptions.labels;this._segmentLabels=new U({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,d.bh)(this.graphic),labelOptions:a,graphic:this.graphic,graphicState:this._graphicState},visible:a.enabled}),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(t,e){if("end"===e.action)return e;let i=0;const a=[],n=this._manipulatorInfos.some((t=>"vertex"===t.type&&t.manipulator.selected)),o=t===oi.SELECTED_OR_ALL&&n;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.grabbing||o&&!s.manipulator.selected||a.push(s),i++);if(0===a.length)return e;if(this._moveVertices(a,e),a.length===i){if(this._updateEventState(ni.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(ni.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((t,e)=>"vertex"===e.type&&e.manipulator.selected?t+1:t),0)>1}_perVertexManipulatorDragAction(t){if(this._updateEventState(ni.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:i,mapDeltaZ:a}=t;if(!e&&!i&&!a)return;const n=[];for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected&&!o.manipulator.grabbing||o===t.info)&&n.push(o);this._moveVertices(n,t,Fe.Y.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(t){if(t===this._reshapeEventState)return!1;switch(t){case ni.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case ni.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case ni.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case ni.MOVING:switch(this._reshapeEventState){case ni.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case ni.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case ni.RESHAPING:switch(this._reshapeEventState){case ni.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case ni.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==t;return this._reshapeEventState=t,e}_createGraphicMoveManipulation(){const{tool:t,view:e}=this,i=this._graphicState;if(this._graphicMoveManipulation=new ye({tool:t,view:e,graphicState:i}),this.enableMoveGraphic){let t=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,i,a)=>{i.next((t=>this._trackNumDragging(t))).next((e=>("start"===e.action&&(t=this._editGeometryOperations.createUndoGroup()),e))).next((t=>this._perGraphicManipulatorDragAction(oi.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(me.XY,t),t))).next((e=>{"end"===e.action&&(this._hideTooltip(),t=(0,s.xt)(t))})),a.next((()=>this._onDragCancel(!0,(()=>t=(0,s.xt)(t)))))}))),this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(t,!1))))}else this._graphicMoveManipulation.forEachManipulator((t=>{t.grabbable=!1,t.cursor=null}));this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(t.events.on("immediate-click",(t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})))))}_createMoveManipulation(t){const{graphic:e,tool:i,view:a}=this,n=this._graphicState;this._moveManipulation=new _e({tool:i,view:a,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&(0,wt.o)(e),snapToScene:!1,radius:_e.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>this.addHandles([t.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(t)||this._manipulatorInfos.some((t=>t.manipulator.selected))||this.emit("immediate-click",{...i,graphic:e}),i.stopPropagation()})),this._watchAndUpdateGrabState(t,!1)])));const o=t=>e=>{this.addHandles(e.events.on("focus-changed",(e=>{let{action:i}=e;"focus"===i?this._updateTranslateTooltip(t):this._hideTooltip()})))};this._moveManipulation.xyManipulation.forEachManipulator(o(me.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(o(me.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(o(me.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const s=e.geometry.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((a,n,o,s,r)=>{const{snappingStep:l,cancelSnapping:h}=(0,Te.L)({predicate:t=>!!t.info,snappingManager:i.snappingManager,snappingContext:new we.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:t,pointer:r,excludeFeature:e,visualizer:new Y.s}),updatingHandles:this._updatingHandles,useZ:!1});return s=s.next((t=>(this._onDragCancel(),t))).next(h),{steps:o=o.next((t=>this._trackNumDragging(t))).next((t=>{const e=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));return t.manipulatorType===St.TRANSLATE_XY&&1===e.length?{...t,info:e[0],snapOrigin:e[0].handle.pos}:t})).next((0,te.pg)(this.view,t,e)).next(...l).next((0,te.EX)()).next((t=>this._perGraphicManipulatorDragAction(oi.SELECTED_OR_ALL,t))).next((t=>(this._updateTranslateTooltip(a,t),t))),cancel:s}}),t,s,e),(0,r.watch)((()=>n.displaying),(()=>this._updateMoveManipulationPosition()),r.initial),n.on("changed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,r.watch)((()=>n.isDraped),(t=>{this._updateMoveManipulationPosition();const e="align-move-manipulation";t?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this.removeHandles(e)}),r.initial)])}_createVisualElements(){const{graphic:t,view:e}=this,i=Xt({view:e,graphic:t,forEachManipulator:t=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(t),this._moveManipulation.forEachManipulator(t);for(const e of this._manipulatorInfos)t(e.manipulator,St.TRANSLATE_XY)}},onManipulatorsChanged:t=>this.on("manipulators-changed",t)});null!=i&&(this._outlineVisualElement=i.visualElement instanceof K.P?i.visualElement:null),null!=this._outlineVisualElement&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(t){var e,i;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,d.bh)(this.graphic);if(t.component.vertices.length<=2)return null;const n=this._settings.manipulators.edgeOffset,s=n.size/2,r=s+n.collisionPadding,l=s/r,h=l*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=(0,ne._B)(this._edgeOffsetManipulatorMaterial,h,l/2,l/2,n.height,n.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=(0,ne._B)(this._edgeOffsetManipulatorMaterial,-h,l/2,l/2,n.height,-n.offset));const p=[new Jt.M(this._edgeOffsetManipulatorGeometryInside.instantiate(),se.p7.Unfocused),new Jt.M(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),se.p7.Focused),new Jt.M(this._edgeOffsetManipulatorGeometryOutside.instantiate(),se.p7.Unfocused),new Jt.M(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),se.p7.Focused)],c=new At.q({view:this.view,renderObjects:p,elevationInfo:"on-the-ground"!==a.mode||(0,He.$d)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:a,worldOriented:!1,focusMultiplier:1,radius:r,available:!(!this.graphic.visible||null===(e=this.graphic.layer)||void 0===e||!e.visible),collisionType:{type:"disc",direction:(0,u.fA)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),g=new At.q({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||null===(i=this.graphic.layer)||void 0===i||!i.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),_={manipulator:c,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:g,elevationInfo:a,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(_,n.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(_);const v=[];for(const o of[t.leftVertex,t.rightVertex]){const t=this._getManipulatorInfoFromHandle(o);null!=t&&v.push(t.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(_))))}_.locationUpdateHandle=(0,o.vE)(v),this._manipulatorHandles.add(_.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(g,!0)],c),this._manipulatorHandles.add((0,te.Xt)(c,this._createEdgeOffsetPipeline(_,a)),c),this._manipulatorHandles.add((0,te.Xt)(g,((t,e,i,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(_,a)(t,e,i);else if(this.enableMoveGraphic){const n=this.graphic,o=null!=n.geometry?n.geometry.spatialReference:null;e.next((t=>this._trackNumDragging(t))).next((0,te.Tp)(this.view,t.elevationAlignedLocation)).next((0,Kt.PW)(this.view,t.elevationAlignedLocation,a,o,n)).next((0,te.sO)()).next((0,te.EX)()).next((t=>this._perGraphicManipulatorDragAction(oi.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(me.XY,t),t))).next((t=>{"end"===t.action&&this._hideTooltip()})),i.next((()=>this._onDragCancel(!t.metadata.deleting)))}})),c);const m=t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",m),g.events.on("immediate-click",m),c.events.on("focus-changed",(t=>{let{action:e}=t;const{sketchOptions:i,tooltip:a}=this;if("focus"===e){var n;const t=null!==(n=this._edgeOffsetTooltipInfo)&&void 0!==n?n:this._edgeOffsetTooltipInfo=new qe({sketchOptions:i});t.distance=gt.r7,t.sketchOptions=i,this._updateTooltipAreaOrTotalLength(t),this._latestTooltipInfo=t,a.info=i.tooltips.effectiveEnabled?this._latestTooltipInfo:null}else this._hideTooltip()}))],c),this._manipulatorInfos.push(_),this.manipulators.add(c),this.manipulators.add(g),this.emit("manipulators-changed"),_}_autoHideEdgeOffsetManipulator(t,e){const i=t.manipulator,a=t.edgeManipulator,n=()=>{t.visibilityHandle=(0,s.xt)(t.visibilityHandle);const n=this._getManipulatorInfoFromHandle(t.handle.leftVertex),r=this._getManipulatorInfoFromHandle(t.handle.rightVertex),l=null!=n&&null!=r&&function(t,e,i){const a=i.projectToRenderScreen(t,(0,_.r_)()),n=i.projectToRenderScreen(e,(0,_.r_)());return null!=a&&null!=n?(0,c.p)((0,c.f)(a,a,n)):0}(n.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<e;(!i.focused&&!a.focused||l)&&(i.grabbable=!l,a.grabbable=!l,t.visibilityHandle=(0,o.vE)([i.disableDisplay(),(0,o.hA)((()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}))]))};this._manipulatorHandles.add([i.events.on("focus-changed",n),a.events.on("focus-changed",n),(0,o.hA)((()=>{(0,s.xt)(t.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}))],i),n()}_updateEdgeOffsetManipulator(t){this._updateManipulatorPosition(t);const{coordinateHelper:e}=this._editGeometryOperations.data,i=Xe(this.view,t.manipulator.elevationAlignedLocation,Ue(e,t.handle,t.manipulator.elevationInfo)),a=this._getManipulatorInfoFromHandle(t.handle.leftVertex),n=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(null==a||null==n)return;const o=a.manipulator.renderLocation,s=n.manipulator.renderLocation,r=null!=i?function(t,e,i){const a=(0,ke.Qj)(t),n=(0,c.E)((0,u.vt)(),e,i),o=(0,c.b)((0,u.vt)(),n,a),s=(0,c.b)((0,u.vt)(),n,o);return(0,Wt.fA)(n[0],n[1],n[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,0,0,0,1)}(i,o,s):Wt.zK;t.manipulator.modelTransform=r,t.edgeManipulator.elevationAlignedLocation=t.manipulator.elevationAlignedLocation,t.edgeManipulator.modelTransform=r;const l=(0,c.l)((0,c.f)(ei,o,s))/2;t.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(t,e){return(i,a,n)=>{this._clearSelection();const{step:o,cleanup:s}=this._initializeEdgeOffset(t,e);a.next((t=>this._trackNumDragging(t))).next((0,te.Tp)(this.view,i.elevationAlignedLocation)).next(o).next((0,Kt.U0)(this.view)).next((0,Kt.mg)(this.view,this._editGeometryOperations.data.spatialReference)).next((0,te.EX)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(t)).next(this._showEdgeOffsetTooltip()).next((t=>{"end"===t.action&&s()})),n.next((()=>{i.metadata.deleting||(s(),this._onDragCancel())}))}}_initializeEdgeOffset(t,e){const{view:i}=this,a=this._editGeometryOperations,l=Ue(a.data.coordinateHelper,t.handle,e),h=a.createUndoGroup(),p=Xe(i,t.manipulator.elevationAlignedLocation,l);if(l.requiresSplitEdgeLeft){const e=this._getManipulatorInfoFromHandle(t.handle.leftVertex.leftEdge);null!=e&&this._splitEdgeManipulator(e,1)}if(l.requiresSplitEdgeRight){const e=this._getManipulatorInfoFromHandle(t.handle.rightVertex.rightEdge);null!=e&&this._splitEdgeManipulator(e,0)}const c=()=>new Le.A({paths:[[t.handle.leftVertex.pos,t.handle.rightVertex.pos]],spatialReference:a.data.spatialReference}),u=this._settings,d=new K.P({view:i,isDraped:this._graphicState.isDraped,geometry:c(),elevationInfo:t.elevationInfo,width:u.visualElements.lineGraphics.outline.width,attached:!1,isDecoration:!0});let g;const _=()=>{this._cleanEdgeOffsetCollapsedEdges(t),g=(0,s.xt)(g)},v=this.on("undo",_);return g=(0,o.vE)([(0,r.watch)((()=>(0,n.QP)(this._accentColor)),(t=>d.color=t),r.initial),(0,o.DQ)(d),(0,r.watch)((()=>this._graphicState.isDraped),(t=>d.isDraped=t)),this._graphicState.on("changed",(()=>d.geometry=c())),h,v]),d.attached=!0,{step:t=>null==l||null==p?(_(),null):{...t,operation:l,plane:p},cleanup:_}}_applyEdgeOffsetStep(t){return e=>{if(this.destroyed||null==e.operation)return e;this._updateEventState(ni.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=e;return(i||a||n)&&(this._offsetEdge(t,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return t=>{const{operation:e,mapEnd:i}=t;return null==e||null==i?t:("start"===t.action&&e.selectArrowFromStartPoint(i),{...t,signedDistance:e.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return t=>{const{mapEnd:e,signedDistance:i,operation:a}=t,{tooltip:n,sketchOptions:o}=this;if(null!=i){var s;const n=null!==(s=this._edgeOffsetTooltipInfo)&&void 0!==s?s:this._edgeOffsetTooltipInfo=new qe({sketchOptions:o});n.sketchOptions=o,n.distance="end"===t.action?gt.r7:function(t,e,i,a,n){if(t){const t=n.toXYZ(n.pointToVector(i)),o=(0,ke._I)(a,t,A.rq.get()),s=(0,Qe.n3)(o,t,n.spatialReference);if(null!=s)return(0,gt.d_)(s.value*Math.sign(e),s.unit)}return(0,gt.d_)(e*(0,S.GA)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*a.selectedArrow,e,a.plane,this._editGeometryOperations.data.coordinateHelper),this._updateTooltipAreaOrTotalLength(n),this._latestTooltipInfo=n}else this._latestTooltipInfo=null;return n.info=o.tooltips.effectiveEnabled?this._latestTooltipInfo:null,t}}_cleanEdgeOffsetCollapsedEdges(t){var e,i;const a=null===(e=t.handle.leftVertex.leftEdge)||void 0===e?void 0:e.leftVertex,n=t.handle.leftVertex,o=null===(i=t.handle.rightVertex.rightEdge)||void 0===i?void 0:i.rightVertex,s=t.handle.rightVertex,r=this._editGeometryOperations.data.coordinateHelper,l=[];if(a&&r.distance(a.pos,n.pos)<ii){const t=this._getManipulatorInfoFromHandle(n);null!=t&&l.push(t)}if(r.distance(n.pos,s.pos)<ii||o&&r.distance(o.pos,s.pos)<ii){const t=this._getManipulatorInfoFromHandle(s);null!=t&&l.push(t)}l.length&&this._removeVertices(l)}_computeVertexManipulatorSizeAndOutline(t){const e=t.size/2,i=e+t.collisionPadding;return{size:e/i,outlineSize:(e+t.outlineSize)/i}}_createVertexOrEdgeManipulator(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,d.bh)(this.graphic),a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{view:n}=this,r=this._settings;if("edge"===t.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(t,i);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(r.manipulators.vertex);this._vertexManipulatorGeometry=(0,ne.CM)(this._vertexManipulatorMaterial,t,16,16),this._vertexManipulatorOutlineGeometry=(0,ne.CM)(this._vertexManipulatorOutlineMaterial,e,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(r.manipulators.edge);this._edgeManipulatorGeometry=(0,ne.CM)(this._edgeManipulatorMaterial,t,16,16),this._edgeManipulatorOutlineGeometry=(0,ne.CM)(this._edgeManipulatorOutlineMaterial,e,16,16)}const{geometry:l}=this.graphic,h=null===l||void 0===l?void 0:l.type,p="point"===h||"mesh"===h?[]:[new Jt.M(this._vertexManipulatorGeometry.instantiate(),ai.Vertex|se.p7.Unselected),new Jt.M(this._vertexManipulatorOutlineGeometry.instantiate(),ai.Vertex|se.p7.Unfocused|se.p7.Unselected),new Jt.M(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ai.Vertex|se.p7.Focused|se.p7.Unselected),new Jt.M(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),se.p7.Selected),new Jt.M(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),se.p7.Selected|se.p7.Unfocused),new Jt.M(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),se.p7.Selected|se.p7.Focused)];this.enableMidpoints&&p.push(new Jt.M(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),ai.Edge|se.p7.Focused|se.p7.Unselected),new Jt.M(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ai.Edge|se.p7.Focused|se.p7.Unselected),new Jt.M(this._edgeManipulatorGeometry.instantiate(),ai.Edge|se.p7.Unfocused|se.p7.Unselected),new Jt.M(this._edgeManipulatorOutlineGeometry.instantiate(),ai.Edge|se.p7.Unfocused|se.p7.Unselected));const c=new At.q({view:n,renderObjects:p,elevationInfo:i,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||null===(e=this.graphic.layer)||void 0===e||!e.visible),metadata:{deleting:!1}});c.selected=a,this._setTypeSpecificManipulatorSettings(c,t,i);const u="edge"===t.type?{manipulator:c,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:c,handle:t,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(u),this.manipulators.add(c),this._updateManipulatorPosition(u),"edge"===u.type){const t=[];for(const e of[u.handle.leftVertex,u.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(e);null!=i&&t.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(u))))}u.locationUpdateHandle=(0,o.vE)(t),this._manipulatorHandles.add(u.locationUpdateHandle,c)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(c,!0),c);const g=(0,te.Xt)(c,((t,e,a,n)=>{let o=null;const{snappingStep:r,cancelSnapping:l}=(0,Te.L)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new we.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:i,pointer:n,excludeFeature:this.graphic,visualizer:new Y.s}),updatingHandles:this._updatingHandles,useZ:!1});a=a.next((e=>(this._onDragCancel(!t.metadata.deleting,(()=>o=(0,s.xt)(o))),e))).next(l),e.next((t=>this._trackNumDragging(t))).next((t=>{if("start"===t.action&&(o=this._editGeometryOperations.createUndoGroup()),"edge"===u.type){const e=this._splitEdgeManipulator(u);return{...t,info:e,snapOrigin:e.handle.pos}}return{...t,info:u,snapOrigin:u.handle.pos}})).next((0,te.Tp)(this.view,t.elevationAlignedLocation)).next((0,Kt.gw)(this.view,this.graphic,t.elevationAlignedLocation,t.location.spatialReference,this.graphic)).next((0,te.pg)(this.view,i,this.graphic)).next(...r).next((0,te.EX)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(o=(0,s.xt)(o)),this._updateTranslateVertexTooltip(t,me.XY,e)}))}));return this._manipulatorHandles.add([g,c.events.on("immediate-click",(t=>this._manipulatorClickCallback(t,u))),c.events.on("select-changed",(()=>{u.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),c.events.on("focus-changed",(t=>{let{action:e}=t;"focus"===e&&"edge"!==u.type?this._updateTranslateVertexTooltip(c,me.XY):this._hideTooltip()}))],c),this.emit("manipulators-changed"),u}_trackNumDragging(t){switch(t.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return t}_onDragCancel(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;switch(this._numDragging--,t&&(this.undo(),this.outputGeometry=null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._hideTooltip(),this._reshapeEventState){case ni.NONE:break;case ni.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case ni.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(ni.NONE)}_setTypeSpecificManipulatorSettings(t,e,i){const{graphic:a}=this,n=this._settings;switch(e.type){case"vertex":{t.state=ai.Vertex,t.selectable=!0,t.cursor="move",t.collisionPriority=2;const{size:e,collisionPadding:o}=n.manipulators.vertex;t.radius=e/2+o,t.elevationInfo=i;const{geometry:s}=a,r=null===s||void 0===s?void 0:s.type;t.interactive=null!=r&&"point"!==r&&"mesh"!==r;break}case"edge":{t.state=ai.Edge,t.selectable=!1,t.cursor="copy",t.collisionPriority=-1;const{size:e,collisionPadding:o}=n.manipulators.edge;t.radius=e/2+o,t.elevationInfo="on-the-ground"!==i.mode||(0,He.$d)(a.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(t,e){return t.events.on("grab-changed",(i=>this._onGrabStateChanged(t,e,i.action,i.pointerType)))}_onGrabStateChanged(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if(!this._recreatingManipulators){if("start"===i)e&&this._updateSelection(t),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(ni.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((t=>{const{manipulator:e}=t,{geometry:i}=this.graphic,a=null===i||void 0===i?void 0:i.type;e.interactive=e.grabbing||!this._numGrabbing&&null!=a&&"point"!==a&&"mesh"!==a,"edgeManipulator"in t&&(t.edgeManipulator.interactive=t.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((t=>{t.interactive=t.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const t of this._manipulatorInfos)t.manipulator.grabbing||(t.manipulator.selected=!1)}_updateSelection(t){t.grabbing&&!t.selected&&t.selectable&&(this._clearSelection(),t.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(t){null!=t&&(t.manipulator.metadata.deleting=!0,this.manipulators.remove(t.manipulator),this._manipulatorHandles.remove(t.manipulator),(0,ze.Xy)(this._manipulatorInfos,t),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(t){if(t)for(const e of this._manipulatorInfos)if(t===e.handle)return e;return null}_updateManipulatorPosition(t){if(null==t)return;const e=this._editGeometryOperations;if("vertex"===t.type)t.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(t.handle.pos,ti),t.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=t.manipulator.renderLocation);else if("edge"===t.type){const i=this._getManipulatorInfoFromHandle(t.handle.leftVertex),a=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if(null==i||null==a)return;const n=i.manipulator,o=a.manipulator;if(null!=t.manipulator.elevationInfo&&"on-the-ground"===t.manipulator.elevationInfo.mode){const i=n.location,a=o.location,s=.5,r=i.x+s*(a.x-i.x),l=i.y+s*(a.y-i.y),h=i.hasZ&&a.hasZ?0:void 0;t.manipulator.location=(0,vt.T)(r,l,h,e.data.spatialReference)}else(0,c.m)(ei,n.renderLocation,o.renderLocation,.5),t.manipulator.renderLocation=ei}}_splitEdgeManipulator(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const i=this._editGeometryOperations,a=i.splitEdge(t.handle,e).createdVertex;t.locationUpdateHandle=(0,s.xt)(t.locationUpdateHandle);const n=(0,d.bh)(this.graphic);let o;this.enableEdgeOffset?(this._removeManipulator(t),o=this._createVertexOrEdgeManipulator(a)):(o=t,o.handle=a,o.type="vertex",this._setTypeSpecificManipulatorSettings(t.manipulator,t.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(o),this.enableEdgeOffset||this._updateTranslateVertexTooltip(o.manipulator,me.XY),this._updateSelection(t.manipulator);const r=this._updateEventState(ni.RESHAPING),l=i.data.coordinateHelper.vectorToArray(o.handle.pos),h=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:h,vertexIndex:a.index}],added:l}),r&&this._updateEventState(ni.NONE),o}_updateMoveManipulationPosition(){const t=(0,c.s)(ei,0,0,0);let e=0,i=!1,a=null,n=null;for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected?(e++,(0,c.g)(t,t,o.manipulator.renderLocation),null==a||o.selectedIndex>a.selectedIndex?(n=a,a=o):(null==n||o.selectedIndex>n.selectedIndex)&&(n=o)):i=!0);if(0===e){const t=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t,this._moveManipulation.zManipulation.available=t&&this.enableZShape&&(0,wt.o)(this.graphic),this._moveManipulation.angle=Mt(this.graphic.geometry),this._moveManipulation.radius=_e.radiusForSymbol(this.graphic.symbol)}else{const t=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.zManipulation.available=t&&this.enableZVertex&&(0,wt.o)(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t&&1!==e;let i=0;if(null!=a){const t=a.handle.pos,e=null!=n?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,o=null==n&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;e&&o?this._moveManipulation.xyAxisManipulation.available=!1:e?i=Ke(e,t):o&&(i=Ke(t,o))}this._moveManipulation.angle=i,this._moveManipulation.radius=Nt}0!==e&&i?((0,c.h)(t,t,1/e),ti.spatialReference=this._editGeometryOperations.data.spatialReference,ti.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,ti),this._moveManipulation.elevationAlignedLocation=ti):null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?(0,mt.V1)(this.view,this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(t){const e=new Array,i=this._editGeometryOperations;for(const n of t){const t=n.handle.component;if("vertex"===n.type&&i.canRemoveVertex(t)){var a;e.push(n.handle),this._removeManipulator(n),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.rightEdge));const o=null===(a=i.removeVertices([n.handle]).removedVertices)||void 0===a?void 0:a[0].createdEdge;o?this._createVertexOrEdgeManipulator(o):this.enableEdgeOffset&&t.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(t.edges[0]))}}if(e.length>0){const t=e.map((t=>{const e=i.data.components.indexOf(t.component);return{coordinates:i.data.coordinateHelper.vectorToArray(t.pos),componentIndex:e,vertexIndex:t.index}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(ni.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:t.map((t=>t.coordinates)),vertices:t}),this.destroyed)return;if(a&&(this._updateEventState(ni.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===e.action?Fe.Y.NEW_STEP:Fe.Y.ACCUMULATE_STEPS;const a=this._editGeometryOperations;a.moveVertices(t.map((t=>t.handle)),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const n of t)this._updateManipulatorPosition(n)}_offsetEdge(t,e){if(null==e.operation||null==e.signedDistance)return;const i=this._editGeometryOperations,a=e.operation.clone();a.distance=e.signedDistance,i.updateVertices([t.handle.leftVertex,t.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.rightVertex))}_manipulatorClickCallback(t,e){t.shiftKey||this._clearSelection(),"vertex"===e.type&&(e.manipulator.selected=!e.manipulator.selected,t.button===Ne.w.Right&&this._removeVertices([e])),"edge"===e.type&&t.button===Ne.w.Left&&this._splitEdgeManipulator(e),t.stopPropagation()}_updateTranslateTooltip(t,e){const i=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,t,e):this._updateTranslateGraphicTooltip(t,e)}_updateTranslateGraphicTooltip(t,e){var i,a,n;const{sketchOptions:o,tooltip:s}=this;switch(t){case me.XY:this._latestTooltipInfo=null!==(i=this._translateGraphicTooltipInfo)&&void 0!==i?i:this._translateGraphicTooltipInfo=new Ee.ar({sketchOptions:o}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,e,((t,e)=>(0,R.Kt)(t,e)));break;case me.XY_AXIS:this._latestTooltipInfo=null!==(a=this._translateGraphicXYTooltipInfo)&&void 0!==a?a:this._translateGraphicXYTooltipInfo=new Ee.nW({sketchOptions:o}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,e,((t,i)=>(0,gt.hs)((0,R.Kt)(t,i),ie(e))));break;case me.Z:this._latestTooltipInfo=null!==(n=this._translateGraphicZTooltipInfo)&&void 0!==n?n:this._translateGraphicZTooltipInfo=new Ee.YI({sketchOptions:o}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,e,Oe.e5)}this._latestTooltipInfo.sketchOptions=o,s.info=o.tooltips.effectiveEnabled?this._latestTooltipInfo:null}_updateTranslateVertexTooltip(t,e,i){var a,n,o;const{sketchOptions:s,tooltip:r}=this;switch(e){case me.XY:this._latestTooltipInfo=null!==(a=this._translateVertexTooltipInfo)&&void 0!==a?a:this._translateVertexTooltipInfo=new Ee.un({sketchOptions:s}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,i,((t,e)=>(0,R.Kt)(t,e))),this._updateTooltipAreaOrTotalLength(this._latestTooltipInfo);break;case me.XY_AXIS:this._latestTooltipInfo=null!==(n=this._translateVertexXYTooltipInfo)&&void 0!==n?n:this._translateVertexXYTooltipInfo=new Ee.JH({sketchOptions:s}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,i,((t,e)=>(0,gt.hs)((0,R.Kt)(t,e),ie(i)))),this._updateTooltipAreaOrTotalLength(this._latestTooltipInfo);break;case me.Z:this._latestTooltipInfo=null!==(o=this._translateVertexZTooltipInfo)&&void 0!==o?o:this._translateVertexZTooltipInfo=new Ee.y3({sketchOptions:s}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,i,Oe.e5)}const l=(0,Oe.Of)(t.location);this._latestTooltipInfo.elevation=null!=l?(0,je.S3)({actual:l}):null,this._latestTooltipInfo.sketchOptions=s,r.info=s.tooltips.effectiveEnabled?this._latestTooltipInfo:null}_updateTranslateTooltipDistance(t,e,i){if(null!=e&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,o=i(a,n);t.distance=null!=o?o:gt.r7}else t.distance=gt.r7}_updateTooltipAreaOrTotalLength(t){const{geometry:e}=this.graphic;if(null==e)return t.area=null,void(t.totalLength=null);t.area="polygon"===e.type?(0,$e.n)(e):null,t.totalLength="polyline"===e.type?(0,R.ob)(e):null}_hideTooltip(){this.tooltip.clear(),this._latestTooltipInfo=null}get test(){return{segmentLabels:this._segmentLabels,manipulatorInfos:this._manipulatorInfos}}};function Ke(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI/2}(0,a._)([(0,l.MZ)()],Je.prototype,"_editGeometryOperations",void 0),(0,a._)([(0,l.MZ)()],Je.prototype,"_segmentLabels",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],Je.prototype,"tool",void 0),(0,a._)([(0,l.MZ)()],Je.prototype,"tooltip",void 0),(0,a._)([(0,l.MZ)()],Je.prototype,"inputGeometry",null),(0,a._)([(0,l.MZ)()],Je.prototype,"outputGeometry",void 0),(0,a._)([(0,l.MZ)({readOnly:!0})],Je.prototype,"updating",null),(0,a._)([(0,l.MZ)()],Je.prototype,"manipulators",null),(0,a._)([(0,l.MZ)()],Je.prototype,"view",null),(0,a._)([(0,l.MZ)()],Je.prototype,"graphic",null),(0,a._)([(0,l.MZ)()],Je.prototype,"enableZShape",null),(0,a._)([(0,l.MZ)()],Je.prototype,"enableZVertex",null),(0,a._)([(0,l.MZ)()],Je.prototype,"enableMoveGraphic",null),(0,a._)([(0,l.MZ)()],Je.prototype,"enableMidpoints",null),(0,a._)([(0,l.MZ)()],Je.prototype,"enableEdgeOffset",null),(0,a._)([(0,l.MZ)()],Je.prototype,"sketchOptions",null),(0,a._)([(0,l.MZ)()],Je.prototype,"_accentColor",null),Je=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Je);const ti=(0,vt.T)(0,0,void 0,We.A.WGS84),ei=(0,u.vt)(),ii=1e-6;var ai,ni,oi;!function(t){t.Vertex=se.SJ.Custom1,t.Edge=se.SJ.Custom2}(ai||(ai={})),function(t){t[t.NONE=0]="NONE",t[t.MOVING=1]="MOVING",t[t.RESHAPING=2]="RESHAPING"}(ni||(ni={})),function(t){t[t.ALL=0]="ALL",t[t.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(oi||(oi={}));let si=class extends(dt.A.EventedMixin(be.g)){constructor(t){super(t),this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new xe.A,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const t=this._reshapeOperation=new Je({tool:this});this.addHandles([t.on("reshape",(t=>{"reshape"===t.type&&this._onReshapeGeometryChanged(),this.emit("reshape",t)})),t.on("move",(t=>{"move"===t.type&&this._onReshapeGeometryChanged(),this.emit("move",t)})),t.on("vertex-add",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)})),t.on("vertex-remove",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)})),t.on("immediate-click",(t=>this.emit("immediate-click",t))),this.view.on("pointer-down",["Shift"],(t=>t.stopPropagation())),(0,r.watch)((()=>this.graphic),(()=>this._updateGraphic()),r.syncAndInitial)]),this.finishToolCreation()}destroy(){this._reshapeOperation=(0,s.pR)(this._reshapeOperation)}get updating(){var t,e;return null!==(t=null===(e=this._reshapeOperation)||void 0===e?void 0:e.updating)&&void 0!==t&&t}_updateGeometry(){const t=(0,Pe.g)(this.graphic);this._reshapeOperation.inputGeometry=null!=t?t.clone():null}_updateGraphic(){if(this.removeHandles("onGraphicGeometryChange"),this._updateGeometry(),(0,Pe.N)(this.graphic)!==xt.e.SUPPORTED)return;const t=(0,r.watch)((()=>{var t;return null===(t=this.graphic)||void 0===t?void 0:t.geometry}),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),r.sync);this.addHandles(t,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(t){this._internalGeometryUpdate=!0;const{graphic:e}=this,{geometry:i}=e;"mesh"===(null===i||void 0===i?void 0:i.type)&&"point"===t.type?(e.geometry=i.centerAt(t),e.notifyGeometryChanged()):e.geometry=t,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:t}=this._reshapeOperation;null!=this.graphic&&t&&this._updateGeometryInternally(t.clone())}get canUndo(){var t;return null!==(t=this._reshapeOperation.canUndo)&&void 0!==t&&t}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const t=this._reshapeOperation.undo(),{outputGeometry:e}=this._reshapeOperation;t&&e&&this._updateGeometryInternally(e.clone())}get canRedo(){var t;return null!==(t=this._reshapeOperation.canRedo)&&void 0!==t&&t}redo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const t=this._reshapeOperation.redo(),{outputGeometry:e}=this._reshapeOperation;t&&e&&this._updateGeometryInternally(e.clone())}onInputEvent(t){"key-down"!==t.type||"Delete"!==t.key&&"Backspace"!==t.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,a._)([(0,l.MZ)()],si.prototype,"_reshapeOperation",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],si.prototype,"view",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],si.prototype,"graphic",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],si.prototype,"enableZShape",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],si.prototype,"enableZVertex",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],si.prototype,"enableMoveGraphic",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],si.prototype,"enableMidpoints",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],si.prototype,"enableEdgeOffset",void 0),(0,a._)([(0,l.MZ)()],si.prototype,"type",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,type:xe.A})],si.prototype,"sketchOptions",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],si.prototype,"snappingManager",void 0),(0,a._)([(0,l.MZ)()],si.prototype,"updating",null),(0,a._)([(0,l.MZ)()],si.prototype,"automaticManipulatorSelection",void 0),si=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],si);var ri=i(13904),li=i(73582),hi=i(52394),pi=i(95925);let ci=class extends Be.w{constructor(t){super(t),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};(0,a._)([(0,l.MZ)()],ci.prototype,"type",void 0),(0,a._)([(0,l.MZ)()],ci.prototype,"rotation",void 0),(0,a._)([(0,l.MZ)()],ci.prototype,"rotationPrecision",void 0),(0,a._)([(0,l.MZ)()],ci.prototype,"orientation",void 0),(0,a._)([(0,l.MZ)()],ci.prototype,"orientationPrecision",void 0),(0,a._)([(0,l.MZ)()],ci.prototype,"rotationType",void 0),ci=(0,a._)([(0,p.$)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],ci);let ui=class extends Be.w{constructor(t){super(t),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};(0,a._)([(0,l.MZ)()],ui.prototype,"type",void 0),(0,a._)([(0,l.MZ)()],ui.prototype,"scale",void 0),(0,a._)([(0,l.MZ)()],ui.prototype,"size",void 0),(0,a._)([(0,l.MZ)()],ui.prototype,"sizeUnit",void 0),(0,a._)([(0,l.MZ)()],ui.prototype,"sizePrecision",void 0),ui=(0,a._)([(0,p.$)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],ui);let di=class extends Be.w{constructor(t){super(t),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};var gi;(0,a._)([(0,l.MZ)()],di.prototype,"type",void 0),(0,a._)([(0,l.MZ)()],di.prototype,"orientation",void 0),(0,a._)([(0,l.MZ)()],di.prototype,"orientationPrecision",void 0),(0,a._)([(0,l.MZ)()],di.prototype,"rotationType",void 0),(0,a._)([(0,l.MZ)()],di.prototype,"size",void 0),(0,a._)([(0,l.MZ)()],di.prototype,"sizePrecision",void 0),(0,a._)([(0,l.MZ)()],di.prototype,"sizeUnit",void 0),di=(0,a._)([(0,p.$)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],di),function(t){t.ScaleIn=se.SJ.Custom2,t.ScaleOut=se.SJ.Custom3,t.RotateLeft=se.SJ.Custom4,t.RotateRight=se.SJ.Custom5,t.Unlocked=se.SJ.Custom7,t.DelayedFocused=se.SJ.Custom8,t.TouchInput=se.SJ.Custom12}(gi||(gi={}));let _i=class extends m.A{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}get updating(){return!!this._activeAnimation}constructor(t){super(t),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new dt.A,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>{var t;return"scale"===(null===(t=this._scaleRotateDragData)||void 0===t?void 0:t.mode)?this.adapter.scale:1}}initialize(){this._tooltip=new Ae.m({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,r.when)((()=>!this.sketchOptions.tooltips.effectiveEnabled),(()=>this._tooltip.clear()),r.initial),(0,r.watch)((()=>{const{adapter:t}=this,{info:e}=this._tooltip;return e===this._absoluteTooltipInfo&&this.getFocused()?[e,t.size,t.orientationClockwise]:[null]}),(t=>{let[e]=t;e&&this._updateFocusTooltip()}))])}destroy(){var t;null!==(t=this._activeAnimation)&&void 0!==t&&t.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,s.pR)(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const e=(0,hi.mg)({update:e=>{let{deltaTime:i}=e;t.update(i)&&this.cancelActiveAnimation()}});this._activeAnimation={...t,frameTask:e}}cancelActiveAnimation(){var t;null!==(t=this._activeAnimation)&&void 0!==t&&t.frameTask.remove(),this._activeAnimation=(0,s.pR)(this._activeAnimation)}forEachManipulator(t){t(this._ringManipulator,St.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const e=this.tool.graphicState.graphic,i=(0,te.Xt)(t,((t,i,a)=>{this._scaleRotateDragData=null;const n=this.adapter.startInteraction(),o={mode:"none",origin:(0,u.o8)(t.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=o,this._updateDragState();const s=A.rq.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,s),i.next((0,Kt.AA)(this.tool.view,(0,ke.O_)(t.renderLocation,s,(0,ke.vt)()))).next((t=>{const i=(0,ke.Qj)(t.plane),a=(0,mt.FY)(t.renderStart,t.renderEnd,o.origin,i),s=li.wf.shortestSignedDiff(o.angle,a);o.angleDir=(0,y.qE)(o.angleDir+s,-.3,.3),o.angle=a;const r=function(t,e){const i=(0,c.f)(A.rq.get(),e.renderStart,t.origin),a=(0,c.f)(A.rq.get(),e.renderEnd,t.origin),n=(0,c.l)(i),o=(0,c.l)(a);return 0===n?0:o/n}(o,t),l=r-this.adapter.scale;if(o.scaleDir=(0,y.qE)(o.scaleDir+l,-.2,.2),this._onScaleChanged(),"none"===o.mode){const i=this.mode||function(t,e,i,a){const{renderStart:n,renderEnd:o}=t,s=vi(n,a,A.rq.get()),r=vi(o,a,A.rq.get());if((0,c.a)(s,r)<100)return null;const l=(0,c.f)(A.rq.get(),n,i),h=(0,c.b)(A.rq.get(),l,(0,ke.Qj)(e)),p=n,u=(0,c.g)(A.rq.get(),p,h),d=vi(i,a,A.rq.get()),g=s,_=vi(u,a,A.rq.get()),v=(0,c.f)(A.rq.get(),_,g),m=(0,c.f)(A.rq.get(),s,d),f=(0,pi.LV)(g,v),y=(0,pi.LV)(d,m);return(0,pi.kb)(f,r)<(0,pi.kb)(y,r)?"rotate":"scale"}(t,t.plane,o.origin,this.tool.view.state.camera);if(null!=i){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:e,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:e,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}o.mode=i}}switch(o.mode){case"rotate":n.state.angle=o.initialAngle+a;break;case"scale":n.state.scale=r,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),t.action){case"start":case"update":switch(o.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:e,angle:(0,y.KJ)(o.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:e,xScale:r,yScale:r})}break;case"end":switch(o.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:(0,y.KJ)(o.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:r,yScale:r})}}return"end"===t.action&&(this.startAnimation(fi(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),n.done()),t})).next(this._updateTooltipPipelineStep(o)),a.next((()=>{if(n.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:1,yScale:1})}this.startAnimation(fi(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this.addHandles([i,t.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(function(t,e,i){let a=0,n=null;const o=()=>!1;return{start:()=>{n=t.getFocused,t.getFocused=o,a=0,e()},update:t=>{var e;return a+=t,null===(e=n)||void 0===e||!e()||a>=i.delayMs?mi.STOP:mi.CONTINUE},destroy:()=>{n&&(t.getFocused=n),e()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),t.events.on("immediate-click",(t=>{t.stopPropagation()})),(0,r.watch)((()=>{var t;return null===(t=this.tool.graphicState)||void 0===t?void 0:t.displaying}),(t=>this._ringManipulator.available=t),r.initial)])}_updateTooltipPipelineStep(t){return e=>{const{sketchOptions:i}=this,{effectiveEnabled:a,visualVariables:n}=i.tooltips;if(!a)return e;if("end"===e.action)return this._updateFocusTooltip(),e;const o=this._tooltip;switch(t.mode){case"scale":{var s;o.info=null!==(s=this._scaleTooltipInfo)&&void 0!==s?s:this._scaleTooltipInfo=new ui({sketchOptions:i});const{size:t,scale:e}=this.adapter,a=null===n||void 0===n?void 0:n.size,r=o.info;r.sketchOptions=i,r.scale={value:e},r.size=null!=t?(0,gt.d_)(t,"meters"):void 0,r.sizePrecision=yi(null===a||void 0===a?void 0:a.valueType),r.sizeUnit=null===a||void 0===a?void 0:a.unit;break}case"rotate":{var r,l;o.info=null!==(r=this._rotateTooltipInfo)&&void 0!==r?r:this._rotateTooltipInfo=new ci({sketchOptions:i});const{orientationClockwise:t,relativeAngleClockwise:e}=this.adapter,a=null===n||void 0===n?void 0:n.rotation,s=yi(null===a||void 0===a?void 0:a.valueType),h=o.info;h.sketchOptions=i,h.rotation=null!=e?(0,gt.Wq)(e,"radians","geographic"):void 0,h.rotationPrecision=s,h.rotationType=null!==(l=null===a||void 0===a?void 0:a.rotationType)&&void 0!==l?l:"geographic",h.orientation=null!=t?(0,gt.Wq)(t,"radians","geographic"):void 0,h.orientationPrecision=s;break}}return e}}_updateFocusTooltip(){const{sketchOptions:t,_tooltip:e}=this,{effectiveEnabled:i,visualVariables:a}=t.tooltips;if(i)if(this.getFocused()){var n,o;const i=null===a||void 0===a?void 0:a.rotation,s=null===a||void 0===a?void 0:a.size,r=this.mode,{size:l,orientationClockwise:h}=this.adapter,p=null!=h&&(null==r||"rotate"===r),c=null!=l&&(null==r||"scale"===r);e.info=null!==(n=this._absoluteTooltipInfo)&&void 0!==n?n:this._absoluteTooltipInfo=new di({sketchOptions:t});const u=e.info;u.sketchOptions=t,u.orientation=p?(0,gt.Wq)(h,"radians","geographic"):void 0,u.orientationPrecision=yi(null===i||void 0===i?void 0:i.valueType),u.rotationType=null!==(o=null===i||void 0===i?void 0:i.rotationType)&&void 0!==o?o:"geographic",u.size=c?(0,gt.d_)(l,"meters"):void 0,u.sizeUnit=null===s||void 0===s?void 0:s.unit,u.sizePrecision=yi(null===s||void 0===s?void 0:s.valueType)}else e.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(gi.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){var t;if(this._ringManipulator.updateStateEnabled(gi.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==(null===(t=this._scaleRotateDragData)||void 0===t?void 0:t.mode))),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(gi.ScaleIn|gi.ScaleOut,!1),this._ringManipulator.updateStateEnabled(gi.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(gi.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(gi.RotateLeft|gi.RotateRight,!1),this._ringManipulator.updateStateEnabled(gi.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(gi.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(gi.ScaleIn|gi.ScaleOut|gi.RotateLeft|gi.RotateRight,!1)}_updateManipulatorTransform(){const t=(0,Qt.$0)(A.Rc.get(),this.adapter.angle,(0,u.fA)(0,0,1));if(null==t)return;const e=this.getScale(),i=(0,Qt.CV)(A.Rc.get(),(0,c.s)(A.rq.get(),e,e,e));this._ringManipulator.modelTransform=(0,Qt.lw)(A.Rc.get(),i,t)}_createRingManipulator(){const t=(t,e,i)=>{const a=[],n=Math.ceil(128*(e-t)/(2*Math.PI));for(let o=0;o<n+1;o++){const s=t+o*(e-t)/n;a.push((0,u.fA)(i*Math.cos(s),i*Math.sin(s),0))}return a},e=e=>t(0,2*Math.PI,e),i=this._createMaterial(1),a=function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;return(0,ne.Nq)(a,(t=>[[-t/2,0],[t/2,0],[t/2,.25],[-t/2,.25]])(e),t,[],[],!1)},n=e(Ft),o=a(n,24),s={left:new Array,right:new Array},r=[];for(let u=0;u<2;u++){const e=u*Math.PI-Math.PI/4,n=Math.PI/2-Bt,o=e+n,l=e+Math.PI/2-n,h=t(o,l,190),p=a(h,9);r.push(h),r.push(t(o,l,201)),s.left.push(p),s.right.push(p.instantiate());for(let t=0;t<2;t++){const e=0===t,a=(0,Wt.vt)();if(e){(0,Qt.hs)(a,a,[1,-1,1]),(0,Qt.e$)(a,a,-o,[0,0,1]);const t=Math.round(.2*(h.length-1));a[12]=h[t][0],a[13]=h[t][1],a[14]=h[t][2]}else{(0,Qt.e$)(a,a,l,[0,0,1]);const t=Math.round(.8*(h.length-1));a[12]=h[t][0],a[13]=h[t][1],a[14]=h[t][2]}const n=(0,ne._B)(i,60,0,23,.5);(0,ne.xh)(n,a),(e?s.left:s.right).push(n)}}const l=[];for(let u=0;u<2;u++){const e=u*Math.PI-Math.PI/4,i=Math.PI/2-qt,n=e+i,o=e+Math.PI/2-i,s=t(n,o,213);l.push(a(s,9))}const h=this._createMaterial(.66),p=this._createMaterial(.5),c=this._createMaterial(.33),g=e(190),_=e(213),v=a(g,9,h),m=a(_,9,c),f=e(130),y=e(107),M=a(f,9,h),b=a(y,9,c);let S=[new Jt.M(o,gi.DelayedFocused),new Jt.M(o.instantiate({material:p}),se.p7.None)];this.mode&&"scale"!==this.mode||(S=S.concat([...l.map((t=>new Jt.M(t,gi.DelayedFocused|gi.Unlocked))),new Jt.M(v,gi.DelayedFocused|gi.ScaleIn),new Jt.M(m,gi.DelayedFocused|gi.ScaleIn),new Jt.M(M,gi.DelayedFocused|gi.ScaleOut),new Jt.M(b,gi.DelayedFocused|gi.ScaleOut)])),this.mode&&"rotate"!==this.mode||(S=S.concat([...s.right.map((t=>new Jt.M(t.instantiate(),gi.DelayedFocused|gi.Unlocked))),...s.left.map((t=>new Jt.M(t,gi.DelayedFocused|gi.RotateLeft))),...s.right.map((t=>new Jt.M(t,gi.DelayedFocused|gi.RotateRight)))]));const x=[n,...r];return new At.q({view:this.tool.view,renderObjects:S,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,d.bh)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:x,direction:(0,u.fA)(0,0,1)}})}_createMaterial(t){const e=new oe.v({cullFace:ae.s2.Back,renderOccluded:nt.m$.Transparent,isDecoration:!0});return this.addHandles((0,r.watch)((()=>({color:(0,n.f6)(this.tool.view.effectiveTheme.accentColor,t)})),(t=>e.setParameters(t)),r.initial)),e}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:t=>this._ringIndicatorDelayMs=t,tooltip:this._tooltip}}};function vi(t,e,i){return e.projectToScreen(t,Mi),(0,c.s)(i,Mi[0],Mi[1],0)}var mi;function fi(t,e){let i=null,a=1;const n=()=>a;return{start:()=>{a=t.getScale(),i=t.getScale,t.getScale=n,e()},update:t=>(a+=((a+1)/2-a)*Math.min(3*t,1),e(),Math.abs(a-1)<.01?mi.STOP:mi.CONTINUE),destroy:()=>{i&&(t.getScale=i),e()}}}function yi(t){switch(t){case"integer":case"long":return 0;default:return null}}(0,a._)([(0,l.MZ)({constructOnly:!0})],_i.prototype,"tool",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],_i.prototype,"adapter",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],_i.prototype,"sketchOptions",void 0),(0,a._)([(0,l.MZ)()],_i.prototype,"mode",void 0),(0,a._)([(0,l.MZ)()],_i.prototype,"_activeAnimation",void 0),(0,a._)([(0,l.MZ)()],_i.prototype,"updating",null),_i=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.GraphicScaleRotateTransform")],_i),function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP"}(mi||(mi={}));const Mi=(0,_.gs)();var bi=i(52896);function Si(t){return null!=t.geometry&&"mesh"===t.geometry.type?function(t){return(0,N.Hq)(t.vertexSpace)?function(t,e,i){let a=null===e||void 0===e?void 0:e.clone(),n=(0,u.o8)(i.origin),o=null,s=null;return{undo:e=>{var r;o=null===(r=t.transform)||void 0===r?void 0:r.clone(),s=(0,u.o8)(i.origin),t.transform=a,t.vertexSpace.origin=n,e.notifyMeshTransformChanged()},redo:e=>{var r;a=null===(r=t.transform)||void 0===r?void 0:r.clone(),n=(0,u.o8)(i.origin),t.transform=o,t.vertexSpace.origin=s,e.notifyMeshTransformChanged()}}}(t,t.transform,t.vertexSpace):function(t){let e,i=t.vertexAttributes.clonePositional();return{undo:a=>{e=t.vertexAttributes.clonePositional(),t.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=t.vertexAttributes.clonePositional(),t.vertexAttributes=e,a.notifyGeometryChanged()}}}(t)}(t.geometry):function(t){let e=t.geometry,i=null;return{undo(t){i=t.geometry,t.geometry=e},redo(t){e=t.geometry,t.geometry=i}}}(t)}let xi=class extends m.A{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([(0,r.when)((()=>{const t=this._interactionState;return t&&t.angle!==t.previousAngle?{interactionState:t,angle:t.state.angle}:null}),(t=>{let{interactionState:e}=t;this._updateMeshRotation(e)}),r.sync),(0,r.when)((()=>{const t=this._interactionState;return t&&t.scale!==t.previousScale?{interactionState:t,scale:t.state.scale}:null}),(t=>{let{interactionState:e}=t;this._updateMeshSize(e)}),r.sync)])}get initialAngle(){var t,e;return null!==(t=null===(e=this._interactionState)||void 0===e?void 0:e.initialAngle)&&void 0!==t?t:0}get angle(){var t,e;const i=this.geometry.transform;if(null==i)return null!==(t=null===(e=this._interactionState)||void 0===e?void 0:e.angle)&&void 0!==t?t:0;const a=(0,bi.yo)(i.rotation)[2];return Math.abs(a)>.999999?(0,y.kU)((0,bi.g7)(i.rotation))*Math.sign(a):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var t,e;return null!==(t=null===(e=this._interactionState)||void 0===e?void 0:e.scale)&&void 0!==t?t:1}startInteraction(){const t=new wi({angle:this.angle});this._interactionState=t;const e=()=>{this._interactionState=null};return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return Si(this.graphic)}_updateMeshRotation(t){const{angle:e,previousAngle:i}=t;t.previousAngle=e;const a=(0,y.KJ)(e-i),{geometry:n}=this,o=n.anchor;n.rotate(0,0,a,{origin:o}),n.transform&&n.vertexSpace.origin?this.graphic.notifyMeshTransformChanged():this.graphic.notifyGeometryChanged()}_updateMeshSize(t){const{scale:e,previousScale:i}=t;t.previousScale=e;const{geometry:a}=this,n=e/i,o=this.geometry.anchor;this.geometry.scale(n,{origin:o}),a.transform&&a.vertexSpace.origin?this.graphic.notifyMeshTransformChanged():this.graphic.notifyGeometryChanged()}};(0,a._)([(0,l.MZ)({constructOnly:!0})],xi.prototype,"graphic",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],xi.prototype,"geometry",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],xi.prototype,"viewingMode",void 0),(0,a._)([(0,l.MZ)()],xi.prototype,"initialAngle",null),(0,a._)([(0,l.MZ)()],xi.prototype,"angle",null),(0,a._)([(0,l.MZ)()],xi.prototype,"angleClockwise",null),(0,a._)([(0,l.MZ)()],xi.prototype,"relativeAngle",null),(0,a._)([(0,l.MZ)()],xi.prototype,"relativeAngleClockwise",null),(0,a._)([(0,l.MZ)()],xi.prototype,"scale",null),(0,a._)([(0,l.MZ)()],xi.prototype,"_interactionState",void 0),xi=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],xi);let wi=class extends m.A{get state(){const{angle:t,scale:e}=this;return{angle:t,scale:e}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,a._)([(0,l.MZ)()],wi.prototype,"angle",void 0),(0,a._)([(0,l.MZ)()],wi.prototype,"initialAngle",void 0),(0,a._)([(0,l.MZ)()],wi.prototype,"previousAngle",void 0),(0,a._)([(0,l.MZ)()],wi.prototype,"previousScale",void 0),(0,a._)([(0,l.MZ)()],wi.prototype,"scale",void 0),(0,a._)([(0,l.MZ)()],wi.prototype,"state",null),wi=(0,a._)([(0,p.$)("InteractionState")],wi);let Ti=class extends m.A{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,r.when)((()=>null!=this._interactionState?this._interactionState.state:null),(t=>{this._updateSymbol(t)}),r.sync))}get initialAngle(){var t,e;return null!==(t=null===(e=this._interactionState)||void 0===e?void 0:e.initialAngle)&&void 0!==t?t:0}get angle(){var t;return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?function(t){return-(0,y.kU)(t)}(null!==(t=this._orientationReferenceSymbolLayer.heading)&&void 0!==t?t:0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){var t,e;return null!==(t=null===(e=this._interactionState)||void 0===e?void 0:e.scale)&&void 0!==t?t:1}get size(){const t=this._sizeReferenceSymbolLayer;if(null==t)return null;const e=this.findLayerView(),i=this._graphicSymbol;if(null==e||null==i||"point-3d"!==i.type)return null;const a=e.getSymbolLayerSize(i,t);if("size"in a&&null!=a.size)return a.size;const n=this.sizeAxis;return!("width"in a)||null==a.width||null!=n&&"width"!==n&&"all"!==n&&"width-and-depth"!==n?!("depth"in a)||null==t.depth||null!=n&&"depth"!==n&&"all"!==n&&"width-and-depth"!==n?!("height"in a)||null==t.height||null!=n&&"height"!==n&&"all"!==n?null:a.height:a.depth:a.width}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return null==t||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return null==t||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&null!=t.heading))}get _graphicSymbol(){var t;return null!=(null===(t=this.graphic)||void 0===t?void 0:t.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if(null!=this._interactionState||null==t||null==e)return Ai;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),a=t.clone(),n=this.angle,o=new Ei({originalSymbol:a,angle:n,initialSizes:i});this._interactionState=o;const s=()=>{this._interactionState=null};return{state:o,done:s,cancel:()=>{this._graphicSymbol=a,s()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol(t){let{scale:e,angle:i,originalSymbol:a,initialSizes:n}=t;const o=this._graphicSymbol;if(null==o||"point-3d"!==o.type)return;const s=o.clone(),r=-(0,y.KJ)(i-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(a,s,((t,i,a)=>{var o;const s=(null!==(o=t.heading)&&void 0!==o?o:0)+r;i.heading!==s&&(i.heading=s,l=!0);const h=n[a];if(null!=h&&"width"in h){h.width=this.sizeFilter(h.width),h.height=this.sizeFilter(h.height),h.depth=this.sizeFilter(h.depth);const t=h.width*e;i.width!==t&&(i.width=t,l=!0);const a=h.depth*e;i.depth!==a&&(i.depth=a,l=!0);const n=h.height*e;i.height!==n&&(i.height=n,l=!0)}})),l&&(this._graphicSymbol=s)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,a)=>{const n=e.symbolLayers.at(a);"object"===t.type&&"object"===n.type&&i(t,n,a)}))}};(0,a._)([(0,l.MZ)()],Ti.prototype,"initialAngle",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"angle",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"angleClockwise",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"orientation",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"orientationClockwise",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"relativeAngle",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"relativeAngleClockwise",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"scale",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"size",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"sizeAxis",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],Ti.prototype,"graphic",void 0),(0,a._)([(0,l.MZ)()],Ti.prototype,"_interactionState",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],Ti.prototype,"findLayerView",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0})],Ti.prototype,"sizeFilter",void 0),(0,a._)([(0,l.MZ)()],Ti.prototype,"_sizeReferenceSymbolLayer",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"_orientationReferenceSymbolLayer",null),(0,a._)([(0,l.MZ)()],Ti.prototype,"_graphicSymbol",null),Ti=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Ti);const Ai={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Ei=class extends m.A{get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:n}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:n}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}};(0,a._)([(0,l.MZ)()],Ei.prototype,"originalSymbol",void 0),(0,a._)([(0,l.MZ)()],Ei.prototype,"angle",void 0),(0,a._)([(0,l.MZ)()],Ei.prototype,"initialAngle",void 0),(0,a._)([(0,l.MZ)()],Ei.prototype,"initialSizes",void 0),(0,a._)([(0,l.MZ)()],Ei.prototype,"scale",void 0),(0,a._)([(0,l.MZ)()],Ei.prototype,"state",null),Ei=(0,a._)([(0,p.$)("InteractionState")],Ei);let Oi=class extends(dt.A.EventedMixin(be.g)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new xe.A,this.type="transform-3d",this.tooltip=null,this._updatingHandles=new _t.U,this._scaleRotate=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{graphic:t,view:e}=this;this.graphicState=new at.y({graphic:t}),this.addHandles((0,r.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled),(t=>{this.tooltip=t?new Ae.m({view:e}):(0,s.pR)(this.tooltip)}),r.syncAndInitial)),this._moveManipulation=new _e({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&(0,wt.o)(t),radius:_e.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.addHandles(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))));const i=t=>e=>{this.addHandles(e.events.on("focus-changed",(e=>{let{action:i}=e;const a=this.tooltip;null!=a&&("focus"===i?this._updateMoveTooltip(t):a.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(me.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(me.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(me.Z));const a=(0,d.bh)(t);this._moveManipulation.elevationInfo=a,this.addHandles(j(this.graphicState,e));const{geometry:n}=t;if(this._moveManipulation.createGraphicDragPipeline(((i,o,s,r,l)=>{if(null!=n&&i===me.XY){const{snappingStep:i,cancelSnapping:o}=(0,Te.L)({snappingContext:new we.e({elevationInfo:a,pointer:l,editGeometryOperations:Se.p.fromGeometry(new ri.A({spatialReference:n.spatialReference}),e.state.viewingMode),visualizer:new Y.s,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});r=r.next(o),s=s.next((0,te.RS)(this.view,a)).next(...i)}return{steps:s=s.next((t=>(this._updateMoveTooltip(i,t),t))),cancel:r}}),this.graphicState,(t=>{const{action:e,graphic:i,dxScreen:a,dyScreen:n}=t,o={graphic:i,dxScreen:a,dyScreen:n};switch(e){case"start":this.emit("graphic-translate-start",o),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",o);break;case"end":this.emit("graphic-translate-stop",o)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,r.watch)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new _i({tool:this,mode:t,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([Xt({view:this.view,graphic:this.graphic,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,o.hA)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,r.watch)((()=>e.scale),(()=>this._updateMoveAngle()))].filter(ze.Ru)),this.addHandles(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((t=>{t instanceof At.q&&this.addHandles(t.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this.tooltip=(0,s.pR)(this.tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,s.pR)(this._scaleRotate),this._scaleRotateAdapter=(0,s.pR)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){var t,e;return null!=this.graphic.geometry&&"mesh"===this.graphic.geometry.type?new xi({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Ti({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer)),sizeAxis:null!==(t=null===(e=this.sketchOptions)||void 0===e||null===(e=e.tooltips)||void 0===e||null===(e=e.visualVariables)||void 0===e||null===(e=e.size)||void 0===e?void 0:e.axis)&&void 0!==t?t:null})}_forEachManipulator(t){var e,i;null!==(e=this._moveManipulation)&&void 0!==e&&e.forEachManipulator(t),null===(i=this._scaleRotate)||void 0===i||i.forEachManipulator(t)}_hideManipulatorsForGraphicState(){return(0,r.watch)((()=>this.graphicState.displaying),(t=>{this._forEachManipulator((e=>e.available=t)),this._moveManipulation.zManipulation.available=t&&this.enableZ&&(0,wt.o)(this.graphic)}))}_createGeometryUndoRecord(){return Si(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){var t;return this._updatingHandles.updating||!(null===(t=this._scaleRotate)||void 0===t||!t.updating)}set location(t){this._moveManipulation.location=t,this._scaleRotate&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){var t;null===(t=this._scaleRotate)||void 0===t||t.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){this.view.state.viewingMode===q.RT.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){(0,mt.V1)(this.view,this,this.graphic)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,e){var i,a,n;const{sketchOptions:o,tooltip:s}=this;if(null!=s){switch(s.clear(),t){case me.XY:s.info=null!==(i=this._translateGraphicTooltipInfo)&&void 0!==i?i:this._translateGraphicTooltipInfo=new Ee.ar({sketchOptions:o}),this._updateMoveTooltipDistance(s.info,e,((t,e)=>(0,R.Kt)(t,e)));break;case me.XY_AXIS:s.info=null!==(a=this._translateGraphicXYTooltipInfo)&&void 0!==a?a:this._translateGraphicXYTooltipInfo=new Ee.nW({sketchOptions:o}),this._updateMoveTooltipDistance(s.info,e,((t,i)=>(0,gt.hs)((0,R.Kt)(t,i),ie(e))));break;case me.Z:s.info=null!==(n=this._translateGraphicZTooltipInfo)&&void 0!==n?n:this._translateGraphicZTooltipInfo=new Ee.YI({sketchOptions:o}),this._updateMoveTooltipDistance(s.info,e,Oe.e5)}s.info.sketchOptions=o}}_updateMoveTooltipDistance(t,e,i){if(null!=e&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,o=i(a,n);t.distance=null!=o?o:gt.r7}else t.distance=gt.r7}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:null!=this._scaleRotate?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:t=>null!=this._scaleRotate?this._scaleRotate.test.setRingIndicatorDelayMs(t):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate}}};(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Oi.prototype,"view",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Oi.prototype,"graphic",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Oi.prototype,"enableZ",void 0),(0,a._)([(0,l.MZ)()],Oi.prototype,"enableRotation",void 0),(0,a._)([(0,l.MZ)()],Oi.prototype,"enableScaling",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,type:xe.A})],Oi.prototype,"sketchOptions",void 0),(0,a._)([(0,l.MZ)()],Oi.prototype,"graphicState",void 0),(0,a._)([(0,l.MZ)({value:!1})],Oi.prototype,"snapToScene",null),(0,a._)([(0,l.MZ)({constructOnly:!0})],Oi.prototype,"snappingManager",void 0),(0,a._)([(0,l.MZ)({readOnly:!0})],Oi.prototype,"type",void 0),(0,a._)([(0,l.MZ)({readOnly:!0})],Oi.prototype,"updating",null),(0,a._)([(0,l.MZ)()],Oi.prototype,"tooltip",void 0),Oi=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Oi);var Ii=i(77654),Ri=i(20205),Gi=i(30120);class Di{constructor(t,e,i,a){this._tool=t,this._graphicState=e,this._editGeometryOperations=i,this._bounds=a,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const n=this._tool,o=n.view;this.moveXYGraphicManipulation=new ye({view:o,tool:n,graphicState:this._graphicState}),n.addHandles(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=new Ri.x(o,Ri.r.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Ii.xM,n.manipulators.add(this.moveZManipulator),n.addHandles([this._createMoveZDragPipeline()]),n.addHandles([n.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))])}destroy(){this.moveXYGraphicManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(t){this.moveXYGraphicManipulation.forEachManipulator(t),t(this.moveZManipulator,St.TRANSLATE_Z)}updateManipulators(t,e){const i=this.moveZManipulator,a=(0,Qt.Qr)(A.Rc.get(),t,Math.PI);a[12]=0,a[13]=0,a[14]=0,i.modelTransform=a,i.renderLocation=(0,c.f)(A.rq.get(),e.origin,e.basis1)}getUpdatedTooltipInfo(){return this.moveXYGraphicManipulation.grabbing||this.moveXYGraphicManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){var t;const e=this._tool,i=null!==(t=this._moveXYTooltipInfo)&&void 0!==t?t:this._moveXYTooltipInfo=new Ee.ar({sketchOptions:e.sketchOptions});if(this.moveXYGraphicManipulation.dragging){const t=this._bounds,a=t.mapBoundsStart.origin,n=t.mapBounds.origin,{renderSpatialReference:o}=e.view;if(!o)return null;const s=(0,R.Do)(a,n,o);if(null==s)return null;i.distance=s}else i.distance=gt.r7;return i}_computeMoveZTooltipInfo(){var t;const e=this._tool,i=null!==(t=this._moveZTooltipInfo)&&void 0!==t?t:this._moveZTooltipInfo=new Ee.YI({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){const t=this._bounds,a=t.mapBoundsStart.origin,n=t.mapBounds.origin,{renderSpatialReference:o}=e.view;if(!o)return null;const s=(0,Oe.cL)(a,n,o);if(null==s)return null;i.distance=s}else i.distance=gt.r7;return i}_createMoveXYGraphicDragPipeline(){return this.moveXYGraphicManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i)))}_createMoveZDragPipeline(){const t=this._editGeometryOperations.data.spatialReference;return(0,te.Xt)(this.moveZManipulator,((e,i,a)=>{const n=(0,u.o8)(e.renderLocation),o=i.next((0,Kt.iv)(this._tool.view,n,t)).next((0,te.sO)());this._applyGraphicMoveSteps(o,a)}))}_applyGraphicMoveSteps(t,e){const i=this._tool,a=i.graphic,n=t.next((t=>("start"===t.action&&(i.inputState={type:"move"},this._bounds.backupMapBounds(),i.emit("graphic-translate-start",{graphic:a,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next((0,te.EX)()).next(this._moveDragUpdateGeometry()).next((t=>{var e,n;const o={graphic:a,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||(null!==(e=t.mapEnd.z)&&void 0!==e?e:0)-(null!==(n=t.mapStart.z)&&void 0!==n?n:0))&&i.emit("graphic-translate",o);break;case"end":i.inputState=null,i.emit("graphic-translate-stop",o)}return t}));return e.next((()=>{null!=i.inputState&&i.emit("graphic-translate-stop",{graphic:a,dxScreen:0,dyScreen:0}),i.cancel()})),n}_moveDragUpdateGeometry(){const t=this._tool;return e=>{if(null==t.inputState||"move"!==t.inputState.type)return e;const i=[];for(const t of this._editGeometryOperations.data.components)i.push(...t.vertices);const a="start"===e.action?Fe.Y.NEW_STEP:Fe.Y.ACCUMULATE_STEPS,n=this._editGeometryOperations.moveVertices(i,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,a);return(0,Gi.Bb)(n,this._bounds.mapBounds),t.graphic.geometry=this._editGeometryOperations.data.geometry,e}}}var Zi=i(79650),Ci=i(59962),Pi=i(78136),zi=i(37431),Li=i(86210),ki=i(3300);class Hi{constructor(t,e,i){var a;this._tool=t,this._editGeometryOperations=e,this._bounds=i,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const n=this._tool,o=n.view,s=!(null!==(a=o._stage)&&void 0!==a&&a.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this.rotateManipulator=new Pi.Q(o,((t,e)=>(0,Ci.t)(o.textures,{accentColor:t,contrastColor:e,preMultiplyAlpha:s}))),n.addHandles([this.rotateManipulator.events.on("grab-changed",(t=>this._onRotateGrab(t))),this._createRotateDragPipeline(this.rotateManipulator)]),n.manipulators.add(this.rotateManipulator),n.addHandles([n.on("graphic-rotate-start",(t=>{this._startAngle=t.angle})),n.on("graphic-rotate",(t=>{this._endAngle=t.angle})),n.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(t){t(this.rotateManipulator,St.ROTATE)}updateManipulators(t,e){const i=this._bounds.mapBounds.plane[2]<0?Math.PI:0,a=(0,Qt.eL)(A.Rc.get(),t,i);a[12]=0,a[13]=0,a[14]=0,this.rotateManipulator.modelTransform=a,this.rotateManipulator.renderLocation=(0,c.g)(A.rq.get(),e.origin,e.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){var t;const e=null!==(t=this._rotateTooltipInfo)&&void 0!==t?t:this._rotateTooltipInfo=new ki.d({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onRotateGrab(t){let{action:e,screenPoint:i}=t;const a=this._tool,n=this._bounds;if("start"!==e||!i)return;const o=(0,Ii.W6)(n.displayBounds,a.view.renderCoordsHelper,Ii.CB.HEADING,(0,ke.vt)()),s=(0,zi.Gc)(a.view.state.camera,i);(0,ke.Ui)(o,s,A.rq.get())&&(n.backupMapBounds(),a.inputState={type:"rotate",rotatePlane:o})}_createRotateDragPipeline(t){const e=this._tool,i=e.graphic;return(0,te.Xt)(t,((t,a,n)=>{const o=e.inputState;null!=o&&(a.next((t=>("start"===t.action&&e.emit("graphic-rotate-start",{graphic:i,angle:0}),t))).next((0,Kt.AA)(e.view,o.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(o)).next(this._rotateDragUpdateGeometry()).next((t=>{const a={graphic:i,angle:(0,y.KJ)(t.rotateAngle)};switch(t.action){case"start":case"update":e.emit("graphic-rotate",a);break;case"end":e.inputState=null,e.emit("graphic-rotate-stop",a)}return t})),n.next((()=>{null!=e.inputState&&e.emit("graphic-rotate-stop",{graphic:i,angle:0}),e.cancel()})))}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=(0,ke.Qj)(t.rotatePlane),a=(0,mt.FY)(e.renderStart,e.renderEnd,this._bounds.displayBounds.origin,i);return{...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){const t=this._tool,e=this._bounds;return i=>{const a=(0,c.c)((0,u.vt)(),e.mapBoundsStart.origin),n=[];for(const t of this._editGeometryOperations.data.components)n.push(...t.vertices);const o="start"===i.action?Fe.Y.NEW_STEP:Fe.Y.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(n,a,i.rotateAngle,o,Li.K.REPLACE);return(0,Zi.c)(e.mapBoundsStart,e.mapBounds),(0,Gi.Bb)(s,e.mapBounds),t.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}var Vi=i(67169),Ui=i(31116);class Xi{constructor(t,e,i){this._tool=t,this._onDisplayBoundsChanged=e,this.mapBounds=(0,Zi.a)(),this.mapBoundsStart=(0,Zi.a)(),this.displayBounds=(0,Zi.a)(),this._calculateMapBounds(i)}get displayBoundsMargin(){var t,e,i;const{view:a,graphic:n}=this._tool,o=null!==(t=null===(e=a.pointsOfInterest)||void 0===e?void 0:e.centerOnSurfaceFrequent.location)&&void 0!==t?t:null===(i=n.geometry)||void 0===i||null===(i=i.extent)||void 0===i?void 0:i.center;return o?Yi*a.pixelSizeAt(o):0}backupMapBounds(){(0,Zi.c)(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged()}_calculateMapBounds(t){const{view:e,attachmentOrigin:i}=this._tool,a=t.geometry,n=yt(a);(0,x.hs)(n,n,-1);const o=e.spatialReference,s=a.spatialReference,r=i?e.pixelSizeAt(i)*(0,S.KX)(o)/(0,S.GA)(s):0;(0,Gi.G3)(n,t,Ni*r,this.mapBounds)}_calculateDisplayBounds(){var t;const{view:e,attachmentOrigin:i,graphic:a}=this._tool;if(!a.geometry)return;const n=null!==(t=null===i||void 0===i?void 0:i.z)&&void 0!==t?t:(0,et.nG)(this.mapBounds.origin,e.elevationProvider,it.F.fromElevationInfo((0,d.bh)(a)),e.renderCoordsHelper),o=(0,Zi.c)(this.mapBounds);o.origin[2]=null!==n&&void 0!==n?n:0,function(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;n||(n=(0,Zi.a)()),e.toRenderCoords(t.origin,i,n.origin);const o=A.rq.get();(0,c.g)(o,t.origin,t.basis1),(0,c.g)(o,o,t.basis2),e.toRenderCoords(o,i,o);const s=A.rq.get();(0,c.g)(s,t.origin,t.basis1),(0,c.f)(s,s,t.basis2),e.toRenderCoords(s,i,s);const r=A.rq.get();(0,c.f)(r,t.origin,t.basis1),(0,c.f)(r,r,t.basis2),e.toRenderCoords(r,i,r);const l=A.rq.get();(0,c.f)(l,t.origin,t.basis1),(0,c.g)(l,l,t.basis2),e.toRenderCoords(l,i,l);const h=(0,c.m)(A.rq.get(),o,s,.5);(0,c.f)(h,h,n.origin);const p=(0,c.m)(A.rq.get(),r,l,.5);(0,c.f)(p,n.origin,p),(0,c.m)(n.basis1,h,p,.5);const u=(0,c.m)(A.rq.get(),l,o,.5);(0,c.f)(u,u,n.origin);const d=(0,c.m)(A.rq.get(),s,r,.5);(0,c.f)(d,n.origin,d),(0,c.m)(n.basis2,u,d,.5);const g=(0,c.b)(A.rq.get(),n.basis1,n.basis2),_=(0,c.b)(g,g,n.basis1);(0,c.n)(_,_),(0,c.h)(n.basis2,_,(0,c.k)(n.basis2,_)),(0,c.h)(n.basis1,n.basis1,1+a/(0,c.l)(n.basis1)),(0,c.h)(n.basis2,n.basis2,1+a/(0,c.l)(n.basis2)),(0,Zi.u)(n)}(o,e.renderCoordsHelper,a.geometry.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const Yi=10,Ni=80;function Fi(t,e,i){return(0,c.f)($i,(0,c.f)($i,t.origin,t.basis1),t.basis2),(0,c.r)(ji,$i,t.basis1,2),(0,c.r)(qi,ji,t.basis2,2),(0,c.r)(Bi,$i,t.basis2,2),$i[2]=ji[2]=qi[2]=Bi[2]=e,(0,Ui.b)({topLeft:Bi,topRight:qi,bottomRight:ji,bottomLeft:$i,spatialReference:i})}const Bi=(0,u.vt)(),qi=(0,u.vt)(),ji=(0,u.vt)(),$i=(0,u.vt)();class Qi{get zMax(){if(!this._zMaxDirty)return this._zMax;const t=this._editGeometryOperations.data;if(t.geometry.hasZ){const i=t.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){var e;const a=null!==(e=i.getZ(t.pos))&&void 0!==e?e:0;this._zMax=Math.max(a,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(t,e,i,a,n){this._tool=t,this._graphicState=e,this._editGeometryOperations=i,this._bounds=a,this._preserveAspectRatioStep=n,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=(0,Zi.a)(),this._displayBoundsMarginStart=0,this._startScale=(0,w.vt)(),this._endScale=(0,w.vt)(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;const o=this._tool,s=o.view;this.resizeManipulators=this._resizeHandles.map((t=>{const e=new Vi.b(s,t);return o.addHandles([e.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(e,t)]),e})),o.manipulators.addMany(this.resizeManipulators),o.addHandles([o.on("graphic-scale-start",(t=>{(0,x.hZ)(this._startScale,t.xScale,t.yScale),(0,x.hZ)(this._endScale,t.xScale,t.yScale)})),o.on("graphic-scale",(t=>{(0,x.hZ)(this._endScale,t.xScale,t.yScale)})),o.on("graphic-scale-stop",(()=>{(0,x.hZ)(this._startScale,0,0),(0,x.hZ)(this._endScale,0,0)})),this._graphicState.on("changed",(()=>{var t;"resize"!==(null===(t=o.inputState)||void 0===t?void 0:t.type)&&(this._zMaxDirty=!0)}))])}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()}))}forEachManipulator(t){this.resizeManipulators.forEach((e=>t(e,St.SCALE)))}updateManipulators(t,e){this.resizeManipulators.forEach(((i,a)=>{(0,Ii.gi)(i,this._resizeHandles[a],t,e)}))}getUpdatedTooltipInfo(){return this.resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){var t;const e=this._tool,i=null!==(t=this._scaleTooltipInfo)&&void 0!==t?t:this._scaleTooltipInfo=new ki.c({sketchOptions:e.sketchOptions}),a=e.graphic.geometry;if(null==a)return null;const n=Fi(this._bounds.mapBounds,this.zMax,a.spatialReference);return null==n?null:(i.xSize=n.xSize,i.ySize=n.ySize,null!=this._sizeStart&&this.resizeManipulators.some((t=>t.dragging))?(i.xScale=n.xSize.value/this._sizeStart.xSize.value,i.yScale=n.ySize.value/this._sizeStart.ySize.value):(i.xScale=1,i.yScale=1),i)}_onResizeGrab(t){let{action:e,screenPoint:i}=t;const a=this._tool,n=this._bounds;if("start"!==e||!i||!a.graphic.geometry)return;const o=(0,zi.Gc)(a.view.state.camera,i);(0,ke.Ui)(n.displayBounds.plane,o,A.rq.get())&&(n.backupMapBounds(),(0,Zi.c)(n.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=n.displayBoundsMargin,this._sizeStart=Fi(n.mapBoundsStart,this.zMax,a.graphic.geometry.spatialReference),a.inputState={type:"resize"})}_createResizeDragPipeline(t,e){const i=this._tool,a=i.graphic;return(0,te.Xt)(t,((t,n,o)=>{null!=i.inputState&&(n.next((t=>("start"===t.action&&i.emit("graphic-scale-start",{graphic:a,xScale:1,yScale:1}),t))).next((0,Kt.AA)(i.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:a,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":i.emit("graphic-scale",e);break;case"end":i.inputState=null,i.emit("graphic-scale-stop",e)}return t})),o.next((()=>{null!=i.inputState&&i.emit("graphic-scale-stop",{graphic:a,xScale:1,yScale:1}),i.cancel()})))}))}_resizeDragRenderPlaneToFactors(){const t=this._bounds;return e=>{const i=this._displayBoundsStart,a=e.handle.direction,n=t.displayBoundsMargin,o=this._displayBoundsMarginStart,s=(0,c.c)(A.rq.get(),i.origin);(0,c.r)(s,s,i.basis1,-a[0]),(0,c.r)(s,s,i.basis2,-a[1]);const r=(0,c.f)(A.rq.get(),e.renderEnd,s),l=(0,c.f)(A.rq.get(),e.renderStart,s),h=(0,Ii.wZ)(e.handle),p=(0,Ii.Yx)(i),u=(0,Ii.Yx)(t.displayBounds)/p,d=(t,e)=>{if(0===t)return 1;let i=(0,c.l)(e),a=.5*t*(0,c.k)(e,r)/i;const s=a<0?-1:1;h&&(a+=(i-.5*t*(0,c.k)(e,l)/i)*s*u);const p=i<1.5*o?1:Wi;return i=Math.max(i-o,Wi),s>0&&(a-=n),s*Math.max(s*(a/i),p)};return{...e,factor1:d(a[0],i.basis1),factor2:d(a[1],i.basis2)}}}_resizeDragUpdateGeometry(){const t=this._tool,e=this._bounds;return i=>{const a=(0,c.c)((0,u.vt)(),e.mapBoundsStart.origin);(0,c.r)(a,a,e.mapBoundsStart.basis1,-i.handle.direction[0]),(0,c.r)(a,a,e.mapBoundsStart.basis2,-i.handle.direction[1]);const n=(0,x.hZ)((0,w.vt)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);(0,x.S8)(n,n);const o=[];for(const t of this._editGeometryOperations.data.components)o.push(...t.vertices);const s="start"===i.action?Fe.Y.NEW_STEP:Fe.Y.ACCUMULATE_STEPS,r=this._editGeometryOperations.scaleVertices(o,a,n,i.factor1,i.factor2,s,Li.K.REPLACE);return(0,Zi.c)(e.mapBoundsStart,e.mapBounds),(0,Gi.Bb)(r,e.mapBounds),t.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}const Wi=1e-6;class Ji{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent&&null!=this._next){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this._next.execute(e)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new te.rh;return this._next=t,[t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t),t]}_adjustScaleFactors(t){const e=(0,Ii.wZ)(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}let Ki=class extends(dt.A.EventedMixin(be.g)){constructor(t){super(t),this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new xe.A,this._preserveAspectRatio=new Ji,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:t,graphic:e}=this,i=this._graphicState=new at.y({graphic:e}),a=e.geometry,n=this._editGeometryOperations=Se.p.fromGeometry(a,t.state.viewingMode),s=this._bounds=new Xi(this,(()=>this._updateManipulators()),n.data);this._extentMove=new Di(this,i,n,s),this._extentScale=new Qi(this,i,n,s,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new Hi(this,n,s),this.addHandles([(0,r.watch)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,St.TRANSLATE_Z))),(0,r.watch)((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((t=>this._updateManipulatorAvailability(t,St.SCALE))))),(0,r.watch)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,St.ROTATE)))]),this._updateAllManipulatorAvailability();const l=Xt({view:t,graphic:e,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,o.hA)()});if(null!=l){const{visualElement:t}=l;t instanceof K.P&&(this._outlineVisualElement=t,this.addHandles(t.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(l)}this.addHandles([i.on("changed",(()=>this._onGeometryChanged())),(0,r.watch)((()=>i.displaying),(()=>this._updateAllManipulatorAvailability())),(0,r.watch)((()=>i.isDraped),(()=>this._graphicDrapedChanged()),r.initial),(0,r.watch)((()=>{var e;return null===(e=t.pointsOfInterest)||void 0===e?void 0:e.centerOnSurfaceFrequent.location}),(()=>s.updateDisplayBounds())),t.trackGraphicState(i)]);this._forEachManipulator((t=>{this.addHandles(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((t,i)=>{this.addHandles(t.events.on("immediate-click",(t=>{i===St.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this._editGeometryOperations.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{view:t}=this,e=this.tooltip=new Ae.m({view:t}),i=()=>{e.info=this._getUpdatedTooltipInfo()};this.addHandles([(0,r.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled),i),this.on("graphic-translate-start",i),this.on("graphic-translate",i),this.on("graphic-translate-stop",(()=>{this.tooltip.clear()})),this.on("graphic-rotate-start",i),this.on("graphic-rotate",i),this.on("graphic-rotate-stop",i),this.on("graphic-scale-start",i),this.on("graphic-scale",i),this.on("graphic-scale-stop",i)]),this._forEachManipulator((t=>{this.addHandles([t.events.on("focus-changed",i),t.events.on("grab-changed",i),t.events.on("drag",(t=>{"cancel"===t.action?this.tooltip.clear():i()}))])}))}_getUpdatedTooltipInfo(){var t,e;return this.sketchOptions.tooltips.effectiveEnabled?null!==(t=null!==(e=this._extentMove.getUpdatedTooltipInfo())&&void 0!==e?e:this._extentScale.getUpdatedTooltipInfo())&&void 0!==t?t:this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(ta),this._bounds.updateDisplayBounds(),this._graphicState.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(t=>{null!=this._attachmentOrigin&&(0,zt.Rj)(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),ta)}_updateManipulators(){if(!this.visible)return;const t=this._bounds.displayBounds,e=(0,Ii.h7)(t,A.Rc.get());this._extentMove.updateManipulators(e,t),this._extentScale.updateManipulators(e,t),this._extentRotate.updateManipulators(e,t)}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)))}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof At.q){const a=this._graphicState.displaying,n=this.enableZ&&(0,wt.o)(this.graphic);switch(e){case St.ROTATE:t.available=a&&this.enableRotation;break;case St.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||n),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?Ii.oc:Ii.zm;break;case St.TRANSLATE_Z:t.available=a&&n;break;default:t.available=a}}}_forEachManipulator(t){this._extentMove.forEachManipulator(t),this._extentScale.forEachManipulator(t),this._extentRotate.forEachManipulator(t)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get attachmentOrigin(){var t,e,i;const a=this.graphic.geometry,n=this._graphicState.isDraped?null:null===(t=this._outlineVisualElement)||void 0===t?void 0:t.attachmentOrigin;return this._attachmentOrigin=null!==(e=null!==n&&void 0!==n?n:(0,mt.Yk)(this.view,this.graphic))&&void 0!==e?e:null===a||void 0===a||null===(i=a.extent)||void 0===i?void 0:i.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){const t=this._editGeometryOperations.undo();(0,Gi.fJ)(t,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}this.inputState=null}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();(0,Gi.fJ)(t,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();(0,Gi.Bb)(t,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get test(){return{moveZManipulator:this._extentMove.moveZManipulator,resizeManipulators:this._extentScale.resizeManipulators,rotateManipulator:this._extentRotate.rotateManipulator}}};(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ki.prototype,"view",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ki.prototype,"graphic",void 0),(0,a._)([(0,l.MZ)()],Ki.prototype,"enableZ",void 0),(0,a._)([(0,l.MZ)()],Ki.prototype,"enableScaling",void 0),(0,a._)([(0,l.MZ)()],Ki.prototype,"enableRotation",void 0),(0,a._)([(0,l.MZ)({constructOnly:!0,type:xe.A})],Ki.prototype,"sketchOptions",void 0),(0,a._)([(0,l.MZ)()],Ki.prototype,"preserveAspectRatio",null),(0,a._)([(0,l.MZ)()],Ki.prototype,"grabbing",void 0),(0,a._)([(0,l.MZ)()],Ki.prototype,"inputState",void 0),(0,a._)([(0,l.MZ)({readOnly:!0})],Ki.prototype,"type",void 0),(0,a._)([(0,l.MZ)()],Ki.prototype,"tooltip",void 0),Ki=(0,a._)([(0,p.$)("esri.views.3d.interactive.editingTools.transformGraphic.ExtentTransformTool")],Ki);const ta="draped-elevation-changes"},86507:(t,e,i)=>{i.d(e,{o:()=>o,s:()=>s});var a=i(54901),n=i(12482);function o(t){return"on-the-ground"!==(arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.bh)(t)).mode&&!(null==t.geometry||!t.geometry.hasZ)}function s(t,e){let i=null;const n=t.events.on("grab-changed",(a=>{null!=i&&(i.remove(),i=null),"start"===a.action?(i=t.disableDisplay(),e&&e(a)):e&&e(a)}));return(0,a.hA)((()=>{var t;null!==(t=i)&&void 0!==t&&t.remove(),n.remove()}))}},85937:(t,e,i)=>{i.d(e,{I:()=>_});var a=i(20664),n=i(9392),o=i(43047),s=i(55855),r=i(32314),l=i(49296),h=i(44815),p=i(67425);var c=i(83490),u=i(62577),d=i(45463),g=i(84294);class _ extends r.X{constructor(t){super(t),this.view=null,this._renderOccluded=d.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,s.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,s.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(t){this._vertices=t,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(t){this._spatialReference=t,this.recreateGeometry()}get color(){return this._color}set color(t){(0,o.a)(t,this._color)||((0,o.c)(this._color,t),this._updateMaterial())}get size(){return this._size}set size(t){t!==this._size&&(this._size=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){(0,o.a)(t,this._outlineColor)||((0,o.c)(this._outlineColor,t),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const t=this.vertices;if(null==t||0===t.length)return[];const e=function(t,e,i,a,n){const o=(0,h.jh)(3*t.length),s=(0,h.jh)(o.length);t.forEach(((t,e)=>{o[3*e]=t[0],o[3*e+1]=t[1],o[3*e+2]=t.length>2?t[2]:0}));const r=(0,p.au)(o,e,0,s,0,o,0,o.length/3,i,a,n),l=null!=r;return{numVertices:t.length,position:o,mapPositions:s,projectionSuccess:l,sampledElevation:r}}(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,l.F.fromElevationInfo(this.elevationInfo)),i=[],n=e.numVertices,o=e.position;for(let s=0;s<n;++s){const t=(0,a.s)(v,o[3*s],o[3*s+1],o[3*s+2]),e=m(this._vertexMaterial,.5,t),n=m(this._vertexOutlineMaterial,.5,t);i.push({vertexGeometry:e,vertexOutlineGeometry:n})}return i}createGeometries(t){const e=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of e)t.addGeometry(i),t.addGeometry(a)}createExternalResources(){this._vertexMaterial=new g.A({...this._vertexMaterialParameters,writeDepth:!0,cullFace:c.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new g.A({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:c.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(t){t(this._vertexMaterial),t(this._vertexOutlineMaterial)}}const v=(0,n.vt)();function m(t,e,i){return(0,u.CM)(t,e,16,16,{offset:i})}},74487:(t,e,i)=>{i.d(e,{d:()=>y});var a=i(15941),n=i(31633),o=i(34761),s=i(20664),r=i(34111),l=i(98510),h=i(64232),p=i(60216),c=i(14487),u=i(5568),d=i(88954),g=i(13927),_=i(96190),v=i(75762),m=i(81284),f=i(64465);class y{constructor(t,e,i,a){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=i,this._coordinateSystem=a,this._tmpCoordinateSystem=(0,d.vt)(a),this.referenceEllipsoid=(0,r.tO)(e),this.sphericalPCPF=(0,l.lO)(e)}set extent(t){t&&(0,d.b)(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return(0,d.US)(this._coordinateSystem,t)}setAltitude(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return(0,d.E$)(this._coordinateSystem,i,e,t)}setAltitudeOfTransformation(t,e){(0,d.Jq)(this._coordinateSystem,e,t,e)}worldUpAtPosition(t,e){return(0,d.jI)(this._coordinateSystem,t,e)}worldBasisAtPosition(t,e,i){return(0,d.vf)(this._coordinateSystem,t,e,i)}basisMatrixAtPosition(t,e){const i=this.worldBasisAtPosition(t,u._.X,v.rq.get()),a=this.worldBasisAtPosition(t,u._.Y,v.rq.get()),n=this.worldBasisAtPosition(t,u._.Z,v.rq.get());return(0,o.hZ)(e,i[0],i[1],i[2],0,a[0],a[1],a[2],0,n[0],n[1],n[2],0,0,0,0,1),e}headingAtPosition(t,e){const i=this.worldUpAtPosition(t,v.rq.get()),n=this.worldBasisAtPosition(t,u._.Y,v.rq.get()),o=(0,_.EJ)(e,n,i);return(0,a.KJ)(o)}intersectManifoldClosestSilhouette(t,e,i){return(0,d.xW)(this._coordinateSystem,e,this._tmpCoordinateSystem),(0,d.lt)(this._tmpCoordinateSystem,t,i),i}intersectManifold(t,e,i){(0,d.xW)(this._coordinateSystem,e,this._tmpCoordinateSystem);const a=v.rq.get();return(0,d.Ui)(this._tmpCoordinateSystem,t,a)?(0,s.c)(i,a):null}intersectInfiniteManifold(t,e,i){if(this.viewingMode===f.RT.Global)return this.intersectManifold(t,e,i);(0,d.xW)(this._coordinateSystem,e,this._tmpCoordinateSystem);const a=this._tmpCoordinateSystem.value,n=v.rq.get();return(0,g.Ui)(a.plane,t,n)?(0,s.c)(i,n):null}toRenderCoords(t,e,i){return(0,m.v)(t)?(0,h.g)(t,e,this.spatialReference):(0,c.F)(t,e,i,this.spatialReference)}fromRenderCoords(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,m.v)(e)?(null!=i&&(e.spatialReference=i),(0,p.E)(t,this.spatialReference,e)?e:null):(0,c.F)(t,this.spatialReference,e,i)?e:null}static create(t,e){switch(t){case f.RT.Local:return new y(f.RT.Local,e,(0,n.GA)(e),(0,d.oJ)());case f.RT.Global:return new y(f.RT.Global,e,1,(0,d.Sj)(e))}}static renderUnitScaleFactor(t,e){return(0,n.KX)(t)/(0,n.KX)(e)}}},37431:(t,e,i)=>{i.d(e,{Gc:()=>l,RI:()=>p,Z4:()=>h,dk:()=>u,vr:()=>c});var a=i(76931),n=i(19555),o=i(20664),s=i(95925),r=i(75762);function l(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.vt)();return h(t,(0,a.WA)(e),i),(0,o.n)(i.direction,i.direction),i}function h(t,e,i){return p(t,t.screenToRender(e,(0,a.sc)(r.rq.get())),i)}function p(t,e,i){const s=(0,a.sc)((0,n.C)(r.rq.get(),e));if(s[2]=0,!t.unprojectFromRenderScreen(s,i.origin))return null;const l=(0,a.sc)((0,n.C)(r.rq.get(),e));l[2]=1;const h=t.unprojectFromRenderScreen(l,r.rq.get());return null==h?null:((0,o.f)(i.direction,h,i.origin),i)}function c(t,e,i){return u(t,t.screenToRender(e,(0,a.sc)(r.rq.get())),i)}function u(t,e,i){(0,o.c)(i.origin,t.eye);const a=(0,o.s)(r.rq.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(a,r.rq.get());return null==n?null:((0,o.f)(i.direction,n,i.origin),i)}},86401:(t,e,i)=>{i.d(e,{Ci:()=>o,Dq:()=>l,dB:()=>r,zK:()=>s});var a=i(48549),n=i(66470);const o=(0,a.BP)().vec3f(n.r.POSITION),s=(0,a.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0),r=(0,a.BP)().vec3f(n.r.POSITION).vec4u8(n.r.COLOR),l=((0,a.BP)().vec3f(n.r.POSITION).vec4u8(n.r.OBJECTANDLAYERIDCOLOR),(0,a.BP)().vec3f(n.r.POSITION).vec2f(n.r.UV0).vec4u8(n.r.OBJECTANDLAYERIDCOLOR));(0,a.BP)().vec3f(n.r.POSITION).vec4u8(n.r.COLOR).vec4u8(n.r.OBJECTANDLAYERIDCOLOR)},76030:(t,e,i)=>{i.r(e),i.d(e,{getDrawMeshHelpMessage:()=>r});var a=i(31633),n=i(20664),o=i(9392),s=i(12482);function r(t,e){var i,o,r,u;const d=null===t||void 0===t?void 0:t.geometry;if(!t||"mesh"!==(null===d||void 0===d?void 0:d.type)||!e)return;const{renderCoordsHelper:g,elevationProvider:_}=e,{camera:v}=e.state,{extent:m}=d,{center:f,spatialReference:y}=m,M=(0,a.GA)(y),b=(0,a.G9)(y),S=(0,a.GA)(g.spatialReference),x=m.width*M,w=m.height*b,T=(null!==(i=m.zmax)&&void 0!==i?i:0)*b,A=T-(null!==(o=m.zmin)&&void 0!==o?o:0)*b,E=Math.max(x,w,A)/S,{x:O,y:I}=f,R=null!==(r=f.z)&&void 0!==r?r:0;(0,n.s)(c,O,I,R),g.toRenderCoords(c,y,c);const G=E/v.computeScreenPixelSizeAt(c);if(G>v.width*h)return"meshTooClose";if(G<l)return"meshTooFar";const D=(0,s.bh)(t),{absoluteZ:Z}=(0,s.Q5)(O,I,T,y,e,D);return Z<(null!==(u=_.getElevation(O,I,R,y,"ground"))&&void 0!==u?u:0)*b+A*p?"meshUnderground":"mesh"}const l=20,h=1,p=.1,c=(0,o.vt)()},3300:(t,e,i)=>{i.d(e,{c:()=>h,d:()=>l});var a=i(35143),n=i(24648),o=i(46053),s=i(85842),r=i(73697);let l=class extends r.w{constructor(t){super(t),this.type="extent-rotate",this.angle=0}};(0,a._)([(0,o.MZ)()],l.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],l.prototype,"angle",void 0),l=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],l);let h=class extends r.w{constructor(t){super(t),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=n.r7,this.ySize=n.r7}};(0,a._)([(0,o.MZ)()],h.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],h.prototype,"xScale",void 0),(0,a._)([(0,o.MZ)()],h.prototype,"yScale",void 0),(0,a._)([(0,o.MZ)()],h.prototype,"xSize",void 0),(0,a._)([(0,o.MZ)()],h.prototype,"ySize",void 0),h=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],h)},72236:(t,e,i)=>{i.d(e,{JH:()=>d,YI:()=>h,ar:()=>l,nW:()=>p,un:()=>c,y3:()=>u});var a=i(35143),n=i(24648),o=i(46053),s=i(85842),r=i(73697);let l=class extends r.w{constructor(t){super(t),this.type="translate-graphic",this.distance=n.r7}clear(){this.distance=n.r7}};(0,a._)([(0,o.MZ)()],l.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],l.prototype,"distance",void 0),l=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],l);let h=class extends r.w{constructor(t){super(t),this.type="translate-graphic-z",this.distance=n.r7}clear(){this.distance=n.r7}};(0,a._)([(0,o.MZ)()],h.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],h.prototype,"distance",void 0),h=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],h);let p=class extends r.w{constructor(t){super(t),this.type="translate-graphic-xy",this.distance=n.r7}};(0,a._)([(0,o.MZ)()],p.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],p.prototype,"distance",void 0),p=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],p);let c=class extends r.w{constructor(t){super(t),this.type="translate-vertex",this.distance=n.r7,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=n.r7,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,o.MZ)()],c.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],c.prototype,"distance",void 0),(0,a._)([(0,o.MZ)()],c.prototype,"elevation",void 0),(0,a._)([(0,o.MZ)()],c.prototype,"area",void 0),(0,a._)([(0,o.MZ)()],c.prototype,"totalLength",void 0),c=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],c);let u=class extends r.w{constructor(t){super(t),this.type="translate-vertex-z",this.distance=n.r7,this.elevation=null}clear(){this.distance=n.r7,this.elevation=null}};(0,a._)([(0,o.MZ)()],u.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"distance",void 0),(0,a._)([(0,o.MZ)()],u.prototype,"elevation",void 0),u=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],u);let d=class extends r.w{constructor(t){super(t),this.type="translate-vertex-xy",this.distance=n.r7,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=n.r7,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,o.MZ)()],d.prototype,"type",void 0),(0,a._)([(0,o.MZ)()],d.prototype,"distance",void 0),(0,a._)([(0,o.MZ)()],d.prototype,"elevation",void 0),(0,a._)([(0,o.MZ)()],d.prototype,"area",void 0),(0,a._)([(0,o.MZ)()],d.prototype,"totalLength",void 0),d=(0,a._)([(0,s.$)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],d)},28048:(t,e,i)=>{i.d(e,{A:()=>d});var a=i(35143),n=i(69539),o=i(91967),s=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),l=(i(27347),i(10760));i(48396);const h={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let p=class extends o.A{get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get _textShadowColor(){const{textColor:t,backgroundColor:e}=this,i=e.clone();return i.a*=t.a,i}get _textShadow(){const t=this._textShadowColor.toCss(!0);return"0 0 ".concat(this._textShadowSize,"px ").concat(t)}get padding(){return.5*this.fontSize}get _borderRadius(){return this.padding}constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new n.A([0,0,0,.6]),this.textColor=new n.A([255,255,255]),this._textShadowSize=1}render(){return(0,l.h)("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(t){if(!this.visible)return;const e=t.font.replace(/^(.*?)px/,"");t.font="".concat(this.fontSize,"px ").concat(e);const i=this.padding,a=this._borderRadius,n=t.measureText(this.text).width,o=this.fontSize,s=c[this.anchor];t.textAlign="center",t.textBaseline="middle";const r=n+2*i,l=o+2*i,h=this.x+s.x*r,p=this.y+s.y*l;this._roundedRect(t,h,p,r,l,a),t.fillStyle=this.backgroundColor.toCss(!0),t.fill();const u=this.x+(s.x+.5)*r,d=this.y+(s.y+.5)*l;this._renderTextShadow(t,this.text,u,d),t.fillStyle=this.textColor.toCss(!0),t.fillText(this.text,u,d)}_renderTextShadow(t,e,i,a){t.lineJoin="miter",t.fillStyle="rgba(".concat(this._textShadowColor.r,", ").concat(this._textShadowColor.g,", ").concat(this._textShadowColor.b,", ").concat(1/u.length,")");const n=this._textShadowSize;for(const[o,s]of u)t.fillText(e,i+n*o,a+n*s)}_roundedRect(t,e,i,a,n,o){t.beginPath(),t.moveTo(e,i+o),t.arcTo(e,i,e+o,i,o),t.lineTo(e+a-o,i),t.arcTo(e+a,i,e+a,i+o,o),t.lineTo(e+a,i+n-o),t.arcTo(e+a,i+n,e+a-o,i+n,o),t.lineTo(e+o,i+n),t.arcTo(e,i+n,e,i+n-o,o),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};let e;for(e in h)t[h[e]]=this.anchor===e;return t}};(0,a._)([(0,s.MZ)()],p.prototype,"x",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"y",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"position",null),(0,a._)([(0,s.MZ)()],p.prototype,"text",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"fontSize",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"anchor",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"visible",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"isDecoration",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"backgroundColor",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"textColor",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"_textShadowSize",void 0),(0,a._)([(0,s.MZ)()],p.prototype,"_textShadowColor",null),(0,a._)([(0,s.MZ)()],p.prototype,"_textShadow",null),(0,a._)([(0,s.MZ)()],p.prototype,"padding",null),(0,a._)([(0,s.MZ)()],p.prototype,"_borderRadius",null),p=(0,a._)([(0,r.$)("esri.views.overlay.TextOverlayItem")],p);const c={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},u=[];{const t=16;for(let e=0;e<360;e+=360/t)u.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}const d=p},31116:(t,e,i)=>{i.d(e,{b:()=>o});var a=i(24648),n=i(68655);function o(t){let{topLeft:e,topRight:i,bottomRight:o,bottomLeft:s,spatialReference:r}=t;const l=(0,a.T9)((0,n.Do)(s,o,r),(0,n.Do)(e,i,r));if(null==l)return null;const h=(0,a.T9)((0,n.Do)(o,i,r),(0,n.Do)(s,e,r));return null==h?null:{xSize:l,ySize:h}}}}]);
//# sourceMappingURL=26088.1b6b0352.chunk.js.map